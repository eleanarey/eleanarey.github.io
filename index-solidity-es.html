

<!DOCTYPE html>
<!--[if gt IE 8]><!--> 
<html lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Solidity 0.4.17 Documentacion en Español</title>
 
 
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="None" href="index.html#document-index"/> 

  
  <script src="_static/js/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!--Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html-->

<link rel="canonical" href="http://solidity.readthedocs.io/en/develop/" />




<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />



<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'index'
</script>


<script type="text/javascript" src="_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> -->




<style>
/* Left for CSS overrides we need to make in the future */

/* Fix badge on RTD Theme */

/* Please keep RTD badge displayed on your site */
.rst-versions.rst-badge {
    display: block;
}

.rst-other-versions {
	text-align: left;
}

.rst-other-versions a {
	border: 0;
}

.rst-other-versions dl {
	margin: 0;
}


/* Fix RTD theme bottom margin */
.rst-content .line-block {
	margin-bottom: 24px
}

/* Fix for nav bottom padding with flyout */
nav.wy-nav-side {
    padding-bottom: 3em;
}

/* bookmark icon */
.bookmark-added-msg {display: none;}
.bookmark-active {display: none;}
.bookmark-inactive {display: none;}


/* Read the Docs promotional block, only applicable to RTD.org

To support sphinx_rtd_theme, a `wy-menu` element is added. Other themes are
targeted using the theme identifier and use custom elements instead of a CSS
framework html structure.

div.rst-pro is deprecated in favor of div.rtd-pro here, though we still need
both rules for historical docs.
*/

div.rtd-pro,
div.rst-pro {
    display: block;
    padding: .5em;
    margin: 1em 0em 1em 0em;
    text-align: center;
}
div.rtd-pro.wy-menu,
div.rtd-pro.wy-menu {
    width: 300px;
}
div.rtd-pro.alabaster {
    width: 100%;
    box-sizing: border-box;
}

div.rtd-pro.wy-menu,
div.rst-pro.wy-menu {
    bottom: 60px;
    background: rgba(0, 0, 0, .06);
}

div.rtd-pro.alabaster {
    background: rgba(220, 220, 220, .1);
}

div.rtd-pro > span,
div.rst-pro > span {
    display: block;
    font-size: 90%;
}

div.rtd-pro.wy-menu > span,
div.rst-pro.wy-menu > span {
    color: #838383;
}

div.rtd-pro.wy-menu a,
div.rtd-pro.wy-menu a:link,
div.rtd-pro.wy-menu a:visited,
div.rst-pro.wy-menu a,
div.rst-pro.wy-menu a:link,
div.rst-pro.wy-menu a:visited { color: #b3b3b3; }

div.rtd-pro.wy-menu a:hover,
div.rtd-pro.wy-menu a:active,
div.rst-pro.wy-menu a:hover,
div.rst-pro.wy-menu a:active { color: #c3c3c3; }

div.rtd-pro a.rtd-pro-image-wrapper {
    display: inline-block;
    padding: 6px;
    margin: 5px 0px 10px 0px;
    border: 1px solid #434343;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
}

div.rtd-pro.wy-menu a.rtd-pro-image-wrapper,
div.rst-pro.wy-menu a.rst-pro-image-wrapper {
    border-color: #434343;
}

div.rtd-pro.alabaster a.rtd-pro-image-wrapper {
    border-color: #d3d3d3;
}

div.rtd-pro img,
div.rst-pro.wy-menu img {
    width: 120px;
    height: 90px;
}

div.rtd-pro div.rtd-pro-about {
    float: right;
    text-align: right;
    font-size: 90%;
}
div.rtd-pro.wy-menu div.rtd-pro-about,
div.rst-pro.wy-menu div.rst-pro-about {
    color: white;
}

div.rtd-pro.alabaster div.rtd-pro-about a {
    border-bottom: 0px;
}

div.rtd-pro.alabaster div.rtd-pro-about i.fa-info-circle:before {
    content: "ïš";
    color: #a3a3a3;
}

@media (max-width: 768px) {
    div.rst-pro.wy-menu {
        display: none;
    }

    div.rtd-pro.alabaster {
        background: rgba(220, 220, 220, .05);
    }

    div.rtd-pro.alabaster a.rtd-pro-image-wrapper {
        border-color: #656565;
    }
}
</style>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> Solidity
          

          
          </a>

          
            
            
            
              <div class="version">
                develop
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc">

<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-introduction-to-smart-contracts">Introduccion a los Contratos Inteligentes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#a-simple-smart-contract">Un Contrato Inteligente Sencillo</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#blockchain-basics">Lo Básico de Blockchain</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#index-6">La Maquina Virtual de Ethereum(EVM)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installing-solidity">Instalación de Solidity</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#versioning">Versiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#remix">Remix</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#npm-node-js">npm / Node.js</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#binary-packages">Paquetes Binarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#buil`ing-from-source">Construyendo desde la Fuente</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#cmake-options">Opciones de CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-version-string-in-detail">La Cadena de Versión en Detalle</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#important-information-about-versioning">Información Importante acerca de Versiones</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-solidity-by-example">Ejemplos de Código Solidity</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#voting">Votación</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#blind-auction">Subasta a Ciegas</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#safe-remote-purchase">Compra Remota Segura</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#micropayment-channel">Canal de Micropagos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-solidity-in-depth">Solidity en Profundidad</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-layout-of-source-files">Diseño de un Archivo Fuente Solidity</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-structure-of-a-contract">Estructura de una Contrato</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-types">Tipos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-units-and-global-variables">Unidades y Variables Globales Disponibles</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-control-structures">Expresiones y Estructuras de Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contracts">Contratos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-assembly">El Ensamblado de Solidity</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-miscellaneous">Misceláneos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-security-considerations">Consideraciones de seguridad</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#pitfalls">Trampas</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#recommendations">Recommendaciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#formal-verification">Verificación Formal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-using-the-compiler">Uso del compilador</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-the-commandline-compiler">Utilización del Compilador de la linea de Comandos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#compiler-input-and-output-json-description">Descripcion del Compilador de Entrada y Salida JSON</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-abi-spec">Especificacion de la Interfaz Binaria de la Aplicación</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-design">Diseño Básico</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#function-selector">Selector de Funciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#argument-encoding">Argumentos Codificación</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#types">Tipos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#formal-specification-of-the-encoding">Especificación Formal de la Codificación</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#function-selector-and-argument-encoding">Selector de Funciones y Codificación de Argumentos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#examples">Ejemplos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#use-of-dynamic-types">Uso de Tipos Dinámicos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#events">Eventos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#json">JSON</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-style-guide">Guía de Estilos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#introduction">Introducción</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-layout">Diseño del Código</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#naming-conventions">Convenciones de Nomenclatura</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-common-patterns">Patrones Comunes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#withdrawal-from-contracts">Contratos de Retiro</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#restricting-access">Acceso Restringido</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#state-machine">Máquina Estatal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-bugs">Lista de Errores Conocidos</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-contributing">Contribuir</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-to-report-issues">Cómo Reportar Problemas</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#workflow-for-pull-requests">Flujo de Trabajo para Solicitudes de Extracción (Pull Requests)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-the-compiler-tests">Ejecución de las Pruebas del Compilador</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#whiskers">Whiskers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-frequently-asked-questions">Preguntas Frecuentes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-questions">Preguntas Básicas</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-questions">Preguntas Avanzadas</a></li>
</ul>
</li>
</ul>

</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">Solidity</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>Solidity 0.4.17 documentación</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/ethereum/solidity/blob/develop/docs/index.rst" class="fa fa-github"> Editar en GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="solidity">
<h1>Solidity<a class="headerlink" href="#solidity" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="_images/logo.svg"><div align="center" class="align-center"><img alt="Solidity logo" src="_images/logo.svg" width="120px" /></div>
</a>
<p>Solidity es un lenguaje orientado a Contratos, de alto nivel, cuya sintaxis es similar a la de 
JavaScript y está diseñada para orientarse a la Máquina Virtual Ethereum (EVM).</p>
<p>Solidity está tipificado estáticamente, admite herencia, bibliotecas y tipos definidos por el usuario complejos entre otras características.</p>
<p>Como verá, es posible crear contratos para la votación, crowdfunding, subastas ciegas, carteras multi-firma y más.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La mejor manera de probar Solidity ahora es usando
<a class="reference external" href="https://remix.ethereum.org/">Remix</a>
(puede tardar un tiempo en cargar, por favor, tenga paciencia).</p>
</div>

<div class="section" id="useful-links">
<h2>Enlaces Útiles<a class="headerlink" href="#useful-links" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://ethereum.org">Ethereum</a></li>
<li><a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/Changelog.md">Registro de Cambios</a></li>
<li><a class="reference external" href="https://www.pivotaltracker.com/n/projects/1189488">Story Backlog</a></li>
<li><a class="reference external" href="https://github.com/ethereum/solidity/">Código Fuente</a></li>
<li><a class="reference external" href="https://ethereum.stackexchange.com/">Ethereum Intercambio de Pilas</a></li>
<li><a class="reference external" href="https://gitter.im/ethereum/solidity/">Gitter Chat</a></li>
</ul>
</div>

<div class="section" id="available-solidity-integrations">
<h2>Integraciones de Solidity disponibles<a class="headerlink" href="#available-solidity-integrations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://remix.ethereum.org/">Remix</a></dt>
<dd>IDE basado en el navegador con compilador integrado y entorno de ejecución de Solidity sin componentes del lado del servidor.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://plugins.jetbrains.com/plugin/9475-intellij-solidity">Plugin IntelliJ IDEA</a></dt>
<dd>Solidity plugin para IntelliJ IDEA (y todos los demás IDEs de JetBrains)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://visualstudiogallery.msdn.microsoft.com/96221853-33c4-4531-bdd5-d2ea5acc4799/">Extensión de Visual Studio</a></dt>
<dd>Solidity plugin para Microsoft Visual Studio que incluye el compilador Solidity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://packagecontrol.io/packages/Ethereum/">Package for SublimeText - Sintaxis del lenguaje de Solidity</a></dt>
<dd>Destacado de la sintaxis de Solidity para el editor SublimeText.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/0mkara/etheratom">Etheratom</a></dt>
<dd>Plugin para el editor de Atom que cuenta con resaltado de sintaxis, compilación y un entorno de tiempo de ejecución (nodo Backend &amp; VM compatible).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://atom.io/packages/linter-solidity">Atom Solidity Linter</a></dt>
<dd>Plugin para el editor de Atom que proporciona linting de Solidity..</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://atom.io/packages/linter-solium">Atom Solium Linter</a></dt>
<dd>Ultimo de Solidty configurable para Atom usando Solium como base.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/duaraghav8/Solium/">Solium</a></dt>
<dd>Un linter de línea de comandos para Solidity que sigue estrictamente las reglas prescritas por la <a class="reference external" href="http://solidity.readthedocs.io/en/latest/style-guide.html">Guía de Estilo de Solidity.</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="http://juan.blanco.ws/solidity-contracts-in-visual-studio-code/">Extensión de Visual Studio Code</a></dt>
<dd>Solidity plugin para Microsoft Visual Studio Code que incluye resaltado de sintaxis y el compilador Solidity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ethereum/emacs-solidity/">Emacs Solidity</a></dt>
<dd>Plugin para el editor de Emacs que proporciona resaltado de sintaxis y reportes de errores de compilación.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/tomlion/vim-solidity/">Vim Solidity</a></dt>
<dd>Plugin para el editor de Vim que proporciona resaltado de sintaxis.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/scrooloose/syntastic">Vim Syntastic</a></dt>
<dd>Plugin para el editor de Vim que proporciona comprobación de compilación.</dd>
</dl>
</li>
</ul>
<p>Interrumpido:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ethereum/mix/">Mix IDE</a></dt>
<dd>IDE basado en Qt para diseñar, depurar y probar contratos sólidos de inteligencia.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://live.ether.camp/">Ethereum Studio</a></dt>
<dd>IDE web especializado que también proporciona acceso a shell a un entorno Ethereum completo.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="solidity-tools">
<h2>Herramientas de Solidity<a class="headerlink" href="#solidity-tools" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://dapp.readthedocs.io">Dapp</a></dt>
<dd>Herramienta de creación, gestor de paquetes y asistente de despliegue de Solidity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/raineorshine/solidity-repl">Solidity REPL</a></dt>
<dd>Intente Solidity de forma instantánea con una consola Solidity de línea de comandos.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/raineorshine/solgraph">solgraph</a></dt>
<dd>Visualice el flujo de control de Solidity y resalte posibles vulnerabilidades de seguridad.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/Arachnid/evmdis">evmdis</a></dt>
<dd>EVM Disassembler que realiza análisis estáticos en el bytecode para proporcionar un nivel de abstracción más alto que las operaciones raw de EVM.
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/DigixGlobal/doxity">Doxity</a></dt>
<dd>Generador de documentación para Solidity.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="third-party-solidity-parsers-and-grammars">
<h2>Analizadores de Solidity de Terceros y Gramática<a class="headerlink" href="#third-party-solidity-parsers-and-grammars" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ConsenSys/solidity-parser">solidity-analista</a></dt>
<dd>Analista de Solidity para JavaScript</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/federicobond/solidity-antlr4">Gramática de Solidity para ANTLR 4</a></dt>
<dd>Gramática de solidity para el generador analista ANTLR 4</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="language-documentation">
<h2>Documentación del Lenguaje de Programacion Solidity<a class="headerlink" href="#language-documentation" title="Permalink to this headline">¶</a></h2>
<p>En las páginas siguientes, veremos primero un <a class="reference internal" href="index.html#simple-smart-contract"><span class="std std-ref">contrato inteligente simple</span></a> escrito
 en Solidity seguido de los conceptos básicos sobre <a class="reference internal" href="index.html#blockchain-basics"><span class="std std-ref">blockchains</span></a>
y la <a class="reference internal" href="index.html#the-ethereum-virtual-machine"><span class="std std-ref">máquina virtual Ethereum.</span></a>.</p>
<p>La siguiente sección explicará varias <em>características </em> de Solidity dando útiles
<a class="reference internal" href="index.html#voting"><span class="std std-ref">ejemplos de contratos</span></a>
Recuerde que siempre puede probar los contratos <a class="reference external" href="https://remix.ethereum.org">en su navegador </a>!</p>
<p>La última y más extensa sección cubrirá todos los aspectos de la Solidity en profundidad.</p>
<p>Si aún tiene preguntas, puede intentar buscar o preguntar en el sitio 
<a class="reference external" href="https://ethereum.stackexchange.com/">Ethereum Stackexchange</a>
, o visitar nuestro <a class="reference external" href="https://gitter.im/ethereum/solidity/">canal gitter </a>.
 Ideas para mejorar la solidity o esta documentación son siempre bienvenidas!</p>
<p>Véase también <a class="reference external" href="https://github.com/ethereum/wiki/wiki/%5BRussian%5D-%D0%A0%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE-%D0%BF%D0%BE-Solidity">la versión en ruso (русский перевод) .</a>.</p>
</div>
</div> 
<div class="section" id="contents">
<h1>Contenido<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="genindex.html"><span class="std std-ref">Índice de palabras clave</span></a>, <a class="reference internal" href="search.html"><span class="std std-ref">Página de búsqueda</span></a></p>
<div class="toctree-wrapper compound">
<span id="document-introduction-to-smart-contracts"></span><div class="section" id="introduction-to-smart-contracts">
<h2>Introducción a los contratos inteligentes<a class="headerlink" href="#introduction-to-smart-contracts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-simple-smart-contract">
<span id="simple-smart-contract"></span><h3>Un simple contrato inteligente<a class="headerlink" href="#a-simple-smart-contract" title="Permalink to this headline">¶</a></h3>
<p>Comencemos con el ejemplo más básico. Está bien si no entiendes todo en este momento, entraremos en más detalles más adelante.</p>
<div class="section" id="storage">
<h4>Almacenamiento<a class="headerlink" href="#storage" title="Permalink to this headline">¶</a></h4>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SimpleStorage</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">storedData</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">set</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">storedData</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">get</span><span class="p">()</span> <span class="k">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">storedData</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La primera línea indica simplemente que el código fuente está escrito
 para Solidity versión 0.4.0 o cualquier cosa más nueva que no rompa la funcionalidad 
 (hasta, pero no incluyendo, la versión 0.5.0). Esto es para asegurarse de que el contrato no se
 comporta repentinamente de manera diferente con una nueva versión del compilador. La palabra clave 
 pragma se llama así porque, en general, los pragmas son instrucciones para el compilador sobre 
 cómo tratar el código fuente (por ejemplo, <a class="reference external" href="https://en.wikipedia.org/wiki/Pragma_once">pragma una vez</a>).</p>
 <p>Un contrato en el sentido de Solidity es una colección de código (sus <em>funcciones</em>) y
 datos (su <em>estado</em>) que reside en una dirección específica en la cadena de bloques Ethereum.
 La línea <code class="docutils literal"><span class="pre">uint</span> <span class="pre">storedData;</span></code>
 declara una variable de estado llamada <code class="docutils literal"><span class="pre">storedData</span></code> de tipo 
 <code class="docutils literal"><span class="pre">uint</span></code>(entero sin signo de 256 bits).
 Se puede pensar en ella como una sola ranura en una base de datos que puede ser consultada y alterada por las funciones de llamada del código 
 que gestiona la base de datos. En el caso de Ethereum, éste es siempre el contrato propietario.  
 Y en este caso, las funciones <code class="docutils literal"><span class="pre">set</span></code> y <code class="docutils literal"><span class="pre">get</span>
 </code> se pueden utilizar para modificar o recuperar el valor de la variable.</p>
<p>Para acceder a una variable de estado, no necesitas el prefijo <code class="docutils literal"><span class="pre">this.</span></code> 
como es común en otros lenguajess.</p>
<p>Este contrato no hace mucho todavía (debido a la infraestructura construida por Ethereum) aparte de permitir que cualquier persona almacene un solo número
 que sea accesible por cualquier persona en el mundo sin una manera (posible) de prevenirle publicar este número. 
 Por supuesto, cualquier persona podría apenas llamar <code class="docutils literal"><span class="pre">set</span></code> otra vez con un valor diferente
 y sobrescribir su número, pero el número todavía será almacenado en la historia de la cadena de bloque. Más adelante, veremos cómo puede imponer restricciones
 de acceso para que solo usted pueda alterar el número.</p>
</div>
<div class="section" id="subcurrency-example">
<span id="index-0"></span><h4>Ejemplo de subcuenta<a class="headerlink" href="#subcurrency-example" title="Permalink to this headline">¶</a></h4>
<p>El siguiente contrato implementará la forma más simple de una criptomoneda. Es posible generar monedas fuera del aire, 
pero sólo la persona que creó el contrato será capaz de hacer eso (es trivial implementar un esquema de emisión diferente). 
Además, cualquier persona puede enviar monedas entre sí sin necesidad de registrarse con nombre de usuario y contraseña 
- todo lo que necesita es un par de comandos en Ethereum.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Coin</span> <span class="p">{</span>
    <span class="c1">// The keyword &quot;public&quot; makes those variables</span>
    <span class="c1">// readable from outside.</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">minter</span><span class="p">;</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="nx">balances</span><span class="p">;</span>

    <span class="c1">// Events allow light clients to react on</span>
    <span class="c1">// changes efficiently.</span>
    <span class="kd">event</span> <span class="nx">Sent</span><span class="p">(</span><span class="kt">address</span> <span class="nx">from</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>

    <span class="c1">// This is the constructor whose code is</span>
    <span class="c1">// run only when the contract is created.</span>
    <span class="kd">function</span> <span class="nx">Coin</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">minter</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">mint</span><span class="p">(</span><span class="kt">address</span> <span class="nx">receiver</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">minter</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">balances</span><span class="p">[</span><span class="nx">receiver</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">send</span><span class="p">(</span><span class="kt">address</span> <span class="nx">receiver</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">amount</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">amount</span><span class="p">;</span>
        <span class="nx">balances</span><span class="p">[</span><span class="nx">receiver</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">amount</span><span class="p">;</span>
        <span class="nx">Sent</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">,</span> <span class="nx">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Este contrato introduce algunos nuevos conceptos, vamos a pasar por ellos uno por uno.</p>
<p>La Linea <code class="docutils literal"><span class="pre">address</span> <span class="pre">public</span> <span class="pre">minter;</span></code> 
declara una variable de estado de tipo address que es accesible al público. El <code class="docutils literal"><span class="pre">address</span></code> 
tipo es un valor de 160 bits que no permite operaciones aritméticas. Es adecuado para almacenar direcciones de contratos o de teclas pertenecientes a personas externas.
 La palabra clave <code class="docutils literal"><span class="pre">public</span></code> genera automáticamente una función que
le permite acceder al valor actual de la variable de estado. Sin esta palabra clave, otros contratos no tienen forma de acceder a la variable.
  La función se verá así:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">minter</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">minter</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Por supuesto, la adición de una función exactamente como esa no funcionará porque tendríamos una función y una variable de estado con el mismo nombre,
 pero esperemos que se obtenga la idea - de la salida de datos del compilador.</p>
<p id="index-1">La línea siguiente, <code class="docutils literal"><span class="pre">mapping</span> <span class="pre">(address</span> 
<span class="pre">=&gt;</span> <span class="pre">uint)</span> <span class="pre">public</span> <span class="pre">balances;</span></code>
también crea una variable de estado público, pero es un tipo de datos más complejo. El tipo asigna direcciones a enteros sin signo.
 Las asignaciones se pueden ver como <a class="reference external" href="https://en.wikipedia.org/wiki/Hash_table">tablas de hash </a>
que son prácticamente inicializadas de tal manera que cada clave posible existe y se asigna a un valor cuya representación de bytes es todos ceros.
 Esta analogía no va demasiado lejos, sin embargo, ya que no es posible obtener una lista de todas las claves de un mapeo, ni una lista de todos los valores. 
 Por lo tanto, tengalo en cuenta (o mejor, guarde una lista o utilice un tipo de datos más avanzado)
 donde agregue la asignación o utilícelo en un contexto en el que no sea necesario, como éste.
 La <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">funcion getter </span></a> creada por la palabra clave
<code class="docutils literal"><span class="pre">public</span></code> es un poco más compleja en este caso. Se parece aproximadamente a lo siguiente: </p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">balances</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_account</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">balances</span><span class="p">[</span><span class="nx">_account</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Como puede ver, puede utilizar esta función para consultar fácilmente el saldo de una sola cuenta.</p>
<p id="index-2">La línea <code class="docutils literal"><span class="pre">event</span> <span class="pre">Sent(address</span> <span class="pre">from,</span> 
<span class="pre">address</span> <span class="pre">to,</span> <span class="pre">uint</span> <span class="pre">amount);</span></code>
 declara un llamado &#8220;evento&#8221; que se dispara en la última línea de la función. <code class="docutils literal"><span class="pre">send</span></code>.
 Interfaces de usuario (así como aplicaciones de servidor, por supuesto) puede escuchar los eventos que se disparó en la cadena de bloque sin mucho costo.
 Tan pronto como se dispara, el oyente también recibirá los argumentos,
<code class="docutils literal"><span class="pre">from</span></code>, <code class="docutils literal"><span class="pre">to</span></code> y 
<code class="docutils literal"><span class="pre">amount</span></code>, lo que hace que sea fácil de realizar un seguimiento de las transacciones.
 Para escuchar este evento, usted usaría:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">Coin</span><span class="p">.</span><span class="nx">Sent</span><span class="p">().</span><span class="nx">watch</span><span class="p">({},</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Coin transfer: &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">amount</span> <span class="o">+</span>
            <span class="s2">&quot; coins were sent from &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">from</span> <span class="o">+</span>
            <span class="s2">&quot; to &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">to</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Balances now:\n&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;Sender: &quot;</span> <span class="o">+</span> <span class="nx">Coin</span><span class="p">.</span><span class="nx">balances</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">from</span><span class="p">)</span> <span class="o">+</span>
            <span class="s2">&quot;Receiver: &quot;</span> <span class="o">+</span> <span class="nx">Coin</span><span class="p">.</span><span class="nx">balances</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">to</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Observe cómo la función automaticamente generada <code class="docutils literal"><span class="pre">balances
</span></code> es llamada desde la interfaz de usuario.</p>
<p id="index-3">La función especial <code class="docutils literal"><span class="pre">Coin</span></code>
 es el constructor que se ejecuta durante la creación del contrato y no se puede llamar 
 después. Almacena permanentemente la dirección de la persona que crea el contrato: 
<code class="docutils literal"><span class="pre">msg</span></code> 
(junto con <code class="docutils literal"><span class="pre">tx</span></code> y 
<code class="docutils literal"><span class="pre">block</span></code>) 
 son una variable global mágica que contiene algunas propiedades que permiten el acceso a la Blockchain.
<code class="docutils literal"><span class="pre">msg.sender</span></code> 
 Es siempre la dirección de donde proviene la llamada de la función (externa) actual.</p>
<p>Finalmente, las funciones que en realidad terminan con el contrato y pueden ser llamadas por 
usuarios y contratos por igual son <code class="docutils literal"><span class="pre">mint</span></code>
 y <code class="docutils literal"><span class="pre">send</span></code>.
 Si <code class="docutils literal"><span class="pre">mint</span></code> es llamado por cualquier persona excepto
 la cuenta que creó el contrato, nada sucederá. Por otro lado,
 <code class="docutils literal"><span class="pre">send</span></code> 
 puede ser utilizado por cualquier persona (que ya tiene algunas de estas monedas) 
 para enviar monedas a cualquier otra persona. Tenga en cuenta que si utiliza este contrato para 
 enviar monedas a una dirección, no verá nada cuando mire esa dirección en un explorador de
 blockchain, por el hecho de que haya enviado monedas y los saldos modificados sólo se almacenan 
 en el almacenamiento de datos de este Contrato de monedas en particular.
 Mediante el uso de eventos es relativamente fácil crear un &#8220;explorador blockchain &#8221; 
 que realiza un seguimiento de transacciones y saldos de su nueva moneda.
</p>
</div>
</div>
<div class="section" id="blockchain-basics">
<span id="id1"></span><h3>Fundamentos de Blockchain<a class="headerlink" href="#blockchain-basics" title="Permalink to this headline">¶</a></h3>
<p>Blockchains como un concepto no son demasiado difíciles de entender para los programadores. La razón es que la mayoría de las complicaciones 
(minería, <a class="reference external" href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">hashing</a>,
 <a class="reference external" href="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography">criptografía de curva elíptica</a>, 
 <a class="reference external" href="https://en.wikipedia.org/wiki/Peer-to-peer"> redes peer-to-peer </a>, etc.)
 están ahí para proporcionar un cierto conjunto de características y promesas. Una vez que acepta estas características tal y como están dadas, 
 no tiene que preocuparse por la tecnología subyacente, o ¿tiene que saber cómo funciona AWS de Amazon internamente para usarlo?</p>
<div class="section" id="transactions">
<span id="index-4"></span><h4>Transacciones<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h4>
<p>Una cadena de bloques es una base de datos transaccional globalmente compartida. 
Esto significa que todos pueden leer entradas en la base de datos simplemente participando en la red. 
Si desea cambiar algo en la base de datos, tiene que crear una llamada transacción que debe ser aceptada por todos los demás. 
La palabra transacción implica que el cambio que usted quiere hacer (asume que usted quiere cambiar dos valores al mismo tiempo) 
no se hace en absoluto o se aplica totalmente. Además, mientras la transacción se aplica a la base de datos, ninguna otra transacción puede alterarla.</p>
<p>Por ejemplo, imagine una tabla que enumera los saldos de todas las cuentas en una moneda electrónica. 
Si se solicita una transferencia de una cuenta a otra, la naturaleza transaccional de la base de datos garantiza
 que si se resta la cantidad de una cuenta, siempre se agrega a la otra. Si debido a cualquier motivo, 
 agregar la cantidad a la cuenta de destino no es posible, la cuenta de origen tampoco se modifica.</p>
<p>Además, una transacción siempre es criptograficamente firmada por el remitente (creador). 
Esto hace que sea sencillo proteger el acceso a modificaciones específicas de la base de datos. 
En el ejemplo de la criptomoneda, un simple cheque asegura que sólo la persona que tiene las llaves de la cuenta puede transferir dinero de ella.</p>
</div>
<div class="section" id="blocks">
<span id="index-5"></span><h4>Bloques<a class="headerlink" href="#blocks" title="Permalink to this headline">¶</a></h4>
<p>Un obstáculo importante para superar es lo que, en términos de Bitcoin, se llama un &#8220;double-spend attack&#8221;(ataque de doble gasto):
¿Qué sucede si dos transacciones existen en la red que ambos quieren vaciar una cuenta, un llamado conflicto?</p>
<p>La respuesta abstracta a esto es que usted no tiene que preocuparse. Una orden de las transacciones será seleccionada para usted, 
las transacciones serán agrupadas en lo que se llama un "bloque" y luego serán ejecutadas y distribuidas entre todos los nodos participantes. 
Si dos transacciones se contradicen, la que termina siendo segunda será rechazada y no pasará a formar parte del bloque.</p>
<p>Estos bloques forman una secuencia lineal en el tiempo y es ahí donde deriva la palabra &#8220;blockchain&#8221;
Los bloques se añaden a la cadena en intervalos regulares - para Ethereum esto es aproximadamente cada 17 segundos.</p>

<p>Como parte del &#8220;mecanismo de seleccion de ordenes&#8221; (como se le llama en &#8220;mineria&#8221;) 
puede suceder que los bloques se reviertan de vez en cuando, pero solo en la &#8220;punta&#8221; de la cadena. 
Por lo tanto, puede ser que sus transacciones sean revertidas e incluso eliminadas de la cadena de bloqueo, pero cuanto más tiempo espere, menos probable será.</p>
<span class="target" id="the-ethereum-virtual-machine"></span></div>
</div>
<div class="section" id="index-6">
<span id="id2"></span><h3>La máquina virtual Ethereum<a class="headerlink" href="#index-6" title="Permalink to this headline">¶</a></h3>
<div class="section" id="overview">
<h4>Visión de conjunto<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>La Ethereum Virtual Machine o EVM es el entorno de ejecución para contratos inteligentes en Ethereum. 
No sólo esta encajonado sino que está totalmente aislado, lo que significa que el código que se ejecuta dentro del EVM no tiene acceso a red, 
sistema de archivos u otros procesos. Los contratos inteligentes incluso tienen acceso limitado a otros contratos inteligentes.</p>
</div>
<div class="section" id="accounts">
<span id="index-7"></span><h4>Cuentas<a class="headerlink" href="#accounts" title="Permalink to this headline">¶</a></h4>
<p>Existen dos tipos de cuentas en Ethereum que comparten el mismo espacio de direcciones: 
<strong>Cuentas Externas</strong> que son controladas por pares de claves público-privadas (es decir, seres humanos) y
<strong>Cuentas de contrato</strong> que están controladas por el código almacenado junto con la cuenta.</p>
<p>La dirección de una cuenta externa se determina a partir de la clave pública mientras que la dirección de un contrato 
se determina en el momento de la creación del contrato (se deriva de la dirección del creador y el número de transacciones 
enviadas desde esa dirección, &#8220;nonce&#8221;).</p>
<p>Independientemente de si la cuenta almacena o no el código, los dos tipos son tratados por igual por el EVM.</p>
<p>Cada cuenta tiene un almacén de valores clave persistente que asigna palabras de 256 bits a palabras de 256 bits llamadas <strong>storage</strong> (almacenamiento).</p>
<p>Además, cada cuenta tiene un <strong>balance</strong> en Ether (en &#8220;Wei&#8221; para ser exactos)
 que se puede modificar mediante el envío de transacciones que incluyen Ether.</p>
</div>
<div class="section" id="index-8">
<span id="id3"></span><h4>Transacciones<a class="headerlink" href="#index-8" title="Permalink to this headline">¶</a></h4>
<p>Una transacción es un mensaje que se envía desde una cuenta a otra cuenta 
(que podría ser la misma o la cuenta cero especial, véase más adelante). 
Puede incluir datos binarios (su carga útil) y Ether.</p>
<p>Si la cuenta de destino contiene código, ese código se ejecuta y la carga útil se proporciona como datos de entrada.</p>

<p>Si la cuenta de destino es la cuenta cero (la cuenta con la dirección <code class="docutils literal"><span class="pre">0</span></code>), 
la transacción crea un <strong>nuevo contrato</strong>. Como ya se ha mencionado, la dirección de ese contrato no es la dirección cero 
sino una dirección derivada del remitente y su número de transacciones enviadas (el &#8220;nonce&#8221;). 
La carga útil de dicha transacción de creación de contrato se toma 
como bytecode EVM y se ejecuta. La salida de esta ejecución se almacena permanentemente como el código del contrato. 
Esto significa que para crear un contrato, usted no envía el código real del contrato, pero en realidad el código devuelve ese código.</p>
</div>
<div class="section" id="gas">
<span id="index-9"></span><h4>Gas<a class="headerlink" href="#gas" title="Permalink to this headline">¶</a></h4>
<p>Al momento de la creación, cada transacción se carga con una cierta cantidad de <strong>gas</strong>,
cuyo propósito es limitar la cantidad de trabajo que se necesita para ejecutar la transacción y pagar por esta ejecución. 
 Mientras que el EVM ejecuta la transacción, el gas se agota gradualmente según reglas específicas.</p>
<p>El <strong>precio del gas</strong> es un valor establecido por el creador de la transacción, que tiene que pagar por adelantado 
<code class="docutils literal"><span class="pre">gas_price</span> <span class="pre">*</span> <span class="pre">gas</span></code> de la cuenta de envío. 
Si queda algo de gas después de la ejecución, se devuelve de la misma manera.</p>
<p>Si el gas se agota en cualquier punto (es decir, es negativo), se dispara una excepción de out-of-gas, 
que revierte todas las modificaciones hechas al estado en el marco de llamada actual.</p>
</div>
<div class="section" id="storage-memory-and-the-stack">
<span id="index-10"></span><h4>Almacenamiento, memoria y la pila<a class="headerlink" href="#storage-memory-and-the-stack" title="Permalink to this headline">¶</a></h4>
<p>Cada cuenta tiene un área de memoria persistente que se denomina <strong>storage</strong> (almacenamiento).
 El almacenamiento es un almacén de valores clave que asigna palabras de 256 bits a palabras de 256 bits. 
 No es posible enumerar el almacenamiento desde dentro de un contrato y es comparativamente costoso leer y aún más, modificar el almacenamiento. 
 Un contrato no puede leer ni escribir en ningún almacenamiento aparte de los suyos.</p>
<p>La segunda área de memoria se llama <strong>memory</strong>,  de la cual un contrato obtiene una instancia recién borrada para cada llamada de mensaje. 
 La memoria es lineal y puede ser dirigida a nivel de byte, pero las lecturas están limitadas a un ancho de 256 bits, 
 mientras que las escrituras pueden ser de 8 bits o 256 bits de ancho. La memoria se expande mediante una palabra (256 bits), 
 al acceder (ya sea a la lectura oa la escritura) una palabra de memoria previamente intacta (es decir, cualquier desplazamiento dentro de una palabra). 
 En el momento de la expansión, el costo en el gas debe ser pagado.  La memoria es más costosa cuanto más crece (escalas cuadráticas).</p>
<p>El EVM no es una máquina de registro, sino una máquina de pila, por lo que todos los cálculos se realizan en un área llamada <strong>stack</strong> (la pila). 
Tiene un tamaño máximo de 1024 elementos y contiene palabras de 256 bits. El acceso a la pila se limita al extremo superior de la siguiente manera: 
Es posible copiar uno de los 16 elementos superiores en la parte superior de la pila o intercambiar el elemento superior con uno de los 16 elementos debajo de él. 
Todas las demás operaciones toman los dos elementos superiores (o uno, o más, dependiendo de la operación) de la pila y empujan el resultado a la pila. 
Por supuesto, es posible mover elementos de pila a almacenamiento o memoria, pero no es posible acceder a elementos arbitrarios más profundos en la pila 
sin primero quitar la parte superior de la pila.</p>
</div>
<div class="section" id="instruction-set">
<span id="index-11"></span><h4>Conjunto de instrucciones<a class="headerlink" href="#instruction-set" title="Permalink to this headline">¶</a></h4>
<p>El conjunto de instrucciones del EVM se mantiene mínimo para evitar implementaciones incorrectas que podrían causar problemas de consenso. 
Todas las instrucciones funcionan con el tipo de datos básico, palabras de 256 bits. Están presentes las operaciones aritméticas, 
de bits, lógicas y de comparación habituales. Saltos condicionales e incondicionales son posibles. 
Además, los contratos pueden acceder a las propiedades relevantes del bloque actual como su número y marca de tiempo (timestamp).</p>
</div>
<div class="section" id="message-calls">
<span id="index-12"></span><h4>Message Calls<a class="headerlink" href="#message-calls" title="Permalink to this headline">¶</a></h4>
<p>Los contratos pueden llamar a otros contratos o enviar Ether a cuentas no contractuales por medio de Message Calls. 
Las llamadas de mensajes son similares a las transacciones, ya que tienen una fuente, un destino, datos útiles, datos de éter, de gas y de retorno.
 De hecho, cada transacción consiste en una llamada de mensaje de nivel superior que a su vez puede crear más llamadas de mensajes.</p>
<p> Un contrato puede decidir cuánto de su <strong>gas</strong> restante debe ser enviado con la llamada interna del mensaje y cuánto quiere retener. 
 Si se produce una excepción out-of-gas 
 en la llamada interna (o en cualquier otra excepción), 
 ésta será señalada por un valor de error puesto en la pila. 
 En este caso, sólo se gasta el gas enviado junto con la llamada. 
En Solidity, el contrato de llamada provoca una excepción manual por defecto en tales situaciones, de modo que las excepciones 
&#8220;bubble up&#8221; la pila de llamadas.</p>
<p>Como ya se ha dicho, el contrato llamado (que puede ser el mismo que el que llama) recibirá una instancia recién borrada de memoria y 
tendrá acceso a la carga útil de la llamada, que se proporcionará en un área separada llamada <strong>calldata</strong>.
Después de que haya terminado la ejecución, puede devolver datos que serán almacenados en una ubicación en la memoria de la llamada preasignada por la persona que llama.</p>
<p>Las llamadas están <strong>limited</strong> a una profundidad de 1024, lo que significa que para operaciones más complejas, los bucles deberían ser preferidos a las llamadas recursivas.</p>
</div>
<div class="section" id="delegatecall-callcode-and-libraries">
<span id="index-13"></span><h4>Delegatecall / Callcode and Libraries<a class="headerlink" href="#delegatecall-callcode-and-libraries" title="Permalink to this headline">¶</a></h4>
<p>Existe una variante especial de una llamada de mensaje, llamada <strong>delegatecall</strong>
que es idéntica a una llamada de mensaje aparte del hecho de que el código en la dirección de destino se ejecuta en el contexto del contrato de llamada y 
<code class="docutils literal"><span class="pre">msg.sender</span></code> y <code class="docutils literal"><span class="pre">msg.value</span></code> 
no cambian sus valores.</p>
<p>Esto significa que un contrato puede cargar dinámicamente código desde una dirección diferente en tiempo de ejecución. 
Almacenamiento, dirección actual y Balance todavía se refieren al contrato de llamada, sólo el código se toma de la dirección llamada.</p>
<p>Esto hace posible implementar la función &#8220;library&#8221; en Solidity:
El codigo reusable de library que se puede aplicar al almacenamiento de un contrato,
 por ejemplo para implementar una estructura de datos compleja.</p>
</div>
<div class="section" id="logs">
<span id="index-14"></span><h4>Logs (Registros)<a class="headerlink" href="#logs" title="Permalink to this headline">¶</a></h4>
<p>Es posible almacenar datos en una estructura de datos especialmente indexada que mapea todo el camino hasta el nivel de bloque. Esta característica llamada
<strong>logs</strong>
es utilizada por Solidity para implementar 
<strong>events</strong>.
Los contratos no pueden acceder a los datos de registro después de haber sido creados, 
pero se puede acceder de forma eficiente desde fuera de la Blockchain. 
Dado que una parte de los datos de registro se almacena en 
<a class="reference external" href="https://en.wikipedia.org/wiki/Bloom_filter">bloom filters</a>, 
es posible buscar estos datos de una manera eficiente y criptográficamente segura, 
por lo que los pares de la red que no descargan la blockchain completa 
(&#8220;light clients&#8221;) pueden encontrar estos registros .</p>
</div>
<div class="section" id="create">
<span id="index-15"></span><h4>Create<a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h4>
<p>Los contratos pueden incluso crear otros contratos utilizando un código de operación especial 
(es decir, no llaman simplemente a la dirección cero). La única diferencia entre estas 
<strong>create calls</strong> 
y las llamadas de mensajes normales es que los datos de carga útil se ejecutan y el resultado se almacena como código 
y el llamador / creador (caller / creator) recibe la dirección del nuevo contrato en la pila.</p>
</div>
<div class="section" id="self-destruct">
<span id="index-16"></span><h4>Self-destruct (Auto destrucción)<a class="headerlink" href="#self-destruct" title="Permalink to this headline">¶</a></h4>
<p>La única posibilidad de que el código se elimine de la blockchain es cuando un contrato en esa dirección realiza la operacion
<code class="docutils literal"><span class="pre">selfdestruct</span></code>.
El resto de Ether almacenado en esa dirección se envía a un destino designado y, a continuación, el almacenamiento y el código se quita del estado.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Incluso si el código de un contrato no contiene una llamada <code class="docutils literal"><span class="pre">selfdestruct</span></code>,
todavía puede realizar esa operación utilizando <code class="docutils literal"><span class="pre">delegatecall</span></code> o <code class="docutils literal"><span class="pre">callcode</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La poda de contratos antiguos puede o no ser implementada por los clientes de Ethereum. 
Además, los nodos de archivo podrían optar por mantener el almacenamiento de contrato y el código indefinidamente.
</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Actualmente,<strong>las cuentas externas</strong> no se pueden eliminar del estado.</p>
</div>
</div>
</div>
</div>
<span id="document-installing-solidity"></span><div class="section" id="installing-solidity">
<span id="index-0"></span><span id="id1"></span><h2>Instalación de Solidity<a class="headerlink" href="#installing-solidity" title="Permalink to this headline">¶</a></h2>
<div class="section" id="versioning">
<h3>Versiones<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h3>
<p>Las versiones de Solidity siguen el <a class="reference external" href="https://semver.org"> versionado semántico </a> 
y además de las versiones, también se ponen a disposición de <strong>nightly development builds</strong>(desarrollos nocturnos).  
 Las construcciones nocturnas no están garantizadas para trabajar y, a pesar de los mejores esfuerzos, pueden contener cambios indocumentados y / o rotos. 
 Recomendamos usar la última versión. Los instaladores de paquetes siguientes usarán la última versión.</p>
</div>
<div class="section" id="remix">
<h3>Remix<a class="headerlink" href="#remix" title="Permalink to this headline">¶</a></h3>
<p>Si sólo desea probar Solidity para pequeños contratos, puede probar
<a class="reference external" href="https://remix.ethereum.org/">Remix</a>
 que no necesita ninguna instalación. Si desea utilizarlo sin conexión a Internet, puede ir a
<a class="reference external" href="https://github.com/ethereum/browser-solidity/tree/gh-pages">https://github.com/ethereum/browser-solidity/tree/gh-pages</a> 
y descargar el archivo .ZIP como se explica en esa página.</p>
</div>
<div class="section" id="npm-node-js">
<h3>npm / Node.js<a class="headerlink" href="#npm-node-js" title="Permalink to this headline">¶</a></h3>
<p>Esta es probablemente la forma más portátil y más conveniente para instalar Solidity localmente.</p>
<p>Se proporciona una biblioteca de JavaScript independiente de la plataforma compilando la fuente C ++ en JavaScript usando Emscripten. 
Se puede utilizar en proyectos directamente (como Remix). 
Consulte el repositorio de <a class="reference external" href="https://github.com/ethereum/solc-js">solc-js</a> para obtener instrucciones.</p>
<p>También contiene una herramienta de línea de comandos llamada <cite>solcjs</cite>, que se puede instalar a través de npm:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">g</span> <span class="nx">solc</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las opciones comandline de <cite>solcjs</cite> no son compatibles con <cite>solc</cite> y herramientas (como <cite>geth</cite>)
 esperando que el comportamiento de <cite>solc</cite> no funcione con <cite>solcjs</cite>.</p>
</div>
</div>
<div class="section" id="docker">
<h3>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h3>
<p>Proporcionamos versiones actualizadas para el compilador. El <code class="docutils literal"><span class="pre">stable</span></code>
repositorio contiene versiones liberadas mientras el <code class="docutils literal"><span class="pre">nightly</span></code>
 repositorio contiene cambios potencialmente inestables en la rama de desarrollo.</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">docker</span> <span class="nx">run</span> <span class="nx">ethereum</span><span class="o">/</span><span class="nx">solc</span><span class="o">:</span><span class="nx">stable</span> <span class="nx">solc</span> <span class="o">--</span><span class="nx">version</span>
</pre></div>
</div>
<p>En la actualidad, la imagen docker sólo contiene el compilador ejecutable, 
por lo que tiene que hacer algún trabajo adicional para vincular en los directorios de origen y salida.</p>
</div>
<div class="section" id="binary-packages">
<h3>Paquetes binarios<a class="headerlink" href="#binary-packages" title="Permalink to this headline">¶</a></h3>
<p>Paquetes binarios de Solidity disponibles en
<a class="reference external" href="https://github.com/ethereum/solidity/releases">solidity/releases</a>.</p>
<p>También tenemos PPA para Ubuntu. Para la última versión estable.</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">add</span><span class="o">-</span><span class="nx">apt</span><span class="o">-</span><span class="nx">repository</span> <span class="nx">ppa</span><span class="o">:</span><span class="nx">ethereum</span><span class="o">/</span><span class="nx">ethereum</span>
<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">update</span>
<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="nx">solc</span>
</pre></div>
</div>
<p>Si desea utilizar la versión de desarrollo de vanguardia:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">add</span><span class="o">-</span><span class="nx">apt</span><span class="o">-</span><span class="nx">repository</span> <span class="nx">ppa</span><span class="o">:</span><span class="nx">ethereum</span><span class="o">/</span><span class="nx">ethereum</span>
<span class="nx">sudo</span> <span class="nx">add</span><span class="o">-</span><span class="nx">apt</span><span class="o">-</span><span class="nx">repository</span> <span class="nx">ppa</span><span class="o">:</span><span class="nx">ethereum</span><span class="o">/</span><span class="nx">ethereum</span><span class="o">-</span><span class="nx">dev</span>
<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">update</span>
<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="nx">solc</span>
</pre></div>
</div>
<p>También estamos lanzando un <a class="reference external" href="https://snapcraft.io/">paquete rápido</a>, 
que es instalable en todas las <a class="reference external" href="https://snapcraft.io/docs/core/install">distribuciones Linux soportadas</a>. 
Para instalar la última versión estable de solc:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">snap</span> <span class="nx">install</span> <span class="nx">solc</span>
</pre></div>
</div>
<p>O si desea ayudar a probar el solc inestable con los cambios más recientes de la rama de desarrollo:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">snap</span> <span class="nx">install</span> <span class="nx">solc</span> <span class="o">--</span><span class="nx">edge</span>
</pre></div>
</div>
<p>Arch Linux también tiene paquetes, aunque limitados a la última versión de desarrollo:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">pacman</span> <span class="o">-</span><span class="nx">S</span> <span class="nx">solidity</span>
</pre></div>
</div>
<p>Homebrew no tiene botellas pre-construidas en el momento de escribir, 
siguiendo una migración de Jenkins a TravisCI, pero Homebrew debería funcionar bien como un medio para construir desde la fuente. 
Volveremos a añadir las botellas pre-construidas pronto.</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">brew</span> <span class="nx">update</span>
<span class="nx">brew</span> <span class="nx">upgrade</span>
<span class="nx">brew</span> <span class="nx">tap</span> <span class="nx">ethereum</span><span class="o">/</span><span class="nx">ethereum</span>
<span class="nx">brew</span> <span class="nx">install</span> <span class="nx">solidity</span>
<span class="nx">brew</span> <span class="nx">linkapps</span> <span class="nx">solidity</span>
</pre></div>
</div>
<p>Si necesita una versión específica de Solidity, puede instalar una fórmula Homebrew directamente desde Github.</p>
<p>Ver
<a class="reference external" href="https://github.com/ethereum/homebrew-ethereum/commits/master/solidity.rb">solidity.rb commits en Github</a>.</p>
<p>Siga los enlaces de historia hasta que tenga un vínculo de archivo sin formato de un commit específico de
<code class="docutils literal"><span class="pre">solidity.rb</span></code>.</p>
<p>Instálelo usando <code class="docutils literal"><span class="pre">brew</span></code>:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">brew</span> <span class="nx">unlink</span> 
<span class="nx">solidity</span>
<span class="err">#</span> <span class="nx">Install</span> <span class="mf">0.4</span><span class="p">.</span><span class="mi">8</span>
<span class="nx">brew</span> <span class="nx">install</span> <span class="nx">https</span><span class="o">:</span><span class="c1">
//raw.githubusercontent.com/ethereum/homebrew-ethereum/77cce03da9f289e5a3ffe579840d3c5dc0a62717/solidity.rb</span>
</pre></div>
</div>
<p>Gentoo Linux también proporciona un paquete de solidity que se puede instalar usando <code class="docutils literal"><span class="pre">emerge</span></code>:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">emerge</span> <span class="nx">dev</span>
<span class="o">-</span><span class="nx">lang</span><span class="o">/</span><span class="nx">solidity</span>
</pre></div>
</div>
</div>
<div class="section" id="building-from-source">
<span id="id3"></span><h3>Construyendo desde la Fuente<a class="headerlink" href="#building-from-source" title="Permalink to this headline">¶</a></h3>
<div class="section" id="clone-the-repository">
<h4>Clonar el repositorio<a class="headerlink" href="#clone-the-repository" title="Permalink to this headline">¶</a></h4>
<p>Para clonar el código fuente, ejecute el siguiente comando:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">clone</span> <span class="o">--</span><span class="nx">recursive</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/ethereum/solidity.git</span>
<span class="nx">cd</span> <span class="nx">solidity</span>
</pre></div>
</div>
<p>Si quieres ayudar a desarrollar Solidity, 
debes hacer fork del repositorio Solidity y añadir tu fork personal como un segundo mando remoto:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">cd</span> <span class="nx">solidity</span>
<span class="nx">git</span> <span class="nx">remote</span> <span class="nx">add</span> <span class="nx">personal</span> <span class="nx">git</span><span class="err">@</span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">:</span><span class="p">[</span><span class="nx">username</span><span class="p">]</span><span class="o">/</span><span class="nx">solidity</span><span class="p">.</span><span class="nx">git</span>
</pre></div>
</div>
<p>Solidity tiene submodulos git. Asegúrese de que estén correctamente cargados:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">submodule</span> <span class="nx">update</span> <span class="o">--</span><span class="nx">init</span> <span class="o">--</span><span class="nx">recursive</span>
</pre></div>
</div>
</div>
<div class="section" id="prerequisites-macos">
<h4>Requisitos previos - macOS<a class="headerlink" href="#prerequisites-macos" title="Permalink to this headline">¶</a></h4>
<p>Para macOS, asegúrese de tener instalada la última versión de
<a class="reference external" href="https://developer.apple.com/xcode/download/">Xcode</a>.
Este contiene el <a class="reference external" href="https://en.wikipedia.org/wiki/Clang">compilador Clang C++</a>, el
<a class="reference external" href="https://en.wikipedia.org/wiki/Xcode">Xcode IDE</a> 
y otras herramientas de desarrollo de Apple que son necesarias para crear aplicaciones C ++ en OS X.
Si instala Xcode por primera vez o acaba de instalar una nueva versión, 
deberá aceptar La licencia antes de que pueda hacer compilaciones de línea de comandos:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">xcodebuild</span> <span class="o">-</span><span class="nx">license</span> <span class="nx">accept</span>
</pre></div>
</div>
<p>Nuestras compilaciones de OS X requieren que <a class="reference external" href="http://brew.sh">instale el gestor de paquetes Homebrew</a>
para instalar dependencias externas.
Aqui esta como <a class="reference external" href="https://github.com/Homebrew/homebrew/blob/master/share/doc/homebrew/FAQ.md#how-do-i-uninstall-homebrew">
desinstalar Homebrew</a>,
 si alguna vez quieres empezar de nuevo desde cero.</p>
</div>
<div class="section" id="prerequisites-windows">
<h4>Requisitos previos - Windows<a class="headerlink" href="#prerequisites-windows" title="Permalink to this headline">¶</a></h4>
<p>Necesitará instalar las siguientes dependencias para las compilaciones de Windows de Solidity:</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Software</th>
<th class="head">Notas</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="https://git-scm.com/download/win">Git for Windows</a></td>
<td>Herramienta de línea de comandos para recuperar fuentes de Github.</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://cmake.org/download/">CMake</a></td>
<td>Generador de archivos de compilación multiplataforma.</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://www.visualstudio.com/products/vs-2015-product-editions">Visual Studio 2015</a></td>
<td>Compilador C ++ y entorno de desarrollo.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="external-dependencies">
<h4>Dependencias Externas<a class="headerlink" href="#external-dependencies" title="Permalink to this headline">¶</a></h4>
<p>Ahora tenemos un script de &#8220;one button&#8221; que instala todas las dependencias externas requeridas en macOS, Windows y en numerosas distros de Linux. 
Esto solía ser un proceso manual de varios pasos, pero ahora se puede hacer en una sola linea de codigo:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">install_deps</span><span class="p">.</span><span class="nx">sh</span>
</pre></div>
</div>
<p>O, en Windows:</p>
<div class="code bat highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">scripts</span><span class="err">\</span><span class="nx">install_deps</span><span class="p">.</span><span class="nx">bat</span>
</pre></div>
</div>
</div>
<div class="section" id="command-line-build">
<h4>Compilación de línea de comandos<a class="headerlink" href="#command-line-build" title="Permalink to this headline">¶</a></h4>
<p>El proyecto de Solidity utiliza CMake para configurar la compilación. 
Construir Solidity es bastante similar en Linux, macOS y otras unidades:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">mkdir</span> <span class="nx">build</span>
<span class="nx">cd</span> <span class="nx">build</span>
<span class="nx">cmake</span> <span class="p">..</span> <span class="o">&amp;&amp;</span> <span class="nx">make</span>
</pre></div>
</div>
<p>o incluso mas facil:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="err">#</span>
<span class="nx">note</span><span class="o">:</span> <span class="k">this</span> <span class="nx">will</span> <span class="nx">install</span> <span class="nx">binaries</span> <span class="nx">solc</span> <span class="nx">and</span> <span class="nx">soltest</span> <span class="nx">at</span> <span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">bin</span>
<span class="p">.</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">build</span><span class="p">.</span><span class="nx">sh</span>
</pre></div>
</div>
<p>E incluso en Windows:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">mkdir</span> <span class="nx">build</span>
<span class="nx">cd</span> <span class="nx">build</span>
<span class="nx">cmake</span> <span class="o">-</span><span class="nx">G</span> <span class="s2">&quot;Visual Studio 14 2015 Win64&quot;</span> <span class="p">..</span>
</pre></div>
</div>
<p>Este último conjunto de instrucciones debería resultar en la creación de
<strong>solidity.sln</strong> en ese directorio de compilación. Hacer doble clic en ese archivo 
debería provocar que Visual Studio se dispare. Sugerimos construir la configuración
<strong>RelWithDebugInfo</strong> pero todos los demás funcionan.</p>
<p>Como alternativa, puede crear para Windows en la línea de comandos, así:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">cmake</span> <span class="o">--</span><span class="nx">build</span> <span class="p">.</span> <span class="o">--</span><span class="nx">config</span> <span class="nx">RelWithDebInfo</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cmake-options">
<h3>Opciones de CMake<a class="headerlink" href="#cmake-options" title="Permalink to this headline">¶</a></h3>
<p>Si está interesado en las opciones de CMake disponibles, ejecute <code class="docutils literal"><span class="pre">cmake</span> <span class="pre">..</span> <span class="pre">-LH</span></code>.</p>
</div>
<div class="section" id="the-version-string-in-detail">
<h3>La cadena de versión en detalle<a class="headerlink" href="#the-version-string-in-detail" title="Permalink to this headline">¶</a></h3>
<p>La cadena de versiones de Solidity contiene cuatro partes:</p>
<ul class="simple">
<li>El número de versión</li>
<li>La etiqueta pre-liberación, por lo general ajustado a <code class="docutils literal"><span class="pre">develop.YYYY.MM.DD</span></code> 
o <code class="docutils literal"><span class="pre">nightly.YYYY.MM.DD</span></code></li>
<li>Hacer commit en el formato de<code class="docutils literal"><span class="pre">commit.GITHASH</span></code></li>
<li>La Plataforma tiene un número arbitrario de elementos, que contiene detalles sobre la plataforma y el compilador</li>
</ul>
<p>Si hay modificaciones locales, el commit será fijado posteriormente con <code class="docutils literal"><span class="pre">.mod</span></code>.</p>
<p>Estas piezas se combinan según lo requiera Semver, donde la etiqueta de pre-lanzamiento de Solidity es igual a 
la pre-lanzamiento de Semver y Solidity commit y la plataforma combinadas forman los metadatos de construcción de Semver.</p>
<p>Un ejemplo de salida: <code class="docutils literal"><span class="pre">0.4.8+commit.60cc1668.Emscripten.clang</span></code>.</p>
<p>Un ejemplo de pre-lanzamiento: <code class="docutils literal"><span class="pre">0.4.9-nightly.2017.1.17+commit.6ecb4aa3.Emscripten.clang</span></code></p>
</div>
<div class="section" id="important-information-about-versioning">
<h3>Información importante sobre el control de versiones<a class="headerlink" href="#important-information-about-versioning" title="Permalink to this headline">¶</a></h3>
<p>Después de realizarse un lanzamiento, es cambiado el nivel de versión del path , ya que suponemos que sólo siguen los cambios de nivel de parches(path). 
 Cuando se fusionan los cambios, la versión debe ser superada según semver y la magnitud del cambio. 
 Finalmente, los lanzamientos siempre se hacen con la versión recientemente construida, pero sin un <code class="docutils literal"><span class="pre">pre-lanzamiento</span></code>.</p> especifico
<p>Ejemplo:</p>
<ol class="arabic simple" start="0">
<li>es realizado el lanzamiento 0.4.0</li>
<li>recientemente se construye una versión 0.4.1</li>
<li>cambios no bruscos son introducidos – no cambian la versión</li>
<li>es introducido un cambio rompeador – la versión es elevada a 0.5.0</li>
<li>el lanzamiento 0.5.0 es realizado</li>
</ol>
<p>Esto sigue funcionando bien con la <a class="reference internal" href="index.html#version-pragma"><span class="std std-ref">version pragma</span></a>.</p>
</div>
</div>
<span id="document-solidity-by-example"></span><div class="section" id="solidity-by-example">
<h2>Solidity con Ejemplos<a class="headerlink" href="#solidity-by-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="voting">
<span id="index-0"></span><span id="id1"></span><h3>Votación<a class="headerlink" href="#voting" title="Permalink to this headline">¶</a></h3>
<p>El siguiente contrato es bastante complejo, pero muestra muchas de las características de Solidity. 
Implementa un contrato de votación. Por supuesto, los principales problemas del voto electrónico es 
cómo asignar los derechos de voto a las personas correctas y cómo evitar la manipulación. 
No resolveremos todos los problemas aquí, pero al menos mostraremos cómo se puede hacer el voto delegado 
para que el conteo de votos sea <strong>automático y completamente transparente </strong>al mismo tiempo.</p>
<p>La idea es crear un contrato de votacion, proporcionando un nombre corto para cada opción. 
Entonces el creador del contrato que sirve como presidente dará el derecho de votar a cada dirección individualmente.</p>
<p>Las personas detrás de las direcciones pueden entonces elegir votar ellos mismos o delegar su voto a una persona en la que confían.</p>
<p>Al final del tiempo de votación, <code class="docutils literal"><span class="pre">winningProposal()</span></code>
devolverá la propuesta con el mayor número de votos.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>
<span class="cs">/// </span><span class="k">@title</span><span class="cs"> Votación con delegación.</span>
<span class="kd">contract</span> <span class="nx">Ballot</span> <span class="p">{</span>
    <span class="c1">// Esto declara un nuevo tipo complejo que</span>
    <span class="c1">//  se utilizará para las variables más adelante.</span>
    <span class="c1">// Representará a un solo votante. </span>
    <span class="kd">struct</span> <span class="nx">Voter</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">weight</span><span class="p">;</span> <span class="c1">// weight se acumula por delegación</span>
        <span class="kt">bool</span> <span class="nx">voted</span><span class="p">;</span>  <span class="c1">// si es verdad, esa persona ya votó</span>
        <span class="kt">address</span> <span class="nx">delegate</span><span class="p">;</span> <span class="c1">// persona delegada a</span>
        <span class="kt">uint</span> <span class="nx">vote</span><span class="p">;</span>   <span class="c1">// índice de la propuesta votada</span>
    <span class="p">}</span>

    <span class="c1">//  Este es un tipo para una propuesta(Caracteristicas de cada propuesta). </span>
    <span class="kd">struct</span> <span class="nx">Proposal</span> <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="nx">name</span><span class="p">;</span>   <span class="c1">// nombre abreviado (hasta 32 bytes) </span>
        <span class="kt">uint</span> <span class="nx">voteCount</span><span class="p">;</span> <span class="c1">// número de votos acumulados </span>
    <span class="p">}</span>

    <span class="kt">address</span> <span class="k">public</span> <span class="nx">chairperson</span><span class="p">;</span>

    <span class="c1">//  Esto declara una variable de estado que </span>
    <span class="c1">// almacena una estructura `Voter` para cada dirección(address) posible.</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="nx">Voter</span><span class="p">)</span> <span class="k">public</span> <span class="nx">voters</span><span class="p">;</span>

    <span class="c1">// Una matriz(array) de tamaño dinámico de estructuras de 'Propuesta'.</span>
    <span class="nx">Proposal</span><span class="p">[]</span> <span class="k">public</span> <span class="nx">proposals</span><span class="p">;</span>
	
    <span class="cs">///  Cree una nueva votacion para elegir uno de `proposalNames` (nombres propuestos).</span>
    <span class="kd">function</span> <span class="nx">Ballot</span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span> <span class="nx">proposalNames</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">chairperson</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">voters</span><span class="p">[</span><span class="nx">chairperson</span><span class="p">].</span><span class="nx">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="c1">// Para cada uno de los nombres de propuesta proporcionados,</span>
        <span class="c1">// crea un nuevo objeto de propuesta y agrega</span>
        <span class="c1">// al final de la matriz(array). </span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">proposalNames</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// `Propuesta({...})` crea un temporal</span>
            <span class="c1">// objeto Propuesto y `proposals.push(...)`</span>
            <span class="c1">// lo anexa al final de las «propuestas». `.</span>
            <span class="nx">proposals</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Proposal</span><span class="p">({</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">proposalNames</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
                <span class="nx">voteCount</span><span class="o">:</span> <span class="mi">0</span>
            <span class="p">}));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">   // Dar al votante el derecho a votar en esta votacion electoral. </span>
    <span class="c1">// Sólo puede ser llamado por `chairperson`.</span>
    <span class="kd">function</span> <span class="nx">giveRightToVote</span><span class="p">(</span><span class="kt">address</span> <span class="nx">voter</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Si el argumento de `` require` evalúa a false`,,</span>
        <span class="c1">// termina y revierte todos los cambios</span>
        <span class="c1">// del estado y los Ether balances. Son a menudo</span>
        <span class="c1">// una buena idea usar si las funciones </span>
        <span class="c1">// se llaman incorrectamente. Pero ten cuidado, este </span>
        <span class="c1">// consumirá actualmente todos los gases suministrados </span>
        <span class="c1">// (esto está previsto que cambie en el futuro).</span>
        <span class="nb">require</span><span class="p">((</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">chairperson</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">voters</span><span class="p">[</span><span class="nx">voter</span><span class="p">].</span><span class="nx">voted</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">voters</span><span class="p">[</span><span class="nx">voter</span><span class="p">].</span><span class="nx">weight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">));</span>
        <span class="nx">voters</span><span class="p">[</span><span class="nx">voter</span><span class="p">].</span><span class="nx">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Delegar su voto al votante `to`.</span>
    <span class="kd">function</span> <span class="nx">delegate</span><span class="p">(</span><span class="kt">address</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// asigna la referencia</span>
        <span class="nx">Voter</span> <span class="k">storage</span> <span class="nx">sender</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span><span class="p">);</span>
        <span class="c1">//  La autodelegacion no está permitida.</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">to</span> <span class="o">!=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>
        <span class="c1">// Reenviar la delegación siempre y cuando </span>
        <span class="c1">// `to` también se delegue.</span>
        <span class="c1">// En general, estos bucles son muy peligrosos,</span>
        <span class="c1">// porque si pasan demasiado tiempo, podrían </span>
        <span class="c1">// necesitar más gas del que está disponible en un bloque.</span>
        <span class="c1">// En este caso, la delegación no se ejecutará, </span>
        <span class="c1">// pero en otras situaciones, tales bucles podrían </span>
        <span class="c1">// hacer que un contrato se &quot;atasque&quot; completamente.</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">].</span><span class="nx">delegate</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">to</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">].</span><span class="nx">delegate</span><span class="p">;</span>

            <span class="c1"> Encontramos un bucle en la delegación, no permitido. </span>
            <span class="nb">require</span><span class="p">(</span><span class="nx">to</span> <span class="o">!=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Puesto que `sender` es una referencia,</span>
        <span class="c1">// modifica el `voters[msg.sender].voted`</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">delegate</span> <span class="o">=</span> <span class="nx">to</span><span class="p">;</span>
        <span class="nx">Voter</span> <span class="k">storage</span> <span class="nx">delegate</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">voted</span><span class="p">)</span> <span class="p">{</span>
         
		 <span class="c1">// Si el delegado ya votó, </span>
            <span class="c1">// añadir directamente con el número de votos </span>
            <span class="nx">proposals</span><span class="p">[</span><span class="nx">delegate</span><span class="p">.</span><span class="nx">vote</span><span class="p">].</span><span class="nx">voteCount</span> <span class="o">+=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Si el delegado no votó todavía,</span>
            <span class="c1">// agrega su weight.</span>
            <span class="nx">delegate</span><span class="p">.</span><span class="nx">weight</span> <span class="o">+=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cs">/// Dé su voto (incluidos los votos delegados a usted) </span>
    <span class="cs">/// a la propuesta `proposals[proposal].name`.</span>
    <span class="kd">function</span> <span class="nx">vote</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">proposal</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Voter</span> <span class="k">storage</span> <span class="nx">sender</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span><span class="p">);</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">vote</span> <span class="o">=</span> <span class="nx">proposal</span><span class="p">;</span>
        <span class="c1">// Si `proposal` está fuera del rango de la matriz o array,</span>
        <span class="c1">// esto lanzará automáticamente y revertirá</span>
        <span class="c1">// todos los cambios.</span>
        <span class="nx">proposals</span><span class="p">[</span><span class="nx">proposal</span><span class="p">].</span><span class="nx">voteCount</span> <span class="o">+=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// </span><span class="k">@dev</span><span class="cs"> Calcula la propuesta ganadora teniendo</span>
    <span class="cs">/// en cuenta todos los votos anteriores.</span>
    <span class="kd">function</span> <span class="nx">winningProposal</span><span class="p">()</span> <span class="k">constant</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">winningProposal</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">winningVoteCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">p</span> <span class="o">&lt;</span> <span class="nx">proposals</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">proposals</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">voteCount</span> <span class="o">&gt;</span> <span class="nx">winningVoteCount</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">winningVoteCount</span> <span class="o">=</span> <span class="nx">proposals</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">voteCount</span><span class="p">;</span>
                <span class="nx">winningProposal</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Llama a la función winningProposal () para obtener el índice</span>
    <span class="c1">// del ganador contenido en la matriz de propuestas y luego </span>
    <span class="c1">// devuelve el nombre del ganador</span>
    <span class="kd">function</span> <span class="nx">winnerName</span><span class="p">()</span> <span class="k">constant</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span> <span class="nx">winnerName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">winnerName</span> <span class="o">=</span> <span class="nx">proposals</span><span class="p">[</span><span class="nx">winningProposal</span><span class="p">()].</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="possible-improvements">

<h4>Posibles mejoras<a class="headerlink" href="#possible-improvements" title="Permalink to this headline">¶</a></h4>
<p>Actualmente, se necesitan muchas transacciones para asignar los derechos de voto a todos los participantes. ¿Puedes pensar en una mejor manera?</p>
</div>
</div>
<div class="section" id="blind-auction">
<span id="index-1"></span><h3>Subasta a ciegas<a class="headerlink" href="#blind-auction" title="Permalink to this headline">¶</a></h3>
<p>En esta sección, mostraremos lo fácil que es crear un contrato de subasta completamente a ciegas en Ethereum. 
Empezaremos con una subasta abierta donde todos podrán ver las ofertas que se hacen y luego extender este contrato 
a una subasta ciega donde no es posible ver la oferta real hasta que finalice el período de oferta.</p>
<div class="section" id="simple-open-auction">
<span id="simple-auction"></span><h4>Subasta sencilla <a class="headerlink" href="#simple-open-auction" title="Permalink to this headline">¶</a></h4>
<p>La idea general del siguiente contrato de subasta simple es que todo el mundo puede enviar sus ofertas durante un período de licitación. 
Las ofertas ya incluyen el envío de dinero / ether con el fin de vincular a los licitantes a su oferta. Si la oferta más alta se eleva, 
el mejor postor anterior recupera su dinero. Después del final del período de licitación, el contrato debe ser llamado manualmente para 
que el beneficiario reciba su dinero - los contratos no pueden activarse por sí mismos.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SimpleAuction</span> <span class="p">{</span>

    <span class="c1">// Parámetros de la subasta. Los tiempos son </span>
    <span class="c1">// absoluto unix timestamps (segundos desde 1970-01-01)</span>
    <span class="c1">// o períodos de tiempo en segundos. </span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">beneficiary</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">auctionStart</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">biddingTime</span><span class="p">;</span>

    <span class="c1">// Estado actual de la subasta.</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">highestBid</span><span class="p">;</span>

    <span class="c1">// Permitieron los retiros de la </span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">pendingReturns</span><span class="p">;</span>

    <span class="c1">// Se establece en true al final, no permite ningún cambio</span>
    <span class="kt">bool</span> <span class="nx">ended</span><span class="p">;</span>

    <span class="c1">// Eventos que se dispararán en los cambios.</span>
    <span class="kd">event</span> <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span> <span class="nx">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>
    <span class="kd">event</span> <span class="nx">AuctionEnded</span><span class="p">(</span><span class="kt">address</span> <span class="nx">winner</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>
    <span class="c1">// Lo que sigue es un comentario llamado natspec,</span>
    <span class="c1">// reconocible por las tres barras.</span>
    <span class="c1">// Se mostrará cuando se solicite al usuario </span>
    <span class="c1">// que confirme una transacción.</span>	
    <span class="cs">/// Crear una subasta simple con `_biddingTime`</span>
    <span class="cs">/// segundos de tiempo de licitación en nombre de la</span>
    <span class="cs">/// dirección beneficiaria` _beneficiary`.</span>
    <span class="kd">function</span> <span class="nx">SimpleAuction</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="nx">_biddingTime</span><span class="p">,</span>
        <span class="kt">address</span> <span class="nx">_beneficiary</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nx">beneficiary</span> <span class="o">=</span> <span class="nx">_beneficiary</span><span class="p">;</span>
        <span class="nx">auctionStart</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>
        <span class="nx">biddingTime</span> <span class="o">=</span> <span class="nx">_biddingTime</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cs">/// Oferta en la subasta con el valor enviado </span>
    <span class="cs">/// junto con esta transacción.</span>
    <span class="cs">/// El valor sólo se reembolsará si </span>
    <span class="cs">/// la subasta no se gana. </span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span>
  
		<span class="c1">// No hay argumentos necesarios, </span>
        <span class="c1">// toda la información ya forma parte de </span>
        <span class="c1">// la transacción. La palabra clave a pagar </span>
        <span class="c1">// se requiere para que la función </span>
        <span class="c1">// pueda recibir Éther.</span>

        <span class="c1">// Revertir la llamada si el período de </span>
        <span class="c1">// licitación ha terminado.</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nx">auctionStart</span> <span class="o">+</span> <span class="nx">biddingTime</span><span class="p">));</span>

        <span class="c1">// Si la oferta no es superior, envíe el </span>
        <span class="c1">// dinero de vuelta.</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">highestBid</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">highestBidder</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// devolver el dinero por el simple uso</span>
            <span class="c1">// highestBidder.send(highestBid) es un riesgo de seguridad </span>
            <span class="c1">// ya que podría ejecutar un contrato que no es de confianza.</span>
            <span class="c1">// Siempre es más seguro dejar que los beneficiarios </span>
            <span class="c1">// retiren su dinero ellos mismos. </span>
            <span class="nx">pendingReturns</span><span class="p">[</span><span class="nx">highestBidder</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">highestBid</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">highestBidder</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">highestBid</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cs">/// Retirar una oferta que fue sobrepasada. </span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Es importante poner esto a cero porque el destinatario </span>
            <span class="c1">// puede volver a llamar a esta función como parte de la llamada de recepción </span>
            <span class="c1">// antes de que `send` devuelva.</span>
            <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">amount</span><span class="p">))</span> <span class="p">{</span>
                <span class="c1">// No hay necesidad de llamar a tirar aquí, sólo restablecer la cantidad adeudada</span>
                <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Finalizar la subasta y enviar la oferta más alta</span>
    <span class="cs">/// al beneficiario.</span>
    <span class="kd">function</span> <span class="nx">auctionEnd</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Es una buena guía para estructurar funciones que interactúan</span>
        <span class="c1">// con otros contratos (es decir, que llamar a funciones o enviar Ether) </span>
        <span class="c1">// en tres fases: </span>
        <span class="c1">// 1. Condiciones de chequeos </span>
        <span class="c1">// 2. realizar acciones ( Potencialmente cambiando las condiciones) </span>
        <span class="c1">// 3. interactuando con otros contratos</span>
        <span class="c1">// Si estas fases se mezclan, el otro contrato podría llamar </span>
        <span class="c1">// de nuevo al contrato actual y modificar el estado o causar </span>
        <span class="c1">// efectos (pago de ether) a realizar múltiples veces.</span>
        <span class="c1">// Si las funciones llamadas internamente incluyen interacción con</span>
        <span class="c1">// contratos, también deben ser considerados como interacción con</span>
        <span class="c1">// contratos externos.</span>

        <span class="c1">// 1. Condiciones</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nx">auctionStart</span> <span class="o">+</span> <span class="nx">biddingTime</span><span class="p">));</span> <span class="c1">
		// la subasta no terminó todavía </span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nx">ended</span><span class="p">);</span> <span class="c1">
		// esta función ya ha sido llamada</span>

        <span class="c1">// 2. Efectos</span>
        <span class="nx">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">AuctionEnded</span><span class="p">(</span><span class="nx">highestBidder</span><span class="p">,</span> <span class="nx">highestBid</span><span class="p">);</span>

        <span class="c1">// 3. Interaccion</span>
        <span class="nx">beneficiary</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">highestBid</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Subasta a ciegas<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>La subasta abierta anterior se extiende a una subasta ciega en lo siguiente. 
La ventaja de una subasta ciega es que no hay presión de tiempo hacia el final del período de licitación. 
Crear una subasta ciega en una plataforma informática transparente puede sonar como una contradicción, 
pero la criptografía viene al rescate.</p>
<p>Durante el <strong>período de licitación </strong>, un licitador no envía realmente su oferta, pero si una versión hashed de ella.
 Puesto que actualmente se considera prácticamente imposible encontrar dos valores 
 (suficientemente largos) cuyos valores de hash sean iguales, el licitador se compromete a la oferta por eso.
 Después del final del período de licitación, los licitadores tienen que revelar sus ofertas: 
 Envían sus valores sin cifrar y el contrato comprueba que el valor hash es el mismo que el proporcionado durante el período de licitación.</p>
<p>Otro desafío es cómo hacer la subasta
<strong>obligatoria y ciega</strong> al mismo tiempo: La única manera de evitar que el postor simplemente no envíe el dinero 
después de que ganó la subasta es hacerla enviarlo junto con la oferta. Dado que las transferencias 
de valores no pueden ser cegadas en Ethereum, cualquiera puede ver el valor.</p>
<p>El siguiente contrato resuelve este problema aceptando cualquier valor que sea mayor que la oferta más alta. 
Dado que esto sólo puede comprobarse durante la fase de revelación, algunas ofertas pueden ser  
<strong>inválidas</strong>,
y esto es a propósito (incluso proporciona un indicador explícito para colocar ofertas no válidas con 
transferencias de alto valor): Los postores pueden confundir la competencia al bajar ofertas inválidas.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">BlindAuction</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Bid</span> <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="nx">blindedBid</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">deposit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">address</span> <span class="k">public</span> <span class="nx">beneficiary</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">auctionStart</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">biddingEnd</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">revealEnd</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">public</span> <span class="nx">ended</span><span class="p">;</span>

    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="nx">Bid</span><span class="p">[])</span> <span class="k">public</span> <span class="nx">bids</span><span class="p">;</span>

    <span class="kt">address</span> <span class="k">public</span> <span class="nx">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">highestBid</span><span class="p">;</span>

    <span class="c1">// Permitieron los retiros de la asignación de ofertas anteriores</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">pendingReturns</span><span class="p">;</span>

    <span class="kd">event</span> <span class="nx">AuctionEnded</span><span class="p">(</span><span class="kt">address</span> <span class="nx">winner</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">highestBid</span><span class="p">);</span>

    <span class="cs">/// Los modificadores son una manera conveniente de validar las entradas a las funciones</span>
    <span class="cs">/// `onlyBefore` se aplica a` bid` a continuación:</span>
    <span class="cs">/// El nuevo cuerpo de la función es el cuerpo del modificador donde</span>
    <span class="cs">/// `_` es reemplazado por el cuerpo de la antigua función.</span>
    <span class="kd">modifier</span> <span class="nx">onlyBefore</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="p">{</span> <span class="nb">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&lt;</span> <span class="nx">_time</span><span class="p">);</span> <span class="nx">_</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">modifier</span> <span class="nx">onlyAfter</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="p">{</span> <span class="nb">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&gt;</span> <span class="nx">_time</span><span class="p">);</span> <span class="nx">_</span><span class="p">;</span> <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">BlindAuction</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="nx">_biddingTime</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="nx">_revealTime</span><span class="p">,</span>
        <span class="kt">address</span> <span class="nx">_beneficiary</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nx">beneficiary</span> <span class="o">=</span> <span class="nx">_beneficiary</span><span class="p">;</span>
        <span class="nx">auctionStart</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>
        <span class="nx">biddingEnd</span> <span class="o">=</span> <span class="nb">now</span> <span class="o">+</span> <span class="nx">_biddingTime</span><span class="p">;</span>
        <span class="nx">revealEnd</span> <span class="o">=</span> <span class="nx">biddingEnd</span> <span class="o">+</span> <span class="nx">_revealTime</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Coloca una puja ciega con `_blindedBid` = keccak256 (valor,</span>
    <span class="cs">/// falso, secreto).</span>
    <span class="cs">/// El ether enviado sólo se devuelve si la oferta es correcta</span>
    <span class="cs">/// revelada en la fase reveladora. La oferta es válida si el</span>
    <span class="cs">/// el ether enviado junto con la oferta es al menos &quot;value&quot; y</span>
    <span class="cs">/// &quot;fake&quot; si no es cierto. Establecer &quot;fake&quot; a true y enviar</span>
    <span class="cs">/// no la cantidad exacta son formas de ocultar la oferta real pero</span>
    <span class="cs">/// sigue haciendo el depósito requerido. La misma dirección puede </span>
    <span class="cs">/// realizar varias pujas. </span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">_blindedBid</span><span class="p">)</span>
        <span class="k">payable</span>
        <span class="nx">onlyBefore</span><span class="p">(</span><span class="nx">biddingEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">bids</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">Bid</span><span class="p">({</span>
            <span class="nx">blindedBid</span><span class="o">:</span> <span class="nx">_blindedBid</span><span class="p">,</span>
            <span class="nx">deposit</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span>
        <span class="p">}));</span>
    <span class="p">}</span>
   
    <span class="cs">/// Revelar sus ofertas ciegas. Obtendrá un reembolso por todas las </span>
    <span class="cs">/// pujas inválidas correctamente ocultas y para todas las pujas excepto para</span>
    <span class="cs">/// la más alta.</span>
    <span class="kd">function</span> <span class="nx">reveal</span><span class="p">(</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">_values</span><span class="p">,</span>
        <span class="kt">bool</span><span class="p">[]</span> <span class="nx">_fake</span><span class="p">,</span>
        <span class="kt">bytes32</span><span class="p">[]</span> <span class="nx">_secret</span>
    <span class="p">)</span>
        <span class="nx">onlyAfter</span><span class="p">(</span><span class="nx">biddingEnd</span><span class="p">)</span>
        <span class="nx">onlyBefore</span><span class="p">(</span><span class="nx">revealEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">bids</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">_values</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">length</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">_fake</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">length</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">_secret</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">length</span><span class="p">);</span>

        <span class="kt">uint</span> <span class="nx">refund</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">bid</span> <span class="o">=</span> <span class="nx">bids</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">][</span><span class="nx">i</span><span class="p">];</span>
            <span class="kd">var</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">fake</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span> <span class="o">=</span>
                    <span class="p">(</span><span class="nx">_values</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">_fake</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">_secret</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">bid</span><span class="p">.</span><span class="nx">blindedBid</span> <span class="o">!=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">fake</span><span class="p">,</span> <span class="nx">secret</span><span class="p">))</span> <span class="p">{</span>
           
				<span class="c1">// La oferta no fue realmente revelada.</span>
                <span class="c1">// No devuelve el depósito. </span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">refund</span> <span class="o">+=</span> <span class="nx">bid</span><span class="p">.</span><span class="nx">deposit</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fake</span> <span class="o">&amp;&amp;</span> <span class="nx">bid</span><span class="p">.</span><span class="nx">deposit</span> <span class="o">&gt;=</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">placeBid</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">value</span><span class="p">))</span>
                    <span class="nx">refund</span> <span class="o">-=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// Hacer imposible que el remitente reclame</span>
            <span class="c1">// el mismo depósito.</span>
            <span class="nx">bid</span><span class="p">.</span><span class="nx">blindedBid</span> <span class="o">=</span> <span class="kt">bytes32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">refund</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Esta es una función &quot;interna&quot; que significa que</span>
    <span class="c1">// sólo se puede llamar desde el propio contrato (o de</span>
    <span class="c1">// contratos derivados).</span>
    <span class="kd">function</span> <span class="nx">placeBid</span><span class="p">(</span><span class="kt">address</span> <span class="nx">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="k">internal</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="nx">success</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&lt;=</span> <span class="nx">highestBid</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">highestBidder</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// reembolsará el postor más alto previamente.</span>
            <span class="nx">pendingReturns</span><span class="p">[</span><span class="nx">highestBidder</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">highestBid</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">highestBid</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="nx">highestBidder</span> <span class="o">=</span> <span class="nx">bidder</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Retirar una oferta que fue sobrepasada.</span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Es importante establecer esto a cero porque el destinatario </span>
            <span class="c1">// puede volver a llamar esta función como parte de la llamada de recepción</span>
            <span class="c1">// antes de que `send` regrese (véase la observación anterior acerca de </span>
            <span class="c1">// condiciones -&gt; efectos -&gt; interaccion).</span>
            <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amount</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cs">/// Finalizar la subasta y enviar la oferta más alta</span>
    <span class="cs">/// al beneficiario.</span>
    <span class="kd">function</span> <span class="nx">auctionEnd</span><span class="p">()</span>
        <span class="nx">onlyAfter</span><span class="p">(</span><span class="nx">revealEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nx">ended</span><span class="p">);</span>
        <span class="nx">AuctionEnded</span><span class="p">(</span><span class="nx">highestBidder</span><span class="p">,</span> <span class="nx">highestBid</span><span class="p">);</span>
        <span class="nx">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
       
		<span class="c1">// Enviamos todo el dinero que tenemos, porque algunos</span>
        <span class="c1">// de los reembolsos pudieron haber fallado.</span>
        <span class="nx">beneficiary</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="safe-remote-purchase">

<span id="index-2"></span><h3>Compra remota segura<a class="headerlink" href="#safe-remote-purchase" title="Permalink to this headline">¶</a></h3>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Purchase</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">value</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">seller</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">buyer</span><span class="p">;</span>
    <span class="kd">enum</span> <span class="nx">State</span> <span class="p">{</span> <span class="nx">Created</span><span class="p">,</span> <span class="nx">Locked</span><span class="p">,</span> <span class="nx">Inactive</span> <span class="p">}</span>
    <span class="nx">State</span> <span class="k">public</span> <span class="nx">state</span><span class="p">;</span>
  
    <span class="c1">// Asegúrese de que `msg.value` sea un número par. </span>
    <span class="c1">// La división trunca si es un número impar.</span>
    <span class="c1">// Comprueba a través de la multiplicación que no era un número impar. </span>
    <span class="kd">function</span> <span class="nx">Purchase</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">seller</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nb">require</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">condition</span><span class="p">(</span><span class="kt">bool</span> <span class="nx">_condition</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">_condition</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">onlyBuyer</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">buyer</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">onlySeller</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">seller</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span> <span class="nx">_state</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">state</span> <span class="o">==</span> <span class="nx">_state</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">event</span> <span class="nx">Aborted</span><span class="p">();</span>
    <span class="kd">event</span> <span class="nx">PurchaseConfirmed</span><span class="p">();</span>
    <span class="kd">event</span> <span class="nx">ItemReceived</span><span class="p">();</span>

    <span class="cs">/// Abortar la compra y recuperar el ether.</span>
    <span class="cs">/// Sólo puede ser llamado por el vendedor antes </span>
    <span class="cs">/// el contrato está bloqueado.</span>
    <span class="kd">function</span> <span class="nx">abort</span><span class="p">()</span>
        <span class="nx">onlySeller</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Created</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">Aborted</span><span class="p">();</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">;</span>
        <span class="nx">seller</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cs">/// Confirme la compra como comprador.</span>
    <span class="cs">/// La transacción tiene que incluir el ether `2 * value`.</span>
    <span class="cs">/// El éter se bloquea hasta que se llama a </span>
    <span class="cs">/// ConfirmReeceived.</span>
    <span class="kd">function</span> <span class="nx">confirmPurchase</span><span class="p">()</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Created</span><span class="p">)</span>
        <span class="nx">condition</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">value</span><span class="p">))</span>
        <span class="k">payable</span>
    <span class="p">{</span>
        <span class="nx">PurchaseConfirmed</span><span class="p">();</span>
        <span class="nx">buyer</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Locked</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Confirme que usted (el comprador) recibió el artículo. </span>
    <span class="cs">/// Esto liberará el ether bloqueado.</span>
    <span class="kd">function</span> <span class="nx">confirmReceived</span><span class="p">()</span>
        <span class="nx">onlyBuyer</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Locked</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">ItemReceived</span><span class="p">();</span>
        <span class="c1">// Es importante cambiar primero el estado porque</span>
        <span class="c1">// de lo contrario, los contratos llamados usando `send` debajo</span>
        <span class="c1">// pueden volver a llamar aquí.</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">;</span>

        <span class="c1">// NOTA: Esto realmente permite que tanto el comprador como el vendedor</span>
        <span class="c1">// bloqueen el reembolso - el patrón de retirada debe ser usado.</span>

        <span class="nx">buyer</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="nx">seller</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="micropayment-channel">
<h3>Canal de micropago<a class="headerlink" href="#micropayment-channel" title="Permalink to this headline">¶</a></h3>
<p>Por ser escrito.</p>
</div>
</div>
<span id="document-solidity-in-depth"></span><div class="section" id="solidity-in-depth">
<h2>Solidity en profundidad<a class="headerlink" href="#solidity-in-depth" title="Permalink to this headline">¶</a></h2>
<p>Esta sección debe proporcionarle todo lo que necesita saber sobre Solidity. 
Si algo falta aquí, póngase en contacto con nosotros en
<a class="reference external" href="https://gitter.im/ethereum/solidity">Gitter</a> o haga una solicitud de extracción(pull request) en
<a class="reference external" href="https://github.com/ethereum/solidity/pulls">Github</a>.</p>
<div class="toctree-wrapper compound">
<span id="document-layout-of-source-files"></span><div class="section" id="layout-of-a-solidity-source-file">
<h3>Diseño de un archivo de origen de Solidity<a class="headerlink" href="#layout-of-a-solidity-source-file" title="Permalink to this headline">¶</a></h3>
<p>os archivos de origen pueden contener un número arbitrario de definiciones de contratos, incluir directivas y directivas de pragma.</p>
<div class="section" id="version-pragma">
<span id="index-0"></span><span id="id1"></span><h4>Version Pragma<a class="headerlink" href="#version-pragma" title="Permalink to this headline">¶</a></h4>
<p>Los archivos fuente pueden (y deben) ser anotados con una denominada version pragma para rechazar 
la compilación con futuras versiones del compilador que podrían introducir cambios incompatibles. 
Tratamos de mantener tales cambios a un mínimo absoluto y especialmente introducir cambios de una 
manera que los cambios en la semántica también requieren cambios en la sintaxis, pero esto no siempre es posible. 
Debido a eso, es siempre una buena idea leer a través del changelog por lo menos para los lanzamientos con cambios importantes, 
esos lanzamientos siempre tendrán versiones del formato 
<code class="docutils literal"><span class="pre">0.x.0</span></code> o <code class="docutils literal"><span class="pre">x.0.0</span></code>.</p>
<p>El pragma de la versión se utiliza de la siguiente manera:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Dicho archivo de origen no se compilará con un compilador anterior a la versión 0.4.0 
y tampoco funcionará en un compilador a partir de la versión 0.5.0 (esta segunda condición se agrega mediante el uso
 <code class="docutils literal"><span class="pre">^</span></code>). La idea detrás de esto es que no habrá cambios de ruptura hasta la versión 
 <code class="docutils literal"><span class="pre">0.5.0</span></code>0.5.0, por lo que siempre podemos estar seguros 
de que nuestro código compilará la forma en que lo intentamos. No arreglamos la versión exacta del compilador, 
de modo que las versiones de bugfix todavía son posibles.</p>
<p>Es posible especificar reglas mucho más complejas para la versión del compilador, la expresión sigue las utilizadas por
 <a class="reference external" href="https://docs.npmjs.com/misc/semver">npm</a>.</p>
</div>
<div class="section" id="importing-other-source-files">
<span id="import"></span><span id="index-1"></span><h4>Importar otros archivos de origen<a class="headerlink" href="#importing-other-source-files" title="Permalink to this headline">¶</a></h4>
<div class="section" id="syntax-and-semantics">
<h5>Sintaxis y Semántica<a class="headerlink" href="#syntax-and-semantics" title="Permalink to this headline">¶</a></h5>
<p>Solidity soporta declaraciones de importación que son muy similares a las disponibles en JavaScript 
(desde ES6 en), aunque Solidity no conoce el concepto de &#8220;exportación predeterminada&#8221;.</p>
<p>A nivel global, puede utilizar declaraciones de importación del siguiente formulario:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="s2">&quot;filename&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Esta instrucción importa todos los símbolos globales de &#8220;filename&#8221; (y símbolos importados allí) 
al ámbito global actual (diferente de ES6 pero compatible con Solidity).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">symbolName</span> <span class="nx">from</span> <span class="s2">&quot;filename&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>... crea un nuevo símbolo global <code class="docutils literal"><span class="pre">symbolName</span></code> 
cuyos miembros son todos los símbolos globales <code class="docutils literal"><span class="pre">&quot;filename ó nombre del archivo&quot;</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="p">{</span><span class="nx">symbol1</span> <span class="k">as</span> <span class="nx">alias</span><span class="p">,</span> <span class="nx">symbol2</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;filename&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>... crea nuevos símbolos globales <code class="docutils literal"><span class="pre">alias</span></code> y <code class="docutils literal"><span class="pre">symbol2</span></code> que hacen referencia a <code class="docutils literal"><span class="pre">symbol1</span></code> y <code class="docutils literal"><span class="pre">symbol2</span></code> desde <code class="docutils literal"><span class="pre">&quot;filename&quot;</span></code>, respectivamente.</p>
<p>Otra sintaxis que no es parte de ES6, pero probablemente conveniente:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="s2">&quot;filename&quot;</span> <span class="k">as</span> <span class="nx">symbolName</span><span class="p">;</span>
</pre></div>
</div>
<p>que es equivalente a <code class="docutils literal"><span class="pre">import</span> <span class="pre">*</span> <span class="pre">as</span> <span class="pre">symbolName</span> <span class="pre">from</span> <span class="pre">&quot;filename&quot;;</span></code>.</p>
</div>
<div class="section" id="paths">
<h5>Paths o Directorios o Rutas o Trayectorias<a class="headerlink" href="#paths" title="Permalink to this headline">¶</a></h5>
 <p>En lo anterior, <code class="docutils literal"><span class="pre">filename</span></code> siempre se trata como una ruta 
 <code class="docutils literal"><span class="pre">/</span></code> como directorio separador, 
<code class="docutils literal"><span class="pre">.</span></code> como el actual y <code class="docutils literal"><span class="pre">..</span></code> 
como el directorio padre. Cuando <code class="docutils literal"><span class="pre">.</span></code> o
 <code class="docutils literal"><span class="pre">..</span></code> es seguido por un carácter excepto 
 <code class="docutils literal"><span class="pre">/</span></code>,
no se considera como el actual o el directorio padre. Todos los nombres de rutas se tratan como rutas absolutas
 a menos que comiencen con el directorio actual <code class="docutils literal"><span class="pre">.</span></code> o el directorio padre
 <code class="docutils literal"><span class="pre">..</span></code>.</p>

<p> Para importar un archivo <code class="docutils literal"><span class="pre">x</span></code> desde el mismo directorio que el archivo actual, utilice 
<code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;./x&quot;</span> <span class="pre">as</span> <span class="pre">x;</span></code>.
Si se utiliza <code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;x&quot;</span> <span class="pre">as</span> 
<span class="pre">x;</span></code> en su lugar, se podría referenciar un archivo diferente 
(en un directorio global de inclusion &#8220;include directory&#8221;).</p>
<p>Depende del compilador (ver abajo) cómo resolver realmente las trayectorias. 
En general, la jerarquía de directorios no necesita mapear estrictamente su sistema de archivos local, 
sino que también puede asignar recursos descubiertos a través, por ejemplo, de ipfs, http o git.</p>
</div>
<div class="section" id="use-in-actual-compilers">
<h5>Uso en compiladores reales<a class="headerlink" href="#use-in-actual-compilers" title="Permalink to this headline">¶</a></h5>
<p>Cuando se invoca el compilador, no sólo es posible especificar cómo descubrir el primer elemento de una ruta, 
sino que es posible especificar remappings de prefijo de ruta de modo que e.g. 
<code class="docutils literal"><span class="pre">github.com/ethereum/dapp-bin/library</span></code> es remapeado a
<code class="docutils literal"><span class="pre">/usr/local/dapp-bin/library</span></code> el compilador leerá los archivos desde allí.
Si se pueden aplicar varios remappings, se intentará primero el que tenga la clave más larga. 
Esto permite un  &#8220;fallback-remapping&#8221; con, por ejemplo, <code class="docutils literal"><span class="pre">&quot;&quot;</span></code> mapas a
<code class="docutils literal"><span class="pre">&quot;/usr/local/include/solidity&quot;</span></code>. Además, estos reasignamientos pueden 
depender del contexto, que le permite configurar paquetes para importar, por ejemplo, diferentes versiones de una biblioteca del mismo nombre.</p>
<p><strong>solc</strong>:</p>

<p>Para solc (el compilador de línea de comandos), estos reasignaciones se proporcionan como
<code class="docutils literal"><span class="pre">context:prefix=target</span></code> argumentos, donde tanto el 
<code class="docutils literal"><span class="pre">context:</span></code> y las 
<code class="docutils literal"><span class="pre">=target</span></code> partes son opcionales (donde predeterminado de destino prefijo en ese caso). Todos los valores de reasignación que 
son archivos regulares se compilan (incluyendo sus dependencias). Este mecanismo es totalmente compatible con 
versiones anteriores (siempre y cuando ningún nombre de archivo contenga = o :) y por lo tanto no haya un cambio de ruptura. 
Todas las importaciones en archivos en o debajo del directorio <code class="docutils literal"><span class="pre">context</span></code> 
que importan un archivo que comienza con <code class="docutils literal"><span class="pre">prefix</span></code> 
se redirigen reemplazando <code class="docutils literal"><span class="pre">prefix</span></code> por <code class="docutils literal"><span class="pre">target</span></code>.</p>
<p>Por ejemplo, si clona
<code class="docutils literal"><span class="pre">github.com/ethereum/dapp-bin/</span></code> localmente a 
<code class="docutils literal"><span class="pre">/usr/local/dapp-bin</span></code>, puede utilizar lo siguiente en su archivo de origen:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="s2">&quot;github.com/ethereum/dapp-bin/library/iterable_mapping.sol&quot;</span> <span class="k">as</span> <span class="nx">it_mapping</span><span class="p">;</span>
</pre></div>
</div>
<p>y ejecute el compilador como</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>solc github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/dapp-bin/ source.sol
</pre></div>
</div>
<p>Como un ejemplo más complejo, suponga que confía en algún módulo que utiliza una versión muy antigua de dapp-bin. 
Esa versión antigua de dapp-bin está desprotegida <code class="docutils literal"><span class="pre">/usr/local/dapp-bin_old</span></code>, entonces usted puede usar</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>solc module1:github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/dapp-bin/ <span class="se">\</span>
     module2:github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/dapp-bin_old/ <span class="se">\</span>
     source.sol
</pre></div>
</div>
<p>de modo que todas las importaciones en el <code class="docutils literal"><span class="pre">module2</span></code> 
tienen la versión antigua, pero las importaciones en <code class="docutils literal"><span class="pre">module1</span></code> obtienen la nueva versión.</p>
<p>Tenga en cuenta que solc sólo permite incluir archivos de determinados directorios: 
Tienen que estar en el directorio (o subdirectorio) de uno de los archivos de origen 
explícitamente especificados o en el directorio (o subdirectorio) de un destino de reasignación. 
Si desea permitir absoluto absoluto incluye, sólo tiene que agregar la reasignación(remapping) <code class="docutils literal"><span class="pre">=/</span></code>.</p>
<p>Si hay varios remappings que conducen a un archivo válido, se selecciona la reasignación con el prefijo común más largo.</p>
<p><strong>Remix</strong>:</p>
<p><a class="reference external" href="https://remix.ethereum.org/">Remix</a>
Remix proporciona una reasignación automática para github y también recuperará automáticamente el archivo 
a través de la red: Puede importar la correlación iterable por ejemplo
<code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;github.com/ethereum/dapp-bin/library/iterable_mapping.sol&quot;</span> <span class="pre">as</span> <span class="pre">it_mapping;</span></code>.</p>
<p>Otros proveedores de código fuente se pueden agregar en el futuro.</p>
</div>
</div>
<div class="section" id="comments">
<span id="index-2"></span><h4>Comentarios<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h4>
<p>Los comentarios de una línea (<code class="docutils literal"><span class="pre">//</span></code>) y los comentarios de varias líneas 
(<code class="docutils literal"><span class="pre">/*...*/</span></code>) son posibles.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// Este es un comentario de una sola línea.</span>

<span class="cm">/*</span>
<span class="cm">Este es un</span>
<span class="cm">comentario de varias líneas.</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>Además, hay otro tipo de comentario llamado comentario natspec, para el que la documentación aún no está escrita. 
Se escriben con una barra triple (<code class="docutils literal"><span class="pre">///</span></code>) 
o un bloque de doble asterisco(<code class="docutils literal"><span class="pre">/**</span> <span class="pre">...</span> <span class="pre">*/</span></code>) y
 deben utilizarse directamente sobre declaraciones de funciones o sentencias.
Puede utilizar etiquetas de estilo <a class="reference external" href="https://en.wikipedia.org/wiki/Doxygen">Doxygen</a>
-dentro de estos comentarios para documentar funciones, 
  anotar condiciones para la verificación formal y proporcionar 
  un <strong>texto de confirmación</strong> que se muestra a los usuarios cuando 
  intentan invocar una función.</p>
<p>En el siguiente ejemplo documentamos el título del contrato, la explicación de los dos parámetros de entrada y dos valores devueltos.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="cs">/** </span><span class="k">@title</span><span class="cs"> Shape Calculadora. */</span>
<span class="kd">contract</span> <span class="nx">shapeCalculator</span> <span class="p">{</span>
    <span class="cs">/** </span><span class="k">@dev</span><span class="cs"> Calcula la superficie y el perímetro de un rectángulo. </span>
<span class="cs">      * </span><span class="k">@param</span><span class="cs"> w Ancho del rectángulo.</span>
<span class="cs">      * </span><span class="k">@param</span><span class="cs"> h Altura del rectángulo.</span>
<span class="cs">      * </span><span class="k">@return</span><span class="cs"> s La superficie calculada.</span>
<span class="cs">      * </span><span class="k">@return</span><span class="cs"> p El perímetro calculado.</span>
<span class="cs">      */</span>
    <span class="kd">function</span> <span class="nx">rectangle</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">w</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">h</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">s</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">*</span> <span class="nx">h</span><span class="p">;</span>
        <span class="nx">p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">w</span> <span class="o">+</span> <span class="nx">h</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-structure-of-a-contract"></span><div class="section" id="structure-of-a-contract">
<span id="contract-structure"></span><span id="index-0"></span><h3>Estructura de un Contrato<a class="headerlink" href="#structure-of-a-contract" title="Permalink to this headline">¶</a></h3>
<p>Los Contratos en Solidity son similares a las clases en lenguajes orientados a objetos. 
Cada contrato puede contener declaraciones de <a class="reference internal" href="#structure-state-variables"><span class="std std-ref">Variables de Estado</span></a>,
 <a class="reference internal" href="#structure-functions"><span class="std std-ref">Funciones</span></a>,
<a class="reference internal" href="#structure-function-modifiers"><span class="std std-ref">Modificadores de Funciones</span></a>, 
<a class="reference internal" href="#structure-events"><span class="std std-ref">Eventos </span></a>, 
<a class="reference internal" href="#structure-structs-types"><span class="std std-ref">Tipos de Structs</span></a> y
 <a class="reference internal" href="#structure-enum-types"><span class="std std-ref">Tipos de Enum</span></a>.
Además, los contratos pueden heredar de otros contratos.</p>
<div class="section" id="state-variables">
<span id="structure-state-variables"></span><h4>Variables de estado<a class="headerlink" href="#state-variables" title="Permalink to this headline">¶</a></h4>
<p>Las variables de estado son valores que permanentemente se almacenan en el storage de un contrato.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SimpleStorage</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">storedData</span><span class="p">;</span> <span class="c1">// Variable de estado</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Consulte la sección  <a class="reference internal" href="index.html#types"><span class="std std-ref">Types</span></a> para tipos de variables de estado válidos y
<a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">Visibilidad y Getters</span></a> para las posibles opciones de visibilidad.</p>

</div>
<div class="section" id="functions">
<span id="structure-functions"></span><h4>Funcciones<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h4>
<p>Las funciones son las unidades de código ejecutables dentro de un contrato.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">contract</span> <span class="nx">SimpleAuction</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span> <span class="c1">// Funcion</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#function-calls"><span class="std std-ref">Las llamadas a Funciones</span></a> 
pueden ocurrir internamente o externamente y tienen diferentes niveles de visibilidad ( 
<a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref"> Visibilidad y Getters </span></a>)
hacia otros contratos.</p>
</div>
<div class="section" id="function-modifiers">
<span id="structure-function-modifiers"></span><h4>Modificadores de funciones<a class="headerlink" href="#function-modifiers" title="Permalink to this headline">¶</a></h4>
<p>Los modificadores de función se pueden utilizar para enmendar la semántica de las funciones de forma declarativa 
(véase la seccion<a class="reference internal" href="index.html#modifiers"><span class="std std-ref"> Modificadores de funciones</span></a>  en los contratos).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Purchase</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">seller</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="nx">onlySeller</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// Modificador</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">seller</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">abort</span><span class="p">()</span> <span class="nx">onlySeller</span> <span class="p">{</span> <span class="c1">// Modificador de uso 
	</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="events">
<span id="structure-events"></span><h4>Eventos<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h4>
<p>Los eventos son interfaces de conveniencia con las instalaciones de registro de EVM.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SimpleAuction</span> <span class="p">{</span>
    <span class="kd">event</span> <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span> <span class="nx">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span> <span class="c1">// Evento</span>

    <span class="kd">function</span> <span class="nx">bid</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// Evento desencadenante</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Consulte la sección <a class="reference internal" href="index.html#events"><span class="std std-ref">Eventos</span></a>
en contratos para obtener información sobre cómo se declaran los eventos y se pueden utilizar desde dapp.</p>
</div>
<div class="section" id="structs-types">
<span id="structure-structs-types"></span><h4>Tipos de estructuras<a class="headerlink" href="#structs-types" title="Permalink to this headline">¶</a></h4>
<p>Los Structs son tipos personalizados definidos que pueden agrupar varias variables (véase la sección
<a class="reference internal" href="index.html#structs"><span class="std std-ref">Structs</span></a> en types).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">contract</span> <span class="nx">Ballot</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Voter</span> <span class="p">{</span> <span class="c1">// Struct o Estructura</span>
        <span class="kt">uint</span> <span class="nx">weight</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="nx">voted</span><span class="p">;</span>
        <span class="kt">address</span> <span class="nx">delegate</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">vote</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="enum-types">
<span id="structure-enum-types"></span><h4>Tipos de Enum<a class="headerlink" href="#enum-types" title="Permalink to this headline">¶</a></h4>
<p>Los enums se pueden utilizar para crear tipos personalizados con un conjunto finito de valores (consulte la sección  
<a class="reference internal" href="index.html#enums"><span class="std std-ref">Enums</span></a> en tipos).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">contract</span> <span class="nx">Purchase</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nx">State</span> <span class="p">{</span> <span class="nx">Created</span><span class="p">,</span> <span class="nx">Locked</span><span class="p">,</span> <span class="nx">Inactive</span> <span class="p">}</span> <span class="c1">// Enum</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-types"></span><div class="section" id="types">
<span id="index-0"></span><span id="id1"></span><h3>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h3>
<p>es un lenguaje escrito de forma estática, lo que significa que el tipo de cada variable (estatal y local) 
necesita ser especificado (o al menos conocido - vea 
<a class="reference internal" href="#type-deduction"><span class="std std-ref">Deducción Type</span></a> a continuación) en tiempo de compilación. 
Solidity proporciona varios tipos elementales que se pueden combinar para formar tipos complejos.</p>
<p>Además, los tipos pueden interactuar entre sí en expresiones que contienen operadores. 
Para una referencia rápida de los distintos operadores, véase 
 <a class="reference internal" href="index.html#order"><span class="std std-ref">Orden de Precedencia de Operadores</span></a>.</p>
<div class="section" id="value-types">
<span id="index-1"></span><h4>Tipos de valor<a class="headerlink" href="#value-types" title="Permalink to this headline">¶</a></h4>
<p>Los tipos siguientes también se denominan tipos de valores porque las variables de estos 
tipos siempre se pasan por valor, es decir, siempre se copian cuando se utilizan como argumentos de función o en asignaciones.</p>
<div class="section" id="booleans">
<span id="index-2"></span><h5>Booleanos<a class="headerlink" href="#booleans" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">bool</span></code>: Los valores posibles son constantes 
<code class="docutils literal"><span class="pre">true</span></code> y <code class="docutils literal"><span class="pre">false</span></code>.</p>
<p>Operadores:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">!</span></code> (Negación lógica)</li>
<li><code class="docutils literal"><span class="pre">&amp;&amp;</span></code> (Conjunción lógica, &#8220;and&#8221;)</li>
<li><code class="docutils literal"><span class="pre">||</span></code> (Disyunción lógica, &#8220;or&#8221;)</li>
<li><code class="docutils literal"><span class="pre">==</span></code> (igualdad)</li>
<li><code class="docutils literal"><span class="pre">!=</span></code> (desigualdad)</li>
</ul>
<p>Los operadores <code class="docutils literal"><span class="pre">||</span></code> 
y <code class="docutils literal"><span class="pre">&amp;&amp;</span></code> 
aplican las normas comunes de cortocircuito. Esto significa que en la expresión 
<code class="docutils literal"><span class="pre">f(x)</span> <span class="pre">||</span> <span class="pre">g(y)</span></code>, 
if <code class="docutils literal"><span class="pre">f(x)</span></code> se evalúa <code class="docutils literal"><span class="pre">true</span></code>, 
<code class="docutils literal"><span class="pre">g(y)</span></code> no se evaluará aunque tenga efectos secundarios.</p>
</div>
<div class="section" id="integers">
<span id="index-3"></span><h5>Enteros<a class="headerlink" href="#integers" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">int</span></code> / <code class="docutils literal"><span class="pre">uint</span></code>: 
Enteros firmados y sin signo de varios tamaños. Las palabras clave <code class="docutils literal"><span class="pre">uint8</span></code> 
to <code class="docutils literal"><span class="pre">uint256</span></code> en pasos de <code class="docutils literal"><span class="pre">8</span></code>
 (sin signo de 8 hasta 256 bits) y <code class="docutils literal"><span class="pre">int8</span></code> to <code class="docutils literal"><span class="pre">
 int256</span></code>. <code class="docutils literal"><span class="pre">uint</span></code> and <code class="docutils literal"><span class="pre">int</span></code>
 son alias para <code class="docutils literal"><span class="pre">uint256</span></code> e <code class="docutils literal"><span class="pre">int256</span></code>,
 respectivamente.</p>
<p>Operadores:</p>
<ul class="simple">
<li>Comparaciones: <code class="docutils literal"><span class="pre">&lt;=</span></code>, 
<code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">==</span></code>, 
<code class="docutils literal"><span class="pre">!=</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code>, 
<code class="docutils literal"><span class="pre">&gt;</span></code> (son de tipo <code class="docutils literal"><span class="pre">booleanos</span></code>)</li>
<li>Operadores de bits: <code class="docutils literal"><span class="pre">&amp;</span></code>, <code class="docutils literal"><span class="pre">|</span></code>, 
<code class="docutils literal"><span class="pre">^</span></code> (bit a bit exclusivo o), <code class="docutils literal"><span class="pre">~</span></code> 
(bit a bit negación)</li>
<li>Los operadores aritméticos: <code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code>, 
unary <code class="docutils literal"><span class="pre">-</span></code>, unary 
<code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">
*</span></code>, <code class="docutils literal"><span class="pre">/</span></code>, <code class="docutils literal"><span class="pre">%</span></code> 
(el residuo de la division), <code class="docutils literal"><span class="pre">**</span></code> (exponentiacion), <code class="docutils literal"><span class="pre">
&lt;&lt;</span></code> (left shift o desplazamiento a la izquierda), <code class="docutils literal"><span class="pre">&gt;&gt;</span></code> 
(right shift o desplazamiento a la derecha)</li>
</ul>
<p>La división siempre trunca (sólo se compila con código de operación del EVM <code class="docutils literal"><span class="pre">DIV</span></code>), 
pero no trunca si ambos operadores son <a class="reference internal" href="#rational-literals"><span class="std std-ref">literals</span></a> 
(o expresiones literales).</p>
<p>División por cero y módulo con cero lanza una excepción de tiempo de ejecución.</p>
<p>El resultado de una operación de cambio es el tipo del operando izquierdo. La expresión
 <code class="docutils literal"><span class="pre">x</span> <span class="pre">&lt;&lt;</span> <span class="pre">y</span></code> es equivalente a
 <code class="docutils literal"><span class="pre">x</span> <span class="pre">*</span> <span class="pre">2**y</span></code>, y 
 <code class="docutils literal"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">y</span></code> 
 es equivalente a <code class="docutils literal"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">2**y</span></code>. 
 Esto significa que se extiende el signo numérico negativo. El cambio de una cantidad negativa arroja una excepción de tiempo de ejecución.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Los resultados producidos por el desplazamiento a la derecha de los valores negativos de tipos enteros 
con signo son diferentes de los producidos por otros lenguajes de programación. En Solidity, desplace 
los mapas de la derecha hasta la división para que los valores negativos desplazados se redondeen 
hacia cero (truncado). En otros lenguajes de programación, el desplazamiento a la derecha de valores 
negativos funciona como la división con el redondeo hacia abajo (hacia el infinito negativo).</p>
</div>
</div>
<div class="section" id="address">
<span id="index-4"></span><span id="id2"></span><h5>Direcciónes<a class="headerlink" href="#address" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">address</span></code>: Contiene un valor de 20 bytes (tamaño de una dirección Ethereum). 
Los tipos de dirección también tienen miembros y sirven como base para todos los contratos.</p>
<p>Operadores:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code> and <code class="docutils literal"><span class="pre">&gt;</span></code></li>
</ul>
<div class="section" id="members-of-addresses">
<span id="id3"></span><h6>Members of Addresses o Miembros de Direcciones<a class="headerlink" href="#members-of-addresses" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">balance</span></code> y <code class="docutils literal"><span class="pre">transfer</span></code></li>
</ul>
<p>Para obtener una referencia rápida, consulte <a class="reference internal" href="index.html#address-related"><span class="std std-ref">Address Related</span></a>.</p>
<p>Es posible consultar el balance de una dirección utilizando la propiedad 
<code class="docutils literal"><span class="pre">balance</span></code>
y enviar Ether (en unidades de wei) a una dirección usando la funcion <code class="docutils literal"><span class="pre">transfer</span></code>:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">address</span> <span class="nx">x</span> <span class="o">=</span> <span class="mh">0x123</span><span class="p">;</span>
<span class="kt">address</span> <span class="nx">myAddress</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">balance</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="nx">myAddress</span><span class="p">.</span><span class="nx">balance</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">x</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si <code class="docutils literal"><span class="pre">x</span></code> es una dirección de contrato, su código 
(más específicamente: su función de fallback, si está presente) se ejecutará junto con la llamada 
<code class="docutils literal"><span class="pre">transfer</span></code> 
 (esto es una limitación del EVM y no se puede evitar). 
 Si esa ejecución se queda sin gas o falla de alguna manera, 
 la transferencia de ether se revertirá y el contrato actual se detendrá con una excepción.</p>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">send</span></code></li>
</ul>
<p>Send es la contraparte de bajo nivel de <code class="docutils literal"><span class="pre">transfer</span></code>. 
Si la ejecución falla, el contrato actual no se detendrá con una excepción, pero <code class="docutils literal"><span class="pre">send</span></code>
retornará <code class="docutils literal"><span class="pre">false</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Hay algunos peligros en el uso de <code class="docutils literal"><span class="pre">send</span></code>: 
La transferencia falla si la profundidad de la pila de llamadas está en 1024 
 (esto siempre puede ser forzado por la persona que llama) y también falla si el 
 receptor se queda sin gas. Así que para hacer transferencias de éter seguro, 
 siempre verifique el valor de retorno de 
 <code class="docutils literal"><span class="pre">send</span></code>, utilice <code class="docutils literal"><span class="pre">transfer</span></code> 
 o incluso mejor: use un patrón donde el destinatario retira el dinero.</p>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">call</span></code>, <code class="docutils literal"><span class="pre">callcode</span></code> y <code class="docutils literal"><span class="pre">delegatecall</span></code></li>
</ul>
<p>Además, para interactuar con contratos que no se adhieren a la ABI, 
se proporciona la función <code class="docutils literal"><span class="pre">call</span></code> 
 que toma un número arbitrario de argumentos de cualquier tipo. 
Estos argumentos se rellenan a 32 bytes y se concatenan. Una excepción es el caso en el que 
el primer argumento está codificado en exactamente cuatro bytes. 
En este caso, no se rellena para permitir el uso de firmas de función aquí.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">address</span> <span class="nx">nameReg</span> <span class="o">=</span> <span class="mh">0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2</span><span class="p">;</span>
<span class="nx">nameReg</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;MyName&quot;</span><span class="p">);</span>
<span class="nx">nameReg</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kt">bytes4</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;fun(uint256)&quot;</span><span class="p">)),</span> <span class="nx">a</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">call</span></code> Devuelve un booleano que indica si la función invocada terminó 
(<code class="docutils literal"><span class="pre">true</span></code>) o si se provocó una excepción EVM 
(<code class="docutils literal"><span class="pre">false</span></code>). No es posible acceder a los datos reales devueltos (para esto necesitaríamos conocer la codificación y el tamaño por adelantado).</p>
<p>De forma similar, la funcion <code class="docutils literal"><span class="pre">delegatecall</span></code> 
se puede utilizar: la diferencia es que sólo se utiliza el código de la dirección dada, todos los demás aspectos (almacenamiento, equilibrio, ...) 
se toman del contrato actual. El propósito de 
<code class="docutils literal"><span class="pre">delegatecall</span></code> 
es utilizar código de la libreria que se almacena en otro contrato. 
El usuario tiene que asegurarse de que el diseño de almacenamiento en ambos contratos 
sea adecuado para que la delegatecall sea usada. 
 Antes de homestead, sólo estaba disponible una variante limitada llamada 
<code class="docutils literal"><span class="pre">callcode</span></code> que no proporcionaba acceso al valor original 
<code class="docutils literal"><span class="pre">msg.sender</span></code> y <code class="docutils literal"><span class="pre">msg.value</span></code>.</p>
<p>Las tres funciones <code class="docutils literal"><span class="pre">call</span></code>, <code class="docutils literal"><span class="pre">delegatecall</span>
</code> y <code class="docutils literal"><span class="pre">callcode</span></code> son funciones de muy bajo nivel y sólo deben utilizarse como un  
<em>último recurso</em> ya que rompen el tipo de seguridad de Solidity.</p>
<p>La opcion<code class="docutils literal"><span class="pre">.gas()</span></code> está disponible en los tres métodos, mientras que la opción 
<code class="docutils literal"><span class="pre">.value()</span></code> no es compatible con  
<code class="docutils literal"><span class="pre">delegatecall</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Todos los contratos heredan los miembros de la dirección, por lo que es posible consultar el saldo del contrato actual utilizando
 <code class="docutils literal"><span class="pre">this.balance</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El uso de <code class="docutils literal"><span class="pre">callcode</span></code> es desalentado y se eliminará en el futuro.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Todas estas funciones son funciones de bajo nivel y deben utilizarse con cuidado. 
Específicamente, cualquier contrato desconocido podría ser malicioso y si lo llamas, 
entregas el control a ese contrato que a su vez podría volver a llamar a tu contrato, 
así que prepárate para cambios en tus variables de estado cuando vuelva la llamada.</p>
</div>
</div>
</div>
<div class="section" id="fixed-size-byte-arrays">
<span id="index-5"></span><h5>Arrays de bytes de tamaño fijo<a class="headerlink" href="#fixed-size-byte-arrays" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">bytes1</span></code>, <code class="docutils literal"><span class="pre">bytes2</span></code>, <code class="docutils literal"><span class="pre">bytes3</span></code>, ..., <code class="docutils literal"><span class="pre">bytes32</span></code>. <code class="docutils literal"><span class="pre">byte</span></code> es un alias para <code class="docutils literal"><span class="pre">bytes1</span></code>.</p>
<p>Operadores:</p>
<ul class="simple">

<li>Comparaciones: <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, 
<code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code>, 
<code class="docutils literal"><span class="pre">&gt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code> 
(son de tipo <code class="docutils literal"><span class="pre">bool</span></code>)</li>
<li>Operadores de bits: <code class="docutils literal"><span class="pre">&amp;</span></code>, <code class="docutils literal"><span class="pre">|</span></code>, 
<code class="docutils literal"><span class="pre">^</span></code> (bit a bit o exclusiva), <code class="docutils literal"><span class="pre">~</span></code> 
(negación bit a bit), <code class="docutils literal"><span class="pre">&lt;&lt;</span></code> (left shift o desplazamiento a la izquierda), 
<code class="docutils literal"><span class="pre">&gt;&gt;</span></code> (right shift o desplazamiento a la derecha)</li>
<li>Índice de Acceso: Si <code class="docutils literal"><span class="pre">x</span></code> es de tipo
<code class="docutils literal"><span class="pre">bytesI</span></code>, a continuación <code class="docutils literal"><span class="pre">x[k]</span></code> 
para <code class="docutils literal"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">k</span> <span class="pre">&lt;</span> <span 
class="pre">I</span></code> devuelve el byte <code class="docutils literal"><span class="pre">k</span></code>º (sólo lectura).</li>
</ul>

<p>
The shifting operator works with any integer type as right operand (but will
return the type of the left operand), which denotes the number of bits to shift by.
Shifting by a negative amount will cause a runtime exception.

El operador de desplazamiento trabaja con cualquier tipo de número entero como operando a la derecha 
(pero devolverá el tipo del operando izquierdo), que indica el número de bits por los que cambiar. 
El cambio de una cantidad negativa causará una excepción de tiempo de ejecución.
</p>

<p>Miembros:</p>
 <ul class="simple">
<li><code class="docutils literal"><span class="pre">.length</span></code> Produce la longitud fija de la matriz de bytes (sólo lectura).</li>
</ul>
</div>
<div class="section" id="dynamically-sized-byte-array">
<h5>Matriz o Array de bytes de tamaño dinámico<a class="headerlink" href="#dynamically-sized-byte-array" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">bytes</span></code>:</dt>
<dd>Matriz de bytes de tamaño dinámico, vea <a class="reference internal" href="#arrays"><span class="std std-ref">Arrays</span></a>. No es un tipo de valor!</dd>
<dt><code class="docutils literal"><span class="pre">string</span></code>:</dt>
<dd>Cadena codificada UTF-8 de tamaño dinámico, vea <a class="reference internal" href="#arrays"><span class="std std-ref">Arrays</span></a>. No es un tipo de valor!</dd>
</dl>
<p>Como regla general, utilice <code class="docutils literal"><span class="pre">bytes</span></code> datos de bytes crudos de longitud arbitraria y datos 
<code class="docutils literal"><span class="pre">string</span></code>
de cadena de longitud arbitraria (UTF-8). Si puede limitar la longitud a un cierto número de bytes, utilice siempre uno de
 <code class="docutils literal"><span class="pre">bytes1</span></code> a <code class="docutils literal"><span class="pre">bytes32</span></code> 
 porque son mucho más baratos.</p>
</div>
<div class="section" id="fixed-point-numbers">
 <span id="index-6"></span><h5>Fixed Point Numbers o Números de puntos fijos<a class="headerlink" href="#fixed-point-numbers" title="Permalink to this headline">¶</a></h5>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Los números de puntos fijos aún no están completamente soportados por Solidity. Pueden ser declarados, pero no se pueden asignar.</p>
</div>
</div>
<div class="section" id="address-literals">
<span id="index-7"></span><span id="id4"></span><h5>Address Literals o Direcciónes Literales<a class="headerlink" href="#address-literals" title="Permalink to this headline">¶</a></h5>
<p>Los literales hexadecimales que pasan la prueba de comprobación de dirección, por ejemplo,
<code class="docutils literal"><span class="pre">0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF</span></code> son de tipo
<code class="docutils literal"><span class="pre">address</span></code>.
Los literales hexadecimales que tienen entre 39 y 41 dígitos de largo y no pasan la prueba de suma de comprobación producen una advertencia 
y son tratados como literales de números racionales regulares.</p>
</div>
<div class="section" id="rational-and-integer-literals">
<span id="rational-literals"></span><span id="index-8"></span><h5>Racionales y Enteros Literales<a class="headerlink" href="#rational-and-integer-literals" title="Permalink to this headline">¶</a></h5>
<p>Los literales enteros se forman a partir de una secuencia de números en el rango de 0-9. Se interpretan como decimales. Por ejemplo,
 <code class="docutils literal"><span class="pre">69</span></code> significa sesenta y nueve. 
 Los literales octales no existen en Solidity y los ceros iniciales son inválidos.</p>
<p>Los literales de fracción decimal están formados por un <code class="docutils literal"><span class="pre">.</span></code> 
con al menos un número en un lado. Los ejemplos incluyen 
<code class="docutils literal"><span class="pre">1.</span></code>, <code class="docutils literal"><span class="pre">.1</span></code> y 
<code class="docutils literal"><span class="pre">1.3</span></code>.</p>
<p>También se admite la notación científica, donde la base puede tener fracciones, mientras que el exponente no puede. Los ejemplos incluyen 
<code class="docutils literal"><span class="pre">2e10</span></code>, <code class="docutils literal"><span class="pre">-2e10</span></code>, <code class="docutils literal"><span class="pre">2e-10</span></code>, <code class="docutils literal"><span class="pre">2.5e1</span></code>.</p>
<p>Las expresiones literales de número conservan precisión arbitraria hasta que se convierten en un tipo no literal 
(es decir, al utilizarlas junto con una expresión no literal). Esto significa que los cálculos no se desbordan 
y las divisiones no se truncan en el número de expresiones literales.</p>
<p>Por ejemplo, <code class="docutils literal"><span class="pre">(2**800</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">-
</span> <span class="pre">2**800</span></code> los resultados en la constante <code class="docutils literal"><span class="pre">1</span></code> 
(de tipo <code class="docutils literal"><span class="pre">uint8</span></code>)
aunque los resultados intermedios ni siquiera se ajustan al lenguaje de la máquina. Además, <code class="docutils literal"><span class="pre">.5
</span> <span class="pre">*</span> <span class="pre">8</span></code> resulta en el entero 
<code class="docutils literal"><span class="pre">4</span></code> (aunque los no enteros se utilizaron en el medio).</p>
<p>Cualquier operador que se puede aplicar a números enteros también se puede aplicar a expresiones literales 
de números siempre y cuando los operandos sean enteros. Si cualquiera de los dos es fraccional, 
las operaciones de bits no son permitidas y la exponenciación se rechaza si el exponente es fraccional 
(porque podría resultar en un número no racional).</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Solidity tiene un número de tipo literal para cada número racional. Los literales enteros y 
los literales de números racionales pertenecen a tipos literales de número. Además, 
todas las expresiones literales numéricas (es decir, las expresiones que contienen 
sólo literales y operadores de números) pertenecen a tipos literales de número. 
Así que el número de expresiones literales <code class="docutils literal"><span class="pre">1
</span> <span class="pre">+</span> <span class="pre">2</span></code> y <code class="docutils literal"><span class="pre">2
</span> <span class="pre">+</span> <span class="pre">1</span></code> 
ambos pertenecen al mismo número de tipo literal para el número racional tres.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">División de literales enteros se utilizaron como truco en versiones anteriores, pero ahora se convertirá en un número racional, es decir,  
<code class="docutils literal"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">2</span></code> no es igual a 
<code class="docutils literal"><span class="pre">2</span></code>, pero si a <code class="docutils literal"><span class="pre">2.5</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las expresiones literales numéricas se convierten en un tipo no literal tan pronto como se utilizan con expresiones no literales. 
Aunque sabemos que el valor de la expresión asignada a <code class="docutils literal"><span class="pre">b</span></code> 
en el siguiente ejemplo se evalúa como un entero, pero la expresión parcial 
<code class="docutils literal"><span class="pre">2.5</span> <span class="pre">+</span> <span class="pre">a</span></code> 
no es aprobada entonces el código no compila.</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint128</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">uint128</span> <span class="nx">b</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="string-literals">
<span id="index-9"></span><h5>String Literals<a class="headerlink" href="#string-literals" title="Permalink to this headline">¶</a></h5>
<p>Los literales de cadena se escriben con comillas dobles o simples 
(<code class="docutils literal"><span class="pre">&quot;foo&quot;</span></code> o <code class="docutils literal"><span class="pre">'bar'</span></code>).  
No implican ceros a la izquierda como en C; <code class="docutils literal"><span class="pre">&quot;foo&quot;</span></code> representa tres bytes no cuatro.  
Al igual que con literales enteros, su tipo puede variar, pero son implícitamente convertibles a <code class="docutils literal"><span class="pre">bytes1</span></code>,
 ..., <code class="docutils literal"><span class="pre">bytes32</span></code>, si encajan, a <code class="docutils literal"><span class="pre">bytes</span></code> 
 y para string a <code class="docutils literal"><span class="pre">string</span></code>.</p>
<p>Los literales de cadenas admiten caracteres de escape, como <code class="docutils literal"><span class="pre">\n</span></code>, 
<code class="docutils literal"><span class="pre">\xNN</span></code> y <code class="docutils literal"><span class="pre">\uNNNN</span></code>. 
<code class="docutils literal"><span class="pre">\xNN</span></code> toma un valor hexadecimal e inserta el byte apropiado, mientras 
<code class="docutils literal"><span class="pre">\uNNNN</span></code> toma un codigo Unicode e inserta una secuencia UTF-8.</p>
</div>
<div class="section" id="hexadecimal-literals">
<span id="index-10"></span><h5>Hexadecimal Literals<a class="headerlink" href="#hexadecimal-literals" title="Permalink to this headline">¶</a></h5>
<p>Los literales hexadecimales están prefijados con la palabra clave <code class="docutils literal"><span class="pre">hex</span></code> 
y están encerrados entre comillas dobles o simples (<code class="docutils literal"><span class="pre">hex&quot;001122FF&quot;</span></code>). 
Su contenido debe ser una cadena hexadecimal y su valor será la representación binaria de esos valores.</p>
<p>Los literales de Hexademical se comportan como literales de la secuencia y tienen las mismas restricciones de la convertibilidad.</p>
</div>
<div class="section" id="enums">
<span id="index-11"></span><span id="id5"></span><h5>Enums<a class="headerlink" href="#enums" title="Permalink to this headline">¶</a></h5>
<p>Enums son una forma de crear un tipo definido por el usuario en Solidity. 
Están explícitamente convertibles a / y desde todos los tipos de entero, 
pero no se permite la conversión implícita. 
Las conversiones explícitas comprueban los rangos de valores en tiempo de ejecución 
y un error produce una excepción. Enums necesita al menos un miembro.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">test</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nx">ActionChoices</span> <span class="p">{</span> <span class="nx">GoLeft</span><span class="p">,</span> <span class="nx">GoRight</span><span class="p">,</span> <span class="nx">GoStraight</span><span class="p">,</span> <span class="nx">SitStill</span> <span class="p">}</span>
    <span class="nx">ActionChoices</span> <span class="nx">choice</span><span class="p">;</span>
    <span class="nx">ActionChoices</span> <span class="k">constant</span> <span class="nx">defaultChoice</span> <span class="o">=</span> <span class="nx">ActionChoices</span><span class="p">.</span><span class="nx">GoStraight</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">setGoStraight</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">choice</span> <span class="o">=</span> <span class="nx">ActionChoices</span><span class="p">.</span><span class="nx">GoStraight</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Puesto que los tipos enum no forman parte de la ABI, la firma &quot;getChoice&quot;</span>
    <span class="c1">// se cambiará automáticamente a &quot;getChoice() returns (uint8)&quot;</span>
    <span class="c1">// para todos los asuntos externos a Solidity. El tipo de entero utilizado es simplemente</span>
    <span class="c1">// lo suficientemente grande como para contener todos los valores de enum, es decir, si tiene más valores, </span>
    <span class="c1">// `uint16` se utilizará y así sucesivamente. </span>
    <span class="kd">function</span> <span class="nx">getChoice</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="nx">ActionChoices</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">choice</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getDefaultChoice</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">uint</span><span class="p">(</span><span class="nx">defaultChoice</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="function-types">
<span id="index-12"></span><span id="id6"></span><h5>Tipos de funciones<a class="headerlink" href="#function-types" title="Permalink to this headline">¶</a></h5>
<p>Son los tipos de funciones. Las variables de tipo de función se pueden asignar desde funciones y 
los parámetros de función de tipo de función se pueden utilizar para pasar funciones y devolver 
funciones de llamadas de función. Los tipos de funciones vienen en dos variantes :
 - <em>internal</em> y <em>external</em> :</p>
<p>Las funciones internas sólo pueden ser llamadas dentro del contrato actual 
(más específicamente, dentro de la unidad de código actual, que también incluye 
funciones de biblioteca interna y funciones heredadas) porque no se pueden ejecutar 
fuera del contexto del contrato actual. Llamar a una función interna se realiza al 
saltar a su etiqueta de entrada, al igual que al llamar una función del contrato actual internamente.</p>
<p>Las funciones externas consisten en una dirección y una firma de función 
y pueden ser pasadas y devueltas por las llamadas de función externas.</p>
<p>Los tipos de funciones se registran de la siguiente manera:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">parameter</span> <span class="nx">types</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span><span class="k">internal</span><span class="o">|</span><span class="k">external</span><span class="p">}</span> <span class="p">[</span><span class="kr">pure</span><span class="o">|</span><span class="k">constant</span><span class="o">|</span><span class="kr">view</span><span class="o">|</span><span class="k">payable</span><span class="p">]</span> <span class="p">[</span><span class="k">returns</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">return</span> <span class="nx">types</span><span class="o">&gt;</span><span class="p">)]</span>
</pre></div>
</div>
<p>En contraste con los tipos de parámetros, los tipos de retorno no pueden estar vacíos - si el tipo de 
función no devuelve nada, se debe omitir toda la parte <code class="docutils literal"><span class="pre">returns
</span> <span class="pre">(&lt;return</span> <span class="pre">types&gt;)</span></code>.</p>
<p>Por defecto, los tipos de función son internos, por lo que la palabra clave
 <code class="docutils literal"><span class="pre">internal</span></code>  se puede omitir. 
 Por el contrario, las funciones de contrato son públicas por defecto, 
 sólo cuando se utilizan como el nombre de un tipo, el valor predeterminado es interno.</p>
<p>Hay dos maneras de acceder a una función en el contrato actual: Ya sea directamente por su nombre  
<code class="docutils literal"><span class="pre">f</span></code>, 
o mediante <code class="docutils literal"><span class="pre">this.f</span></code>. 
La primera resultará en una función interna, la última en una función externa.</p>
<p>Si no se inicializa una variable de tipo de función, llamarla dará lugar a una excepción. 
Lo mismo sucede si llama a una función después de usar <code class="docutils literal"><span class="pre">delete</span></code>.</p>
<p>Si se utilizan tipos de funciones externas fuera del contexto de Solidity, se tratan como de tipo 
<code class="docutils literal"><span class="pre">function</span></code> 
que codifica la dirección seguida por el identificador de función en un solo tipo
<code class="docutils literal"><span class="pre">bytes24</span></code>.</p>
<p>Tenga en cuenta que las funciones públicas del contrato actual pueden utilizarse tanto como una función interna como como una función externa. 
 Para usar <code class="docutils literal"><span class="pre">f</span></code> como una función interna,
sólo usa <code class="docutils literal"><span class="pre">f</span></code>, 
si quieres usar su forma externa, usa <code class="docutils literal"><span class="pre">this.f</span></code>.</p>
<p>Ejemplo que muestra cómo usar los tipos de funciones internas:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
<span class="kd">library</span> <span class="nx">ArrayUtils</span> <span class="p">{</span>
  <span class="c1">// ilas funciones internas se pueden usar en las funciones de biblioteca interna porque </span>
  <span class="c1">// serán parte del mismo contexto de código </span>
  <span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">self</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="nx">f</span><span class="p">)</span>
    <span class="k">internal</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">r</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="nx">self</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span><span class="p">(</span><span class="nx">self</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">reduce</span><span class="p">(</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">self</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="nx">f</span>
  <span class="p">)</span>
    <span class="k">internal</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">r</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="nx">self</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="nx">f</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">self</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">range</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">length</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="nx">length</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Pyramid</span> <span class="p">{</span>
  <span class="k">using</span> <span class="nx">ArrayUtils</span> <span class="k">for</span> <span class="o">*</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">pyramid</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">l</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ArrayUtils</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">l</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">square</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">sum</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">square</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">sum</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">y</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Otro ejemplo que utiliza tipos de funciones externas:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Oracle</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="nx">Request</span> <span class="p">{</span>
    <span class="kt">bytes</span> <span class="nx">data</span><span class="p">;</span>
    <span class="kd">function</span><span class="p">(</span><span class="kt">bytes</span> <span class="k">memory</span><span class="p">)</span> <span class="k">external</span> <span class="nx">callback</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">Request</span><span class="p">[]</span> <span class="nx">requests</span><span class="p">;</span>
  <span class="kd">event</span> <span class="nx">NewRequest</span><span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
  <span class="kd">function</span> <span class="nx">query</span><span class="p">(</span><span class="kt">bytes</span> <span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="kt">bytes</span> <span class="k">memory</span><span class="p">)</span> <span class="k">external</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">requests</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Request</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">));</span>
    <span class="nx">NewRequest</span><span class="p">(</span><span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">reply</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">requestID</span><span class="p">,</span> <span class="kt">bytes</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Aquí se comprueba que la respuesta proviene de una fuente de confianza </span>
    <span class="nx">requests</span><span class="p">[</span><span class="nx">requestID</span><span class="p">].</span><span class="nx">callback</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">OracleUser</span> <span class="p">{</span>
  <span class="nx">Oracle</span> <span class="k">constant</span> <span class="nx">oracle</span> <span class="o">=</span> <span class="nx">Oracle</span><span class="p">(</span><span class="mh">0x1234567</span><span class="p">);</span> <span class="c1">// contrato reconocido</span>
  <span class="kd">function</span> <span class="nx">buySomething</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">oracle</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s2">&quot;USD&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">oracleResponse</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">oracleResponse</span><span class="p">(</span><span class="kt">bytes</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nx">oracle</span><span class="p">));</span>
    <span class="c1">// Usar los datos</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Lambda o funciones en línea están planificadas, pero aún no están soportadas.</p>
</div>
</div>
</div>
<div class="section" id="reference-types">
<span id="index-13"></span><h4>Tipos de referencia<a class="headerlink" href="#reference-types" title="Permalink to this headline">¶</a></h4>
<p>Los tipos complejos, es decir, los tipos que no siempre encajan en 256 bits tienen que ser manejados con 
más cuidado que los tipos de valores que ya hemos visto. Dado que copiarlos puede ser bastante costoso, 
tenemos que pensar si queremos que se almacenen en 
 <strong>memory</strong> (que no es persistente) o en <strong>storage</strong>
(donde se mantienen las variables de estado).</p>
<div class="section" id="data-location">
<h5>Localización de datos<a class="headerlink" href="#data-location" title="Permalink to this headline">¶</a></h5>
<p>Cada tipo complejo, es decir, <em>arrays</em> y <em>structs</em>, tienen una anotación adicional, la
 &#8220;data location&#8221;,   acerca de si se almacena en la memoria o en almacenamiento. 
  Dependiendo del contexto, siempre hay un valor predeterminado, 
  pero se puede anular añadiendo <code class="docutils literal"><span class="pre">storage</span></code> o 
  <code class="docutils literal"><span class="pre">memory</span></code> al tipo. 
  El valor por defecto para los parámetros de la función (incluidos los parámetros de retorno) es  
  <code class="docutils literal"><span class="pre">memory</span></code>, 
  el valor por defecto para las variables locales es <code class="docutils literal"><span class="pre">storage</span></code> 
  y la ubicación es forzada a 
  <code class="docutils literal"><span class="pre">storage</span></code> para las variables de estado (obviamente).</p> 
<p>También hay una tercera ubicación de datos, <code class="docutils literal"><span class="pre">calldata</span></code>, 
que es un área no modificable y no persistente donde se almacenan argumentos de función. Los parámetros de función 
(no los parámetros de retorno) de las funciones externas son forzados a <code class="docutils literal"><span class="pre">calldata</span></code> 
y se comportan principalmente como <code class="docutils literal"><span class="pre">memory</span></code>.</p>
<p>Las ubicaciones de datos son importantes porque cambian la forma en que se comportan las asignaciones: 
las asignaciones entre almacenamiento y memoria y también a una variable de estado (incluso de otras variables de estado) 
siempre crean una copia independiente. Sin embargo, las asignaciones a variables de almacenamiento locales 
sólo asignan una referencia, y esta referencia siempre apunta a la variable de estado incluso si ésta se cambia 
mientras tanto. Por otro lado, las asignaciones de un tipo de referencia almacenado en memoria a otro tipo 
de referencia almacenado en memoria no crean una copia.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// la ubicación de datos de x es storage </span>
    <span class="c1">// la ubicación de los datos es memoryArray </span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">memoryArray</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">memoryArray</span><span class="p">;</span> <span class="c1">// funciona, copia toda la matriz a storage </span>
        <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// trabaja, asigna un puntero, la localización de datos de "y" es storage</span>
        <span class="nx">y</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span> <span class="c1">// fino, devuelve el octavo elemento</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// fino, modifica x a través de y </span>
        <span class="k">delete</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// fino, borra la matriz, también modifica "y"</span>
        <span class="c1">// Lo siguiente no funciona; necesitaría crear una nueva matriz temporal /</span>
        <span class="c1">// sin nombre en storage, pero el almacenamiento está &quot;estáticamente&quot; asignado:</span>
        <span class="c1">// y = memoryArray;</span>
        <span class="c1">// Esto tampoco funciona, ya que restablecerá &quot;reset&quot; el puntero, pero no</span>
        <span class="c1">// hay ninguna ubicación razonable a la que pueda apuntar.</span>
        <span class="c1">// delete y;</span>
        <span class="nx">g</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// llama g, entregando una referencia a x </span>
        <span class="nx">h</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// llama h y crea una copia independiente y temporal en la memoria</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">storage</span> <span class="nx">storageArray</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{}</span>
    <span class="kd">function</span> <span class="nx">h</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">memoryArray</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="summary">
<h6>Resumen<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt>Localización de datos forzados:</dt>
<dd><ul class="first last simple">
<li>parámetros (no return) de funciones externas: calldata</li>
<li>variables de estado: storage</li>
</ul>
</dd>
<dt>Ubicación de los datos predeterminados:</dt>
<dd><ul class="first last simple">
<li>parámetros (también los return) de las funciones: memory</li>
<li>todas las demás variables locales: storage</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="arrays">
<span id="index-14"></span><span id="id7"></span><h5>Arrays o Matrices<a class="headerlink" href="#arrays" title="Permalink to this headline">¶</a></h5>
<p>Las matrices pueden tener un tamaño fijo en tiempo de compilación o pueden ser dinámicas. 
Para los arrays de storage, el tipo de elemento puede ser arbitrario 
(es decir, también otros arrays, mappings o structs). Para matrices de memory, 
no puede ser una asignación "mapping" y tiene que ser un tipo ABI 
si es un argumento de una función públicamente visible.</p>
<p>Una matriz de tamaño fijo <code class="docutils literal"><span class="pre">k</span></code> 
y tipo de elemento <code class="docutils literal"><span class="pre">T</span></code> 
se escribe como <code class="docutils literal"><span class="pre">T[k]</span></code>,
una matriz de tamaño dinámico como <code class="docutils literal"><span class="pre">T[]</span></code>. Como un ejemplo, una matriz dinámica de 5 posiciones  de 
<code class="docutils literal"><span class="pre">uint</span></code> es <code class="docutils literal"><span class="pre">uint[][5]</span></code> 
(tenga en cuenta que la notación se invierte en comparación con algunos otros lenguajes).  
Para acceder a la segunda uint en la tercera posicion de la matriz dinámica, se utiliza  
<code class="docutils literal"><span class="pre">x[2][1]</span></code> 
(los índices son basados ​​en cero y el acceso funciona de manera opuesta a la declaración, es decir, 
<code class="docutils literal"><span class="pre">x[2]</span></code>
se corta un nivel en el tipo de la derecha).</p>
<p>Las Variables de tipo <code class="docutils literal"><span class="pre">bytes</span></code> 
y <code class="docutils literal"><span class="pre">string</span></code> 
son matrices especiales. Un <code class="docutils literal"><span class="pre">bytes</span></code> 
es similar a <code class="docutils literal"><span class="pre">byte[]</span></code>,
pero se empaqueta firmemente en calldata. <code class="docutils literal"><span class="pre">string</span></code> 
es igual a <code class="docutils literal"><span class="pre">bytes</span></code> 
pero no permite acceso de longitud "length" o índice "index" (por ahora).</p>
<p>Así que siempre se debe preferir <code class="docutils literal"><span class="pre">bytes</span></code> 
 over <code class="docutils literal"><span class="pre">byte[]</span></code> porque es más barato.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si desea acceder a la representación de bytes de un string <code class="docutils literal"><span class="pre">s</span></code>, use
<code class="docutils literal"><span class="pre">bytes(s).length</span></code> / <code class="docutils literal"><span class="pre">bytes(s)[7]
</span> <span class="pre">=</span> <span class="pre">'x';</span></code>. 
Tenga en cuenta que está accediendo a los bytes de bajo nivel de la representación UTF-8, 
y no a los caracteres individuales!</p>
</div>
<p>Es posible marcar arrays como <code class="docutils literal"><span class="pre">public</span></code> y permitir a Solidity crear un 
<a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getter</span></a>.
El índice numérico se convertirá en un parámetro necesario para el getter.</p>
<div class="section" id="allocating-memory-arrays">
<span id="index-15"></span><h6>Asignación de matrices de memoria (Allocating Memory Arrays)<a class="headerlink" href="#allocating-memory-arrays" title="Permalink to this headline">¶</a></h6>
<p>Se pueden crear de Arrays con longitud variable en memory utilizando la palabra clave <code class="docutils literal"><span class="pre">new</span></code>. 
A diferencia de los Arrays en storage, que <strong>no</strong> es posible cambiar el tamaño de memory arrays mediante la asignación al miembro
<code class="docutils literal"><span class="pre">.length</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
   <span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="mi">7</span><span class="p">);</span>
        <span class="kt">bytes</span> <span class="k">memory</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="nx">len</span><span class="p">);</span>
        <span class="c1">// Aquí tenemos a .length == 7 y b.length == len</span>
        <span class="nx">a</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="array-literals-inline-arrays">
<span id="index-16"></span><h6>Array Literales / Arrays en Línea<a class="headerlink" href="#array-literals-inline-arrays" title="Permalink to this headline">¶</a></h6>
<p>Los arrays literales son arreglos que se escriben como una expresión y no se asignan a una variable de inmediato.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">g</span><span class="p">([</span><span class="kt">uint</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nx">_data</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El tipo de una matriz literal es un memory array de tamaño fijo cuyo tipo de base es el tipo común de los elementos dados. El tipo de 
<code class="docutils literal"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> es
<code class="docutils literal"><span class="pre">uint8[3]</span> <span class="pre">memory</span></code>, 
porque el tipo de cada una de estas constantes es <code class="docutils literal"><span class="pre">uint8</span></code>.
Debido a eso, fue necesario convertir el primer elemento en el ejemplo anterior a 
<code class="docutils literal"><span class="pre">uint</span></code>. 
Tenga en cuenta que en la actualidad, las matrices de memoria de tamaño fijo no se pueden asignar 
a matrices de memoria de tamaño dinámico, es decir, no es posible lo siguiente:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// Esto no compilará.</span>

<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// La siguiente línea crea un error de tipo porque uint [3] memory </span>
        <span class="c1">// no se puede convertir en uint [] memory. </span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Se planea eliminar esta restricción en el futuro, pero actualmente crea algunas complicaciones debido a cómo los arrays se pasan en el ABI.</p>
</div>
<div class="section" id="members">
<span id="index-17"></span><h6>Members o Miembros<a class="headerlink" href="#members" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><strong>longitud "length"</strong>:</dt>
<dd>Las matrices tienen un miembro <code class="docutils literal"><span class="pre">length</span></code> para mantener su número de elementos. 
Los arrays dinámicos se pueden cambiar el tamaño en el almacenamiento "storage" (no en la memoria "memory") cambiando el miembro
<code class="docutils literal"><span class="pre">.length</span></code>. 
Esto no ocurre automáticamente al intentar acceder a elementos fuera de la longitud actual. 
El tamaño de las matrices de memoria es fijo (pero dinámico, es decir, 
puede depender de los parámetros de tiempo de ejecución) una vez que se crean.</dd>
<dt><strong>push</strong>:</dt>
<dd>Arrays de almacenamiento dinámico y <code class="docutils literal"><span class="pre">bytes</span></code> 
(no <code class="docutils literal"><span class="pre">string</span></code>) tienen un miembro o función de llamada  
<code class="docutils literal"><span class="pre">push</span></code> 
que se puede utilizar para añadir un elemento al final de la matriz. La función devuelve la nueva longitud.</dd>
</dl>
<div class="admonition warning">Advertencia</p>
<p class="last">Todavía no es posible utilizar matrices de matrices en funciones externas.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p>Debido a las limitaciones del EVM, no es posible devolver 
el contenido dinámico de las llamadas de función externas. La función <code class="docutils literal"><span class="pre">f</span></code> en
<code class="docutils literal"><span class="pre">contract</span> <span class="pre">C</span> <span class="pre">{</span> <span class="pre">function
</span> <span class="pre">f()</span> <span class="pre">returns</span> <span class="pre">(uint[])</span> <span class="pre">{</span> <span class="pre">...
</span> <span class="pre">}</span> <span class="pre">}</span></code> 
devolverá algo si se llama desde web3.js, pero no si se llama desde Solidity.</p>
<p class="last">La única solución para ahora es utilizar grandes matrices de tamaño estático.</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">ArrayContract</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="mi">20</span><span class="p">]</span> <span class="nx">m_aLotOfIntegers</span><span class="p">;</span>
    <span class="c1">// Observe que lo siguiente no es un par de matrices dinámicas sino una</span>
    <span class="c1">// matriz dinámica de pares (es decir, matrices de tamaño fijo de longitud dos).</span>
    <span class="kt">bool</span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span> <span class="nx">m_pairsOfFlags</span><span class="p">;</span>
    <span class="c1">// newPairs se almacena en la memoria - el valor predeterminado para los argumentos de la función</span>

    <span class="kd">function</span> <span class="nx">setAllFlagPairs</span><span class="p">(</span><span class="kt">bool</span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span> <span class="nx">newPairs</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// la asignación a una matriz de almacenamiento reemplaza la matriz completa </span>
        <span class="nx">m_pairsOfFlags</span> <span class="o">=</span> <span class="nx">newPairs</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">setFlagPair</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">index</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">flagA</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">flagB</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// el acceso a un índice no existente lanzará una excepción </span>
        <span class="nx">m_pairsOfFlags</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">flagA</span><span class="p">;</span>
        <span class="nx">m_pairsOfFlags</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">flagB</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">changeFlagArraySize</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">newSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// si el nuevo tamaño es menor, los elementos de matriz eliminados se borrarán </span>
        <span class="nx">m_pairsOfFlags</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">newSize</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">clear</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// estos borran  los arrays completamente</span>
        <span class="k">delete</span> <span class="nx">m_pairsOfFlags</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">m_aLotOfIntegers</span><span class="p">;</span>
        <span class="c1">// efecto idéntico aquí </span>
        <span class="nx">m_pairsOfFlags</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bytes</span> <span class="nx">m_byteData</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">byteArrays</span><span class="p">(</span><span class="kt">bytes</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// matrices de bytes ( "bytes") son diferentes, ya que se almacenan sin relleno,</span>
        <span class="c1">// pero se pueden tratar idéntica a "uint8 []" </span>
        <span class="nx">m_byteData</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="nx">m_byteData</span><span class="p">.</span><span class="nx">length</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>
        <span class="nx">m_byteData</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">m_byteData</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">addFlag</span><span class="p">(</span><span class="kt">bool</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="nx">flag</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">m_pairsOfFlags</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">flag</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">createMemoryArray</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">size</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Los arrays de memoria dinámica se crean usando `new`:</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span> <span class="k">memory</span> <span class="nx">arrayOfPairs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[</span><span class="mi">2</span><span class="p">][](</span><span class="nx">size</span><span class="p">);</span>
        <span class="c1">// Crear una matriz de bytes dinámicos: </span>
        <span class="kt">bytes</span> <span class="k">memory</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kt">byte</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">b</span><span class="p">;</span>
    <span class="p">}</span>
 span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="structs">
<span id="index-18"></span><span id="id8"></span><h5>Structs<a class="headerlink" href="#structs" title="Permalink to this headline">¶</a></h5>
<p>Solidity proporciona una forma de definir nuevos tipos en forma de estructuras, que se muestra en el siguiente ejemplo:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">CrowdFunding</span> <span class="p">{</span>
    <span class="c1">// Define un nuevo tipo con dos campos.</span>
    <span class="kd">struct</span> <span class="nx">Funder</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="nx">addr</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">struct</span> <span class="nx">Campaign</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="nx">beneficiary</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">fundingGoal</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">numFunders</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">amount</span><span class="p">;</span>
        <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="nx">Funder</span><span class="p">)</span> <span class="nx">funders</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">uint</span> <span class="nx">numCampaigns</span><span class="p">;</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="nx">Campaign</span><span class="p">)</span> <span class="nx">campaigns</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">newCampaign</span><span class="p">(</span><span class="kt">address</span> <span class="nx">beneficiary</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">goal</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">campaignID</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">campaignID</span> <span class="o">=</span> <span class="nx">numCampaigns</span><span class="o">++</span><span class="p">;</span> <span class="c1">// campaign ID es la variable de retorno</span>
        <span class="c1">// Crea nueva estructura y guarda en almacenamiento. Dejamos de lado el tipo de mapeo..</span>
        <span class="nx">campaigns</span><span class="p">[</span><span class="nx">campaignID</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Campaign</span><span class="p">(</span><span class="nx">beneficiary</span><span class="p">,</span> <span class="nx">goal</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">contribute</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">campaignID</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">Campaign</span> <span class="k">storage</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">campaigns</span><span class="p">[</span><span class="nx">campaignID</span><span class="p">];</span>
        <span class="c1">// Crea una nueva estructura de memoria temporal, inicializada con los valores dados </span>
        <span class="c1">// y la copia en el almacenamiento.</span>
        <span class="c1">// Observe que también puede usar Funder (msg.sender, msg.value) para inicializar. </span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">funders</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">numFunders</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Funder</span><span class="p">({</span><span class="nx">addr</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">amount</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">amount</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">checkGoalReached</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">campaignID</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="nx">reached</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Campaign</span> <span class="k">storage</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">campaigns</span><span class="p">[</span><span class="nx">campaignID</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">amount</span> <span class="o">&lt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">fundingGoal</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">amount</span><span class="p">;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">beneficiary</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amount</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El contrato no ofrece la funcionalidad completa de un contrato de crowdfunding, 
pero contiene los conceptos básicos necesarios para entender las estructuras. 
Los tipos de estructura se pueden utilizar dentro de mappings y arrays y ellos 
mismos pueden contener mappings y arrays.</p>
<p>No es posible que una estructura contenga un miembro de su propio tipo, 
aunque la estructura misma puede ser el tipo de valor de un miembro de asignación(mapping). 
Esta restricción es necesaria, ya que el tamaño de la estructura tiene que ser finito.</p>
<p>Observe cómo en todas las funciones, un tipo de estructura se asigna a una variable local 
(de la ubicación de datos de almacenamiento predeterminada). Esto no copia la estructura 
pero sólo almacena una referencia para que las asignaciones a los miembros de la variable 
local realmente poder escribir en el estado.</p>
<p>Por supuesto, también puede acceder directamente a los miembros de la estructura sin asignarla a una variable local, como en
<code class="docutils literal"><span class="pre">campaigns[campaignID].amount</span> <span class="pre">=</span> <span class="pre">0</span></code>.</p>
</div>
</div>
<div class="section" id="mappings">
<span id="index-19"></span><h4>Mappings o Asignaciones <a class="headerlink" href="#mappings" title="Permalink to this headline">¶</a></h4>
<p>Mapping types o Los tipos de asignación se declaran como <code class="docutils literal"><span class="pre">mapping(_KeyType</span> <span class="pre">=&gt;</span> <span class="pre">_ValueType)</span></code>.
Aquí <code class="docutils literal"><span class="pre">_KeyType</span></code> 
puede haber casi cualquier tipo excepto un mapeo, una matriz de tamaño dinámico, un contrato, un enum y una estructura. 
<code class="docutils literal"><span class="pre">_ValueType</span></code> puede ser de cualquier tipo, incluyendo asignaciones (mappings).</p>
<p>Las asignaciones se pueden ver como <a class="reference external" href="https://en.wikipedia.org/wiki/Hash_table">hash tables</a> 
que están virtualmente inicializadas de tal manera que cada clave 
posible existe y se asigna a un valor cuya representación de bytes es todos ceros: el 
<a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a> de un tipo. 
La similitud termina aquí, sin embargo: Los datos de la llave no se almacenan realmente en una correspondencia "mapping", solamente su 
<code class="docutils literal"><span class="pre">keccak256</span></code> hash usado para mirar para arriba el valor.</p>
<p>Debido a esto, las asignaciones no tienen una longitud o un concepto de una clave o valor que se "establece". &#8220;set&#8221;.</p>
<p>Las asignaciones sólo se permiten para variables de estado (o como tipos de referencia de almacenamiento en funciones internas).</p>
<p>Es posible declarar asignaciones <code class="docutils literal"><span class="pre">public</span></code> 
y permitir a Solidity crear un <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getter</span></a>.
El <code class="docutils literal"><span class="pre">_KeyType</span></code> se convertirá en un parámetro necesario para el getter y retornará 
<code class="docutils literal"><span class="pre">_ValueType</span></code>.</p>
<p>El <code class="docutils literal"><span class="pre">_ValueType</span></code> puede ser un mapping tambien. El getter tendrá un parámetro para cada uno
 <code class="docutils literal"><span class="pre">_KeyType</span></code>, recursivamente.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">contract</span> <span class="nx">MappingExample</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="nx">balances</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">newBalance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newBalance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">MappingUser</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">MappingExample</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MappingExample</span><span class="p">();</span>
        <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">balances</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las asignaciones no son iterables, pero es posible implementar una estructura de datos encima de ellas. Para ver un ejemplo, consulte 
<a class="reference external" href="https://github.com/ethereum/dapp-bin/blob/master/library/iterable_mapping.sol">iterable mapping</a>.</p>
</div>
</div>
<div class="section" id="operators-involving-lvalues">
<span id="index-20"></span><h4>Operadores con LValues<a class="headerlink" href="#operators-involving-lvalues" title="Permalink to this headline">¶</a></h4>
<p>Si <code class="docutils literal"><span class="pre">a</span></code> 
es un LValue (es decir, una variable o algo que se puede asignar a), los siguientes operadores están disponibles como abreviaturas:</p>
<p><code class="docutils literal"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">e</span></code> Es equivalente a 
<code class="docutils literal"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">+
</span> <span class="pre">e</span></code>. Los operadores <code class="docutils literal"><span class="pre">-=</span></code>, 
<code class="docutils literal"><span class="pre">*=</span></code>, <code class="docutils literal"><span class="pre">/=</span></code>, 
<code class="docutils literal"><span class="pre">%=</span></code>, <code class="docutils literal"><span class="pre">a</span> <span class="pre">|=</span></code>, 
<code class="docutils literal"><span class="pre">&amp;=</span></code> y <code class="docutils literal"><span class="pre">^=</span></code> se definen en consecuencia. 
<code class="docutils literal"><span class="pre">a++</span></code> y <code class="docutils literal"><span class="pre">a--</span></code> son equivalentes a 
<code class="docutils literal"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">1</span></code> / 
<code class="docutils literal"><span class="pre">a</span> <span class="pre">-=</span> <span class="pre">1</span></code> 
pero la expresión misma todavía tiene el valor anterior de <code class="docutils literal"><span class="pre">a</span></code>. 
Por el contrario, <code class="docutils literal"><span class="pre">--a</span></code> y <code class="docutils literal"><span class="pre">++a</span></code> 
tienen el mismo efecto sobre <code class="docutils literal"><span class="pre">a</span></code> pero retorna el valor después del cambio.</p>
<div class="section" id="delete">
<h5>delete o eliminar<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">delete</span> <span class="pre">a</span></code> 
asigna el valor inicial para el tipo en <code class="docutils literal"><span class="pre">a</span></code>. 
Es decir, para enteros es equivalente a <code class="docutils literal"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">0</span></code>, 
pero también se puede utilizar en arrays, donde asigna una matriz dinámica de longitud cero o una matriz estática 
de la misma longitud con todos los elementos restablecidos. Para structs, asigna una estructura con todos los miembros restablecidos.</p>
<p><code class="docutils literal"><span class="pre">delete</span></code> 



has no effect on whole mappings (as the keys of mappings may be arbitrary and are generally unknown). 
So if you delete a struct, it will reset all members that are not mappings and also recurse into the 
members unless they are mappings. However, individual keys and what they map to can be deleted.

no tiene ningún efecto en las asignaciones completas (ya que las claves de las asignaciones pueden ser 
arbitrarias y generalmente son desconocidas). Así que si eliminas una estructura, restablecerá todos 
los miembros que no sean asignaciones y también recursar en los miembros a menos que sean asignaciones. 
Sin embargo, las claves individuales y lo que se asignan a se pueden eliminar.
</p>

 

<p>Es importante notar que <code class="docutils literal"><span class="pre">delete</span> <span class="pre">a</span></code> 
realmente se comporta como una asignación  <code class="docutils literal"><span class="pre">a</span></code>, es decir, almacena un nuevo objeto en 
<code class="docutils literal"><span class="pre">a</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">contract</span> <span class="nx">DeleteExample</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">data</span><span class="p">;</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">dataArray</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// establece x en 0, no afecta data</span>
        <span class="k">delete</span> <span class="nx">data</span><span class="p">;</span> <span class="c1">// establece a data en 0, no afecta a x que todavía tiene una copia</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">dataArray</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">dataArray</span><span class="p">;</span> <span class="c1">// esto establece dataArray.length a cero, pero como uint [] es un objeto complejo, también </span>
        <span class="c1">// se afecta a "y" es un alias al objeto de almacenamiento </span>
        <span class="c1">// Por otro lado: "delete y" no es válido, como asignaciones a variables locales </span>
        <span class="c1">// referenciar objetos de almacenamiento sólo puede hacerse a partir de objetos de almacenamiento existentes.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="conversions-between-elementary-types">
<span id="index-21"></span><h4>Conversiones entre tipos elementales<a class="headerlink" href="#conversions-between-elementary-types" title="Permalink to this headline">¶</a></h4>
<div class="section" id="implicit-conversions">
<h5>Conversiones implícitas<a class="headerlink" href="#implicit-conversions" title="Permalink to this headline">¶</a></h5>
<p>Si un operador se aplica a diferentes tipos, el compilador intenta convertir implícitamente 
uno de los operandos al tipo de otro (lo mismo es cierto para las asignaciones). En general, 
una conversión implícita entre el valor de tipo es posible si tiene sentido semántico y no 
se pierde información: 
<code class="docutils literal"><span class="pre">uint8</span></code> es convertible a
<code class="docutils literal"><span class="pre">uint16</span></code> y <code class="docutils literal"><span class="pre">int128</span></code> 
a <code class="docutils literal"><span class="pre">int256</span></code>, pero <code class="docutils literal"><span class="pre">int8</span></code> 
no es convertible a <code class="docutils literal"><span class="pre">uint256</span></code>
(porque <code class="docutils literal"><span class="pre">uint256</span></code> no lo soporta por ejemplo 
<code class="docutils literal"><span class="pre">-1</span></code>).
Además, los enteros sin signo se pueden convertir en bytes del mismo tamaño o mayor, pero no viceversa. 
Cualquier tipo que se puede convertir a <code class="docutils literal"><span class="pre">uint160</span></code> 
también se puede convertir a <code class="docutils literal"><span class="pre">address</span></code>.</p>
</div>
<div class="section" id="explicit-conversions">
<h5>Conversiones explícitas<a class="headerlink" href="#explicit-conversions" title="Permalink to this headline">¶</a></h5>
<p>Si el compilador no permite la conversión implícita pero sabe lo que está haciendo, 
a veces es posible una conversión de tipo explícita. Tenga en cuenta que esto puede 
darle un comportamiento inesperado así que asegúrese de probar para asegurarse de 
que el resultado es lo que desea! Tome el ejemplo siguiente en el que está 
convirtiendo un negativo <code class="docutils literal"><span class="pre">int8</span></code> en un 
<code class="docutils literal"><span class="pre">uint</span></code>:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">int8</span> <span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
<span class="kt">uint</span> <span class="nx">x</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
</pre></div>
</div>
<p>Al final de este fragmento de código, <code class="docutils literal"><span class="pre">x</span></code> 
tendrá el valor <code class="docutils literal"><span class="pre">0xfffff..fd</span></code> 
(64 caracteres hexadecimales), que es -3 en la representación del complemento de dos de 256 bits.</p>
<p>Si un tipo se convierte explícitamente en un tipo más pequeño, los bits de orden superior se cortan:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint32</span> <span class="nx">a</span> <span class="o">=</span> <span class="mh">0x12345678</span><span class="p">;</span>
<span class="kt">uint16</span> <span class="nx">b</span> <span class="o">=</span> <span class="kt">uint16</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span> <span class="c1">// b será 0x5678 ahora
</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="type-deduction">
<span id="index-22"></span><span id="id9"></span><h4>Tipos de Deduccion<a class="headerlink" href="#type-deduction" title="Permalink to this headline">¶</a></h4>
<p>Por comodidad, no siempre es necesario especificar explícitamente el tipo de una variable, 
el compilador lo infiere automáticamente del tipo de la primera expresión asignada a la variable:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint24</span> <span class="nx">x</span> <span class="o">=</span> <span class="mh">0x123</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
</pre></div>
</div>
<p>Aquí, el tipo de <code class="docutils literal"><span class="pre">y</span></code> será <code class="docutils literal"><span class="pre">uint24</span></code>. 
El uso de <code class="docutils literal"><span class="pre">var</span></code> no es posible para parámetros de función o parámetros de retorno.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">El tipo sólo se deduce de la primera asignación, por lo que el bucle en el fragmento siguiente es infinito, ya que 
<code class="docutils literal"><span class="pre">i</span></code> tendrá el tipo
<code class="docutils literal"><span class="pre">uint8</span></code> y cualquier valor de este tipo es menor que 
<code class="docutils literal"><span class="pre">2000</span></code>.
<code class="docutils literal"><span class="pre">for</span> <span class="pre">(var</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">2000;</span> <span class="pre">i++)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code></p>
</div>
</div>
</div>
<span id="document-units-and-global-variables"></span><div class="section" id="units-and-globally-available-variables">
<h3>Unidades y variables disponibles globalmente<a class="headerlink" href="#units-and-globally-available-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ether-units">
<span id="index-0"></span><h4>Unidades de Éther<a class="headerlink" href="#ether-units" title="Permalink to this headline">¶</a></h4>
<p>Un número literal puede tomar un sufijo de <code class="docutils literal"><span class="pre">wei</span></code>, 
<code class="docutils literal"><span class="pre">finney</span></code>, <code class="docutils literal"><span class="pre">szabo</span></code> 
o <code class="docutils literal"><span class="pre">ether</span></code> 
para convertirse entre las subdenominaciones de ether, donde los números de moneda Ether sin un sufijo seran por defecto Wei, por ejemplo,
<code class="docutils literal"><span class="pre">2</span> <span class="pre">ether</span> <span class="pre">==</span> <span class="pre">2000
</span> <span class="pre">finney</span></code> es evaluado a  <code class="docutils literal"><span class="pre">true</span></code>.</p>
</div>
<div class="section" id="time-units">
<span id="index-1"></span><h4>Unidades de tiempo<a class="headerlink" href="#time-units" title="Permalink to this headline">¶</a></h4>
<p>Sufijos como <code class="docutils literal"><span class="pre">seconds</span></code>, <code class="docutils literal"><span class="pre">minutes</span></code>, 
<code class="docutils literal"><span class="pre">hours</span></code>, <code class="docutils literal"><span class="pre">days</span></code>, 
<code class="docutils literal"><span class="pre">weeks</span></code> y
<code class="docutils literal"><span class="pre">years</span></code> 
 después de los números literales se pueden utilizar para convertir entre unidades de tiempo 
 donde segundos son la unidad base y las unidades se consideran nativamente de la siguiente forma:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">==</span> <span class="pre">1</span> <span class="pre">seconds</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">minutes</span> <span class="pre">==</span> <span class="pre">60</span> <span class="pre">seconds</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">hours</span> <span class="pre">==</span> <span class="pre">60</span> <span class="pre">minutes</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">days</span> <span class="pre">==</span> <span class="pre">24</span> <span class="pre">hours</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">weeks</span> <span class="pre">==</span> <span class="pre">7</span> <span class="pre">days</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">years</span> <span class="pre">==</span> <span class="pre">365</span> <span class="pre">days</span></code></li>
</ul>
</div></blockquote> 
<p>Tenga cuidado si realiza cálculos de calendario usando estas unidades, 
porque no todos los años equivale a 365 días y ni siquiera cada día tiene 24 horas debido a
<a class="reference external" href="https://en.wikipedia.org/wiki/Leap_second">segundos de salto</a>.
Debido al hecho de que los segundos de salto no se pueden predecir, una biblioteca de calendario exacta tiene que ser actualizada por un oráculo externo.</p>
<p>Estos sufijos no se pueden aplicar a las variables. Si desea interpretar alguna variable de entrada, 
por ejemplo, días, puede hacerlo de la siguiente manera:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">start</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">daysAfter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">&gt;=</span> <span class="nx">start</span> <span class="o">+</span> <span class="nx">daysAfter</span> <span class="o">*</span> <span class="mi">1</span> <span class="kt">days</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="special-variables-and-functions">
<h4>Variables especiales y funciones<a class="headerlink" href="#special-variables-and-functions" title="Permalink to this headline">¶</a></h4>
<p>Hay variables y funciones especiales que siempre existen en el espacio de nombres global 
y se utilizan principalmente para proporcionar información sobre la blockchain.</p>
<div class="section" id="block-and-transaction-properties">
<span id="index-2"></span><h5>Propiedades de bloques y transacciones<a class="headerlink" href="#block-and-transaction-properties" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">block.blockhash(uint</span> <span class="pre">blockNumber)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: 
hash del bloque dado - sólo funciona para los 256 bloques más recientes excluyendo el actual</li>
<li><code class="docutils literal"><span class="pre">block.coinbase</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): 
la dirección actual del minero del bloque</li>
<li><code class="docutils literal"><span class="pre">block.difficulty</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): 
dificultad de bloque actual</li>
<li><code class="docutils literal"><span class="pre">block.gaslimit</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): 
limite de gas del bloque actual</li>
<li><code class="docutils literal"><span class="pre">block.number</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): 
número de bloque actual</li>
<li><code class="docutils literal"><span class="pre">block.timestamp</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): 
 timestamp del bloque actual como segundos desde la época de unix</li>
<li><code class="docutils literal"><span class="pre">msg.data</span></code> (<code class="docutils literal"><span class="pre">bytes</span></code>): 
calldata completo</li>
<li><code class="docutils literal"><span class="pre">msg.gas</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): 
gas residual</li>
<li><code class="docutils literal"><span class="pre">msg.sender</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): 
remitente del mensaje (llamada actual)</li>
<li><code class="docutils literal"><span class="pre">msg.sig</span></code> (<code class="docutils literal"><span class="pre">bytes4</span></code>): 
primeros cuatro bytes de los calldata (es decir, identificador de función)</li>
<li><code class="docutils literal"><span class="pre">msg.value</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): 
número de wei enviado con el mensaje</li>
<li><code class="docutils literal"><span class="pre">now</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): 
marca de tiempo de bloque actual (alias para <code class="docutils literal"><span class="pre">block.timestamp</span></code>)</li>
<li><code class="docutils literal"><span class="pre">tx.gasprice</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): 
precio del gas de la transacción</li>
<li><code class="docutils literal"><span class="pre">tx.origin</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): 
remitente de la transacción (llamada de cadena completa)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Los valores de todos los miembros de <code class="docutils literal"><span class="pre">msg</span></code>, 
incluyendo <code class="docutils literal"><span class="pre">msg.sender</span></code> y
<code class="docutils literal"><span class="pre">msg.value</span></code> pueden cambiar para cada llamada de función <strong>external</strong>.
Esto incluye llamadas a funciones de biblioteca.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si desea implementar restricciones de acceso en las funciones de la biblioteca utilizando
<code class="docutils literal"><span class="pre">msg.sender</span></code>, tiene que suministrar manualmente el valor de
<code class="docutils literal"><span class="pre">msg.sender</span></code> como un argumento.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Los hashes de bloques no están disponibles para todos los bloques por razones de escalabilidad. 
Sólo puede acceder a los hashes de los últimos 256 bloques, todos los demás valores serán cero.</p>
</div>
</div>
<div class="section" id="error-handling">
<span id="index-3"></span><h5>Manejo de errores<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">assert(bool</span> <span class="pre">condition)</span></code>:</dt>
<dd>Se arroja si la condición no se cumple - para ser utilizado para errores internos.</dd>
<dt><code class="docutils literal"><span class="pre">require(bool</span> <span class="pre">condition)</span></code>:</dt>
<dd>Se arroja si la condición no se cumple - para ser utilizado para errores en entradas o componentes externos.</dd>
<dt><code class="docutils literal"><span class="pre">revert()</span></code>:</dt>
<dd>cancelar la ejecución y revertir los cambios de estado</dd>
</dl>
</div>
<div class="section" id="mathematical-and-cryptographic-functions">
<span id="index-4"></span><h5>Funciones matemáticas y criptográficas<a class="headerlink" href="#mathematical-and-cryptographic-functions" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">addmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,
</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>:</dt>
<dd>calcula  <code class="docutils literal"><span class="pre">(x</span> <span class="pre">+</span> <span class="pre">y)</span> <span class="pre">%
</span> <span class="pre">k</span></code> donde la adición se realiza con precisión arbitraria y no se envuelve en <code class="docutils literal"><span class="pre">2**256</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">mulmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,
</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>:</dt>
<dd>calcula <code class="docutils literal"><span class="pre">(x</span> <span class="pre">*</span> <span class="pre">y)
</span> <span class="pre">%</span> <span class="pre">k</span></code> 
donde la multiplicación se realiza con precisión arbitraria y no se envuelve en <code class="docutils literal"><span class="pre">2**256</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">keccak256(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>:</dt>
<dd>calcula el hash Ethereum-SHA-3 (Keccak-256) de los argumentos (tightly packed o firmemente empacados)</dd>
<dt><code class="docutils literal"><span class="pre">sha256(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>:</dt>
<dd>calcula el hash SHA-256 de los argumentos (tightly packed o firmemente empacados)</dd>
<dt><code class="docutils literal"><span class="pre">sha3(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>:</dt>
<dd>alias to <code class="docutils literal"><span class="pre">keccak256</span></code></dd>
<dt><code class="docutils literal"><span class="pre">ripemd160(...)</span> <span class="pre">returns</span> <span class="pre">(bytes20)</span></code>:</dt>
<dd>calcular RIPEMD-160 hash de los argumentos (tightly packed o firmemente empacados)</dd>
<dt><code class="docutils literal"><span class="pre">ecrecover(bytes32</span> <span class="pre">hash,</span> <span class="pre">uint8</span> <span class="pre">v,
</span> <span class="pre">bytes32</span> <span class="pre">r,</span> <span class="pre">bytes32</span> <span class="pre">s)</span> <span class="pre">returns
</span> <span class="pre">(address)</span></code>:</dt>
<dd>recuperar la dirección asociada a la clave pública de la firma de la curva elíptica o devolver el cero en caso de error
(<a class="reference external" href="https://ethereum.stackexchange.com/q/1 77/222">ejemplo de uso</a>)</dd>
</dl>
<p>En lo anterior, &#8220;tightly packed&#8221; (traduccion: hermeticamente empacados o firmemente empacados o apretado)
significa que los argumentos se concatenan sin relleno. Esto significa que los siguientes son todos idénticos:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;ab&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span>
<span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">)</span>
<span class="nb">keccak256</span><span class="p">(</span><span class="mh">0x616263</span><span class="p">)</span>
<span class="nb">keccak256</span><span class="p">(</span><span class="mi">6382179</span><span class="p">)</span>
<span class="nb">keccak256</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
</pre></div>
</div>
<p>Si se necesita relleno, pueden usarse conversiones de tipos explícitas: <code class="docutils literal"><span class="pre">keccak256(&quot;\x00\x12&quot;)
</span></code> es igual que <code class="docutils literal"><span class="pre">keccak256(uint16(0x12))</span></code>.</p>
<p>Tenga en cuenta que las constantes se empaquetarán utilizando el número mínimo de bytes necesarios para almacenarlas. Esto significa que, por ejemplo, 
<code class="docutils literal"><span class="pre">keccak256(0)</span> <span class="pre">==</span> <span class="pre">keccak256(uint8(0))</span></code> y
<code class="docutils literal"><span class="pre">keccak256(0x12345678)</span> <span class="pre">==</span> <span class="pre">keccak256(uint32(0x12345678))</span></code>.</p>
<p>Puede ser que te encuentres con Out-of-Gas para <code class="docutils literal"><span class="pre">sha256</span></code>, 
<code class="docutils literal"><span class="pre">ripemd160</span></code> o <code class="docutils literal"><span class="pre">ecrecover</span></code> 
en una <em>private blockchain</em>. La razón de esto es que estos se implementan como los llamados contratos precompilados y 
estos contratos sólo existen realmente después de que recibieron el primer mensaje 
(aunque su código de contrato es codificado en tiempo real). Los mensajes a contratos 
no existentes son más caros y por lo tanto la ejecución se ejecuta en un error 
Out-of-Gas. Una solución para este problema es enviar primero por ejemplo 1 Wei a cada uno 
de los contratos antes de utilizarlos en sus contratos reales. 
Esto no es un problema en la red oficial o de prueba.</p>
</div>
<div class="section" id="address-related">
<span id="index-5"></span><span id="id1"></span><h5> Dirección Relacionada o Address Related<a class="headerlink" href="#address-related" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.balance</span></code> (<code class="docutils literal"><span class="pre">uint256</span></code>):</dt>
<dd>saldo de la <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> in Wei</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.transfer(uint256</span> <span class="pre">amount)</span></code>:</dt>
<dd>enviar una cantidad dada de Wei a <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, 
si fracasa "on failure"</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.send(uint256</span> <span class="pre">amount)</span> <span class="pre">
returns</span> <span class="pre">(bool)</span></code>:</dt>
<dd>enviar una cantidad dada de Wei a <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, 
returns <code class="docutils literal"><span class="pre">false</span></code> sobre el fracaso</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.call(...)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>:</dt>
<dd>emisión de bajo nivel <code class="docutils literal"><span class="pre">CALL</span></code>, returns <code class="docutils literal"><span class="pre">false</span></code>
 si fracasa</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.callcode(...)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>:</dt>
<dd>emisión de bajo nivel <code class="docutils literal"><span class="pre">CALLCODE</span></code>, returns <code class="docutils literal"><span class="pre">false</span>
</code> si fracasa</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.delegatecall(...)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>:</dt>
<dd>emisión de bajo nivel <code class="docutils literal"><span class="pre">DELEGATECALL</span></code>, returns <code class="docutils literal"><span class="pre">
false</span></code> si fracasa</dd>
</dl>
<p>Para obtener más información, consulte la sección <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Hay algunos peligros en el uso de <code class="docutils literal"><span class="pre">send</span></code>: 
La transferencia falla si la profundidad de la pila de llamadas está en 1024 
(esto siempre puede ser obligado por la persona que llama) y también falla si 
el receptor se queda sin gas. Así que para hacer transferencias de ether seguras, 
siempre compruebe el valor de retorno de  <code class="docutils literal"><span class="pre">send</span></code>, 
utilice <code class="docutils literal"><span class="pre">transfer</span></code> 
o incluso mejor: Utilice un patrón en el que el destinatario retira el dinero.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El uso de <code class="docutils literal"><span class="pre">callcode</span></code> es desalentado y será eliminado en el futuro.</p>
</div>
</div>
<div class="section" id="contract-related">
<span id="index-6"></span><h5>Relacionados con el contrato<a class="headerlink" href="#contract-related" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">this</span></code> (tipo de contrato actual):</dt>
<dd>el contrato actual, explícitamente convertible a <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a></dd>
<dt><code class="docutils literal"><span class="pre">selfdestruct(address</span> <span class="pre">recipient)</span></code>:</dt>
<dd>destruir el contrato actual, enviando sus fondos a la dirección dada <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a></dd>
<dt><code class="docutils literal"><span class="pre">suicide(address</span> <span class="pre">recipient)</span></code>:</dt>
<dd>alias a <code class="docutils literal"><span class="pre">selfdestruct</span></code></dd>
</dl>
<p>Además, todas las funciones del contrato actual se pueden llamar directamente incluyendo la función actual.</p>
</div>
</div>
</div>
<span id="document-control-structures"></span><div class="section" id="expressions-and-control-structures">
<h3>Expresiones y estructuras de control<a class="headerlink" href="#expressions-and-control-structures" title="Permalink to this headline">¶</a></h3>
<div class="section" id="input-parameters-and-output-parameters">
<span id="index-0"></span><h4>Parámetros de entrada y parámetros de salida<a class="headerlink" href="#input-parameters-and-output-parameters" title="Permalink to this headline">¶</a></h4>
<p>Como en Javascript, las funciones pueden tomar parámetros como entrada; 
a diferencia de Javascript y C, también pueden devolver un número 
arbitrario de parámetros como salida.</p>
<div class="section" id="input-parameters">
<h5>Parámetros de entrada<a class="headerlink" href="#input-parameters" title="Permalink to this headline">¶</a></h5>
<p>Los parámetros de entrada se declaran de la misma manera que las variables. 
Como excepción, los parámetros no utilizados pueden omitir el nombre de la 
variable. Por ejemplo, supongamos que queremos que nuestro contrato acepte 
un tipo de llamadas externas con dos enteros, escribiríamos algo como:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Simple</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">taker</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">_b</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// hacer algo con _a y _b.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="output-parameters">
<h5>Parámetros de salida<a class="headerlink" href="#output-parameters" title="Permalink to this headline">¶</a></h5>
<p>Los parámetros de salida se pueden declarar con la misma sintaxis después de la palabra clave
<code class="docutils literal"><span class="pre">returns</span></code>. 
Por ejemplo, supongamos que deseamos devolver dos resultados: la suma y el producto de los dos enteros dados, entonces escribiríamos:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Simple</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">arithmetics</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">_b</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">o_sum</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">o_product</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">o_sum</span> <span class="o">=</span> <span class="nx">_a</span> <span class="o">+</span> <span class="nx">_b</span><span class="p">;</span>
        <span class="nx">o_product</span> <span class="o">=</span> <span class="nx">_a</span> <span class="o">*</span> <span class="nx">_b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Los nombres de los parámetros de salida pueden omitirse. 
Los valores de salida también se pueden especificar mediante sentencias <code class="docutils literal"><span class="pre">return</span></code>.
Las sentencias  <code class="docutils literal"><span class="pre">return</span></code> también son capaces de devolver varios valores, véase 
<a class="reference internal" href="#multi-return"><span class="std std-ref">Retorno de varios valores</span></a>.
Los parámetros de retorno se inicializan a cero; si no se establecen explícitamente, permanecen cero.</p>
<p>Los parámetros de entrada y de salida se pueden utilizar como expresiones en el cuerpo de la función. 
Allí, también se pueden utilizar en el lado izquierdo de la asignación.</p>
</div>
</div>
<div class="section" id="control-structures">
<span id="index-1"></span><h4>Estructuras de Control<a class="headerlink" href="#control-structures" title="Permalink to this headline">¶</a></h4>
<p>La mayoría de las estructuras de control de JavaScript están disponibles en Solidity excepto para  
<code class="docutils literal"><span class="pre">switch</span></code> y <code class="docutils literal"><span class="pre">goto</span></code>. 
Entonces tenemos: <code class="docutils literal"><span class="pre">if</span></code>, <code class="docutils literal"><span class="pre">else</span></code>, 
<code class="docutils literal"><span class="pre">while</span></code>, <code class="docutils literal"><span class="pre">do</span></code>, 
<code class="docutils literal"><span class="pre">for</span></code>, <code class="docutils literal"><span class="pre">break</span></code>, 
<code class="docutils literal"><span class="pre">continue</span></code>, <code class="docutils literal"><span class="pre">return</span></code>, 
<code class="docutils literal"><span class="pre">?</span> <span class="pre">:</span></code>, 
con la semántica usual conocidos de C o JavaScript.</p>
<p>Los paréntesis <em>no</em> se pueden omitir para los condicionales, pero los bordes rizados se pueden omitir alrededor de los cuerpos de una sola afirmación.</p>
<p>Tenga en cuenta que no hay conversión de tipos no booleanos a tipos booleanos, que existe en C y JavaScript, entonces 
<code class="docutils literal"><span class="pre">if</span> <span class="pre">(1)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}
</span></code> <em>no</em> es valido en Solidity.</p>
<div class="section" id="returning-multiple-values">
<span id="multi-return"></span><h5>Devolución de múltiples valores <a class="headerlink" href="#returning-multiple-values" title="Permalink to this headline">¶</a></h5>
<p>Cuando una función tiene varios parámetros de salida, <code class="docutils literal"><span class="pre">return</span> <span class="pre">
(v0,</span> <span class="pre">v1,</span> <span class="pre">...,</span><span class="pre">vn)</span></code> 
puede devolver varios valores. El número de componentes debe ser el mismo que el número de parámetros de salida.</p>
</div>
</div>
<div class="section" id="function-calls">
<span id="index-2"></span><span id="id1"></span><h4>Llamadas de funciónes<a class="headerlink" href="#function-calls" title="Permalink to this headline">¶</a></h4>
<div class="section" id="internal-function-calls">
<h5>Llamadas de función interna<a class="headerlink" href="#internal-function-calls" title="Permalink to this headline">¶</a></h5>
<p>Las funciones del contrato actual pueden ser llamadas directamente (&#8220;internamente&#8221;), también recursivamente, como se ve en este absurdo ejemplo:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">g</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">f</span><span class="p">();</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">g</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Estas llamadas de función se traducen en saltos simples dentro del EVM. Esto tiene el efecto de que la memoria actual no se borra, 
es decir, transferir referencias de memoria a funciones internamente llamadas es muy eficiente. Sólo las funciones del mismo contrato 
pueden ser llamadas internamente.</p>
</div>
<div class="section" id="external-function-calls">
<h5>Llamadas de función externa<a class="headerlink" href="#external-function-calls" title="Permalink to this headline">¶</a></h5>
<p>Las expresiones <code class="docutils literal"><span class="pre">this.g(8);</span></code> y <code class="docutils literal"><span class="pre">
c.g(2);</span></code> (donde <code class="docutils literal"><span class="pre">c</span></code> 
es una instancia de contrato) son también llamadas de función válidas, pero esta vez, la función se llamará &#8220;externamente&#8221;, 
a través de una llamada de mensaje y no directamente a través de saltos. Tenga en cuenta que las llamadas de función  
<code class="docutils literal"><span class="pre">this</span></code> 
no se pueden utilizar en el constructor, ya que el contrato real todavía no se ha creado.</p>
<p>Las funciones de otros contratos tienen que ser llamadas externamente. Para una llamada externa, todos los argumentos de función tienen que ser copiados en la memoria.</p>
<p>Cuando llamamos a funciones de otros contratos, la cantidad de Wei enviada con la llamada y el gas se puede especificar con las opciones especiales  
<code class="docutils literal"><span class="pre">.value()</span></code> y <code class="docutils literal"><span class="pre">.gas()</span></code>, respectivamente:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">InfoFeed</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">info</span><span class="p">()</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">42</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Consumer</span> <span class="p">{</span>
    <span class="nx">InfoFeed</span> <span class="nx">feed</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">setFeed</span><span class="p">(</span><span class="kt">address</span> <span class="nx">addr</span><span class="p">)</span> <span class="p">{</span> <span class="nx">feed</span> <span class="o">=</span> <span class="nx">InfoFeed</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">callFeed</span><span class="p">()</span> <span class="p">{</span> <span class="nx">feed</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nx">gas</span><span class="p">(</span><span class="mi">800</span><span class="p">)();</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El modificador <code class="docutils literal"><span class="pre">payable</span></code> tiene que ser usado para <code class="docutils literal"><span class="pre">info
</span></code>, porque de lo contrario, la opción <cite>.value()</cite> no estaría disponible.</p>
<p>Tenga en cuenta que la expresión <code class="docutils literal"><span class="pre">InfoFeed(addr)</span></code> 
realiza una conversión de tipo explícita indicando que &#8220;sabemos que el tipo del contrato en la dirección dada es 
<code class="docutils literal"><span class="pre">InfoFeed</span></code>&#8221; 
y esto no ejecuta un constructor. Las conversiones de tipo explícito tienen que ser manejadas con extrema precaución. 
Nunca llame a una función en un contrato en el que no esté seguro acerca de su tipo.</p>
<p>También podríamos haber usado directamente <code class="docutils literal"><span class="pre">function</span> <span class="pre">setFeed(InfoFeed</span> <span class="pre">_feed)
</span> <span class="pre">{</span> <span class="pre">feed</span> <span class="pre">=</span> <span class="pre">_feed;</span> <span class="pre">}</span></code> 
Tenga cuidado con el hecho de que <code class="docutils literal"><span class="pre">feed.info.value(10).gas(800)</span></code>
sólo (localmente) establece el valor y la cantidad de gas enviado con la llamada de función y 
sólo los paréntesis al final realizan la llamada real.</p>
<p>Las llamadas de función provocan excepciones si el contrato llamado no existe 
(en el sentido de que la cuenta no contiene código) o si el contrato llamado mismo arroja una excepción o arroja out of gas.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Cualquier interacción con otro contrato impone un peligro potencial, 
especialmente si el código fuente del contrato no se conoce de antemano. 
El contrato actual entrega el control al contrato llamado y que potencialmente 
puede hacer cualquier cosa. Incluso si el contrato llamado hereda de un contrato 
padre conocido, el contrato hereditario sólo se requiere para tener una interfaz 
correcta. La ejecución del contrato, sin embargo, puede ser completamente arbitraria 
y, por lo tanto, suponen un peligro. Además, esté preparado en caso de que llame a 
otros contratos de su sistema o incluso de nuevo en el contrato de llamada antes de 
la primera llamada vuelve. Esto significa que el contrato llamado puede cambiar 
variables de estado del contrato de llamada a través de sus funciones. 
Escriba sus funciones de una manera que, por ejemplo, las llamadas a funciones externas 
ocurran después de cualquier cambio en las variables de estado en su contrato
por lo que su contrato no es vulnerable a una explotación de reentrada.
</p>
</div>
</div>
<div class="section" id="named-calls-and-anonymous-function-parameters">
<h5>Llamadas Nombradas y Parámetros de Función Anónima<a class="headerlink" href="#named-calls-and-anonymous-function-parameters" title="Permalink to this headline">¶</a></h5>
<p>Los argumentos de llamada de función también pueden darse por nombre, en cualquier orden, si están encerrados en 
<code class="docutils literal"><span class="pre">{</span> <span class="pre">}</span></code> 
como se puede ver en el ejemplo siguiente. La lista de argumentos tiene que coincidir 
por nombre con la lista de parámetros de la declaración de función, pero puede estar en orden arbitrario.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">key</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// argumentos nombrados </span>
        <span class="nx">f</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">3</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="omitted-function-parameter-names">
<h5>Nombres de parámetros de función omitidos<a class="headerlink" href="#omitted-function-parameter-names" title="Permalink to this headline">¶</a></h5>
<p>Los nombres de los parámetros no utilizados (especialmente los parámetros de retorno) se pueden omitir. 
Esos nombres todavía estarán presentes en la pila, pero son inaccesibles.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="c1">// nombre omitido para el parámetro</span>
    <span class="kd">function</span> <span class="nx">func</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">k</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">k</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-contracts-via-new">
<span id="creating-contracts"></span><span id="index-3"></span><h4>Creación de contratos a través de <code class="docutils literal"><span class="pre">new</span></code><a class="headerlink" href="#creating-contracts-via-new" title="Permalink to this headline">¶</a></h4>
<p>Un contrato puede crear un nuevo contrato utilizando la palabra clave <code class="docutils literal"><span class="pre">new</span></code>. 
El código completo del contrato que se crea tiene que ser conocido de antemano, por lo que no son posibles las dependencias recursivas de la creación.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">D</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="nx">D</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">D</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// se ejecutará como parte del constructor de C</span>

    <span class="kd">function</span> <span class="nx">createD</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">D</span> <span class="nx">newD</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">D</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">createAndEndowD</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">arg</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Envía ether junto con la creación </span>
        <span class="nx">D</span> <span class="nx">newD</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">D</span><span class="p">).</span><span class="nx">value</span><span class="p">(</span><span class="nx">amount</span><span class="p">)(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Como se ve en el ejemplo, es posible reenviar Ether a la creación utilizando la opción 
<code class="docutils literal"><span class="pre">.value()</span></code> 
, pero no es posible limitar la cantidad de gas. Si la creación falla (debido a la falta 
de pila, no hay suficiente balance u otros problemas), se genera una excepción.</p>
</div>
<div class="section" id="order-of-evaluation-of-expressions">
<h4>Orden de Evaluación de las Expresiones<a class="headerlink" href="#order-of-evaluation-of-expressions" title="Permalink to this headline">¶</a></h4>
<p>No se especifica el orden de evaluación de las expresiones (más formalmente, 
no se especifica el orden en que se evalúan los hijos de un nodo en el árbol 
de expresiones, pero se evalúan antes del propio nodo). Sólo se garantiza que 
las sentencias se ejecutan en orden y se realiza un cortocircuito para las 
expresiones booleanas. Para más información ver 
<a class="reference internal" href="index.html#order"><span class="std std-ref">Orden de Precedencia de Operadores</span></a>.</p>
</div>
<div class="section" id="assignment">
<span id="index-4"></span><h4>Asignaciones<a class="headerlink" href="#assignment" title="Permalink to this headline">¶</a></h4>
<div class="section" id="destructuring-assignments-and-returning-multiple-values">
<span id="index-5"></span><h5>Desestructuración de asignaciones y devolución de valores múltiples<a class="headerlink" href="#destructuring-assignments-and-returning-multiple-values" title="Permalink to this headline">¶</a></h5>
<p>Solidity internamente permite tipos de tupla, es decir, 
una lista de objetos de tipos potencialmente diferentes 
cuyo tamaño es una constante en tiempo de compilación. 
Esas tuplas pueden usarse para devolver múltiples valores 
al mismo tiempo y también asignarlos a múltiples variables 
(o LValues ​​en general) al mismo tiempo:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">bool</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Declara y asigna las variables. Especificar el tipo explícitamente no es posible.</span>
        <span class="kd">var</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">=</span> <span class="nx">f</span><span class="p">();</span>
        <span class="c1">// Asigna a una variable preexistente.</span>
        <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
        <span class="c1">// Truco común para intercambiar valores - no funciona para tipos de almacenamiento sin valor. </span>
        <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">x</span><span class="p">);</span>
        <span class="c1">// Los componentes se pueden omitir (también para las declaraciones de variables).</span>
        <span class="c1">// Si la tupla termina en un componente vacío,</span>
        <span class="c1">// el resto de los valores se descartan. </span>
        <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,)</span> <span class="o">=
		</span> <span class="nx">f</span><span class="p">();</span> <span class="c1">// Establece la longitud a 7 </span>
        <span class="c1">// Lo mismo se puede hacer en el lado izquierdo.</span>
        <span class="p">(,</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">=</span> <span class="nx">f</span><span class="p">();</span> <span class="c1">// Sets data[3] to 2</span>
        <span class="c1">// Los componentes sólo se pueden omitir a la izquierda de las asignaciones, con</span>
        <span class="c1">// una excepcion:</span>
        <span class="p">(</span><span class="nx">x</span><span class="p">,)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,);</span>
        <span class="c1">// ((1,) es la única manera de especificar una tupla de 1 componente, porque (1) es</span>
        <span class="c1">// equivalente a 1.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="complications-for-arrays-and-structs">
<h5>Complicaciones para Arrays y Structs<a class="headerlink" href="#complications-for-arrays-and-structs" title="Permalink to this headline">¶</a></h5>
<p>La semántica de la asignación es un poco más complicada para los tipos sin valor como arrays y structs. Asignar <em>a (to)</em> 
una variable de estado siempre crea una copia independiente. Por otra parte, asignar a una variable local crea 
una copia independiente sólo para tipos elementales, es decir, tipos estáticos que encajan en 32 bytes. Si las estructuras o matrices (incluyendo 
<code class="docutils literal"><span class="pre">bytes</span></code> y <code class="docutils literal"><span class="pre">string</span></code>) 
se asignan desde una variable de estado a una variable local, la variable local contiene una referencia a la variable de estado original. 
Una segunda asignación a la variable local no modifica el estado sino que sólo cambia la referencia. Las asignaciones a los miembros 
(o elementos) de la variable local <em>hacen (do)</em> cambiar el estado.</p>
</div>
</div>
<div class="section" id="scoping-and-declarations">
<span id="default-value"></span><span id="index-6"></span><h4>Determinación del alcance y declaraciones<a class="headerlink" href="#scoping-and-declarations" title="Permalink to this headline">¶</a></h4>
<p>Una variable que se declara tendrá un valor inicial por defecto cuya representación de bytes es todos ceros. Los  
&#8220;default values&#8221; de las variables son el típico &#8220;zero-state&#8221; de cualquiera que sea el tipo. Por ejemplo, el valor predeterminado de un 
<code class="docutils literal"><span class="pre">bool</span></code> es <code class="docutils literal"><span class="pre">false</span></code>. 
El valor predeterminado para los tipos <code class="docutils literal"><span class="pre">uint</span></code> o <code class="docutils literal"><span class="pre">int</span></code> es 
<code class="docutils literal"><span class="pre">0</span></code>. Para matrices de tamaño estático y <code class="docutils literal"><span class="pre">bytes1</span>
</code> a <code class="docutils literal"><span class="pre">bytes32</span></code>, 
cada elemento individual se inicializará al valor por defecto correspondiente a su tipo. Por último, para matrices de tamaño dinámico,  
<code class="docutils literal"><span class="pre">bytes</span></code> y <code class="docutils literal"><span class="pre">string</span></code>, 
el valor predeterminado es una matriz o cadena vacía.</p>
<p>Una variable declarada en cualquier lugar dentro de una función estará en alcance para <em>toda la función</em>, 
 independientemente de dónde se declare. Esto sucede porque Solidity hereda sus reglas de alcance de JavaScript. 
 Esto contrasta con muchos lenguajes en los que las variables sólo tienen un ámbito en el que se declaran hasta 
 el final del bloque semántico. Como resultado, el código siguiente es ilegal y provoca que el compilador lance 
 un error, 
<code class="docutils literal"><span class="pre">Identifier</span> <span class="pre">already</span> <span class="pre">declared</span></code>:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// Esto no compilará</span>
<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">ScopingErrors</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">scoping</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">
			// Ilegal, segunda declaración del mismo1 </span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">minimalScoping</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">
			// Ilegal, segunda declaración del mismo2</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">forLoopScoping</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">same3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">same3</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">same3</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">same3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">same3</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">same3</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="c1">
		// Ilegal, segunda declaración del mismo3</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Además de esto, si se declara una variable, se inicializará al principio de la función a su valor predeterminado. 
Como resultado, el siguiente código es legal, a pesar de estar mal escrito:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// baz se inicializa implícitamente como 0</span>
    <span class="kt">uint</span> <span class="nx">bar</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">bar</span> <span class="o">+=</span> <span class="nx">baz</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">baz</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span><span class="c1">
		// nunca se ejecuta</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">bar</span><span class="p">;</span><span class="c1">// devuelve 5</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="error-handling-assert-require-revert-and-exceptions">
<span id="index-7"></span><h4>Manejo de errores: Asertar, Requerir, Revertir y Excepciones (Assert, Require, Revert, Exceptions)<a class="headerlink" href="#error-handling-assert-require-revert-and-exceptions" title="Permalink to this headline">¶</a></h4>
<p>Solidity utiliza excepciones que revertirán el estado para manejar errores. Tal excepción deshará todos los cambios realizados al estado en la llamada actual 
(y todas sus sub-llamadas) y también marcará un error al llamador. Las funciones 
<code class="docutils literal"><span class="pre">assert</span></code> y <code class="docutils literal"><span class="pre">require</span></code>
 puede usarse a conveniencia para verificar condiciones y lanzar una excepción si la condición no se cumple. La función 
 <code class="docutils literal"><span class="pre">assert</span></code>  sólo debe utilizarse para comprobar errores internos y para comprobar invariantes. La función 
 <code class="docutils literal"><span class="pre">require</span></code> 
  debe utilizarse para garantizar que se cumplan condiciones válidas, como entradas o variables de estado de contrato, o para validar valores de retorno 
 de llamadas a contratos externos. Si se usan correctamente, las herramientas de análisis pueden evaluar su contrato para identificar las condiciones y 
 las llamadas de función que llegarán a un failing
<code class="docutils literal"><span class="pre">assert</span></code>. 
 El código de funcionamiento correcto nunca debe llegar a una sentencia afirmativa fallida; si esto ocurre hay un error en su contrato que debe arreglar.</p>
<p>Existen otras dos formas de activar excepciones: La función <code class="docutils literal"><span class="pre">revert</span></code> 
se puede utilizar para marcar un error y revertir la llamada actual. En el futuro también podría ser posible incluir detalles sobre el error en una llamada a 
<code class="docutils literal"><span class="pre">revert</span></code>. La palabra clave <code class="docutils literal"><span class="pre">throw</span></code> 
también se puede utilizar como una alternativa a <code class="docutils literal"><span class="pre">revert()</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Desde la versión 0.4.13 la palabra clave <code class="docutils literal"><span class="pre">throw</span></code> 
está obsoleta y se eliminará gradualmente en el futuro.</p>
</div>
<p>Cuando las excepciones ocurren en una sub-llamada, ellas burbujean o &#8220;bubble up&#8221; 
(es decir, las excepciones se vuelven a disparar) de forma automática. Excepciones a esta regla son 
<code class="docutils literal"><span class="pre">send</span></code>
y las funciones de bajo nivel <code class="docutils literal"><span class="pre">call</span></code>, 
<code class="docutils literal"><span class="pre">delegatecall</span></code> y <code class="docutils literal"><span class="pre">callcode</span></code>
 &#8211; las devuelven <code class="docutils literal"><span class="pre">false</span></code> en caso de una excepción en lugar de burbujeo o &#8220;bubbling up&#8221;.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">El nivel bajo <code class="docutils literal"><span class="pre">call</span></code>, <code class="docutils literal"><span class="pre">
delegatecall</span></code> y <code class="docutils literal"><span class="pre">callcode</span></code> 
retornará success  si la cuenta de llamada no existe, como parte del diseño de EVM. La existencia debe ser verificada antes de llamar si lo desea.</p>
</div>
<p>La captura de excepciones aún no es posible.</p>
<p>En el siguiente ejemplo, puede ver cómo <code class="docutils literal"><span class="pre">require</span></code> 
se puede utilizar para verificar fácilmente las condiciones de las entradas y cómo 
<code class="docutils literal"><span class="pre">assert</span></code> se puede utilizar para la comprobación interna de errores:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">contract</span> <span class="nx">Sharer</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">sendHalf</span><span class="p">(</span><span class="kt">address</span> <span class="nx">addr</span><span class="p">)</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">balance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">
		// Sólo permite números pares</span>
        <span class="kt">uint</span> <span class="nx">balanceBeforeTransfer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">;</span>
        <span class="nx">addr</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="c1">// Dado que la transferencia genera una excepción en caso de fallo y </span>
        <span class="c1">// no puede volver a llamar aquí, no debería haber manera para nosotros de</span>
        <span class="c1">// tener todavía la mitad del dinero.</span>
        <span class="nb">assert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span> <span class="o">==</span> <span class="nx">balanceBeforeTransfer</span> <span class="o">-</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Una excepción de estilo <code class="docutils literal"><span class="pre">assert</span></code> se genera en las siguientes situaciones:</p>
<ol class="arabic simple">
<li>Si accede a una matriz en un índice demasiado grande o negativo (es decir, <code class="docutils literal"><span class="pre">x[i]</span></code> 
donde <code class="docutils literal"><span class="pre">i</span> <span class="pre">&gt;=</span> <span class="pre">x.length</span></code> o 
<code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">0</span></code>).</li>
<li>Si accede a una longitud fija <code class="docutils literal"><span class="pre">bytesN</span></code> en un índice demasiado grande o negativo.</li>
<li>Si divide o modulo por cero (e.g. <code class="docutils literal"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">0</span></code>
 o <code class="docutils literal"><span class="pre">23</span> <span class="pre">%</span> <span class="pre">0</span></code>).</li>
<li>Si cambia "shift" por una cantidad negativa.</li>
<li>Si convierte un valor demasiado grande o negativo en un tipo de enum.</li>
<li>Si llama a una variable de inicialización cero de tipo de función interna.</li>
<li>Si llama a <code class="docutils literal"><span class="pre">assert</span></code> con un argumento que se evalúa como false.</li>
</ol>
<p>Una excepción de estilo <code class="docutils literal"><span class="pre">require</span></code> se genera en las siguientes situaciones:</p>
<ol class="arabic simple">
<li>Llamando <code class="docutils literal"><span class="pre">throw</span></code>.</li>
<li>Llamando <code class="docutils literal"><span class="pre">require</span></code> con un argumento que se evalúa como <code class="docutils literal"><span class="pre">false</span></code>.</li>
<li>Si se llama a una función a través de una llamada mensaje, pero no termina correctamente 
(es decir, que se queda sin gas, no tiene ninguna función de coincidencia, o produce una excepción en sí), excepto cuando se utiliza una operación de bajo nivel 
<code class="docutils literal"><span class="pre">call</span></code>, <code class="docutils literal"><span class="pre">send</span></code>, 
<code class="docutils literal"><span class="pre">delegatecall</span></code> o <code class="docutils literal"><span class="pre">callcode</span></code>.  
Las operaciones de bajo nivel nunca lanzan excepciones pero indican fallas al retornar <code class="docutils literal"><span class="pre">false</span></code>.</li>
<li>Si crea un contrato utilizando la palabra clave <code class="docutils literal"><span class="pre">new</span></code> 
pero la creación del contrato no finaliza correctamente (véase más arriba para la definición de &#8220;not finish properly&#8221;).</li>
<li>Si realiza una llamada de función externa dirigida a un contrato que no contiene código.</li>
<li>Si su contrato recibe Ether a través de una función pública sin modificador <code class="docutils literal"><span class="pre">payable</span></code> 
 (incluyendo el constructor y la función de fallback).</li>
<li>Si su contrato recibe Ether a través de una función getter pública.</li>
<li>Si falla un <code class="docutils literal"><span class="pre">.transfer()</span></code>.</li>
</ol>
<p>Internamente, Solidity realiza una operación de revertir (instrucción <code class="docutils literal"><span class="pre">0xfd</span></code>) para una excepción de estilo  
<code class="docutils literal"><span class="pre">require</span></code> y ejecuta una operación no válida (instrucción 
<code class="docutils literal"><span class="pre">0xfe</span></code>) para lanzar una excepción de estilo <code class="docutils literal"><span class="pre">assert</span></code>
En ambos casos, esto hace al EVM revertir todos los cambios realizados en el estado. 
La razón para revertir es que no hay manera segura de continuar la ejecución, porque no se produjo un efecto esperado. 
Debido a que queremos retener la atomicidad de las transacciones, lo más seguro es revertir todos los cambios y hacer 
que toda la transacción (o al menos call) quede sin efecto. Tenga en cuenta que las excepciones de estilo 
<code class="docutils literal"><span class="pre">assert</span></code> consumen todo el gas disponible para la llamada, mientras que las excepciones de estilo 
<code class="docutils literal"><span class="pre">require</span></code> no consumirán ningún gas a partir de la liberación de Metropolis.</p>
</div>
</div>
<span id="document-contracts"></span><div class="section" id="contracts">
<span id="index-0"></span><h3>Contratos<a class="headerlink" href="#contracts" title="Permalink to this headline">¶</a></h3>
<p>Los Contratos en Solidity son similares a las clases en lenguajes orientados a objetos. 
Contienen datos persistentes en variables de estado y funciones que pueden modificar estas variables. 
Llamar a una función en un contrato diferente (instancia) realizará una llamada de función EVM y, 
por tanto, cambiará el contexto de modo que las variables de estado sean inaccesibles.</p>
<div class="section" id="creating-contracts">
<span id="index-1"></span><h4>Creación de Contratos<a class="headerlink" href="#creating-contracts" title="Permalink to this headline">¶</a></h4>
<p>Los contratos pueden ser creados "desde fuera" o desde contratos de Solidity. 
Cuando se crea un contrato, su constructor (una función con el mismo nombre que el contrato) se ejecuta una vez.</p>
<p>Un constructor es opcional. Sólo se permite un constructor, y esto significa que la sobrecarga no es compatible.</p>
<p>Desde <code class="docutils literal"><span class="pre">web3.js</span></code>, es decir, la API de JavaScript, esto se hace de la siguiente manera:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">
// Necesita especificar alguna fuente incluyendo el nombre del contrato para el parámetro de datos debajo</span>
<span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="s2">&quot;contract CONTRACT_NAME { function CONTRACT_NAME(uint a, uint b) {} }&quot;</span><span class="p">;</span>

<span class="c1">// El json array abi generado por el compilador </span>
<span class="kd">var</span> <span class="nx">abiArray</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;inputs&quot;</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;constructor&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;constant&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;inputs&quot;</span><span class="o">:</span><span class="p">[],</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
        <span class="s2">&quot;outputs&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;bytes32&quot;</span><span class="p">}],</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;function&quot;</span>
    <span class="p">}</span>
<span class="p">];</span>

<span class="kd">var</span> <span class="nx">MyContract_</span> <span class="o">=</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="kd">contract</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
<span class="nx">MyContract</span> <span class="o">=</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="kd">contract</span><span class="p">(</span><span class="nx">MyContract_</span><span class="p">.</span><span class="nx">CONTRACT_NAME</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">abiDefinition</span><span class="p">);</span>
<span class="c1">// desplegar nuevo contrato </span>
<span class="kd">var</span> <span class="nx">contractInstance</span> <span class="o">=</span> <span class="nx">MyContract</span><span class="p">.</span><span class="k">new</span><span class="p">(</span>
    <span class="mi">10</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">,</span>
    <span class="p">{</span><span class="nx">from</span><span class="o">:</span> <span class="nx">myAccount</span><span class="p">,</span> <span class="nx">gas</span><span class="o">:</span> <span class="mi">1000000</span><span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
 <p id="index-2">Internamente, los argumentos del constructor se pasan después del código del contrato en sí, pero usted no tiene que preocuparse por esto si usa <code class="docutils literal"><span class="pre">web3.js</span></code>.</p>
<p>Si un contrato quiere crear otro contrato, el código fuente (y el binario) del contrato creado debe ser conocido por el creador. 
Esto significa que las dependencias de creación cíclica son imposibles.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span> 
<span class="kd">contract</span> <span class="nx">OwnedToken</span> <span class="p">{</span>
    <span class="c1">// TokenCreator es un tipo de contrato que se define a continuación. </span>
    <span class="c1">// Está bien hacer referencia siempre y cuando no se use </span>
    <span class="c1">// para crear un nuevo contrato.</span>
    <span class="nx">TokenCreator</span> <span class="nx">creator</span><span class="p">;</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
    <span class="kt">bytes32</span> <span class="nx">name</span><span class="p">;</span>

    <span class="c1">// Este es el constructor que registra el </span>
    <span class="c1">// creador y el nombre asignado.</span>
    <span class="kd">function</span> <span class="nx">OwnedToken</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">_name</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Se accede a las variables de estado a través de su nombre </span>
        <span class="c1">// y no a través de, por ejemplo, this.owner. Esto también se aplica </span>
        <span class="c1">// a las funciones y especialmente en los constructores, </span>
        <span class="c1">// sólo se puede llamar así ("internamente"), ,</span>
        <span class="c1">// porque el contrato en sí no existe todavía. </span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="c1">// Hacemos una conversión de tipo explícita de `address` </span>
        <span class="c1">// ta` TokenCreator` y asumimos que el tipo de </span>
        <span class="c1">// el contrato que llama es TokenCreator,</span>
        <span class="c1">// no hay manera real de comprobar eso.</span>
        <span class="nx">creator</span> <span class="o">=</span> <span class="nx">TokenCreator</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="nx">_name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">changeName</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">newName</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Sólo el creador puede alterar el nombre --</span>
        <span class="c1">// la comparación es posible ya que los contratos </span>
        <span class="c1">// son implícitamente convertibles en direcciones.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nx">creator</span><span class="p">))</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">newName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="nx">newOwner</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Sólo el propietario actual puede transferir el token.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">owner</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="c1">// También queremos preguntar al creador si la transferencia </span>
        <span class="c1">// está bien. Tenga en cuenta que esto llama una función del </span>
        <span class="c1">// contrato definido a continuación. Si la llamada falla (por ejemplo,</span>
        <span class="c1">// debido a la falta de gas), la ejecución aquí se detiene</span>
        <span class="c1">// inmediatamente. </span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">creator</span><span class="p">.</span><span class="nx">isTokenTransferOK</span><span class="p">(</span><span class="nx">owner</span><span class="p">,</span> <span class="nx">newOwner</span><span class="p">))</span>
            <span class="nx">owner</span> <span class="o">=</span> <span class="nx">newOwner</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="nx">TokenCreator</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">createToken</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">name</span><span class="p">)</span>
       <span class="k">returns</span> <span class="p">(</span><span class="nx">OwnedToken</span> <span class="nx">tokenAddress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Crea un nuevo contrato Token y devuelve su dirección. </span>
        <span class="c1">// Del lado de JavaScript, el tipo de retorno es simplemente </span>
        <span class="c1">// &quot;address&quot;, ya que éste es el tipo más cercano disponible en</span>
        <span class="c1">// el ABI.</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">OwnedToken</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">changeName</span><span class="p">(</span><span class="nx">OwnedToken</span> <span class="nx">tokenAddress</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// De nuevo, el tipo externo de &quot;tokenAddress&quot; es</span>
        <span class="c1">// simplemente &quot;address&quot;.</span>
        <span class="nx">tokenAddress</span><span class="p">.</span><span class="nx">changeName</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">isTokenTransferOK</span><span class="p">(</span>
        <span class="kt">address</span> <span class="nx">currentOwner</span><span class="p">,</span>
        <span class="kt">address</span> <span class="nx">newOwner</span>
    <span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Check some arbitrary condition.</span>
        <span class="kt">address</span> <span class="nx">tokenAddress</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="nx">newOwner</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="kt">bytes20</span><span class="p">(</span><span class="nx">tokenAddress</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="visibility-and-getters">
<span id="index-3"></span><span id="id1"></span><h4>Visibilidad y Getters<a class="headerlink" href="#visibility-and-getters" title="Permalink to this headline">¶</a></h4>
<p>Dado que Solidity conoce dos tipos de llamadas de función (las internas que no crean una llamada EVM real 
(también llamada una &#8220;message call o llamada de mensaje&#8221;) y las externas que lo hacen), 
hay cuatro tipos de visibilidades para funciones y variables de estado.</p>
<p>Las funciones pueden ser especificadas como tipo <code class="docutils literal"><span class="pre">external</span></code>,
<code class="docutils literal"><span class="pre">public</span></code>, <code class="docutils literal"><span class="pre">internal</span></code> 
o <code class="docutils literal"><span class="pre">private</span></code>, donde el valor predeterminado es
<code class="docutils literal"><span class="pre">public</span></code>. Para las variables de estado, 
<code class="docutils literal"><span class="pre">external</span></code> no es posible y el valor predeterminado es 
<code class="docutils literal"><span class="pre">internal</span></code>.</p> <dl class="docutils">
<dt><code class="docutils literal"><span class="pre">external</span></code>:</dt>
<dd>Las funciones externas forman parte de la interfaz del contrato, 
lo que significa que pueden ser llamadas desde otros contratos y 
por medio de transacciones. Una función externa <code class="docutils literal"><span class="pre">f</span></code> 
no se puede llamar internamente (es decir <code class="docutils literal"><span class="pre">f()</span></code> 
no funciona, pero <code class="docutils literal"><span class="pre">this.f()</span></code>
si funciona). Las funciones externas son a veces más eficientes cuando reciben grandes arreglos de datos.</dd>
<dt><code class="docutils literal"><span class="pre">public</span></code>:</dt>
<dd>Las funciones públicas forman parte de la interfaz del contrato y 
pueden ser llamadas internamente o por mensajes. Para las variables 
de estado público, se genera una función getter automática (véase más adelante).</dd>
<dt><code class="docutils literal"><span class="pre">internal</span></code>:</dt>
<dd>Esas funciones y variables de estado sólo se pueden acceder internamente 
(es decir, de dentro del contrato o contratos actuales derivados de él), sin utilizar 
<code class="docutils literal"><span class="pre">this</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">private</span></code>:</dt>
<dd>Las funciones privadas y las variables de estado sólo 
son visibles para el contrato en el que se definen y no en los contratos derivados.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Todo lo que está dentro de un contrato es visible para todos los observadores externos. Hacer algo 
 <code class="docutils literal"><span class="pre">private</span></code>
sólo impide que otros contratos accedan y modifiquen la información, 
pero seguirá siendo visible para todo el mundo fuera de la blockchain.</p>
</div>
<p>El especificador de visibilidad se da después del tipo de variables de estado 
y entre la lista de parámetros y la lista de parámetros de retorno para las funciones.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">private</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">setData</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En el siguiente ejemplo, <code class="docutils literal"><span class="pre">D</span></code>, puede llamar <code class="docutils literal"><span class="pre">
c.getData()</span></code> para recuperar el valor de
<code class="docutils literal"><span class="pre">data</span></code> en almacenamiento de estado, pero no puede llamar 
<code class="docutils literal"><span class="pre">f</span></code>. El contrato <code class="docutils literal"><span class="pre">E</span></code> es derivado de
<code class="docutils literal"><span class="pre">C</span></code> y por lo tanto, puede llamar <code class="docutils literal"><span class="pre">compute</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// Esto no compilará</span>
<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">private</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">private</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">setData</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">getData</span><span class="p">()</span> <span class="k">public</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">data</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">compute</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">readData</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">C</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
        <span class="kt">uint</span> <span class="nx">local</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">f</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span> <span class="c1">// error: el miembro "f" no es visible</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="nx">local</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">getData</span><span class="p">();</span>
        <span class="nx">local</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">compute</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// error: el miembro &quot;compute&quot; no es visible</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">E</span> <span class="k">is</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">C</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
        <span class="kt">uint</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">compute</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>  <span class="c1">// acceso al miembro interno (del contrato derivado al contrato principal) </span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="getter-functions">
 <span id="index-4"></span><span id="id2"></span><h5>Funciones Getter<a class="headerlink" href="#getter-functions" title="Permalink to this headline">¶</a></h5>
<p>El compilador crea automáticamente las funciones getter para todas las variables de estado <strong>public</strong>. 
Para el contrato dado a continuación, el compilador generará una función llamada 
<code class="docutils literal"><span class="pre">data</span></code> que no toma argumentos y devuelve a   
<code class="docutils literal"><span class="pre">uint</span></code>, el valor de la variable de estado  
<code class="docutils literal"><span class="pre">data</span></code>. La inicialización de las variables de estado se puede hacer en la declaración.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">data</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">Caller</span> <span class="p">{</span>
    <span class="nx">C</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">local</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Las funciones getter tienen visibilidad externa. Si el símbolo se accede internamente (es decir, sin 
<code class="docutils literal"><span class="pre">this.</span></code>),
se evalúa como una variable de estado. Si se accede externamente (es decir, con 
<code class="docutils literal"><span class="pre">this.</span></code>), se evalúa como una función.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">data</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">x</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// acceso interno</span>
        <span class="kt">uint</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">();</span> <span class="c1">// acceso externo</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El siguiente ejemplo es un poco más complejo:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Complex</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Data</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">a</span><span class="p">;</span>
        <span class="kt">bytes3</span> <span class="nx">b</span><span class="p">;</span>
        <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">map</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">bool</span> <span class="o">=&gt;</span> <span class="nx">Data</span><span class="p">[]))</span> <span class="k">public</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Se generará una función de la siguiente forma:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">data</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">arg1</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">arg2</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">arg3</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">bytes3</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">arg1</span><span class="p">][</span><span class="nx">arg2</span><span class="p">][</span><span class="nx">arg3</span><span class="p">].</span><span class="nx">a</span><span class="p">;</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">arg1</span><span class="p">][</span><span class="nx">arg2</span><span class="p">][</span><span class="nx">arg3</span><span class="p">].</span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Tenga en cuenta que la asignación en la estructura se omite porque no hay ninguna buena forma de proporcionar la clave para la asignación(mapping)
.</p>
</div>
</div>
<div class="section" id="function-modifiers">
<span id="modifiers"></span><span id="index-5"></span><h4>Modificadores de funciones<a class="headerlink" href="#function-modifiers" title="Permalink to this headline">¶</a></h4>
<p>Los modificadores se pueden utilizar para cambiar fácilmente el comportamiento de las funciones. 
Por ejemplo, pueden comprobar automáticamente una condición antes de ejecutar la función. 
Los modificadores son propiedades heredables de los contratos y pueden ser anulados por los contratos derivados.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">owned</span><span class="p">()</span> <span class="p">{</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>

    <span class="c1">// Este contrato sólo define un modificador pero no lo usa</span>
    <span class="c1">// it - se utilizará en contratos derivados.</span>
    <span class="c1">// Se inserta el cuerpo de la función donde está el símbolo especial</span>
    <span class="c1">// en la definición de un modificador aparece &quot;_;&quot; .</span>
    <span class="c1">// Esto significa que si el propietario llama a esta función, </span>
    <span class="c1">// se ejecuta la función y, de lo contrario, se produce </span>
    <span class="c1">// una excepción.</span>
    <span class="kd">modifier</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="nx">mortal</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="c1">// Este contrato hereda el modificador &quot;onlyOwner&quot; de</span>
    <span class="c1">// &quot;owned&quot; y lo aplica a la función &quot;close&quot;,que</span>
    <span class="c1">// hace que las llamadas a &quot;close&quot; solo tengan un efecto si </span>
    <span class="c1">// son realizadas por el propietario almacenado. </span>
    <span class="kd">function</span> <span class="nx">close</span><span class="p">()</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="nx">priced</span> <span class="p">{</span>
    <span class="c1">// Los modificadores pueden recibir argumentos:</span>
    <span class="kd">modifier</span> <span class="nx">costs</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">price</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;=</span> <span class="nx">price</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">Register</span> <span class="k">is</span> <span class="nx">priced</span><span class="p">,</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">registeredAddresses</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="nx">price</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">Register</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">initialPrice</span><span class="p">)</span> <span class="p">{</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">initialPrice</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">// Es importante también proporcionar la</span>
    <span class="c1">// palabra clave &quot;payable&quot; aquí, de lo contrario la función</span>
    <span class="c1">// rechazará automáticamente todo el ether que se le envíe. </span>
    <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span> <span class="k">payable</span> <span class="nx">costs</span><span class="p">(</span><span class="nx">price</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">registeredAddresses</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">changePrice</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_price</span><span class="p">)</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
        <span class="nx">price</span> <span class="o">=</span> <span class="nx">_price</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Mutex</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="nx">locked</span><span class="p">;</span>
    <span class="kd">modifier</span> <span class="nx">noReentrancy</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nx">locked</span><span class="p">);</span>
        <span class="nx">locked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">_</span><span class="p">;</span>
        <span class="nx">locked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Esta función está protegida por un mutex, lo que significa que </span>
    <span class="cs">/// llamadas reentrantes desde dentro de msg.sender.call no se puede llamar a f de nuevo.</span>
    <span class="cs">/// La sentencia `return 7` asigna 7 al valor devuelto pero todavía</span>
    <span class="cs">/// ejecuta la instrucción` locked = false` en el modificador.</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="nx">noReentrancy</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">call</span><span class="p">());</span>
        <span class="k">return</span> <span class="mi">7</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Se aplican múltiples modificadores a una función especificándolos 
en una lista separada por espacios en blanco y se evalúan en el orden presentado.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">En una versión anterior de Solidity, las sentencias <code class="docutils literal"><span class="pre">return</span></code> 
en funciones que tenían modificadores se comportaron de manera diferente.</p>
</div>
<p>Los retornos explícitos de un modificador o cuerpo de función sólo dejan 
el modificador actual o el cuerpo de la función. Las variables de retorno 
se asignan y el flujo de control continúa después del &#8220;_&#8221; en el modificador anterior.</p>
<p>Las expresiones arbitrarias se permiten para los argumentos modificadores 
y en este contexto, todos los símbolos visibles de la función son visibles 
en el modificador. Los símbolos introducidos en el modificador no son visibles 
en la función (ya que podrían cambiar por sobreescritura).</p>
</div>
<div class="section" id="constant-state-variables">
<span id="index-6"></span><h4>Variables de Estado Constante<a class="headerlink" href="#constant-state-variables" title="Permalink to this headline">¶</a></h4>
<p>Las variables de estado se pueden declarar como <code class="docutils literal"><span class="pre">constant</span></code>. 
En este caso, tienen que ser asignados a partir de una expresión que es una constante en tiempo de compilación. 
Cualquier expresión que acceda a storage, blockchain data (e.g. 
<code class="docutils literal"><span class="pre">now</span></code>, <code class="docutils literal"><span class="pre">this.balance</span></code> o
<code class="docutils literal"><span class="pre">block.number</span></code>) o
datos de ejecución (<code class="docutils literal"><span class="pre">msg.gas</span></code>) 
o que realice llamadas a contratos externos no se permitirán. Las expresiones que podrían tener un efecto secundario 
sobre la asignación de memoria son permitidas, pero no las que pueden tener un efecto secundario en otros objetos de 
memoria. Las funciones integradas
<code class="docutils literal"><span class="pre">keccak256</span></code>, <code class="docutils literal"><span class="pre">sha256</span></code>, 
<code class="docutils literal"><span class="pre">ripemd160</span></code>, <code class="docutils literal"><span class="pre">ecrecover</span></code>, 
<code class="docutils literal"><span class="pre">addmod</span></code> and <code class="docutils literal"><span class="pre">mulmod</span></code>
estan permitidas (a pesar de que ellos hacen llamar los contratos externos).</p>
<p>La razón detrás de permitir efectos secundarios en el asignador de memoria 
es que debería ser posible construir objetos complejos como, por ejemplo, 
lookup-tables. Esta característica aún no es totalmente utilizable.</p>
<p>El compilador no reserva una ranura de almacenamiento para estas variables, 
y cada ocurrencia es reemplazada por la expresión constante respectiva 
(que puede ser computada a un solo valor por el optimizador).</p>
<p>No todos los tipos de constantes se implementan en este momento. Los únicos tipos soportados son tipos de value y strings.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">constant</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">32</span><span class="o">**</span><span class="mi">22</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
    <span class="kt">string</span> <span class="k">constant</span> <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;abc&quot;</span><span class="p">;</span>
    <span class="kt">bytes32</span> <span class="k">constant</span> <span class="nx">myHash</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="view-functions">
<span id="id3"></span><h4>Funciones de visualización<a class="headerlink" href="#view-functions" title="Permalink to this headline">¶</a></h4>
<p>Se pueden declarar las funciones <code class="docutils literal"><span class="pre">view</span></code> en cuyo caso prometen no modificar el estado.</p>
<p>Las siguientes sentencias se consideran modificadores de estado:</p>
<ol class="arabic simple">
<li>Escribir en variables de estado.</li>
<li><a class="reference internal" href="#events"><span class="std std-ref">Emisión de eventos.</span></a>.</li>
<li><a class="reference internal" href="index.html#creating-contracts"><span class="std std-ref">Creación de otros contratos</span></a>.</li>
<li>Usando <code class="docutils literal"><span class="pre">selfdestruct</span></code>.</li>
<li>Envío de ether a través de llamadas.</li>
<li>Llamar a cualquier función no marcada <code class="docutils literal"><span class="pre">view</span></code> o <code class="docutils literal"><span class="pre">pure</span></code>.</li>
<li>Uso de llamadas de bajo nivel.</li>
<li>Uso del ensamblado en línea que contiene ciertos opcodes.</li>
</ol>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span> <span class="o">*</span> <span class="p">(</span><span class="nx">b</span> <span class="o">+</span> <span class="mi">42</span><span class="p">)</span> <span class="o">+</span> <span class="nb">now</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last"><code class="docutils literal"><span class="pre">constant</span></code> es un alias a <code class="docutils literal"><span class="pre">view</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Los métodos Getter están marcados <code class="docutils literal"><span class="pre">view</span></code>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">El compilador no aplica aún que un método <code class="docutils literal"><span class="pre">view</span></code> no esté modificando el estado.</p>
</div>
</div>
<div class="section" id="pure-functions">
<span id="id4"></span><h4>Funciones puras<a class="headerlink" href="#pure-functions" title="Permalink to this headline">¶</a></h4>
<p>Se pueden declarar funciones <code class="docutils literal"><span class="pre">pure</span></code> ,en cuyo caso prometen no leer ni modificar el estado.</p>
<p>Además de la lista de estados de modificación explicada anteriormente, se consideran como lectura del estado:</p>
<ol class="arabic simple">
<li>Lectura de variables de estado.</li>
<li>Acceso <code class="docutils literal"><span class="pre">this.balance</span></code> o <code class="docutils literal"><span class="pre">&lt;address&gt;.balance</span></code>.</li>
<li>Acceder a cualquiera de los miembros de <code class="docutils literal"><span class="pre">block</span></code>, 
<code class="docutils literal"><span class="pre">tx</span></code>, <code class="docutils literal"><span class="pre">msg</span></code> 
(con la excepción de <code class="docutils literal"><span class="pre">msg.sig</span></code> y 
<code class="docutils literal"><span class="pre">msg.data</span></code>).</li>
<li>Llamar a cualquier función no marcada <code class="docutils literal"><span class="pre">pure</span></code>.</li>
<li>Uso del ensamblado en línea que contiene ciertos opcodes.</li>
</ol>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span> <span class="o">*</span> <span class="p">(</span><span class="nx">b</span> <span class="o">+</span> <span class="mi">42</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">El compilador no aplica todavia que un método <code class="docutils literal"><span class="pre">pure</span></code> 
no esté leyendo desde el estado.</p>
</div>
</div>
<div class="section" id="fallback-function">
<span id="index-7"></span><span id="id5"></span><h4>Función de retroceso (Fallback)<a class="headerlink" href="#fallback-function" title="Permalink to this headline">¶</a></h4>
<p>Un contrato puede tener exactamente una función sin nombre. 
Esta función no puede tener argumentos y no puede devolver nada. 
Se ejecuta en una llamada al contrato si ninguna de las otras funciones 
coincide con el identificador de función dado (o si no se ha proporcionado ningún dato en absoluto).</p>
<p>Además, esta función se ejecuta siempre que el contrato reciba Ether simple (sin datos). 
En este contexto, normalmente hay muy poco gas disponible para la llamada de función 
(para ser precisos, 2300 de gas), por lo que es importante que las funciones de fallback sean tan baratas como sea posible.</p>
<p>En particular, las siguientes operaciones consumirán más gas que el expendio proporcionado a una función de reserva:</p>
<ul class="simple">
<li>Escribir en el almacenamiento (Writing to storage)</li>
<li>Creación de un contrato</li>
<li>Llamar a una función externa que consume una gran cantidad de gas</li>
<li>Enviando Ether</li>
</ul>
<p>Por favor asegúrese de probar su función de fallback a fondo para asegurar 
que el costo de ejecución es menos de 2300 de gas antes de desplegar un contrato.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Los contratos que reciben Ether directamente (sin una llamada de función, es decir, usando 
<code class="docutils literal"><span class="pre">send</span></code> o <code class="docutils literal"><span class="pre">transfer</span></code>)
pero no definen una función de fallback lanzan una excepción, devolviendo el ether 
(esto era diferente antes de Solidity v0.4.0). Así que si quieres que tu contrato reciba Ether, 
debes implementar una función de fallback..</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Test</span> <span class="p">{</span>
    <span class="c1">// Esta función se llama para todos los mensajes enviados a</span>
    <span class="c1">// este contrato (no hay otra función). </span>
    <span class="c1">// Enviar Ether a este contrato causará una excepción,</span>
    <span class="c1">// porque la función fallback no tiene el modificador </span>
    <span class="c1">// &quot;payable&quot;.</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// Este contrato mantiene a todo Ether enviado a él sin ninguna manera </span>
<span class="c1">// para recuperarlo.</span>
<span class="kd">contract</span> <span class="nx">Sink</span> <span class="p">{</span>
    <span class="kd">function</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="nx">Caller</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">callTest</span><span class="p">(</span><span class="nx">Test</span> <span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">test</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="mh">0xabcdef01</span><span class="p">);</span> <span class="c1">// hash does not exist</span>
        <span class="c1">// resulta en test.x becoming == 1.</span>

        <span class="c1">// Lo siguiente no compilará, pero incluso</span>
        <span class="c1">// si alguien envía ether a ese contrato,</span>
        <span class="c1">// la transacción fallará y rechazará</span>
        <span class="c1">// el ether.</span>
        <span class="c1">//test.send(2 ether);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="events">
<span id="index-8"></span><span id="id6"></span><h4>Eventos<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h4>
<p>Los eventos permiten el uso conveniente de las instalaciones de registro de EVM, 
que a su vez se pueden utilizar para &#8220;llamar&#8221; callbacks de JavaScript en la interfaz 
de usuario de un dapp, que escucha estos eventos.</p>
<p>Los eventos son miembros heredables de los contratos. Cuando se llaman, 
hacen que los argumentos se almacenen en el registro de la transacción, 
una estructura de datos especial en la cadena de bloques. Estos registros 
están asociados con la dirección del contrato y se incorporarán a la 
cadena de bloques y permanecerán allí mientras el bloque sea accesible 
(siempre como Frontier y Homestead, pero esto puede cambiar con Serenity). 
Los datos de registros y eventos no son accesibles desde dentro de los contratos 
(ni siquiera del contrato que los creó).</p>
<p>Las pruebas de SPV para registros son posibles, por lo que si una entidad externa proporciona 
un contrato con dicha prueba, puede comprobar que el registro realmente existe dentro de la 
cadena de bloques. Pero tenga en cuenta que los encabezados de bloque tienen que ser suministrados 
porque el contrato sólo puede ver los últimos 256 hashes de bloque.</p>
<p>Hasta tres parámetros pueden recibir el atributo <code class="docutils literal"><span class="pre">indexed</span></code> 
 que hará que se busquen los respectivos argumentos: Es posible filtrar 
 para valores específicos de argumentos indexados en la interfaz de usuario.</p>
<p>Si arrays (incluidos <code class="docutils literal"><span class="pre">string</span></code> y <code class="docutils literal"><span class="pre">bytes</span></code>) 
se utilizan como argumentos indexados, el hash Keccak-256 de él se almacena como tema en su lugar.</p>
<p>El hash de la firma del evento es uno de los temas excepto si declaró el evento con el especificador
 <code class="docutils literal"><span class="pre">anonymous</span></code>. 
 Esto significa que no es posible filtrar para eventos anónimos específicos por nombre.</p>
<p>Todos los argumentos no indexados se almacenarán en la parte de datos del registro (log).</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Los argumentos indexados no se almacenarán ellos mismos. Sólo puede buscar los valores, pero es imposible recuperar los valores ellos mismos.</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">ClientReceipt</span> <span class="p">{</span>
    <span class="kd">event</span> <span class="nx">Deposit</span><span class="p">(</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="nx">_from</span><span class="p">,</span>
        <span class="kt">bytes32</span> <span class="k">indexed</span> <span class="nx">_id</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="nx">_value</span>
    <span class="p">);</span>

    <span class="kd">function</span> <span class="nx">deposit</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">_id</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// Cualquier llamada a esta función (incluso profundamente anidada) puede </span>
        <span class="c1">// ser detectada a partir de la API JavaScript filtrando </span>
        <span class="c1">// for `Deposit` to be called.</span>
        <span class="nx">Deposit</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">_id</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El uso en la API de JavaScript sería el siguiente:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">abi</span> <span class="o">=</span> <span class="cm">/* abi generado por el compilador */</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">ClientReceipt</span> <span class="o">=</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="kd">contract</span><span class="p">(</span><span class="nx">abi</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">clientReceipt</span> <span class="o">=</span> <span class="nx">ClientReceipt</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s2">&quot;0x1234...ab67&quot;</span> <span class="cm">/* direccion */</span><span class="p">);</span>

<span class="kd">var</span> <span class="kd">event</span> <span class="o">=</span> <span class="nx">clientReceipt</span><span class="p">.</span><span class="nx">Deposit</span><span class="p">();</span>

<span class="c1">// mirar cambios</span>
<span class="kd">event</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">){</span>
    <span class="c1">// resultado contendrá información variada</span>
    <span class="c1">// incluyendo los argumets dados a la consola de </span>
    <span class="c1">// Deposits call.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// O pasar una devolución de llamada (callback) para comenzar a ver inmediatamente</span>
<span class="kd">var</span> <span class="kd">event</span> <span class="o">=</span> <span class="nx">clientReceipt</span><span class="p">.</span><span class="nx">Deposit</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="section" id="low-level-interface-to-logs">
<span id="index-9"></span><h5>Interfaz de bajo nivel con registros (logs)<a class="headerlink" href="#low-level-interface-to-logs" title="Permalink to this headline">¶</a></h5>
<p>También es posible acceder a la interfaz de bajo nivel para el mecanismo de registro a través de las funciones 
<code class="docutils literal"><span class="pre">log0</span></code>, 
<code class="docutils literal"><span class="pre">log1</span></code>, <code class="docutils literal"><span class="pre">log2</span></code>, <code class="docutils literal"><span class="pre">log3</span></code> and <code class="docutils literal"><span class="pre">log4</span></code>.
<code class="docutils literal"><span class="pre">logi</span></code> toma 
<code class="docutils literal"><span class="pre">i</span> <span class="pre">+</span> <span class="pre">1</span></code> 
el parámetro de tipo <code class="docutils literal"><span class="pre">bytes32</span></code>, 
donde se utilizará el primer argumento para la parte de datos del registro y los demás como temas. 
La llamada de evento anterior se puede realizar de la misma manera que</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nb">log3</span><span class="p">(</span>
    <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
    <span class="mh">0x50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20</span><span class="p">,</span>
    <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span>
    <span class="nx">_id</span>
<span class="p">);</span>
</pre></div>
</div>
<p>donde el número hexadecimal largo es igual a la firma del evento
<code class="docutils literal"><span class="pre">keccak256(&quot;Deposit(address,hash256,uint256)&quot;)</span></code>.</p>
</div>
<div class="section" id="additional-resources-for-understanding-events">
<h5>Recursos adicionales para entender los eventos<a class="headerlink" href="#additional-resources-for-understanding-events" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ethereum/wiki/wiki/JavaScript-API#contract-events">Documentación Javascript</a></li>
<li><a class="reference external" href="https://github.com/debris/smart-exchange/blob/master/lib/contracts/SmartExchange.sol">Ejemplo de uso de eventos</a></li>
<li><a class="reference external" href="https://github.com/debris/smart-exchange/blob/master/lib/exchange_transactions.js">Cómo acceder a ellos en js</a></li>
</ul>
</div>
</div>
<div class="section" id="inheritance">

<span id="index-10"></span><h4>Herencia<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h4>
<p>Solidity admite múltiples herencias copiando el código, incluyendo el polimorfismo.</p>
<p>Todas las llamadas de función son virtuales, lo que significa que se llama a la función más derivada, 
excepto cuando el nombre del contrato se da explícitamente.</p>
<p>Cuando un contrato hereda de varios contratos, sólo se crea un contrato único en la cadena de bloque, 
y el código de todos los contratos base se copia en el contrato creado.</p>
<p>El sistema de herencia general es muy similar al de 
<a class="reference external" href="https://docs.python.org/3/tutorial/classes.html#inheritance">Python&#8217;s</a>,
especialmente en relación con la herencia múltiple.</p>
<p>Los detalles se dan en el siguiente ejemplo.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">owned</span><span class="p">()</span> <span class="p">{</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Use &quot;is&quot; para derivar de otro contrato. Los contratos derivados</span>
<span class="c1">// pueden acceder a todos los miembros no privados incluyendo</span>
<span class="c1">// funciones internas y variables de estado. Sin embargo,</span>
<span class="c1">// estos no se pueden acceder externamente a través de `this`. </span>
<span class="kd">contract</span> <span class="nx">mortal</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Estos contratos abstractos sólo se proporcionan para hacer que la</span>
<span class="c1">// interfaz sea conocida por el compilador. Observe la función </span>
<span class="c1">// sin cuerpo(body). Si un contrato no implementa todas las</span>
<span class="c1">// funciones, sólo puede utilizarse como una interfaz.</span>
<span class="kd">contract</span> <span class="nx">Config</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">lookup</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">id</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="nx">adr</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="nx">NameReg</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">register</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">name</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">unregister</span><span class="p">();</span>
 <span class="p">}</span>
<span class="c1">// Es posible la herencia múltiple. Tenga en cuenta que &quot;owned&quot; es</span>
<span class="c1">// también una clase base de &quot;mortal&quot;, sin embargo, sólo hay una única </span>
<span class="c1">// instancia de &quot;owned&quot; (como para la herencia virtual en C ++).</span>
<span class="kd">contract</span> <span class="nx">named</span> <span class="k">is</span> <span class="nx">owned</span><span class="p">,</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">named</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Config</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">Config</span><span class="p">(</span><span class="mh">0xd5f9d8d94886e70b06e474c3fb14fd43e2f23970</span><span class="p">);</span>
        <span class="nx">NameReg</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="nx">register</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Las funciones pueden ser anuladas por otra función con el mismo nombre y </span>
    <span class="c1">// el mismo número / tipos de entradas. Si la función principal tiene diferentes</span>
    <span class="c1">// tipos de parámetros de salida, esto causa un error.</span>
    <span class="c1">// Tanto las llamadas de función locales como las basadas en mensajes toman </span>
    <span class="c1">// en cuenta estas sustituciones.</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Config</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">Config</span><span class="p">(</span><span class="mh">0xd5f9d8d94886e70b06e474c3fb14fd43e2f23970</span><span class="p">);</span>
            <span class="nx">NameReg</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="nx">unregister</span><span class="p">();</span>
            <span class="c1">// Todavía es posible llamar a una función específica </span>
            <span class="c1">// overridden.</span>
            <span class="nx">mortal</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Si un constructor toma un argumento, necesita ser</span>
<span class="c1">// proporcionado en el encabezado (o modificador-invocación-estilo en </span>
<span class="c1">// el constructor del contrato derivado (ver abajo)).</span>
<span class="kd">contract</span> <span class="nx">PriceFeed</span> <span class="k">is</span> <span class="nx">owned</span><span class="p">,</span> <span class="nx">mortal</span><span class="p">,</span> <span class="nx">named</span><span class="p">(</span><span class="s2">&quot;GoldFeed&quot;</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="nx">updateInfo</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">newInfo</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">newInfo</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kd">function</span> <span class="nx">get</span><span class="p">()</span> <span class="k">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">info</span><span class="p">;</span> <span class="p">}</span>

   <span class="kt">uint</span> <span class="nx">info</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Tenga en cuenta que arriba, llamamos a <code class="docutils literal"><span class="pre">mortal.kill()</span></code> a &#8220;forward&#8221; 
(reenviar) la solicitud de destrucción. La manera en que esto se hace es problemática, como se ve en el siguiente ejemplo:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">owned</span><span class="p">()</span> <span class="p">{</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">mortal</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Base1</span> <span class="k">is</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* do cleanup 1 */</span> <span class="nx">mortal</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Base2</span> <span class="k">is</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* do cleanup 2 */</span> <span class="nx">mortal</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Final</span> <span class="k">is</span> <span class="nx">Base1</span><span class="p">,</span> <span class="nx">Base2</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Una llamada a <code class="docutils literal"><span class="pre">Final.kill()</span></code> 
llamará <code class="docutils literal"><span class="pre">Base2.kill</span></code> 
como la derivación más derivada, pero esta función pasará por alto 
<code class="docutils literal"><span class="pre">Base1.kill</span></code>, 
básicamente porque ni siquiera sabe acerca de
<code class="docutils literal"><span class="pre">Base1</span></code>.  
La manera alrededor de esto es utilizar <code class="docutils literal"><span class="pre">super</span></code>:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">owned</span><span class="p">()</span> <span class="p">{</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">mortal</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Base1</span> <span class="k">is</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* do cleanup 1 */</span> <span class="k">super</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">Base2</span> <span class="k">is</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* do cleanup 2 */</span> <span class="k">super</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="nx">Final</span> <span class="k">is</span> <span class="nx">Base2</span><span class="p">,</span> <span class="nx">Base1</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si <code class="docutils literal"><span class="pre">Base1</span></code> calls a function of <code class="docutils literal"><span class="pre">super</span></code>, it does not simply
llama una función de super, no simplemente llama a esta función en uno de sus contratos base. 
Por el contrario, llama a esta función en el siguiente contrato base en el gráfico de herencia final, 
por lo que llamará <code class="docutils literal"><span class="pre">Base2.kill()</span></code> 
(nota que la secuencia de herencia final es - comenzando con el contrato más derivado: 
Final, Base1, Base2, mortal, propiedad). La función real que se llama cuando se utiliza super 
se desconoce en el contexto de la clase donde se utiliza, aunque su tipo es conocido. 
Esto es similar para la búsqueda de métodos virtuales ordinarios.</p>
<div class="section" id="arguments-for-base-constructors">
<span id="index-11"></span><h5>Argumentos para los constructores de base<a class="headerlink" href="#arguments-for-base-constructors" title="Permalink to this headline">¶</a></h5>
<p>Los contratos derivados deben proporcionar todos los argumentos necesarios 
para los constructores de base. Esto se puede hacer de dos formas:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Base</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">Base</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_x</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">_x</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="nx">Derived</span> <span class="k">is</span> <span class="nx">Base</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">Derived</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_y</span><span class="p">)</span> <span class="nx">Base</span><span class="p">(</span><span class="nx">_y</span> <span class="o">*</span> <span class="nx">_y</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Una forma está directamente en la lista de herencia (<code class="docutils literal"><span class="pre">is</span> <span class="pre">Base(7)</span></code>).  
El otro está en la forma en que un modificador sería invocado como parte del encabezado del constructor derivado 
(<code class="docutils literal"><span class="pre">Base(_y</span> <span class="pre">*</span> <span class="pre">_y)</span></code>). 
La primera manera de hacerlo es más conveniente si el argumento del constructor es una constante y 
define el comportamiento del contrato o lo describe. La segunda forma tiene que ser utilizada si los 
argumentos del constructor de la base dependen de los del contrato derivado. Si, como en este ejemplo 
tonto, ambos lugares se usan, el argumento de estilo modificador tiene prioridad.</p>
</div>
<div class="section" id="multiple-inheritance-and-linearization">
<span id="index-12"></span><h5>Herencia Múltiple y Linealización<a class="headerlink" href="#multiple-inheritance-and-linearization" title="Permalink to this headline">¶</a></h5>
<p>Los lenguajes que permiten la herencia múltiple tienen que tratar con varios problemas. Uno es el  
<a class="reference external" href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">Diamond Problem</a>.
Solidity sigue el camino de Python y utiliza &#8220;<a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 Linearization</a>&#8221;
para forzar un orden específico en el DAG de las clases base. Esto resulta en la propiedad deseable 
de la monotonicidad, pero no permite algunos gráficos de herencia. Especialmente, el orden en que se 
dan las clases base en la directiva <code class="docutils literal"><span class="pre">is</span></code> 
es importante. En el siguiente código, Solidity dará el error &#8220;Linearization of inheritance graph impossible&#8221;.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// Esto no compilará</span>

<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">X</span> <span class="p">{}</span>
<span class="kd">contract</span> <span class="nx">A</span> <span class="k">is</span> <span class="nx">X</span> <span class="p">{}</span>
<span class="kd">contract</span> <span class="nx">C</span> <span class="k">is</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">X</span> <span class="p">{}</span>
</pre></div>
</div>
<p>La razón de esto es que las <code class="docutils literal"><span class="pre">C</span></code> peticiones <code class="docutils literal"><span class="pre">X</span>
</code> para anular <code class="docutils literal"><span class="pre">A</span></code>
(especificando <code class="docutils literal"><span class="pre">A,</span> <span class="pre">X</span></code> en este orden), pero 
<code class="docutils literal"><span class="pre">A</span></code> sí las solicitudes para anular 
<code class="docutils literal"><span class="pre">X</span></code>, son una contradicción que no puede ser resuelto.</p>
<p>Una regla simple a recordar es especificar las clases base en el orden de &#8220;most base-like&#8221; a &#8220;most derived&#8221;.</p>
</div>
<div class="section" id="inheriting-different-kinds-of-members-of-the-same-name">
<h5>Heredando diferentes tipos de miembros del mismo nombre<a class="headerlink" href="#inheriting-different-kinds-of-members-of-the-same-name" title="Permalink to this headline">¶</a></h5>
<p>Cuando la herencia da como resultado un contrato con una función y un modificador del mismo nombre, se considera como un error. 
Este error es producido también por un evento y un modificador del mismo nombre, y una función y un evento del mismo nombre. 
Como excepción, un getter de variable de estado puede anular una función pública.</p>
</div>
</div>
<div class="section" id="abstract-contracts">
<span id="index-13"></span><h4>Contratos abstractos<a class="headerlink" href="#abstract-contracts" title="Permalink to this headline">¶</a></h4>
<p>Las funciones de contrato pueden carecer de una implementación como en el ejemplo siguiente 
(tenga en cuenta que el encabezado de declaración de función es terminado por <code class="docutils literal"><span class="pre">;</span></code>):</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Feline</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">utterance</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Tales contratos no pueden ser compilados (aunque contengan funciones implementadas junto con funciones no implementadas), 
pero pueden ser utilizados como contratos base:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Feline</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">utterance</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Cat</span> <span class="k">is</span> <span class="nx">Feline</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">utterance</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="s2">&quot;miaow&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si un contrato hereda de un contrato abstracto y no implementa todas las funciones no implementadas por sobreescribir, será por sí mismo abstracto.</p>
</div>
<div class="section" id="interfaces">
<span id="index-14"></span><h4>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h4>
<p>Las interfaces son similares a los contratos abstractos, pero no pueden tener ninguna función implementada. Existen otras restricciones:</p>
<ol class="arabic simple">
<li>No puede heredar otros contratos o interfaces.</li>
<li>No se puede definir el constructor.</li>
<li>No se pueden definir variables.</li>
<li>No se pueden definir estructuras.</li>
<li>No se pueden definir enums.</li>
</ol>
<p>Algunas de estas restricciones podrían ser levantadas en el futuro.</p>
<p>Las interfaces se limitan básicamente a lo que el contrato ABI puede representar, 
y la conversión entre el ABI y una interfaz debe ser posible sin pérdida de información.</p>
<p>Las interfaces se indican con su propia palabra clave:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">interface</span> <span class="nx">Token</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="nx">recipient</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Los contratos pueden heredar interfaces, ya que heredarían otros contratos.</p>
</div>
<div class="section" id="libraries">
<span id="index-15"></span><span id="id7"></spa
n><h4>Libraries o Bibliotecas<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h4>
<p>Las bibliotecas son similares a los contratos, pero su propósito es que se desplieguen sólo una vez en una dirección específica y 
su código se reutilice utilizando la función <code class="docutils literal"><span class="pre">DELEGATECALL</span></code>
(<code class="docutils literal"><span class="pre">CALLCODE</span></code> hasta Homestead)
del EVM. Esto significa que si se llaman las funciones de la biblioteca, su código se ejecuta en el contexto del contrato de llamada, 
 es decir, los puntos <code class="docutils literal"><span class="pre">this</span></code> 
  del contrato de llamada y, especialmente, el almacenamiento del contrato de llamada se puede acceder. Como una biblioteca 
 es una pieza aislada del código fuente, sólo puede acceder a las variables de estado del contrato de llamada si se suministran 
 explícitamente (no tendría forma de nombrarlos, de lo contrario).</p>
<p>Las bibliotecas pueden ser vistas como contratos base implícitos de los contratos que las utilizan. No serán explícitamente visibles 
en la jerarquía de herencia, pero las llamadas a funciones de biblioteca se parecen a las llamadas a funciones de contratos base explícitos
 (<code class="docutils literal"><span class="pre">L.f()</span></code> si <code class="docutils literal"><span class="pre">L</span></code> 
 es el nombre de la biblioteca). Además, las funciones
<code class="docutils literal"><span class="pre">internas</span></code> 
de las bibliotecas son visibles en todos los contratos, como si la biblioteca fuera un contrato base. 
 Por supuesto, las llamadas a funciones internas utilizan la convención de llamada interna, lo que significa 
 que se pueden pasar todos los tipos internos y los tipos de memoria se pasarán por referencia y no se copiarán. 
 Para realizar esto en el EVM, el código de las funciones internas de la biblioteca y todas las funciones llamadas a 
 partir de la misma se insertarán en el contrato de llamada 
 <code class="docutils literal"><span class="pre">JUMP</span></code>  y se utilizará una llamada regular en lugar de a 
 <code class="docutils literal"><span class="pre">DELEGATECALL</span></code>.</p>
<p id="index-16">El siguiente ejemplo ilustra cómo utilizar las bibliotecas (pero asegúrese de consultar 
<a class="reference internal" href="#using-for"><span class="std std-ref">using for</span></a> 
para un ejemplo más avanzado para implementar un conjunto).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>
<span class="kd">library</span> <span class="nx">Set</span> <span class="p">{</span>
  <span class="c1">// Definimos un nuevo tipo de datos struct que se utilizará para</span>
  <span class="c1">// mantener sus datos en el contrato de llamada. </span>
  <span class="kd">struct</span> <span class="nx">Data</span> <span class="p">{</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">flags</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// Tenga en cuenta que el primer parámetro es del tipo &quot;storage</span>
  <span class="c1">// reference&quot; y por lo tanto sólo su dirección de almacenamiento y no</span>
  <span class="c1">// su contenido se pasa como parte de la llamada. Esta es una</span>
  <span class="c1">// característica especial de las funciones de la biblioteca. Es idiomático</span>
  <span class="c1">// llamar al primer parámetro &#39;self&#39;, si la función</span>
  <span class="c1">// puede ser vista como un método de ese objeto.</span>
  <span class="kd">function</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">])</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// ya hay </span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">])</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// not there</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">Data</span> <span class="nx">knownValues</span><span class="p">;</span>  
     <span class="kd">function</span> <span class="nx">register</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Las funciones de biblioteca se pueden llamar sin una</span>
        <span class="c1">// instancia específica de la biblioteca, ya que</span>
        <span class="c1">// &quot;instance&quot; será el contrato actual.</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">Set</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">knownValues</span><span class="p">,</span> <span class="nx">value</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="c1">// En este contrato, también podemos acceder directamente a knownValues.flags, si queremos.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Por supuesto, usted no tiene que seguir esta manera de utilizar las bibliotecas - 
también pueden ser utilizados sin la definición de tipos de datos de estructura. 
Las funciones también funcionan sin ningún parámetro de referencia de almacenamiento, 
y pueden tener múltiples parámetros de referencia de almacenamiento y en cualquier posición.</p>
<p>Las llamadas a <code class="docutils literal"><span class="pre">Set.contains</span></code>, <code class="docutils literal"><span class="pre">Set.insert</span></code>
 y <code class="docutils literal"><span class="pre">Set.remove</span></code>
se compilan todos como calls (<code class="docutils literal"><span class="pre">DELEGATECALL</span></code>) 
a un contrato externo / biblioteca. Si utiliza bibliotecas, asegúrese de que se realice una llamada de función externa real.
<code class="docutils literal"><span class="pre">msg.sender</span></code>, <code class="docutils literal"><span class="pre">msg.value</span></code> y 
<code class="docutils literal"><span class="pre">this</span></code> 
conservarán sus valores en esta llamada, sin embargo (antes de Homestead, debido al uso de <code class="docutils literal"><span class="pre">CALLCODE</span></code>, <code class="docutils literal"><span class="pre">msg.sender</span></code> and
<code class="docutils literal"><span class="pre">msg.value</span></code> cambia).</p>
<p>El siguiente ejemplo muestra cómo utilizar tipos de memoria y funciones internas en bibliotecas para implementar 
tipos personalizados sin la sobrecarga de las llamadas de función externas:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">library</span> <span class="nx">BigInt</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">bigint</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">limbs</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">fromUint</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="nx">bigint</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="mi">1</span><span class="p">);</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">bigint</span> <span class="nx">_a</span><span class="p">,</span> <span class="nx">bigint</span> <span class="nx">_b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="nx">bigint</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="nx">max</span><span class="p">(</span><span class="nx">_a</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">_b</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span>
        <span class="kt">uint</span> <span class="nx">carry</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">limb</span><span class="p">(</span><span class="nx">_a</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
            <span class="kt">uint</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">limb</span><span class="p">(</span><span class="nx">_b</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">+</span> <span class="nx">carry</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">a</span> <span class="o">||</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">==</span> <span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">carry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
                <span class="nx">carry</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="nx">carry</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">carry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// too bad, we have to add a limb</span>
            <span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">newLimbs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span>
                <span class="nx">newLimbs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="nx">newLimbs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">carry</span><span class="p">;</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span> <span class="o">=</span> <span class="nx">newLimbs</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">limb</span><span class="p">(</span><span class="nx">bigint</span> <span class="nx">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">_limb</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_limb</span> <span class="o">&lt;</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">limbs</span><span class="p">[</span><span class="nx">_limb</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">max</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="k">private</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span> <span class="o">?</span> <span class="nx">a</span> <span class="o">:</span> <span class="nx">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="k">using</span> <span class="nx">BigInt</span> <span class="k">for</span> <span class="nx">BigInt</span><span class="p">.</span><span class="nx">bigint</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">BigInt</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">BigInt</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
 <p>Dado que el compilador no puede saber dónde se desplegará la biblioteca, estas direcciones deben ser rellenadas en el 
bytecode final por un vinculador (consulte 
<a class="reference internal" href="index.html#commandline-compiler"><span class="std std-ref">Utilización del compilador de línea de comandos</span></a> 
para saber cómo utilizar el compilador de línea de comandos para vincular). Si las direcciones no se dan como argumentos al compilador, 
el código hexadecimal compilado contendrá marcadores de posición del formato 
<code class="docutils literal"><span class="pre">__Set______</span></code> (donde 
<code class="docutils literal"><span class="pre">Set</span></code>  es el nombre de la biblioteca). La dirección se puede rellenar manualmente 
reemplazando todos esos 40 símbolos por la codificación hexadecimal de la dirección del contrato de biblioteca.</p>
<p>Restricciones para las bibliotecas en comparación con los contratos:</p>
<ul class="simple">
<li>No hay variables de estado</li>
<li>No puede heredar ni ser heredado</li>
<li>No se puede recibir Ether</li>
</ul>
<p>(Estos pueden ser levantados en un punto posterior.)</p>
</div>
<div class="section" id="using-for">
<span id="index-17"></span><span id="id8"></span><h4>Using For<a class="headerlink" href="#using-for" title="Permalink to this headline">¶</a></h4>
<p>La directiva <code class="docutils literal"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> 
<span class="pre">B;</span></code> 
se puede utilizar para conectar funciones de biblioteca (desde la biblioteca <code class="docutils literal"><span class="pre">A</span></code>) 
a cualquier tipo (<code class="docutils literal"><span class="pre">B</span></code>).
Estas funciones recibirán el objeto al que son llamados como su primer parámetro (como la variable  
<code class="docutils literal"><span class="pre">self</span></code> en Python).</p>
<p>El efecto de <code class="docutils literal"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">*;</span>
</code> es que las funciones de la biblioteca <code class="docutils literal"><span class="pre">A</span></code> se adjuntan a cualquier tipo.</p>
<p>  En ambas situaciones, todas las funciones, incluso aquellas en las que el tipo del primer parámetro 
  no coincide con el tipo del objeto, se adjuntan. El tipo se comprueba en el punto en que se llama a 
  la función y se realiza la resolución de sobrecarga de funciones.</p>
<p>La directiva <code class="docutils literal"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B;</span></code> 
está activa para el ámbito actual, que se limita a un contrato por ahora, pero se elevará al ámbito global más adelante, de modo que al incluir un módulo, 
sus tipos de datos, incluidas las funciones de biblioteca, estén disponibles sin tener que añadir más código.</p>
<p>Vamos a reescribir el ejemplo de conjunto de las 
<a class="reference internal" href="#libraries"><span class="std std-ref">Libraries</span></a> de esta manera:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>
<span class="c1">// Este es el mismo código que antes, solo sin comentarios </span>
<span class="kd">library</span> <span class="nx">Set</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="nx">Data</span> <span class="p">{</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">flags</span><span class="p">;</span> <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// ya hay</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">])</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// no hay</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="k">using</span> <span class="nx">Set</span> <span class="k">for</span> <span class="nx">Set</span><span class="p">.</span><span class="nx">Data</span><span class="p">;</span> <span class="c1">// este es el cambio crucial</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">Data</span> <span class="nx">knownValues</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">register</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Aquí, todas las variables del tipo Set.Data tienen </span>
        <span class="c1">// funciones miembro correspondientes.</span>
        <span class="c1">// La siguiente llamada a la función es idéntica a</span>
        <span class="c1">// Set.insert(knownValues, value)</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">knownValues</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>También es posible ampliar los tipos elementales de esta manera:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="nx">Search</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">indexOf</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">value</span><span class="p">)</span> <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">return</span> <span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="k">using</span> <span class="nx">Search</span> <span class="k">for</span> <span class="kt">uint</span><span class="p">[];</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">append</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">replace</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_old</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">_new</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This performs the library function call</span>
        <span class="kt">uint</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">_old</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_new</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="nx">data</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_new</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Tenga en cuenta que todas las llamadas de biblioteca son llamadas de función EVM reales. 
Esto significa que si pasa tipos de memoria o value, se realizará una copia, incluso de la variable
<code class="docutils literal"><span class="pre">self</span></code>. 
La única situación en la que no se realizará ninguna copia es cuando se usan variables de referencia de almacenamiento.</p>
</div>
</div>
<span id="document-assembly"></span><div class="section" id="solidity-assembly">
<h3>Solidity Assembly<a class="headerlink" href="#solidity-assembly" title="Permalink to this headline">¶</a></h3>
<p id="index-0">Solidity defines an assembly language that can also be used without Solidity.
This assembly language can also be used as &#8220;inline assembly&#8221; inside Solidity
source code. We start with describing how to use inline assembly and how it
differs from standalone assembly and then specify assembly itself.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">TODO: Write about how scoping rules of inline assembly are a bit different
and the complications that arise when for example using internal functions
of libraries. Furthermore, write about the symbols defined by the compiler.</p>
</div>
<div class="section" id="inline-assembly">
<span id="id1"></span><h4>Inline Assembly<a class="headerlink" href="#inline-assembly" title="Permalink to this headline">¶</a></h4>
<p>For more fine-grained control especially in order to enhance the language by writing libraries,
it is possible to interleave Solidity statements with inline assembly in a language close
to the one of the virtual machine. Due to the fact that the EVM is a stack machine, it is
often hard to address the correct stack slot and provide arguments to opcodes at the correct
point on the stack. Solidity&#8217;s inline assembly tries to facilitate that and other issues
arising when writing manual assembly by the following features:</p>
<ul class="simple">
<li>functional-style opcodes: <code class="docutils literal"><span class="pre">mul(1,</span> <span class="pre">add(2,</span> <span class="pre">3))</span></code> instead of <code class="docutils literal"><span class="pre">push1</span> <span class="pre">3</span> <span class="pre">push1</span> <span class="pre">2</span> <span class="pre">add</span> <span class="pre">push1</span> <span class="pre">1</span> <span class="pre">mul</span></code></li>
<li>assembly-local variables: <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(2,</span> <span class="pre">3)</span>&#160; <span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mload(0x40)</span>&#160; <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(x,</span> <span class="pre">y)</span></code></li>
<li>access to external variables: <code class="docutils literal"><span class="pre">function</span> <span class="pre">f(uint</span> <span class="pre">x)</span> <span class="pre">{</span> <span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">sub(x,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">}</span></code></li>
<li>labels: <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">10</span>&#160; <span class="pre">repeat:</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">sub(x,</span> <span class="pre">1)</span> <span class="pre">jumpi(repeat,</span> <span class="pre">eq(x,</span> <span class="pre">0))</span></code></li>
<li>loops: <code class="docutils literal"><span class="pre">for</span> <span class="pre">{</span> <span class="pre">let</span> <span class="pre">i</span> <span class="pre">:=</span> <span class="pre">0</span> <span class="pre">}</span> <span class="pre">lt(i,</span> <span class="pre">x)</span> <span class="pre">{</span> <span class="pre">i</span> <span class="pre">:=</span> <span class="pre">add(i,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(2,</span> <span class="pre">y)</span> <span class="pre">}</span></code></li>
<li>switch statements: <code class="docutils literal"><span class="pre">switch</span> <span class="pre">x</span> <span class="pre">case</span> <span class="pre">0</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(x,</span> <span class="pre">2)</span> <span class="pre">}</span> <span class="pre">default</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">0</span> <span class="pre">}</span></code></li>
<li>function calls: <code class="docutils literal"><span class="pre">function</span> <span class="pre">f(x)</span> <span class="pre">-&gt;</span> <span class="pre">y</span> <span class="pre">{</span> <span class="pre">switch</span> <span class="pre">x</span> <span class="pre">case</span> <span class="pre">0</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">1</span> <span class="pre">}</span> <span class="pre">default</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(x,</span> <span class="pre">f(sub(x,</span> <span class="pre">1)))</span> <span class="pre">}</span>&#160;&#160; <span class="pre">}</span></code></li>
</ul>
<p>We now want to describe the inline assembly language in detail.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Inline assembly is a way to access the Ethereum Virtual Machine
at a low level. This discards several important safety
features of Solidity.</p>
</div>
<div class="section" id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<p>The following example provides library code to access the code of another contract and
load it into a <code class="docutils literal"><span class="pre">bytes</span></code> variable. This is not possible at all with &#8220;plain Solidity&#8221; and the
idea is that assembly libraries will be used to enhance the language in such ways.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="nx">GetCode</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">at</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_addr</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span> <span class="nx">o_code</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="c1">// retrieve the size of the code, this needs assembly</span>
            <span class="kr">let</span> <span class="nx">size</span> <span class="o">:=</span> <span class="nx">extcodesize</span><span class="p">(</span><span class="nx">_addr</span><span class="p">)</span>
            <span class="c1">// allocate output byte array - this could also be done without assembly</span>
            <span class="c1">// by using o_code = new bytes(size)</span>
            <span class="nx">o_code</span> <span class="o">:=</span> <span class="nx">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
            <span class="c1">// new &quot;memory end&quot; including padding</span>
            <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">o_code</span><span class="p">,</span> <span class="nx">and</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="mh">0x1f</span><span class="p">),</span> <span class="nx">not</span><span class="p">(</span><span class="mh">0x1f</span><span class="p">))))</span>
            <span class="c1">// store length in memory</span>
            <span class="nx">mstore</span><span class="p">(</span><span class="nx">o_code</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
            <span class="c1">// actually retrieve the code, this needs assembly</span>
            <span class="nx">extcodecopy</span><span class="p">(</span><span class="nx">_addr</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">o_code</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Inline assembly could also be beneficial in cases where the optimizer fails to produce
efficient code. Please be aware that assembly is much more difficult to write because
the compiler does not perform checks, so you should use it for complex things only if
you really know what you are doing.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">12</span><span class="p">;</span>

<span class="kd">library</span> <span class="nx">VectorSum</span> <span class="p">{</span>
    <span class="c1">// This function is less efficient because the optimizer currently fails to</span>
    <span class="c1">// remove the bounds checks in array access.</span>
    <span class="kd">function</span> <span class="nx">sumSolidity</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">_data</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">o_sum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span>
            <span class="nx">o_sum</span> <span class="o">+=</span> <span class="nx">_data</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// We know that we only access the array in bounds, so we can avoid the check.</span>
    <span class="c1">// 0x20 needs to be added to an array because the first slot contains the</span>
    <span class="c1">// array length.</span>
    <span class="kd">function</span> <span class="nx">sumAsm</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">_data</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">o_sum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">assembly</span> <span class="p">{</span>
                <span class="nx">o_sum</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">o_sum</span><span class="p">,</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">_data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="nx">mul</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">))))</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Same as above, but accomplish the entire code within inline assembly.</span>
    <span class="kd">function</span> <span class="nx">sumPureAsm</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">_data</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">o_sum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
           <span class="c1">// Load the length (first 32 bytes)</span>
           <span class="kr">let</span> <span class="nx">len</span> <span class="o">:=</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">_data</span><span class="p">)</span>

           <span class="c1">// Skip over the length field.</span>
           <span class="c1">//</span>
           <span class="c1">// Keep temporary variable so it can be incremented in place.</span>
           <span class="c1">//</span>
           <span class="c1">// NOTE: incrementing _data would result in an unusable</span>
           <span class="c1">//       _data variable after this assembly block</span>
           <span class="kr">let</span> <span class="nx">data</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">_data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>

           <span class="c1">// Iterate until the bound is not met.</span>
           <span class="k">for</span>
               <span class="p">{</span> <span class="kr">let</span> <span class="nx">end</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">len</span><span class="p">)</span> <span class="p">}</span>
               <span class="nx">lt</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>
               <span class="p">{</span> <span class="nx">data</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">}</span>
           <span class="p">{</span>
               <span class="nx">o_sum</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">o_sum</span><span class="p">,</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
           <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="syntax">
<h5>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h5>
<p>Assembly parses comments, literals and identifiers exactly as Solidity, so you can use the
usual <code class="docutils literal"><span class="pre">//</span></code> and <code class="docutils literal"><span class="pre">/*</span> <span class="pre">*/</span></code> comments. Inline assembly is marked by <code class="docutils literal"><span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> and inside
these curly braces, the following can be used (see the later sections for more details)</p>
<blockquote>
<div><ul class="simple">
<li>literals, i.e. <code class="docutils literal"><span class="pre">0x123</span></code>, <code class="docutils literal"><span class="pre">42</span></code> or <code class="docutils literal"><span class="pre">&quot;abc&quot;</span></code> (strings up to 32 characters)</li>
<li>opcodes (in &#8220;instruction style&#8221;), e.g. <code class="docutils literal"><span class="pre">mload</span> <span class="pre">sload</span> <span class="pre">dup1</span> <span class="pre">sstore</span></code>, for a list see below</li>
<li>opcodes in functional style, e.g. <code class="docutils literal"><span class="pre">add(1,</span> <span class="pre">mlod(0))</span></code></li>
<li>labels, e.g. <code class="docutils literal"><span class="pre">name:</span></code></li>
<li>variable declarations, e.g. <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">7</span></code>, <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(y,</span> <span class="pre">3)</span></code> or <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span></code> (initial value of empty (0) is assigned)</li>
<li>identifiers (labels or assembly-local variables and externals if used as inline assembly), e.g. <code class="docutils literal"><span class="pre">jump(name)</span></code>, <code class="docutils literal"><span class="pre">3</span> <span class="pre">x</span> <span class="pre">add</span></code></li>
<li>assignments (in &#8220;instruction style&#8221;), e.g. <code class="docutils literal"><span class="pre">3</span> <span class="pre">=:</span> <span class="pre">x</span></code></li>
<li>assignments in functional style, e.g. <code class="docutils literal"><span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(y,</span> <span class="pre">3)</span></code></li>
<li>blocks where local variables are scoped inside, e.g. <code class="docutils literal"><span class="pre">{</span> <span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">3</span> <span class="pre">{</span> <span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">add(x,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">}</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="opcodes">
<h5>Opcodes<a class="headerlink" href="#opcodes" title="Permalink to this headline">¶</a></h5>
<p>This document does not want to be a full description of the Ethereum virtual machine, but the
following list can be used as a reference of its opcodes.</p>
<p>If an opcode takes arguments (always from the top of the stack), they are given in parentheses.
Note that the order of arguments can be seen to be reversed in non-functional style (explained below).
Opcodes marked with <code class="docutils literal"><span class="pre">-</span></code> do not push an item onto the stack, those marked with <code class="docutils literal"><span class="pre">*</span></code> are
special and all others push exactly one item onto the stack.</p>
<p>In the following, <code class="docutils literal"><span class="pre">mem[a...b)</span></code> signifies the bytes of memory starting at position <code class="docutils literal"><span class="pre">a</span></code> up to
(excluding) position <code class="docutils literal"><span class="pre">b</span></code> and <code class="docutils literal"><span class="pre">storage[p]</span></code> signifies the storage contents at position <code class="docutils literal"><span class="pre">p</span></code>.</p>
<p>The opcodes <code class="docutils literal"><span class="pre">pushi</span></code> and <code class="docutils literal"><span class="pre">jumpdest</span></code> cannot be used directly.</p>
<p>In the grammar, opcodes are represented as pre-defined identifiers.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="6%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td rowspan="2">stop</td>
<td rowspan="2"><cite>-</cite></td>
<td rowspan="2">stop execution, identical to return(0,0)</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td>add(x, y)</td>
<td>&#160;</td>
<td>x + y</td>
</tr>
<tr class="row-even"><td>sub(x, y)</td>
<td>&#160;</td>
<td>x - y</td>
</tr>
<tr class="row-odd"><td>mul(x, y)</td>
<td>&#160;</td>
<td>x * y</td>
</tr>
<tr class="row-even"><td>div(x, y)</td>
<td>&#160;</td>
<td>x / y</td>
</tr>
<tr class="row-odd"><td>sdiv(x, y)</td>
<td>&#160;</td>
<td>x / y, for signed numbers in two&#8217;s complement</td>
</tr>
<tr class="row-even"><td>mod(x, y)</td>
<td>&#160;</td>
<td>x % y</td>
</tr>
<tr class="row-odd"><td>smod(x, y)</td>
<td>&#160;</td>
<td>x % y, for signed numbers in two&#8217;s complement</td>
</tr>
<tr class="row-even"><td>exp(x, y)</td>
<td>&#160;</td>
<td>x to the power of y</td>
</tr>
<tr class="row-odd"><td>not(x)</td>
<td>&#160;</td>
<td>~x, every bit of x is negated</td>
</tr>
<tr class="row-even"><td>lt(x, y)</td>
<td>&#160;</td>
<td>1 if x &lt; y, 0 otherwise</td>
</tr>
<tr class="row-odd"><td>gt(x, y)</td>
<td>&#160;</td>
<td>1 if x &gt; y, 0 otherwise</td>
</tr>
<tr class="row-even"><td>slt(x, y)</td>
<td>&#160;</td>
<td>1 if x &lt; y, 0 otherwise, for signed numbers in two&#8217;s complement</td>
</tr>
<tr class="row-odd"><td>sgt(x, y)</td>
<td>&#160;</td>
<td>1 if x &gt; y, 0 otherwise, for signed numbers in two&#8217;s complement</td>
</tr>
<tr class="row-even"><td>eq(x, y)</td>
<td>&#160;</td>
<td>1 if x == y, 0 otherwise</td>
</tr>
<tr class="row-odd"><td>iszero(x)</td>
<td>&#160;</td>
<td>1 if x == 0, 0 otherwise</td>
</tr>
<tr class="row-even"><td>and(x, y)</td>
<td>&#160;</td>
<td>bitwise and of x and y</td>
</tr>
<tr class="row-odd"><td>or(x, y)</td>
<td>&#160;</td>
<td>bitwise or of x and y</td>
</tr>
<tr class="row-even"><td>xor(x, y)</td>
<td>&#160;</td>
<td>bitwise xor of x and y</td>
</tr>
<tr class="row-odd"><td>byte(n, x)</td>
<td>&#160;</td>
<td>nth byte of x, where the most significant byte is the 0th byte</td>
</tr>
<tr class="row-even"><td>addmod(x, y, m)</td>
<td>&#160;</td>
<td>(x + y) % m with arbitrary precision arithmetics</td>
</tr>
<tr class="row-odd"><td>mulmod(x, y, m)</td>
<td>&#160;</td>
<td>(x * y) % m with arbitrary precision arithmetics</td>
</tr>
<tr class="row-even"><td>signextend(i, x)</td>
<td>&#160;</td>
<td>sign extend from (i*8+7)th bit counting from least significant</td>
</tr>
<tr class="row-odd"><td>keccak256(p, n)</td>
<td>&#160;</td>
<td>keccak(mem[p...(p+n)))</td>
</tr>
<tr class="row-even"><td>sha3(p, n)</td>
<td>&#160;</td>
<td>keccak(mem[p...(p+n)))</td>
</tr>
<tr class="row-odd"><td>jump(label)</td>
<td><cite>-</cite></td>
<td>jump to label / code position</td>
</tr>
<tr class="row-even"><td>jumpi(label, cond)</td>
<td><cite>-</cite></td>
<td>jump to label if cond is nonzero</td>
</tr>
<tr class="row-odd"><td>pc</td>
<td>&#160;</td>
<td>current position in code</td>
</tr>
<tr class="row-even"><td>pop(x)</td>
<td><cite>-</cite></td>
<td>remove the element pushed by x</td>
</tr>
<tr class="row-odd"><td>dup1 ... dup16</td>
<td>&#160;</td>
<td>copy ith stack slot to the top (counting from top)</td>
</tr>
<tr class="row-even"><td>swap1 ... swap16</td>
<td><cite>*</cite></td>
<td>swap topmost and ith stack slot below it</td>
</tr>
<tr class="row-odd"><td>mload(p)</td>
<td>&#160;</td>
<td>mem[p..(p+32))</td>
</tr>
<tr class="row-even"><td>mstore(p, v)</td>
<td><cite>-</cite></td>
<td>mem[p..(p+32)) := v</td>
</tr>
<tr class="row-odd"><td>mstore8(p, v)</td>
<td><cite>-</cite></td>
<td>mem[p] := v &amp; 0xff    - only modifies a single byte</td>
</tr>
<tr class="row-even"><td>sload(p)</td>
<td>&#160;</td>
<td>storage[p]</td>
</tr>
<tr class="row-odd"><td>sstore(p, v)</td>
<td><cite>-</cite></td>
<td>storage[p] := v</td>
</tr>
<tr class="row-even"><td>msize</td>
<td>&#160;</td>
<td>size of memory, i.e. largest accessed memory index</td>
</tr>
<tr class="row-odd"><td>gas</td>
<td>&#160;</td>
<td>gas still available to execution</td>
</tr>
<tr class="row-even"><td>address</td>
<td>&#160;</td>
<td>address of the current contract / execution context</td>
</tr>
<tr class="row-odd"><td>balance(a)</td>
<td>&#160;</td>
<td>wei balance at address a</td>
</tr>
<tr class="row-even"><td>caller</td>
<td>&#160;</td>
<td>call sender (excluding delegatecall)</td>
</tr>
<tr class="row-odd"><td>callvalue</td>
<td>&#160;</td>
<td>wei sent together with the current call</td>
</tr>
<tr class="row-even"><td>calldataload(p)</td>
<td>&#160;</td>
<td>call data starting from position p (32 bytes)</td>
</tr>
<tr class="row-odd"><td>calldatasize</td>
<td>&#160;</td>
<td>size of call data in bytes</td>
</tr>
<tr class="row-even"><td>calldatacopy(t, f, s)</td>
<td><cite>-</cite></td>
<td>copy s bytes from calldata at position f to mem at position t</td>
</tr>
<tr class="row-odd"><td>codesize</td>
<td>&#160;</td>
<td>size of the code of the current contract / execution context</td>
</tr>
<tr class="row-even"><td>codecopy(t, f, s)</td>
<td><cite>-</cite></td>
<td>copy s bytes from code at position f to mem at position t</td>
</tr>
<tr class="row-odd"><td>extcodesize(a)</td>
<td>&#160;</td>
<td>size of the code at address a</td>
</tr>
<tr class="row-even"><td>extcodecopy(a, t, f, s)</td>
<td><cite>-</cite></td>
<td>like codecopy(t, f, s) but take code at address a</td>
</tr>
<tr class="row-odd"><td>returndatasize</td>
<td>&#160;</td>
<td>size of the last returndata</td>
</tr>
<tr class="row-even"><td>returndatacopy(t, f, s)</td>
<td><cite>-</cite></td>
<td>copy s bytes from returndata at position f to mem at position t</td>
</tr>
<tr class="row-odd"><td>create(v, p, s)</td>
<td>&#160;</td>
<td>create new contract with code mem[p..(p+s)) and send v wei
and return the new address</td>
</tr>
<tr class="row-even"><td>create2(v, n, p, s)</td>
<td>&#160;</td>
<td>create new contract with code mem[p..(p+s)) at address
keccak256(&lt;address&gt; . n . keccak256(mem[p..(p+s))) and send v
wei and return the new address</td>
</tr>
<tr class="row-odd"><td>call(g, a, v, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>call contract at address a with input mem[in..(in+insize))
providing g gas and v wei and output area
mem[out..(out+outsize)) returning 0 on error (eg. out of gas)
and 1 on success</td>
</tr>
<tr class="row-even"><td>callcode(g, a, v, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>identical to <cite>call</cite> but only use the code from a and stay
in the context of the current contract otherwise</td>
</tr>
<tr class="row-odd"><td>delegatecall(g, a, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>identical to <cite>callcode</cite> but also keep <code class="docutils literal"><span class="pre">caller</span></code>
and <code class="docutils literal"><span class="pre">callvalue</span></code></td>
</tr>
<tr class="row-even"><td>staticcall(g, a, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>identical to <cite>call(g, a, 0, in, insize, out, outsize)</cite> but do
not allow state modifications</td>
</tr>
<tr class="row-odd"><td>return(p, s)</td>
<td><cite>-</cite></td>
<td>end execution, return data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>revert(p, s)</td>
<td><cite>-</cite></td>
<td>end execution, revert state changes, return data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>selfdestruct(a)</td>
<td><cite>-</cite></td>
<td>end execution, destroy current contract and send funds to a</td>
</tr>
<tr class="row-even"><td>invalid</td>
<td><cite>-</cite></td>
<td>end execution with invalid instruction</td>
</tr>
<tr class="row-odd"><td>log0(p, s)</td>
<td><cite>-</cite></td>
<td>log without topics and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>log1(p, s, t1)</td>
<td><cite>-</cite></td>
<td>log with topic t1 and data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>log2(p, s, t1, t2)</td>
<td><cite>-</cite></td>
<td>log with topics t1, t2 and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>log3(p, s, t1, t2, t3)</td>
<td><cite>-</cite></td>
<td>log with topics t1, t2, t3 and data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>log4(p, s, t1, t2, t3,
t4)</td>
<td><cite>-</cite></td>
<td>log with topics t1, t2, t3, t4 and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>origin</td>
<td>&#160;</td>
<td>transaction sender</td>
</tr>
<tr class="row-odd"><td>gasprice</td>
<td>&#160;</td>
<td>gas price of the transaction</td>
</tr>
<tr class="row-even"><td>blockhash(b)</td>
<td>&#160;</td>
<td>hash of block nr b - only for last 256 blocks excluding current</td>
</tr>
<tr class="row-odd"><td>coinbase</td>
<td>&#160;</td>
<td>current mining beneficiary</td>
</tr>
<tr class="row-even"><td>timestamp</td>
<td>&#160;</td>
<td>timestamp of the current block in seconds since the epoch</td>
</tr>
<tr class="row-odd"><td>number</td>
<td>&#160;</td>
<td>current block number</td>
</tr>
<tr class="row-even"><td>difficulty</td>
<td>&#160;</td>
<td>difficulty of the current block</td>
</tr>
<tr class="row-odd"><td>gaslimit</td>
<td>&#160;</td>
<td>block gas limit of the current block</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="literals">
<h5>Literals<a class="headerlink" href="#literals" title="Permalink to this headline">¶</a></h5>
<p>You can use integer constants by typing them in decimal or hexadecimal notation and an
appropriate <code class="docutils literal"><span class="pre">PUSHi</span></code> instruction will automatically be generated. The following creates code
to add 2 and 3 resulting in 5 and then computes the bitwise and with the string &#8220;abc&#8221;.
Strings are stored left-aligned and cannot be longer than 32 bytes.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">assembly</span> <span class="p">{</span> <span class="mi">2</span> <span class="mi">3</span> <span class="nx">add</span> <span class="s2">&quot;abc&quot;</span> <span class="nx">and</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="functional-style">
<h5>Functional Style<a class="headerlink" href="#functional-style" title="Permalink to this headline">¶</a></h5>
<p>You can type opcode after opcode in the same way they will end up in bytecode. For example
adding <code class="docutils literal"><span class="pre">3</span></code> to the contents in memory at position <code class="docutils literal"><span class="pre">0x80</span></code> would be</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="mh">0x80</span> <span class="nx">mload</span> <span class="nx">add</span> <span class="mh">0x80</span> <span class="nx">mstore</span>
</pre></div>
</div>
<p>As it is often hard to see what the actual arguments for certain opcodes are,
Solidity inline assembly also provides a &#8220;functional style&#8221; notation where the same code
would be written as follows</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">mstore</span><span class="p">(</span><span class="mh">0x80</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">mload</span><span class="p">(</span><span class="mh">0x80</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>Functional style expressions cannot use instructional style internally, i.e.
<code class="docutils literal"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">mstore(0x80,</span> <span class="pre">add)</span></code> is not valid assembly, it has to be written as
<code class="docutils literal"><span class="pre">mstore(0x80,</span> <span class="pre">add(2,</span> <span class="pre">1))</span></code>. For opcodes that do not take arguments, the
parentheses can be omitted.</p>
<p>Note that the order of arguments is reversed in functional-style as opposed to the instruction-style
way. If you use functional-style, the first argument will end up on the stack top.</p>
</div>
<div class="section" id="access-to-external-variables-and-functions">
<h5>Access to External Variables and Functions<a class="headerlink" href="#access-to-external-variables-and-functions" title="Permalink to this headline">¶</a></h5>
<p>Solidity variables and other identifiers can be accessed by simply using their name.
For memory variables, this will push the address and not the value onto the
stack. Storage variables are different: Values in storage might not occupy a
full storage slot, so their &#8220;address&#8221; is composed of a slot and a byte-offset
inside that slot. To retrieve the slot pointed to by the variable <code class="docutils literal"><span class="pre">x</span></code>, you
used <code class="docutils literal"><span class="pre">x_slot</span></code> and to retrieve the byte-offset you used <code class="docutils literal"><span class="pre">x_offset</span></code>.</p>
<p>In assignments (see below), we can even use local Solidity variables to assign to.</p>
<p>Functions external to inline assembly can also be accessed: The assembly will
push their entry label (with virtual function resolution applied). The calling semantics
in solidity are:</p>
<blockquote>
<div><ul class="simple">
<li>the caller pushes return label, arg1, arg2, ..., argn</li>
<li>the call returns with ret1, ret2, ..., retm</li>
</ul>
</div></blockquote>
<p>This feature is still a bit cumbersome to use, because the stack offset essentially
changes during the call, and thus references to local variables will be wrong.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">b</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="nx">r</span> <span class="o">:=</span> <span class="nx">mul</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">sload</span><span class="p">(</span><span class="nx">b_slot</span><span class="p">))</span> <span class="c1">// ignore the offset, we know it is zero</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="labels">
<h5>Labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h5>
<p>Another problem in EVM assembly is that <code class="docutils literal"><span class="pre">jump</span></code> and <code class="docutils literal"><span class="pre">jumpi</span></code> use absolute addresses
which can change easily. Solidity inline assembly provides labels to make the use of
jumps easier. Note that labels are a low-level feature and it is possible to write
efficient assembly without labels, just using assembly functions, loops and switch instructions
(see below). The following code computes an element in the Fibonacci series.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">n</span> <span class="o">:=</span> <span class="nx">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="kr">let</span> <span class="nx">a</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="kr">let</span> <span class="nx">b</span> <span class="o">:=</span> <span class="nx">a</span>
<span class="nx">loop</span><span class="o">:</span>
    <span class="nx">jumpi</span><span class="p">(</span><span class="nx">loopend</span><span class="p">,</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nx">a</span> <span class="nx">add</span> <span class="nx">swap1</span>
    <span class="nx">n</span> <span class="o">:=</span> <span class="nx">sub</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">loop</span><span class="p">)</span>
<span class="nx">loopend</span><span class="o">:</span>
    <span class="nx">mstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Please note that automatically accessing stack variables can only work if the
assembler knows the current stack height. This fails to work if the jump source
and target have different stack heights. It is still fine to use such jumps, but
you should just not access any stack variables (even assembly variables) in that case.</p>
<p>Furthermore, the stack height analyser goes through the code opcode by opcode
(and not according to control flow), so in the following case, the assembler
will have a wrong impression about the stack height at label <code class="docutils literal"><span class="pre">two</span></code>:</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">8</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">two</span><span class="p">)</span>
    <span class="nx">one</span><span class="o">:</span>
        <span class="c1">// Here the stack height is 2 (because we pushed x and 7),</span>
        <span class="c1">// but the assembler thinks it is 1 because it reads</span>
        <span class="c1">// from top to bottom.</span>
        <span class="c1">// Accessing the stack variable x here will lead to errors.</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="mi">9</span>
        <span class="nx">jump</span><span class="p">(</span><span class="nx">three</span><span class="p">)</span>
    <span class="nx">two</span><span class="o">:</span>
        <span class="mi">7</span> <span class="c1">// push something onto the stack</span>
        <span class="nx">jump</span><span class="p">(</span><span class="nx">one</span><span class="p">)</span>
    <span class="nx">three</span><span class="o">:</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This problem can be fixed by manually adjusting the stack height for the
assembler - you can provide a stack height delta that is added
to the stack height just prior to the label.
Note that you will not have to care about these things if you just use
loops and assembly-level functions.</p>
<p>As an example how this can be done in extreme cases, please see the following.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">8</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">two</span><span class="p">)</span>
    <span class="mi">0</span> <span class="c1">// This code is unreachable but will adjust the stack height correctly</span>
    <span class="nx">one</span><span class="o">:</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="mi">9</span> <span class="c1">// Now x can be accessed properly.</span>
        <span class="nx">jump</span><span class="p">(</span><span class="nx">three</span><span class="p">)</span>
        <span class="nx">pop</span> <span class="c1">// Similar negative correction.</span>
    <span class="nx">two</span><span class="o">:</span>
        <span class="mi">7</span> <span class="c1">// push something onto the stack</span>
        <span class="nx">jump</span><span class="p">(</span><span class="nx">one</span><span class="p">)</span>
    <span class="nx">three</span><span class="o">:</span>
    <span class="nx">pop</span> <span class="c1">// We have to pop the manually pushed value here again.</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="declaring-assembly-local-variables">
<h5>Declaring Assembly-Local Variables<a class="headerlink" href="#declaring-assembly-local-variables" title="Permalink to this headline">¶</a></h5>
<p>You can use the <code class="docutils literal"><span class="pre">let</span></code> keyword to declare variables that are only visible in
inline assembly and actually only in the current <code class="docutils literal"><span class="pre">{...}</span></code>-block. What happens
is that the <code class="docutils literal"><span class="pre">let</span></code> instruction will create a new stack slot that is reserved
for the variable and automatically removed again when the end of the block
is reached. You need to provide an initial value for the variable which can
be just <code class="docutils literal"><span class="pre">0</span></code>, but it can also be a complex functional-style expression.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="kr">let</span> <span class="nx">v</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x80</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kr">let</span> <span class="nx">y</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">sload</span><span class="p">(</span><span class="nx">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="nx">b</span> <span class="o">:=</span> <span class="nx">y</span>
            <span class="p">}</span> <span class="c1">// y is &quot;deallocated&quot; here</span>
            <span class="nx">b</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
        <span class="p">}</span> <span class="c1">// v is &quot;deallocated&quot; here</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="assignments">
<h5>Assignments<a class="headerlink" href="#assignments" title="Permalink to this headline">¶</a></h5>
<p>Assignments are possible to assembly-local variables and to function-local
variables. Take care that when you assign to variables that point to
memory or storage, you will only change the pointer and not the data.</p>
<p>There are two kinds of assignments: functional-style and instruction-style.
For functional-style assignments (<code class="docutils literal"><span class="pre">variable</span> <span class="pre">:=</span> <span class="pre">value</span></code>), you need to provide a value in a
functional-style expression that results in exactly one stack value
and for instruction-style (<code class="docutils literal"><span class="pre">=:</span> <span class="pre">variable</span></code>), the value is just taken from the stack top.
For both ways, the colon points to the name of the variable. The assignment
is performed by replacing the variable&#8217;s value on the stack by the new value.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">v</span> <span class="o">:=</span> <span class="mi">0</span> <span class="c1">// functional-style assignment as part of variable declaration</span>
    <span class="kr">let</span> <span class="nx">g</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nx">sload</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">=:</span> <span class="nx">v</span> <span class="c1">// instruction style assignment, puts the result of sload(10) into v</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="switch">
<h5>Switch<a class="headerlink" href="#switch" title="Permalink to this headline">¶</a></h5>
<p>You can use a switch statement as a very basic version of &#8220;if/else&#8221;.
It takes the value of an expression and compares it to several constants.
The branch corresponding to the matching constant is taken. Contrary to the
error-prone behaviour of some programming languages, control flow does
not continue from one case to the next. There can be a fallback or default
case called <code class="docutils literal"><span class="pre">default</span></code>.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="kr">switch</span> <span class="nx">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="kr">case</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nx">calldataload</span><span class="p">(</span><span class="mh">0x24</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kr">default</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nx">calldataload</span><span class="p">(</span><span class="mh">0x44</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">sstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">div</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The list of cases does not require curly braces, but the body of a
case does require them.</p>
</div>
<div class="section" id="loops">
<h5>Loops<a class="headerlink" href="#loops" title="Permalink to this headline">¶</a></h5>
<p>Assembly supports a simple for-style loop. For-style loops have
a header containing an initializing part, a condition and a post-iteration
part. The condition has to be a functional-style expression, while
the other two are blocks. If the initializing part
declares any variables, the scope of these variables is extended into the
body (including the condition and the post-iteration part).</p>
<p>The following example computes the sum of an area in memory.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">{</span> <span class="kr">let</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">}</span> <span class="nx">lt</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">}</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For loops can also be written so that they behave like while loops:
Simply leave the initialization and post-iteration parts empty.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="kr">let</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">{</span> <span class="p">}</span> <span class="nx">lt</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="p">{</span>     <span class="c1">// while(i &lt; 0x100)</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="functions">
<h5>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h5>
<p>Assembly allows the definition of low-level functions. These take their
arguments (and a return PC) from the stack and also put the results onto the
stack. Calling a function looks the same way as executing a functional-style
opcode.</p>
<p>Functions can be defined anywhere and are visible in the block they are
declared in. Inside a function, you cannot access local variables
defined outside of that function. There is no explicit <code class="docutils literal"><span class="pre">return</span></code>
statement.</p>
<p>If you call a function that returns multiple values, you have to assign
them to a tuple using <code class="docutils literal"><span class="pre">a,</span> <span class="pre">b</span> <span class="pre">:=</span> <span class="pre">f(x)</span></code> or <code class="docutils literal"><span class="pre">let</span> <span class="pre">a,</span> <span class="pre">b</span> <span class="pre">:=</span> <span class="pre">f(x)</span></code>.</p>
<p>The following example implements the power function by square-and-multiply.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kd">function</span> <span class="nx">power</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">exponent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">result</span> <span class="p">{</span>
        <span class="kr">switch</span> <span class="nx">exponent</span>
        <span class="kr">case</span> <span class="mi">0</span> <span class="p">{</span> <span class="nx">result</span> <span class="o">:=</span> <span class="mi">1</span> <span class="p">}</span>
        <span class="kr">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="nx">result</span> <span class="o">:=</span> <span class="nx">base</span> <span class="p">}</span>
        <span class="kr">default</span> <span class="p">{</span>
            <span class="nx">result</span> <span class="o">:=</span> <span class="nx">power</span><span class="p">(</span><span class="nx">mul</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">base</span><span class="p">),</span> <span class="nx">div</span><span class="p">(</span><span class="nx">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="kr">switch</span> <span class="nx">mod</span><span class="p">(</span><span class="nx">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="kr">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="nx">result</span> <span class="o">:=</span> <span class="nx">mul</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="things-to-avoid">
<h5>Things to Avoid<a class="headerlink" href="#things-to-avoid" title="Permalink to this headline">¶</a></h5>
<p>Inline assembly might have a quite high-level look, but it actually is extremely
low-level. Function calls, loops and switches are converted by simple
rewriting rules and after that, the only thing the assembler does for you is re-arranging
functional-style opcodes, managing jump labels, counting stack height for
variable access and removing stack slots for assembly-local variables when the end
of their block is reached. Especially for those two last cases, it is important
to know that the assembler only counts stack height from top to bottom, not
necessarily following control flow. Furthermore, operations like swap will only
swap the contents of the stack but not the location of variables.</p>
</div>
<div class="section" id="conventions-in-solidity">
<h5>Conventions in Solidity<a class="headerlink" href="#conventions-in-solidity" title="Permalink to this headline">¶</a></h5>
<p>In contrast to EVM assembly, Solidity knows types which are narrower than 256 bits,
e.g. <code class="docutils literal"><span class="pre">uint24</span></code>. In order to make them more efficient, most arithmetic operations just
treat them as 256-bit numbers and the higher-order bits are only cleaned at the
point where it is necessary, i.e. just shortly before they are written to memory
or before comparisons are performed. This means that if you access such a variable
from within inline assembly, you might have to manually clean the higher order bits
first.</p>
<p>Solidity manages memory in a very simple way: There is a &#8220;free memory pointer&#8221;
at position <code class="docutils literal"><span class="pre">0x40</span></code> in memory. If you want to allocate memory, just use the memory
from that point on and update the pointer accordingly.</p>
<p>Elements in memory arrays in Solidity always occupy multiples of 32 bytes (yes, this is
even true for <code class="docutils literal"><span class="pre">byte[]</span></code>, but not for <code class="docutils literal"><span class="pre">bytes</span></code> and <code class="docutils literal"><span class="pre">string</span></code>). Multi-dimensional memory
arrays are pointers to memory arrays. The length of a dynamic array is stored at the
first slot of the array and then only the array elements follow.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Statically-sized memory arrays do not have a length field, but it will be added soon
to allow better convertibility between statically- and dynamically-sized arrays, so
please do not rely on that.</p>
</div>
</div>
</div>
<div class="section" id="standalone-assembly">
<h4>Standalone Assembly<a class="headerlink" href="#standalone-assembly" title="Permalink to this headline">¶</a></h4>
<p>The assembly language described as inline assembly above can also be used
standalone and in fact, the plan is to use it as an intermediate language
for the Solidity compiler. In this form, it tries to achieve several goals:</p>
<ol class="arabic simple">
<li>Programs written in it should be readable, even if the code is generated by a compiler from Solidity.</li>
<li>The translation from assembly to bytecode should contain as few &#8220;surprises&#8221; as possible.</li>
<li>Control flow should be easy to detect to help in formal verification and optimization.</li>
</ol>
<p>In order to achieve the first and last goal, assembly provides high-level constructs
like <code class="docutils literal"><span class="pre">for</span></code> loops, <code class="docutils literal"><span class="pre">switch</span></code> statements and function calls. It should be possible
to write assembly programs that do not make use of explicit <code class="docutils literal"><span class="pre">SWAP</span></code>, <code class="docutils literal"><span class="pre">DUP</span></code>,
<code class="docutils literal"><span class="pre">JUMP</span></code> and <code class="docutils literal"><span class="pre">JUMPI</span></code> statements, because the first two obfuscate the data flow
and the last two obfuscate control flow. Furthermore, functional statements of
the form <code class="docutils literal"><span class="pre">mul(add(x,</span> <span class="pre">y),</span> <span class="pre">7)</span></code> are preferred over pure opcode statements like
<code class="docutils literal"><span class="pre">7</span> <span class="pre">y</span> <span class="pre">x</span> <span class="pre">add</span> <span class="pre">mul</span></code> because in the first form, it is much easier to see which
operand is used for which opcode.</p>
<p>The second goal is achieved by introducing a desugaring phase that only removes
the higher level constructs in a very regular way and still allows inspecting
the generated low-level assembly code. The only non-local operation performed
by the assembler is name lookup of user-defined identifiers (functions, variables, ...),
which follow very simple and regular scoping rules and cleanup of local variables from the stack.</p>
<p>Scoping: An identifier that is declared (label, variable, function, assembly)
is only visible in the block where it was declared (including nested blocks
inside the current block). It is not legal to access local variables across
function borders, even if they would be in scope. Shadowing is not allowed.
Local variables cannot be accessed before they were declared, but labels,
functions and assemblies can. Assemblies are special blocks that are used
for e.g. returning runtime code or creating contracts. No identifier from an
outer assembly is visible in a sub-assembly.</p>
<p>If control flow passes over the end of a block, pop instructions are inserted
that match the number of local variables declared in that block.
Whenever a local variable is referenced, the code generator needs
to know its current relative position in the stack and thus it needs to
keep track of the current so-called stack height. Since all local variables
are removed at the end of a block, the stack height before and after the block
should be the same. If this is not the case, a warning is issued.</p>
<p>Why do we use higher-level constructs like <code class="docutils literal"><span class="pre">switch</span></code>, <code class="docutils literal"><span class="pre">for</span></code> and functions:</p>
<p>Using <code class="docutils literal"><span class="pre">switch</span></code>, <code class="docutils literal"><span class="pre">for</span></code> and functions, it should be possible to write
complex code without using <code class="docutils literal"><span class="pre">jump</span></code> or <code class="docutils literal"><span class="pre">jumpi</span></code> manually. This makes it much
easier to analyze the control flow, which allows for improved formal
verification and optimization.</p>
<p>Furthermore, if manual jumps are allowed, computing the stack height is rather complicated.
The position of all local variables on the stack needs to be known, otherwise
neither references to local variables nor removing local variables automatically
from the stack at the end of a block will work properly. The desugaring
mechanism correctly inserts operations at unreachable blocks that adjust the
stack height properly in case of jumps that do not have a continuing control flow.</p>
<p>Example:</p>
<p>We will follow an example compilation from Solidity to desugared assembly.
We consider the runtime bytecode of the following Solidity program:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">y</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following assembly will be generated:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">)</span> <span class="c1">// store the &quot;free memory pointer&quot;</span>
  <span class="c1">// function dispatcher</span>
  <span class="kr">switch</span> <span class="nx">div</span><span class="p">(</span><span class="nx">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">exp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">226</span><span class="p">))</span>
  <span class="kr">case</span> <span class="mh">0xb3de648b</span> <span class="p">{</span>
    <span class="kr">let</span> <span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="o">=</span> <span class="nx">f</span><span class="p">(</span><span class="nx">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="kr">let</span> <span class="nx">ret</span> <span class="o">:=</span> <span class="nx">$allocate</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span>
    <span class="nx">mstore</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="kr">default</span> <span class="p">{</span> <span class="nb">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
  <span class="c1">// memory allocator</span>
  <span class="kd">function</span> <span class="nx">$allocate</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">pos</span> <span class="p">{</span>
    <span class="nx">pos</span> <span class="o">:=</span> <span class="nx">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
    <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">size</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="c1">// the contract function</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">y</span> <span class="p">{</span>
    <span class="nx">y</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="p">{</span> <span class="kr">let</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">}</span> <span class="nx">lt</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span> <span class="p">{</span>
      <span class="nx">y</span> <span class="o">:=</span> <span class="nx">mul</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After the desugaring phase it looks as follows:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kr">let</span> <span class="nx">$0</span> <span class="o">:=</span> <span class="nx">div</span><span class="p">(</span><span class="nx">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">exp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">226</span><span class="p">))</span>
    <span class="nx">jumpi</span><span class="p">(</span><span class="nx">$case1</span><span class="p">,</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">$0</span><span class="p">,</span> <span class="mh">0xb3de648b</span><span class="p">))</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">$caseDefault</span><span class="p">)</span>
    <span class="nx">$case1</span><span class="o">:</span>
    <span class="p">{</span>
      <span class="c1">// the function call - we put return label and arguments on the stack</span>
      <span class="nx">$ret1</span> <span class="nx">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="nx">jump</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
      <span class="c1">// This is unreachable code. Opcodes are added that mirror the</span>
      <span class="c1">// effect of the function on the stack height: Arguments are</span>
      <span class="c1">// removed and return values are introduced.</span>
      <span class="nx">pop</span> <span class="nx">pop</span>
      <span class="kr">let</span> <span class="nx">r</span> <span class="o">:=</span> <span class="mi">0</span>
      <span class="nx">$ret1</span><span class="o">:</span> <span class="c1">// the actual return point</span>
      <span class="nx">$ret2</span> <span class="mh">0x20</span> <span class="nx">jump</span><span class="p">(</span><span class="nx">$allocate</span><span class="p">)</span>
      <span class="nx">pop</span> <span class="nx">pop</span> <span class="kr">let</span> <span class="nx">ret</span> <span class="o">:=</span> <span class="mi">0</span>
      <span class="nx">$ret2</span><span class="o">:</span>
      <span class="nx">mstore</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
      <span class="k">return</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
      <span class="c1">// although it is useless, the jump is automatically inserted,</span>
      <span class="c1">// since the desugaring process is a purely syntactic operation that</span>
      <span class="c1">// does not analyze control-flow</span>
      <span class="nx">jump</span><span class="p">(</span><span class="nx">$endswitch</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">$caseDefault</span><span class="o">:</span>
    <span class="p">{</span>
      <span class="nb">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">jump</span><span class="p">(</span><span class="nx">$endswitch</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">$endswitch</span><span class="o">:</span>
  <span class="p">}</span>
  <span class="nx">jump</span><span class="p">(</span><span class="nx">$afterFunction</span><span class="p">)</span>
  <span class="nx">allocate</span><span class="o">:</span>
  <span class="p">{</span>
    <span class="c1">// we jump over the unreachable code that introduces the function arguments</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">$start</span><span class="p">)</span>
    <span class="kr">let</span> <span class="nx">$retpos</span> <span class="o">:=</span> <span class="mi">0</span> <span class="kr">let</span> <span class="nx">size</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="nx">$start</span><span class="o">:</span>
    <span class="c1">// output variables live in the same scope as the arguments and is</span>
    <span class="c1">// actually allocated.</span>
    <span class="kr">let</span> <span class="nx">pos</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">{</span>
      <span class="nx">pos</span> <span class="o">:=</span> <span class="nx">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
      <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">size</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="c1">// This code replaces the arguments by the return values and jumps back.</span>
    <span class="nx">swap1</span> <span class="nx">pop</span> <span class="nx">swap1</span> <span class="nx">jump</span>
    <span class="c1">// Again unreachable code that corrects stack height.</span>
    <span class="mi">0</span> <span class="mi">0</span>
  <span class="p">}</span>
  <span class="nx">f</span><span class="o">:</span>
  <span class="p">{</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">$start</span><span class="p">)</span>
    <span class="kr">let</span> <span class="nx">$retpos</span> <span class="o">:=</span> <span class="mi">0</span> <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="nx">$start</span><span class="o">:</span>
    <span class="kr">let</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">{</span>
      <span class="kr">let</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span>
      <span class="nx">$for_begin</span><span class="o">:</span>
      <span class="nx">jumpi</span><span class="p">(</span><span class="nx">$for_end</span><span class="p">,</span> <span class="nx">iszero</span><span class="p">(</span><span class="nx">lt</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">x</span><span class="p">)))</span>
      <span class="p">{</span>
        <span class="nx">y</span> <span class="o">:=</span> <span class="nx">mul</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="nx">$for_continue</span><span class="o">:</span>
      <span class="p">{</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
      <span class="nx">jump</span><span class="p">(</span><span class="nx">$for_begin</span><span class="p">)</span>
      <span class="nx">$for_end</span><span class="o">:</span>
    <span class="p">}</span> <span class="c1">// Here, a pop instruction will be inserted for i</span>
    <span class="nx">swap1</span> <span class="nx">pop</span> <span class="nx">swap1</span> <span class="nx">jump</span>
    <span class="mi">0</span> <span class="mi">0</span>
  <span class="p">}</span>
  <span class="nx">$afterFunction</span><span class="o">:</span>
  <span class="nx">stop</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Assembly happens in four stages:</p>
<ol class="arabic simple">
<li>Parsing</li>
<li>Desugaring (removes switch, for and functions)</li>
<li>Opcode stream generation</li>
<li>Bytecode generation</li>
</ol>
<p>We will specify steps one to three in a pseudo-formal way. More formal
specifications will follow.</p>
<div class="section" id="parsing-grammar">
<h5>Parsing / Grammar<a class="headerlink" href="#parsing-grammar" title="Permalink to this headline">¶</a></h5>
<p>The tasks of the parser are the following:</p>
<ul class="simple">
<li>Turn the byte stream into a token stream, discarding C++-style comments
(a special comment exists for source references, but we will not explain it here).</li>
<li>Turn the token stream into an AST according to the grammar below</li>
<li>Register identifiers with the block they are defined in (annotation to the
AST node) and note from which point on, variables can be accessed.</li>
</ul>
<p>The assembly lexer follows the one defined by Solidity itself.</p>
<p>Whitespace is used to delimit tokens and it consists of the characters
Space, Tab and Linefeed. Comments are regular JavaScript/C++ comments and
are interpreted in the same way as Whitespace.</p>
<p>Grammar:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">AssemblyBlock</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="nx">AssemblyItem</span><span class="o">*</span> <span class="s1">&#39;}&#39;</span>
<span class="nx">AssemblyItem</span> <span class="o">=</span>
    <span class="nx">Identifier</span> <span class="o">|</span>
    <span class="nx">AssemblyBlock</span> <span class="o">|</span>
    <span class="nx">FunctionalAssemblyExpression</span> <span class="o">|</span>
    <span class="nx">AssemblyLocalDefinition</span> <span class="o">|</span>
    <span class="nx">FunctionalAssemblyAssignment</span> <span class="o">|</span>
    <span class="nx">AssemblyAssignment</span> <span class="o">|</span>
    <span class="nx">LabelDefinition</span> <span class="o">|</span>
    <span class="nx">AssemblySwitch</span> <span class="o">|</span>
    <span class="nx">AssemblyFunctionDefinition</span> <span class="o">|</span>
    <span class="nx">AssemblyFor</span> <span class="o">|</span>
    <span class="s1">&#39;break&#39;</span> <span class="o">|</span> <span class="s1">&#39;continue&#39;</span> <span class="o">|</span>
    <span class="nx">SubAssembly</span> <span class="o">|</span> <span class="s1">&#39;dataSize&#39;</span> <span class="s1">&#39;(&#39;</span> <span class="nx">Identifier</span> <span class="s1">&#39;)&#39;</span> <span class="o">|</span>
    <span class="nx">LinkerSymbol</span> <span class="o">|</span>
    <span class="s1">&#39;errorLabel&#39;</span> <span class="o">|</span> <span class="s1">&#39;bytecodeSize&#39;</span> <span class="o">|</span>
    <span class="nx">NumberLiteral</span> <span class="o">|</span> <span class="nx">StringLiteral</span> <span class="o">|</span> <span class="nx">HexLiteral</span>
<span class="nx">Identifier</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="o">-</span><span class="nx">zA</span><span class="o">-</span><span class="nx">Z_$</span><span class="p">]</span> <span class="p">[</span><span class="nx">a</span><span class="o">-</span><span class="nx">zA</span><span class="o">-</span><span class="nx">Z_0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span>
<span class="nx">FunctionalAssemblyExpression</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="s1">&#39;(&#39;</span> <span class="p">(</span> <span class="nx">AssemblyItem</span> <span class="p">(</span> <span class="s1">&#39;,&#39;</span> <span class="nx">AssemblyItem</span> <span class="p">)</span><span class="o">*</span> <span class="p">)</span><span class="o">?</span> <span class="s1">&#39;)&#39;</span>
<span class="nx">AssemblyLocalDefinition</span> <span class="o">=</span> <span class="s1">&#39;let&#39;</span> <span class="nx">IdentifierOrList</span> <span class="s1">&#39;:=&#39;</span> <span class="nx">FunctionalAssemblyExpression</span>
<span class="nx">FunctionalAssemblyAssignment</span> <span class="o">=</span> <span class="nx">IdentifierOrList</span> <span class="s1">&#39;:=&#39;</span> <span class="nx">FunctionalAssemblyExpression</span>
<span class="nx">IdentifierOrList</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="o">|</span> <span class="s1">&#39;(&#39;</span> <span class="nx">IdentifierList</span> <span class="s1">&#39;)&#39;</span>
<span class="nx">IdentifierList</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="p">(</span> <span class="s1">&#39;,&#39;</span> <span class="nx">Identifier</span><span class="p">)</span><span class="o">*</span>
<span class="nx">AssemblyAssignment</span> <span class="o">=</span> <span class="s1">&#39;=:&#39;</span> <span class="nx">Identifier</span>
<span class="nx">LabelDefinition</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="s1">&#39;:&#39;</span>
<span class="nx">AssemblySwitch</span> <span class="o">=</span> <span class="s1">&#39;switch&#39;</span> <span class="nx">FunctionalAssemblyExpression</span> <span class="nx">AssemblyCase</span><span class="o">*</span>
    <span class="p">(</span> <span class="s1">&#39;default&#39;</span> <span class="nx">AssemblyBlock</span> <span class="p">)</span><span class="o">?</span>
<span class="nx">AssemblyCase</span> <span class="o">=</span> <span class="s1">&#39;case&#39;</span> <span class="nx">FunctionalAssemblyExpression</span> <span class="nx">AssemblyBlock</span>
<span class="nx">AssemblyFunctionDefinition</span> <span class="o">=</span> <span class="s1">&#39;function&#39;</span> <span class="nx">Identifier</span> <span class="s1">&#39;(&#39;</span> <span class="nx">IdentifierList</span><span class="o">?</span> <span class="s1">&#39;)&#39;</span>
    <span class="p">(</span> <span class="s1">&#39;-&gt;&#39;</span> <span class="s1">&#39;(&#39;</span> <span class="nx">IdentifierList</span> <span class="s1">&#39;)&#39;</span> <span class="p">)</span><span class="o">?</span> <span class="nx">AssemblyBlock</span>
<span class="nx">AssemblyFor</span> <span class="o">=</span> <span class="s1">&#39;for&#39;</span> <span class="p">(</span> <span class="nx">AssemblyBlock</span> <span class="o">|</span> <span class="nx">FunctionalAssemblyExpression</span><span class="p">)</span>
    <span class="nx">FunctionalAssemblyExpression</span> <span class="p">(</span> <span class="nx">AssemblyBlock</span> <span class="o">|</span> <span class="nx">FunctionalAssemblyExpression</span><span class="p">)</span> <span class="nx">AssemblyBlock</span>
<span class="nx">SubAssembly</span> <span class="o">=</span> <span class="s1">&#39;assembly&#39;</span> <span class="nx">Identifier</span> <span class="nx">AssemblyBlock</span>
<span class="nx">LinkerSymbol</span> <span class="o">=</span> <span class="s1">&#39;linkerSymbol&#39;</span> <span class="s1">&#39;(&#39;</span> <span class="nx">StringLiteral</span> <span class="s1">&#39;)&#39;</span>
<span class="nx">NumberLiteral</span> <span class="o">=</span> <span class="nx">HexNumber</span> <span class="o">|</span> <span class="nx">DecimalNumber</span>
<span class="nx">HexLiteral</span> <span class="o">=</span> <span class="s1">&#39;hex&#39;</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">|</span> <span class="s1">&#39;\&#39;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">)</span>
<span class="nx">StringLiteral</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="p">([</span><span class="o">^</span><span class="s2">&quot;\r\n\\] | &#39;\\&#39; .)* &#39;&quot;</span><span class="s1">&#39;</span>
<span class="s1">HexNumber = &#39;</span><span class="mi">0</span><span class="nx">x</span><span class="err">&#39;</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]</span><span class="o">+</span>
<span class="nx">DecimalNumber</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span>
</pre></div>
</div>
</div>
<div class="section" id="desugaring">
<h5>Desugaring<a class="headerlink" href="#desugaring" title="Permalink to this headline">¶</a></h5>
<p>An AST transformation removes for, switch and function constructs. The result
is still parseable by the same parser, but it will not use certain constructs.
If jumpdests are added that are only jumped to and not continued at, information
about the stack content is added, unless no local variables of outer scopes are
accessed or the stack height is the same as for the previous instruction.</p>
<p>Pseudocode:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">desugar</span> <span class="nx">item</span><span class="o">:</span> <span class="nx">AST</span> <span class="o">-&gt;</span> <span class="nx">AST</span> <span class="o">=</span>
<span class="kr">match</span> <span class="nx">item</span> <span class="p">{</span>
<span class="nx">AssemblyFunctionDefinition</span><span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="nx">name</span> <span class="s1">&#39;(&#39;</span> <span class="nx">arg1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">argn</span> <span class="s1">&#39;)&#39;</span> <span class="s1">&#39;-&gt;&#39;</span> <span class="p">(</span> <span class="s1">&#39;(&#39;</span> <span class="nx">ret1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">retm</span> <span class="s1">&#39;)&#39;</span> <span class="nx">body</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;:</span>
  <span class="p">{</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">$</span><span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;</span><span class="nx">_start</span><span class="p">)</span>
    <span class="kr">let</span> <span class="nx">$retPC</span> <span class="o">:=</span> <span class="mi">0</span> <span class="kr">let</span> <span class="nx">argn</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">...</span> <span class="kr">let</span> <span class="nx">arg1</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="nx">$</span><span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;</span><span class="nx">_start</span><span class="o">:</span>
    <span class="kr">let</span> <span class="nx">ret1</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">...</span> <span class="kr">let</span> <span class="nx">retm</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">{</span> <span class="nx">desugar</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="p">}</span>
    <span class="nx">swap</span> <span class="nx">and</span> <span class="nx">pop</span> <span class="nx">items</span> <span class="nx">so</span> <span class="nx">that</span> <span class="nx">only</span> <span class="nx">ret1</span><span class="p">,</span> <span class="p">...</span> <span class="nx">retm</span><span class="p">,</span> <span class="nx">$retPC</span> <span class="nx">are</span> <span class="nx">left</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">stack</span>
    <span class="nx">jump</span>
    <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nx">n</span> <span class="nx">times</span><span class="p">)</span> <span class="nx">to</span> <span class="nx">compensate</span> <span class="nx">removal</span> <span class="kr">of</span> <span class="nx">arg1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">argn</span> <span class="nx">and</span> <span class="nx">$retPC</span>
  <span class="p">}</span>
<span class="nx">AssemblyFor</span><span class="p">(</span><span class="s1">&#39;for&#39;</span> <span class="p">{</span> <span class="nx">init</span> <span class="p">}</span> <span class="nx">condition</span> <span class="nx">post</span> <span class="nx">body</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">{</span>
    <span class="nx">init</span> <span class="c1">// cannot be its own block because we want variable scope to extend into the body</span>
    <span class="c1">// find I such that there are no labels $forI_*</span>
    <span class="nx">$forI_begin</span><span class="o">:</span>
    <span class="nx">jumpi</span><span class="p">(</span><span class="nx">$forI_end</span><span class="p">,</span> <span class="nx">iszero</span><span class="p">(</span><span class="nx">condition</span><span class="p">))</span>
    <span class="p">{</span> <span class="nx">body</span> <span class="p">}</span>
    <span class="nx">$forI_continue</span><span class="o">:</span>
    <span class="p">{</span> <span class="nx">post</span> <span class="p">}</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">$forI_begin</span><span class="p">)</span>
    <span class="nx">$forI_end</span><span class="o">:</span>
  <span class="p">}</span>
<span class="s1">&#39;break&#39;</span> <span class="o">-&gt;</span>
  <span class="p">{</span>
    <span class="c1">// find nearest enclosing scope with label $forI_end</span>
    <span class="nx">pop</span> <span class="nx">all</span> <span class="nx">local</span> <span class="nx">variables</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">defined</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">point</span>
    <span class="nx">but</span> <span class="nx">not</span> <span class="nx">at</span> <span class="nx">$forI_end</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">$forI_end</span><span class="p">)</span>
    <span class="mi">0</span> <span class="p">(</span><span class="k">as</span> <span class="nx">many</span> <span class="k">as</span> <span class="nx">variables</span> <span class="nx">were</span> <span class="nx">removed</span> <span class="nx">above</span><span class="p">)</span>
  <span class="p">}</span>
<span class="s1">&#39;continue&#39;</span> <span class="o">-&gt;</span>
  <span class="p">{</span>
    <span class="c1">// find nearest enclosing scope with label $forI_continue</span>
    <span class="nx">pop</span> <span class="nx">all</span> <span class="nx">local</span> <span class="nx">variables</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">defined</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">point</span>
    <span class="nx">but</span> <span class="nx">not</span> <span class="nx">at</span> <span class="nx">$forI_continue</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">$forI_continue</span><span class="p">)</span>
    <span class="mi">0</span> <span class="p">(</span><span class="k">as</span> <span class="nx">many</span> <span class="k">as</span> <span class="nx">variables</span> <span class="nx">were</span> <span class="nx">removed</span> <span class="nx">above</span><span class="p">)</span>
  <span class="p">}</span>
<span class="nx">AssemblySwitch</span><span class="p">(</span><span class="kr">switch</span> <span class="nx">condition</span> <span class="nx">cases</span> <span class="p">(</span> <span class="kr">default</span><span class="o">:</span> <span class="nx">defaultBlock</span> <span class="p">)</span><span class="o">?</span> <span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">{</span>
    <span class="c1">// find I such that there is no $switchI* label or variable</span>
    <span class="kr">let</span> <span class="nx">$switchI_value</span> <span class="o">:=</span> <span class="nx">condition</span>
    <span class="k">for</span> <span class="nx">each</span> <span class="kr">of</span> <span class="nx">cases</span> <span class="kr">match</span> <span class="p">{</span>
      <span class="kr">case</span> <span class="nx">val</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="nx">jumpi</span><span class="p">(</span><span class="nx">$switchI_caseJ</span><span class="p">,</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">$switchI_value</span><span class="p">,</span> <span class="nx">val</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="kr">default</span> <span class="nb">block</span> <span class="nx">present</span><span class="o">:</span> <span class="o">-&gt;</span>
      <span class="p">{</span> <span class="nx">defaultBlock</span> <span class="nx">jump</span><span class="p">(</span><span class="nx">$switchI_end</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">for</span> <span class="nx">each</span> <span class="kr">of</span> <span class="nx">cases</span> <span class="kr">match</span> <span class="p">{</span>
      <span class="kr">case</span> <span class="nx">val</span><span class="o">:</span> <span class="p">{</span> <span class="nx">body</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="nx">$switchI_caseJ</span><span class="o">:</span> <span class="p">{</span> <span class="nx">body</span> <span class="nx">jump</span><span class="p">(</span><span class="nx">$switchI_end</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">$switchI_end</span><span class="o">:</span>
  <span class="p">}</span>
<span class="nx">FunctionalAssemblyExpression</span><span class="p">(</span> <span class="nx">identifier</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">argn</span><span class="p">)</span> <span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="nx">identifier</span> <span class="k">is</span> <span class="kd">function</span> <span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;</span> <span class="nx">with</span> <span class="nx">n</span> <span class="nx">args</span> <span class="nx">and</span> <span class="nx">m</span> <span class="nx">ret</span> <span class="nx">values</span> <span class="o">-&gt;</span>
      <span class="p">{</span>
        <span class="c1">// find I such that $funcallI_* does not exist</span>
        <span class="nx">$funcallI_return</span> <span class="nx">argn</span>  <span class="p">...</span> <span class="nx">arg2</span> <span class="nx">arg1</span> <span class="nx">jump</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;</span><span class="p">)</span>
        <span class="nx">pop</span> <span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="nx">times</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">context</span> <span class="k">is</span> <span class="err">`</span><span class="kr">let</span> <span class="p">(</span><span class="nx">id1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">idm</span><span class="p">)</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">(...)</span><span class="err">`</span> <span class="o">-&gt;</span>
          <span class="kr">let</span> <span class="nx">id1</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">...</span> <span class="kr">let</span> <span class="nx">idm</span> <span class="o">:=</span> <span class="mi">0</span>
          <span class="nx">$funcallI_return</span><span class="o">:</span>
        <span class="k">else</span> <span class="o">-&gt;</span>
          <span class="mi">0</span> <span class="p">(</span><span class="nx">m</span> <span class="nx">times</span><span class="p">)</span>
          <span class="nx">$funcallI_return</span><span class="o">:</span>
          <span class="nx">turn</span> <span class="nx">the</span> <span class="nx">functional</span> <span class="nx">expression</span> <span class="nx">that</span> <span class="nx">leads</span> <span class="nx">to</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">call</span>
          <span class="nx">into</span> <span class="nx">a</span> <span class="nx">statement</span> <span class="nx">stream</span>
      <span class="p">}</span>
    <span class="k">else</span> <span class="o">-&gt;</span> <span class="nx">desugar</span><span class="p">(</span><span class="nx">children</span> <span class="kr">of</span> <span class="nx">node</span><span class="p">)</span>
  <span class="p">}</span>
<span class="kr">default</span> <span class="nx">node</span> <span class="o">-&gt;</span>
  <span class="nx">desugar</span><span class="p">(</span><span class="nx">children</span> <span class="kr">of</span> <span class="nx">node</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="opcode-stream-generation">
<h5>Opcode Stream Generation<a class="headerlink" href="#opcode-stream-generation" title="Permalink to this headline">¶</a></h5>
<p>During opcode stream generation, we keep track of the current stack height
in a counter,
so that accessing stack variables by name is possible. The stack height is modified with every opcode
that modifies the stack and with every label that is annotated with a stack
adjustment. Every time a new
local variable is introduced, it is registered together with the current
stack height. If a variable is accessed (either for copying its value or for
assignment), the appropriate <code class="docutils literal"><span class="pre">DUP</span></code> or <code class="docutils literal"><span class="pre">SWAP</span></code> instruction is selected depending
on the difference between the current stack height and the
stack height at the point the variable was introduced.</p>
<p>Pseudocode:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">codegen</span> <span class="nx">item</span><span class="o">:</span> <span class="nx">AST</span> <span class="o">-&gt;</span> <span class="nx">opcode_stream</span> <span class="o">=</span>
<span class="kr">match</span> <span class="nx">item</span> <span class="p">{</span>
<span class="nx">AssemblyBlock</span><span class="p">({</span> <span class="nx">items</span> <span class="p">})</span> <span class="o">-&gt;</span>
  <span class="nx">join</span><span class="p">(</span><span class="nx">codegen</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="k">for</span> <span class="nx">item</span> <span class="kr">in</span> <span class="nx">items</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">last</span> <span class="nx">generated</span> <span class="nx">opcode</span> <span class="nx">has</span> <span class="nx">continuing</span> <span class="nx">control</span> <span class="nx">flow</span><span class="o">:</span>
    <span class="nx">POP</span> <span class="k">for</span> <span class="nx">all</span> <span class="nx">local</span> <span class="nx">variables</span> <span class="nx">registered</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nb">block</span> <span class="p">(</span><span class="nx">including</span> <span class="nx">variables</span>
    <span class="nx">introduced</span> <span class="nx">by</span> <span class="nx">labels</span><span class="p">)</span>
    <span class="nx">warn</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">stack</span> <span class="nx">height</span> <span class="nx">at</span> <span class="k">this</span> <span class="nx">point</span> <span class="k">is</span> <span class="nx">not</span> <span class="nx">the</span> <span class="nx">same</span> <span class="k">as</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">start</span> <span class="kr">of</span> <span class="nx">the</span> <span class="nb">block</span>
<span class="nx">Identifier</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">lookup</span> <span class="nx">id</span> <span class="kr">in</span> <span class="nx">the</span> <span class="nx">syntactic</span> <span class="nx">stack</span> <span class="kr">of</span> <span class="nb">block</span><span class="nx">s</span>
  <span class="kr">match</span> <span class="kr">type</span> <span class="kr">of</span> <span class="nx">id</span>
    <span class="nx">Local</span> <span class="nx">Variable</span> <span class="o">-&gt;</span>
      <span class="nx">DUPi</span> <span class="nx">where</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">stack_height</span> <span class="o">-</span> <span class="nx">stack_height_of_identifier</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="nx">Label</span> <span class="o">-&gt;</span>
      <span class="c1">// reference to be resolved during bytecode generation</span>
      <span class="nx">PUSH</span><span class="o">&lt;</span><span class="nx">bytecode</span> <span class="nx">position</span> <span class="kr">of</span> <span class="nx">label</span><span class="o">&gt;</span>
    <span class="nx">SubAssembly</span> <span class="o">-&gt;</span>
      <span class="nx">PUSH</span><span class="o">&lt;</span><span class="nx">bytecode</span> <span class="nx">position</span> <span class="kr">of</span> <span class="nx">subassembly</span> <span class="nx">data</span><span class="o">&gt;</span>
<span class="nx">FunctionalAssemblyExpression</span><span class="p">(</span><span class="nx">id</span> <span class="p">(</span> <span class="nx">arguments</span> <span class="p">)</span> <span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">join</span><span class="p">(</span><span class="nx">codegen</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="k">for</span> <span class="nx">arg</span> <span class="kr">in</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">reversed</span><span class="p">())</span>
  <span class="nx">id</span> <span class="p">(</span><span class="nx">which</span> <span class="nx">has</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">an</span> <span class="nx">opcode</span><span class="p">,</span> <span class="nx">might</span> <span class="nx">be</span> <span class="nx">a</span> <span class="kd">function</span> <span class="nx">name</span> <span class="nx">later</span><span class="p">)</span>
<span class="nx">AssemblyLocalDefinition</span><span class="p">(</span><span class="kr">let</span> <span class="p">(</span><span class="nx">id1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">idn</span><span class="p">)</span> <span class="o">:=</span> <span class="nx">expr</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">register</span> <span class="nx">identifiers</span> <span class="nx">id1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">idn</span> <span class="k">as</span> <span class="nx">locals</span> <span class="kr">in</span> <span class="nx">current</span> <span class="nb">block</span> <span class="nx">at</span> <span class="nx">current</span> <span class="nx">stack</span> <span class="nx">height</span>
  <span class="nx">codegen</span><span class="p">(</span><span class="nx">expr</span><span class="p">)</span> <span class="o">-</span> <span class="nb">assert</span> <span class="nx">that</span> <span class="nx">expr</span> <span class="k">returns</span> <span class="nx">n</span> <span class="nx">items</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">stack</span>
<span class="nx">FunctionalAssemblyAssignment</span><span class="p">((</span><span class="nx">id1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">idn</span><span class="p">)</span> <span class="o">:=</span> <span class="nx">expr</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">lookup</span> <span class="nx">id1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">idn</span> <span class="kr">in</span> <span class="nx">the</span> <span class="nx">syntactic</span> <span class="nx">stack</span> <span class="kr">of</span> <span class="nb">block</span><span class="nx">s</span><span class="p">,</span> <span class="nb">assert</span> <span class="nx">that</span> <span class="nx">they</span> <span class="nx">are</span> <span class="nx">variables</span>
  <span class="nx">codegen</span><span class="p">(</span><span class="nx">expr</span><span class="p">)</span>
  <span class="k">for</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">n</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">i</span><span class="o">:</span>
  <span class="nx">SWAPi</span> <span class="nx">where</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">stack_height</span> <span class="o">-</span> <span class="nx">stack_height_of_identifier</span><span class="p">(</span><span class="nx">idj</span><span class="p">)</span>
  <span class="nx">POP</span>
<span class="nx">AssemblyAssignment</span><span class="p">(</span><span class="o">=:</span> <span class="nx">id</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">look</span> <span class="nx">up</span> <span class="nx">id</span> <span class="kr">in</span> <span class="nx">the</span> <span class="nx">syntactic</span> <span class="nx">stack</span> <span class="kr">of</span> <span class="nb">block</span><span class="nx">s</span><span class="p">,</span> <span class="nb">assert</span> <span class="nx">that</span> <span class="nx">it</span> <span class="k">is</span> <span class="nx">a</span> <span class="nx">variable</span>
  <span class="nx">SWAPi</span> <span class="nx">where</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">stack_height</span> <span class="o">-</span> <span class="nx">stack_height_of_identifier</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
  <span class="nx">POP</span>
<span class="nx">LabelDefinition</span><span class="p">(</span><span class="nx">name</span><span class="o">:</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">JUMPDEST</span>
<span class="nx">NumberLiteral</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">PUSH</span><span class="o">&lt;</span><span class="nx">num</span> <span class="nx">interpreted</span> <span class="k">as</span> <span class="nx">decimal</span> <span class="nx">and</span> <span class="nx">right</span><span class="o">-</span><span class="nx">aligned</span><span class="o">&gt;</span>
<span class="nx">HexLiteral</span><span class="p">(</span><span class="nx">lit</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">PUSH32</span><span class="o">&lt;</span><span class="nx">lit</span> <span class="nx">interpreted</span> <span class="k">as</span> <span class="k">hex</span> <span class="nx">and</span> <span class="nx">left</span><span class="o">-</span><span class="nx">aligned</span><span class="o">&gt;</span>
<span class="nx">StringLiteral</span><span class="p">(</span><span class="nx">lit</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">PUSH32</span><span class="o">&lt;</span><span class="nx">lit</span> <span class="nx">utf</span><span class="o">-</span><span class="mi">8</span> <span class="nx">encoded</span> <span class="nx">and</span> <span class="nx">left</span><span class="o">-</span><span class="nx">aligned</span><span class="o">&gt;</span>
<span class="nx">SubAssembly</span><span class="p">(</span><span class="k">assembly</span> <span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;</span> <span class="nb">block</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">append</span> <span class="nx">codegen</span><span class="p">(</span><span class="nb">block</span><span class="p">)</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">end</span> <span class="kr">of</span> <span class="nx">the</span> <span class="nx">code</span>
<span class="nx">dataSize</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nb">assert</span> <span class="nx">that</span> <span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;</span> <span class="k">is</span> <span class="nx">a</span> <span class="nx">subassembly</span> <span class="o">-&gt;</span>
  <span class="nx">PUSH32</span><span class="o">&lt;</span><span class="nx">size</span> <span class="kr">of</span> <span class="nx">code</span> <span class="nx">generated</span> <span class="nx">from</span> <span class="nx">subassembly</span> <span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;&gt;</span>
<span class="nx">linkerSymbol</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">lit</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">PUSH32</span><span class="o">&lt;</span><span class="nx">zeros</span><span class="o">&gt;</span> <span class="nx">and</span> <span class="nx">append</span> <span class="nx">position</span> <span class="nx">to</span> <span class="nx">linker</span> <span class="nx">table</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-miscellaneous"></span><div class="section" id="miscellaneous">
<h3>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h3>
<div class="section" id="layout-of-state-variables-in-storage">
<span id="index-0"></span><h4>Layout of State Variables in Storage<a class="headerlink" href="#layout-of-state-variables-in-storage" title="Permalink to this headline">¶</a></h4>
<p>Statically-sized variables (everything except mapping and dynamically-sized array types) are laid out contiguously in storage starting from position <code class="docutils literal"><span class="pre">0</span></code>. Multiple items that need less than 32 bytes are packed into a single storage slot if possible, according to the following rules:</p>
<ul class="simple">
<li>The first item in a storage slot is stored lower-order aligned.</li>
<li>Elementary types use only that many bytes that are necessary to store them.</li>
<li>If an elementary type does not fit the remaining part of a storage slot, it is moved to the next storage slot.</li>
<li>Structs and array data always start a new slot and occupy whole slots (but items inside a struct or array are packed tightly according to these rules).</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When using elements that are smaller than 32 bytes, your contract&#8217;s gas usage may be higher.
This is because the EVM operates on 32 bytes at a time. Therefore, if the element is smaller
than that, the EVM must use more operations in order to reduce the size of the element from 32
bytes to the desired size.</p>
<p>It is only beneficial to use reduced-size arguments if you are dealing with storage values
because the compiler will pack multiple elements into one storage slot, and thus, combine
multiple reads or writes into a single operation. When dealing with function arguments or memory
values, there is no inherent benefit because the compiler does not pack these values.</p>
<p class="last">Finally, in order to allow the EVM to optimize for this, ensure that you try to order your
storage variables and <code class="docutils literal"><span class="pre">struct</span></code> members such that they can be packed tightly. For example,
declaring your storage variables in the order of <code class="docutils literal"><span class="pre">uint128,</span> <span class="pre">uint128,</span> <span class="pre">uint256</span></code> instead of
<code class="docutils literal"><span class="pre">uint128,</span> <span class="pre">uint256,</span> <span class="pre">uint128</span></code>, as the former will only take up two slots of storage whereas the
latter will take up three.</p>
</div>
<p>The elements of structs and arrays are stored after each other, just as if they were given explicitly.</p>
<p>Due to their unpredictable size, mapping and dynamically-sized array types use a Keccak-256 hash
computation to find the starting position of the value or the array data. These starting positions are always full stack slots.</p>
<p>The mapping or the dynamic array itself
occupies an (unfilled) slot in storage at some position <code class="docutils literal"><span class="pre">p</span></code> according to the above rule (or by
recursively applying this rule for mappings to mappings or arrays of arrays). For a dynamic array, this slot stores the number of elements in the array (byte arrays and strings are an exception here, see below). For a mapping, the slot is unused (but it is needed so that two equal mappings after each other will use a different hash distribution).
Array data is located at <code class="docutils literal"><span class="pre">keccak256(p)</span></code> and the value corresponding to a mapping key
<code class="docutils literal"><span class="pre">k</span></code> is located at <code class="docutils literal"><span class="pre">keccak256(k</span> <span class="pre">.</span> <span class="pre">p)</span></code> where <code class="docutils literal"><span class="pre">.</span></code> is concatenation. If the value is again a
non-elementary type, the positions are found by adding an offset of <code class="docutils literal"><span class="pre">keccak256(k</span> <span class="pre">.</span> <span class="pre">p)</span></code>.</p>
<p><code class="docutils literal"><span class="pre">bytes</span></code> and <code class="docutils literal"><span class="pre">string</span></code> store their data in the same slot where also the length is stored if they are short. In particular: If the data is at most <code class="docutils literal"><span class="pre">31</span></code> bytes long, it is stored in the higher-order bytes (left aligned) and the lowest-order byte stores <code class="docutils literal"><span class="pre">length</span> <span class="pre">*</span> <span class="pre">2</span></code>. If it is longer, the main slot stores <code class="docutils literal"><span class="pre">length</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">+</span> <span class="pre">1</span></code> and the data is stored as usual in <code class="docutils literal"><span class="pre">keccak256(slot)</span></code>.</p>
<p>So for the following contract snippet:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="nx">s</span> <span class="p">{</span> <span class="kt">uint</span> <span class="nx">a</span><span class="p">;</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
  <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">))</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The position of <code class="docutils literal"><span class="pre">data[4][9].b</span></code> is at <code class="docutils literal"><span class="pre">keccak256(uint256(9)</span> <span class="pre">.</span> <span class="pre">keccak256(uint256(4)</span> <span class="pre">.</span> <span class="pre">uint256(1)))</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
</div>
<div class="section" id="layout-in-memory">
<h4>Layout in Memory<a class="headerlink" href="#layout-in-memory" title="Permalink to this headline">¶</a></h4>
<p>Solidity reserves three 256-bit slots:</p>
<ul class="simple">
<li>0 - 64: scratch space for hashing methods</li>
<li>64 - 96: currently allocated memory size (aka. free memory pointer)</li>
</ul>
<p>Scratch space can be used between statements (ie. within inline assembly).</p>
<p>Solidity always places new objects at the free memory pointer and memory is never freed (this might change in the future).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There are some operations in Solidity that need a temporary memory area larger than 64 bytes and therefore will not fit into the scratch space. They will be placed where the free memory points to, but given their short lifecycle, the pointer is not updated. The memory may or may not be zeroed out. Because of this, one shouldn&#8217;t expect the free memory to be zeroed out.</p>
</div>
</div>
<div class="section" id="layout-of-call-data">
<h4>Layout of Call Data<a class="headerlink" href="#layout-of-call-data" title="Permalink to this headline">¶</a></h4>
<p>When a Solidity contract is deployed and when it is called from an
account, the input data is assumed to be in the format in <a class="reference internal" href="index.html#abi"><span class="std std-ref">the ABI
specification</span></a>. The ABI specification requires arguments to be padded to multiples of 32
bytes.  The internal function calls use a different convention.</p>
</div>
<div class="section" id="internals-cleaning-up-variables">
<h4>Internals - Cleaning Up Variables<a class="headerlink" href="#internals-cleaning-up-variables" title="Permalink to this headline">¶</a></h4>
<p>When a value is shorter than 256-bit, in some cases the remaining bits
must be cleaned.
The Solidity compiler is designed to clean such remaining bits before any operations
that might be adversely affected by the potential garbage in the remaining bits.
For example, before writing a value to the memory, the remaining bits need
to be cleared because the memory contents can be used for computing
hashes or sent as the data of a message call.  Similarly, before
storing a value in the storage, the remaining bits need to be cleaned
because otherwise the garbled value can be observed.</p>
<p>On the other hand, we do not clean the bits if the immediately
following operation is not affected.  For instance, since any non-zero
value is considered <code class="docutils literal"><span class="pre">true</span></code> by <code class="docutils literal"><span class="pre">JUMPI</span></code> instruction, we do not clean
the boolean values before they are used as the condition for
<code class="docutils literal"><span class="pre">JUMPI</span></code>.</p>
<p>In addition to the design principle above, the Solidity compiler
cleans input data when it is loaded onto the stack.</p>
<p>Different types have different rules for cleaning up invalid values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="31%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Valid Values</th>
<th class="head">Invalid Values Mean</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>enum of n
members</td>
<td>0 until n - 1</td>
<td>exception</td>
</tr>
<tr class="row-odd"><td>bool</td>
<td>0 or 1</td>
<td>1</td>
</tr>
<tr class="row-even"><td>signed integers</td>
<td>sign-extended
word</td>
<td>currently silently
wraps; in the
future exceptions
will be thrown</td>
</tr>
<tr class="row-odd"><td>unsigned
integers</td>
<td>higher bits
zeroed</td>
<td>currently silently
wraps; in the
future exceptions
will be thrown</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="internals-the-optimizer">
<span id="index-1"></span><h4>Internals - The Optimizer<a class="headerlink" href="#internals-the-optimizer" title="Permalink to this headline">¶</a></h4>
<p>The Solidity optimizer operates on assembly, so it can be and also is used by other languages. It splits the sequence of instructions into basic blocks at <code class="docutils literal"><span class="pre">JUMPs</span></code> and <code class="docutils literal"><span class="pre">JUMPDESTs</span></code>. Inside these blocks, the instructions are analysed and every modification to the stack, to memory or storage is recorded as an expression which consists of an instruction and a list of arguments which are essentially pointers to other expressions. The main idea is now to find expressions that are always equal (on every input) and combine them into an expression class. The optimizer first tries to find each new expression in a list of already known expressions. If this does not work, the expression is simplified according to rules like <code class="docutils literal"><span class="pre">constant</span> <span class="pre">+</span> <span class="pre">constant</span> <span class="pre">=</span> <span class="pre">sum_of_constants</span></code> or <code class="docutils literal"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">1</span> <span class="pre">=</span> <span class="pre">X</span></code>. Since this is done recursively, we can also apply the latter rule if the second factor is a more complex expression where we know that it will always evaluate to one. Modifications to storage and memory locations have to erase knowledge about storage and memory locations which are not known to be different: If we first write to location x and then to location y and both are input variables, the second could overwrite the first, so we actually do not know what is stored at x after we wrote to y. On the other hand, if a simplification of the expression x - y evaluates to a non-zero constant, we know that we can keep our knowledge about what is stored at x.</p>
<p>At the end of this process, we know which expressions have to be on the stack in the end and have a list of modifications to memory and storage. This information is stored together with the basic blocks and is used to link them. Furthermore, knowledge about the stack, storage and memory configuration is forwarded to the next block(s). If we know the targets of all <code class="docutils literal"><span class="pre">JUMP</span></code> and <code class="docutils literal"><span class="pre">JUMPI</span></code> instructions, we can build a complete control flow graph of the program. If there is only one target we do not know (this can happen as in principle, jump targets can be computed from inputs), we have to erase all knowledge about the input state of a block as it can be the target of the unknown <code class="docutils literal"><span class="pre">JUMP</span></code>. If a <code class="docutils literal"><span class="pre">JUMPI</span></code> is found whose condition evaluates to a constant, it is transformed to an unconditional jump.</p>
<p>As the last step, the code in each block is completely re-generated. A dependency graph is created from the expressions on the stack at the end of the block and every operation that is not part of this graph is essentially dropped. Now code is generated that applies the modifications to memory and storage in the order they were made in the original code (dropping modifications which were found not to be needed) and finally, generates all values that are required to be on the stack in the correct place.</p>
<p>These steps are applied to each basic block and the newly generated code is used as replacement if it is smaller. If a basic block is split at a <code class="docutils literal"><span class="pre">JUMPI</span></code> and during the analysis, the condition evaluates to a constant, the <code class="docutils literal"><span class="pre">JUMPI</span></code> is replaced depending on the value of the constant, and thus code like</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="nx">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">else</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>is simplified to code which can also be compiled from</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>even though the instructions contained a jump in the beginning.</p>
</div>
<div class="section" id="source-mappings">
<span id="index-2"></span><h4>Source Mappings<a class="headerlink" href="#source-mappings" title="Permalink to this headline">¶</a></h4>
<p>As part of the AST output, the compiler provides the range of the source
code that is represented by the respective node in the AST. This can be
used for various purposes ranging from static analysis tools that report
errors based on the AST and debugging tools that highlight local variables
and their uses.</p>
<p>Furthermore, the compiler can also generate a mapping from the bytecode
to the range in the source code that generated the instruction. This is again
important for static analysis tools that operate on bytecode level and
for displaying the current position in the source code inside a debugger
or for breakpoint handling.</p>
<p>Both kinds of source mappings use integer indentifiers to refer to source files.
These are regular array indices into a list of source files usually called
<code class="docutils literal"><span class="pre">&quot;sourceList&quot;</span></code>, which is part of the combined-json and the output of
the json / npm compiler.</p>
<p>The source mappings inside the AST use the following
notation:</p>
<p><code class="docutils literal"><span class="pre">s:l:f</span></code></p>
<p>Where <code class="docutils literal"><span class="pre">s</span></code> is the byte-offset to the start of the range in the source file,
<code class="docutils literal"><span class="pre">l</span></code> is the length of the source range in bytes and <code class="docutils literal"><span class="pre">f</span></code> is the source
index mentioned above.</p>
<p>The encoding in the source mapping for the bytecode is more complicated:
It is a list of <code class="docutils literal"><span class="pre">s:l:f:j</span></code> separated by <code class="docutils literal"><span class="pre">;</span></code>. Each of these
elements corresponds to an instruction, i.e. you cannot use the byte offset
but have to use the instruction offset (push instructions are longer than a single byte).
The fields <code class="docutils literal"><span class="pre">s</span></code>, <code class="docutils literal"><span class="pre">l</span></code> and <code class="docutils literal"><span class="pre">f</span></code> are as above and <code class="docutils literal"><span class="pre">j</span></code> can be either
<code class="docutils literal"><span class="pre">i</span></code>, <code class="docutils literal"><span class="pre">o</span></code> or <code class="docutils literal"><span class="pre">-</span></code> signifying whether a jump instruction goes into a
function, returns from a function or is a regular jump as part of e.g. a loop.</p>
<p>In order to compress these source mappings especially for bytecode, the
following rules are used:</p>
<blockquote>
<div><ul class="simple">
<li>If a field is empty, the value of the preceding element is used.</li>
<li>If a <code class="docutils literal"><span class="pre">:</span></code> is missing, all following fields are considered empty.</li>
</ul>
</div></blockquote>
<p>This means the following source mappings represent the same information:</p>
<p><code class="docutils literal"><span class="pre">1:2:1;1:9:1;2:1:2;2:1:2;2:1:2</span></code></p>
<p><code class="docutils literal"><span class="pre">1:2:1;:9;2::2;;</span></code></p>
</div>
<div class="section" id="contract-metadata">
<h4>Contract Metadata<a class="headerlink" href="#contract-metadata" title="Permalink to this headline">¶</a></h4>
<p>The Solidity compiler automatically generates a JSON file, the
contract metadata, that contains information about the current contract.
It can be used to query the compiler version, the sources used, the ABI
and NatSpec documentation in order to more safely interact with the contract
and to verify its source code.</p>
<p>The compiler appends a Swarm hash of the metadata file to the end of the
bytecode (for details, see below) of each contract, so that you can retrieve
the file in an authenticated way without having to resort to a centralized
data provider.</p>
<p>Of course, you have to publish the metadata file to Swarm (or some other service)
so that others can access it. The file can be output by using <code class="docutils literal"><span class="pre">solc</span> <span class="pre">--metadata</span></code>
and the file will be called <code class="docutils literal"><span class="pre">ContractName_meta.json</span></code>.
It will contain Swarm references to the source code, so you have to upload
all source files and the metadata file.</p>
<p>The metadata file has the following format. The example below is presented in a
human-readable way. Properly formatted metadata should use quotes correctly,
reduce whitespace to a minimum and sort the keys of all objects to arrive at a
unique formatting.
Comments are of course also not permitted and used here only for explanatory purposes.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>{
  // Required: The version of the metadata format
  version: &quot;1&quot;,
  // Required: Source code language, basically selects a &quot;sub-version&quot;
  // of the specification
  language: &quot;Solidity&quot;,
  // Required: Details about the compiler, contents are specific
  // to the language.
  compiler: {
    // Required for Solidity: Version of the compiler
    version: &quot;0.4.6+commit.2dabbdf0.Emscripten.clang&quot;,
    // Optional: Hash of the compiler binary which produced this output
    keccak256: &quot;0x123...&quot;
  },
  // Required: Compilation source files/source units, keys are file names
  sources:
  {
    &quot;myFile.sol&quot;: {
      // Required: keccak256 hash of the source file
      &quot;keccak256&quot;: &quot;0x123...&quot;,
      // Required (unless &quot;content&quot; is used, see below): Sorted URL(s)
      // to the source file, protocol is more or less arbitrary, but a
      // Swarm URL is recommended
      &quot;urls&quot;: [ &quot;bzzr://56ab...&quot; ]
    },
    &quot;mortal&quot;: {
      // Required: keccak256 hash of the source file
      &quot;keccak256&quot;: &quot;0x234...&quot;,
      // Required (unless &quot;url&quot; is used): literal contents of the source file
      &quot;content&quot;: &quot;contract mortal is owned { function kill() { if (msg.sender == owner) selfdestruct(owner); } }&quot;
    }
  },
  // Required: Compiler settings
  settings:
  {
    // Required for Solidity: Sorted list of remappings
    remappings: [ &quot;:g/dir&quot; ],
    // Optional: Optimizer settings (enabled defaults to false)
    optimizer: {
      enabled: true,
      runs: 500
    },
    // Required for Solidity: File and name of the contract or library this
    // metadata is created for.
    compilationTarget: {
      &quot;myFile.sol&quot;: &quot;MyContract&quot;
    },
    // Required for Solidity: Addresses for libraries used
    libraries: {
      &quot;MyLib&quot;: &quot;0x123123...&quot;
    }
  },
  // Required: Generated information about the contract.
  output:
  {
    // Required: ABI definition of the contract
    abi: [ ... ],
    // Required: NatSpec user documentation of the contract
    userdoc: [ ... ],
    // Required: NatSpec developer documentation of the contract
    devdoc: [ ... ],
  }
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note the ABI definition above has no fixed order. It can change with compiler versions.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since the bytecode of the resulting contract contains the metadata hash, any change to
the metadata will result in a change of the bytecode. Furthermore, since the metadata
includes a hash of all the sources used, a single whitespace change in any of the source
codes will result in a different metadata, and subsequently a different bytecode.</p>
</div>
<div class="section" id="encoding-of-the-metadata-hash-in-the-bytecode">
<h5>Encoding of the Metadata Hash in the Bytecode<a class="headerlink" href="#encoding-of-the-metadata-hash-in-the-bytecode" title="Permalink to this headline">¶</a></h5>
<p>Because we might support other ways to retrieve the metadata file in the future,
the mapping <code class="docutils literal"><span class="pre">{&quot;bzzr0&quot;:</span> <span class="pre">&lt;Swarm</span> <span class="pre">hash&gt;}</span></code> is stored
<a class="reference external" href="https://tools.ietf.org/html/rfc7049">CBOR</a>-encoded. Since the beginning of that
encoding is not easy to find, its length is added in a two-byte big-endian
encoding. The current version of the Solidity compiler thus adds the following
to the end of the deployed bytecode:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0xa1</span> <span class="mh">0x65</span> <span class="s1">&#39;b&#39;</span> <span class="s1">&#39;z&#39;</span> <span class="s1">&#39;z&#39;</span> <span class="s1">&#39;r&#39;</span> <span class="s1">&#39;0&#39;</span> <span class="mh">0x58</span> <span class="mh">0x20</span> <span class="o">&lt;</span><span class="mi">32</span> <span class="kt">bytes</span> <span class="nx">swarm</span> <span class="nx">hash</span><span class="o">&gt;</span> <span class="mh">0x00</span> <span class="mh">0x29</span>
</pre></div>
</div>
<p>So in order to retrieve the data, the end of the deployed bytecode can be checked
to match that pattern and use the Swarm hash to retrieve the file.</p>
</div>
<div class="section" id="usage-for-automatic-interface-generation-and-natspec">
<h5>Usage for Automatic Interface Generation and NatSpec<a class="headerlink" href="#usage-for-automatic-interface-generation-and-natspec" title="Permalink to this headline">¶</a></h5>
<p>The metadata is used in the following way: A component that wants to interact
with a contract (e.g. Mist) retrieves the code of the contract, from that
the Swarm hash of a file which is then retrieved.
That file is JSON-decoded into a structure like above.</p>
<p>The component can then use the ABI to automatically generate a rudimentary
user interface for the contract.</p>
<p>Furthermore, Mist can use the userdoc to display a confirmation message to the user
whenever they interact with the contract.</p>
</div>
<div class="section" id="usage-for-source-code-verification">
<h5>Usage for Source Code Verification<a class="headerlink" href="#usage-for-source-code-verification" title="Permalink to this headline">¶</a></h5>
<p>In order to verify the compilation, sources can be retrieved from Swarm
via the link in the metadata file.
The compiler of the correct version (which is checked to be part of the &#8220;official&#8221; compilers)
is invoked on that input with the specified settings. The resulting
bytecode is compared to the data of the creation transaction or <code class="docutils literal"><span class="pre">CREATE</span></code> opcode data.
This automatically verifies the metadata since its hash is part of the bytecode.
Excess data corresponds to the constructor input data, which should be decoded
according to the interface and presented to the user.</p>
</div>
</div>
<div class="section" id="tips-and-tricks">
<h4>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Use <code class="docutils literal"><span class="pre">delete</span></code> on arrays to delete all its elements.</li>
<li>Use shorter types for struct elements and sort them such that short types are grouped together. This can lower the gas costs as multiple <code class="docutils literal"><span class="pre">SSTORE</span></code> operations might be combined into a single (<code class="docutils literal"><span class="pre">SSTORE</span></code> costs 5000 or 20000 gas, so this is what you want to optimise). Use the gas price estimator (with optimiser enabled) to check!</li>
<li>Make your state variables public - the compiler will create <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getters</span></a> for you automatically.</li>
<li>If you end up checking conditions on input or state a lot at the beginning of your functions, try using <a class="reference internal" href="index.html#modifiers"><span class="std std-ref">Function Modifiers</span></a>.</li>
<li>If your contract has a function called <code class="docutils literal"><span class="pre">send</span></code> but you want to use the built-in send-function, use <code class="docutils literal"><span class="pre">address(contractVariable).send(amount)</span></code>.</li>
<li>Initialise storage structs with a single assignment: <code class="docutils literal"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">MyStruct({a:</span> <span class="pre">1,</span> <span class="pre">b:</span> <span class="pre">2});</span></code></li>
</ul>
</div>
<div class="section" id="cheatsheet">
<h4>Cheatsheet<a class="headerlink" href="#cheatsheet" title="Permalink to this headline">¶</a></h4>
<div class="section" id="order-of-precedence-of-operators">
<span id="order"></span><span id="index-3"></span><h5>Order of Precedence of Operators<a class="headerlink" href="#order-of-precedence-of-operators" title="Permalink to this headline">¶</a></h5>
<p>The following is the order of precedence for operators, listed in order of evaluation.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="40%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Precedence</th>
<th class="head">Description</th>
<th class="head">Operator</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="6"><em>1</em></td>
<td>Postfix increment and decrement</td>
<td><code class="docutils literal"><span class="pre">++</span></code>, <code class="docutils literal"><span class="pre">--</span></code></td>
</tr>
<tr class="row-odd"><td>New expression</td>
<td><code class="docutils literal"><span class="pre">new</span> <span class="pre">&lt;typename&gt;</span></code></td>
</tr>
<tr class="row-even"><td>Array subscripting</td>
<td><code class="docutils literal"><span class="pre">&lt;array&gt;[&lt;index&gt;]</span></code></td>
</tr>
<tr class="row-odd"><td>Member access</td>
<td><code class="docutils literal"><span class="pre">&lt;object&gt;.&lt;member&gt;</span></code></td>
</tr>
<tr class="row-even"><td>Function-like call</td>
<td><code class="docutils literal"><span class="pre">&lt;func&gt;(&lt;args...&gt;)</span></code></td>
</tr>
<tr class="row-odd"><td>Parentheses</td>
<td><code class="docutils literal"><span class="pre">(&lt;statement&gt;)</span></code></td>
</tr>
<tr class="row-even"><td rowspan="5"><em>2</em></td>
<td>Prefix increment and decrement</td>
<td><code class="docutils literal"><span class="pre">++</span></code>, <code class="docutils literal"><span class="pre">--</span></code></td>
</tr>
<tr class="row-odd"><td>Unary plus and minus</td>
<td><code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code></td>
</tr>
<tr class="row-even"><td>Unary operations</td>
<td><code class="docutils literal"><span class="pre">delete</span></code></td>
</tr>
<tr class="row-odd"><td>Logical NOT</td>
<td><code class="docutils literal"><span class="pre">!</span></code></td>
</tr>
<tr class="row-even"><td>Bitwise NOT</td>
<td><code class="docutils literal"><span class="pre">~</span></code></td>
</tr>
<tr class="row-odd"><td><em>3</em></td>
<td>Exponentiation</td>
<td><code class="docutils literal"><span class="pre">**</span></code></td>
</tr>
<tr class="row-even"><td><em>4</em></td>
<td>Multiplication, division and modulo</td>
<td><code class="docutils literal"><span class="pre">*</span></code>, <code class="docutils literal"><span class="pre">/</span></code>, <code class="docutils literal"><span class="pre">%</span></code></td>
</tr>
<tr class="row-odd"><td><em>5</em></td>
<td>Addition and subtraction</td>
<td><code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code></td>
</tr>
<tr class="row-even"><td><em>6</em></td>
<td>Bitwise shift operators</td>
<td><code class="docutils literal"><span class="pre">&lt;&lt;</span></code>, <code class="docutils literal"><span class="pre">&gt;&gt;</span></code></td>
</tr>
<tr class="row-odd"><td><em>7</em></td>
<td>Bitwise AND</td>
<td><code class="docutils literal"><span class="pre">&amp;</span></code></td>
</tr>
<tr class="row-even"><td><em>8</em></td>
<td>Bitwise XOR</td>
<td><code class="docutils literal"><span class="pre">^</span></code></td>
</tr>
<tr class="row-odd"><td><em>9</em></td>
<td>Bitwise OR</td>
<td><code class="docutils literal"><span class="pre">|</span></code></td>
</tr>
<tr class="row-even"><td><em>10</em></td>
<td>Inequality operators</td>
<td><code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code></td>
</tr>
<tr class="row-odd"><td><em>11</em></td>
<td>Equality operators</td>
<td><code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code></td>
</tr>
<tr class="row-even"><td><em>12</em></td>
<td>Logical AND</td>
<td><code class="docutils literal"><span class="pre">&amp;&amp;</span></code></td>
</tr>
<tr class="row-odd"><td><em>13</em></td>
<td>Logical OR</td>
<td><code class="docutils literal"><span class="pre">||</span></code></td>
</tr>
<tr class="row-even"><td><em>14</em></td>
<td>Ternary operator</td>
<td><code class="docutils literal"><span class="pre">&lt;conditional&gt;</span> <span class="pre">?</span> <span class="pre">&lt;if-true&gt;</span> <span class="pre">:</span> <span class="pre">&lt;if-false&gt;</span></code></td>
</tr>
<tr class="row-odd"><td><em>15</em></td>
<td>Assignment operators</td>
<td><code class="docutils literal"><span class="pre">=</span></code>, <code class="docutils literal"><span class="pre">|=</span></code>, <code class="docutils literal"><span class="pre">^=</span></code>, <code class="docutils literal"><span class="pre">&amp;=</span></code>, <code class="docutils literal"><span class="pre">&lt;&lt;=</span></code>,
<code class="docutils literal"><span class="pre">&gt;&gt;=</span></code>, <code class="docutils literal"><span class="pre">+=</span></code>, <code class="docutils literal"><span class="pre">-=</span></code>, <code class="docutils literal"><span class="pre">*=</span></code>, <code class="docutils literal"><span class="pre">/=</span></code>,
<code class="docutils literal"><span class="pre">%=</span></code></td>
</tr>
<tr class="row-even"><td><em>16</em></td>
<td>Comma operator</td>
<td><code class="docutils literal"><span class="pre">,</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="global-variables">
<span id="index-4"></span><h5>Global Variables<a class="headerlink" href="#global-variables" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">block.blockhash(uint</span> <span class="pre">blockNumber)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: hash of the given block - only works for 256 most recent blocks</li>
<li><code class="docutils literal"><span class="pre">block.coinbase</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): current block miner&#8217;s address</li>
<li><code class="docutils literal"><span class="pre">block.difficulty</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block difficulty</li>
<li><code class="docutils literal"><span class="pre">block.gaslimit</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block gaslimit</li>
<li><code class="docutils literal"><span class="pre">block.number</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block number</li>
<li><code class="docutils literal"><span class="pre">block.timestamp</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block timestamp</li>
<li><code class="docutils literal"><span class="pre">msg.data</span></code> (<code class="docutils literal"><span class="pre">bytes</span></code>): complete calldata</li>
<li><code class="docutils literal"><span class="pre">msg.gas</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): remaining gas</li>
<li><code class="docutils literal"><span class="pre">msg.sender</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): sender of the message (current call)</li>
<li><code class="docutils literal"><span class="pre">msg.value</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): number of wei sent with the message</li>
<li><code class="docutils literal"><span class="pre">now</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block timestamp (alias for <code class="docutils literal"><span class="pre">block.timestamp</span></code>)</li>
<li><code class="docutils literal"><span class="pre">tx.gasprice</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): gas price of the transaction</li>
<li><code class="docutils literal"><span class="pre">tx.origin</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): sender of the transaction (full call chain)</li>
<li><code class="docutils literal"><span class="pre">assert(bool</span> <span class="pre">condition)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal"><span class="pre">false</span></code> (use for internal error)</li>
<li><code class="docutils literal"><span class="pre">require(bool</span> <span class="pre">condition)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal"><span class="pre">false</span></code> (use for malformed input or error in external component)</li>
<li><code class="docutils literal"><span class="pre">revert()</span></code>: abort execution and revert state changes</li>
<li><code class="docutils literal"><span class="pre">keccak256(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: compute the Ethereum-SHA-3 (Keccak-256) hash of the (tightly packed) arguments</li>
<li><code class="docutils literal"><span class="pre">sha3(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: an alias to <code class="docutils literal"><span class="pre">keccak256</span></code></li>
<li><code class="docutils literal"><span class="pre">sha256(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: compute the SHA-256 hash of the (tightly packed) arguments</li>
<li><code class="docutils literal"><span class="pre">ripemd160(...)</span> <span class="pre">returns</span> <span class="pre">(bytes20)</span></code>: compute the RIPEMD-160 hash of the (tightly packed) arguments</li>
<li><code class="docutils literal"><span class="pre">ecrecover(bytes32</span> <span class="pre">hash,</span> <span class="pre">uint8</span> <span class="pre">v,</span> <span class="pre">bytes32</span> <span class="pre">r,</span> <span class="pre">bytes32</span> <span class="pre">s)</span> <span class="pre">returns</span> <span class="pre">(address)</span></code>: recover address associated with the public key from elliptic curve signature, return zero on error</li>
<li><code class="docutils literal"><span class="pre">addmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>: compute <code class="docutils literal"><span class="pre">(x</span> <span class="pre">+</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the addition is performed with arbitrary precision and does not wrap around at <code class="docutils literal"><span class="pre">2**256</span></code></li>
<li><code class="docutils literal"><span class="pre">mulmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>: compute <code class="docutils literal"><span class="pre">(x</span> <span class="pre">*</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the multiplication is performed with arbitrary precision and does not wrap around at <code class="docutils literal"><span class="pre">2**256</span></code></li>
<li><code class="docutils literal"><span class="pre">this</span></code> (current contract&#8217;s type): the current contract, explicitly convertible to <code class="docutils literal"><span class="pre">address</span></code></li>
<li><code class="docutils literal"><span class="pre">super</span></code>: the contract one level higher in the inheritance hierarchy</li>
<li><code class="docutils literal"><span class="pre">selfdestruct(address</span> <span class="pre">recipient)</span></code>: destroy the current contract, sending its funds to the given address</li>
<li><code class="docutils literal"><span class="pre">suicide(address</span> <span class="pre">recipieint)</span></code>: an alias to <code class="docutils literal"><span class="pre">selfdestruct</span></code></li>
<li><code class="docutils literal"><span class="pre">&lt;address&gt;.balance</span></code> (<code class="docutils literal"><span class="pre">uint256</span></code>): balance of the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> in Wei</li>
<li><code class="docutils literal"><span class="pre">&lt;address&gt;.send(uint256</span> <span class="pre">amount)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>: send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, returns <code class="docutils literal"><span class="pre">false</span></code> on failure</li>
<li><code class="docutils literal"><span class="pre">&lt;address&gt;.transfer(uint256</span> <span class="pre">amount)</span></code>: send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, throws on failure</li>
</ul>
</div>
<div class="section" id="function-visibility-specifiers">
<span id="index-5"></span><h5>Function Visibility Specifiers<a class="headerlink" href="#function-visibility-specifiers" title="Permalink to this headline">¶</a></h5>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">myFunction</span><span class="p">()</span> <span class="o">&lt;</span><span class="nx">visibility</span> <span class="nx">specifier</span><span class="o">&gt;</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">public</span></code>: visible externally and internally (creates a <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">getter function</span></a> for storage/state variables)</li>
<li><code class="docutils literal"><span class="pre">private</span></code>: only visible in the current contract</li>
<li><code class="docutils literal"><span class="pre">external</span></code>: only visible externally (only for functions) - i.e. can only be message-called (via <code class="docutils literal"><span class="pre">this.func</span></code>)</li>
<li><code class="docutils literal"><span class="pre">internal</span></code>: only visible internally</li>
</ul>
</div>
<div class="section" id="modifiers">
<span id="index-6"></span><h5>Modifiers<a class="headerlink" href="#modifiers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">pure</span></code> for functions: Disallows modification or access of state - this is not enforced yet.</li>
<li><code class="docutils literal"><span class="pre">view</span></code> for functions: Disallows modification of state - this is not enforced yet.</li>
<li><code class="docutils literal"><span class="pre">payable</span></code> for functions: Allows them to receive Ether together with a call.</li>
<li><code class="docutils literal"><span class="pre">constant</span></code> for state variables: Disallows assignment (except initialisation), does not occupy storage slot.</li>
<li><code class="docutils literal"><span class="pre">constant</span></code> for functions: Same as <code class="docutils literal"><span class="pre">view</span></code>.</li>
<li><code class="docutils literal"><span class="pre">anonymous</span></code> for events: Does not store event signature as topic.</li>
<li><code class="docutils literal"><span class="pre">indexed</span></code> for event parameters: Stores the parameter as topic.</li>
</ul>
</div>
<div class="section" id="reserved-keywords">
<h5>Reserved Keywords<a class="headerlink" href="#reserved-keywords" title="Permalink to this headline">¶</a></h5>
<p>These keywords are reserved in Solidity. They might become part of the syntax in the future:</p>
<p><code class="docutils literal"><span class="pre">abstract</span></code>, <code class="docutils literal"><span class="pre">after</span></code>, <code class="docutils literal"><span class="pre">case</span></code>, <code class="docutils literal"><span class="pre">catch</span></code>, <code class="docutils literal"><span class="pre">default</span></code>, <code class="docutils literal"><span class="pre">final</span></code>, <code class="docutils literal"><span class="pre">in</span></code>, <code class="docutils literal"><span class="pre">inline</span></code>, <code class="docutils literal"><span class="pre">let</span></code>, <code class="docutils literal"><span class="pre">match</span></code>, <code class="docutils literal"><span class="pre">null</span></code>,
<code class="docutils literal"><span class="pre">of</span></code>, <code class="docutils literal"><span class="pre">relocatable</span></code>, <code class="docutils literal"><span class="pre">static</span></code>, <code class="docutils literal"><span class="pre">switch</span></code>, <code class="docutils literal"><span class="pre">try</span></code>, <code class="docutils literal"><span class="pre">type</span></code>, <code class="docutils literal"><span class="pre">typeof</span></code>.</p>
</div>
<div class="section" id="language-grammar">
<h5>Language Grammar<a class="headerlink" href="#language-grammar" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none"><div class="highlight"><pre><span></span>SourceUnit = (PragmaDirective | ImportDirective | ContractDefinition)*

// Pragma actually parses anything up to the trailing &#39;;&#39; to be fully forward-compatible.
PragmaDirective = &#39;pragma&#39; Identifier ([^;]+) &#39;;&#39;

ImportDirective = &#39;import&#39; StringLiteral (&#39;as&#39; Identifier)? &#39;;&#39;
        | &#39;import&#39; (&#39;*&#39; | Identifier) (&#39;as&#39; Identifier)? &#39;from&#39; StringLiteral &#39;;&#39;
        | &#39;import&#39; &#39;{&#39; Identifier (&#39;as&#39; Identifier)? ( &#39;,&#39; Identifier (&#39;as&#39; Identifier)? )* &#39;}&#39; &#39;from&#39; StringLiteral &#39;;&#39;

ContractDefinition = ( &#39;contract&#39; | &#39;library&#39; | &#39;interface&#39; ) Identifier
                     ( &#39;is&#39; InheritanceSpecifier (&#39;,&#39; InheritanceSpecifier )* )?
                     &#39;{&#39; ContractPart* &#39;}&#39;

ContractPart = StateVariableDeclaration | UsingForDeclaration
             | StructDefinition | ModifierDefinition | FunctionDefinition | EventDefinition | EnumDefinition

InheritanceSpecifier = UserDefinedTypeName ( &#39;(&#39; Expression ( &#39;,&#39; Expression )* &#39;)&#39; )?

StateVariableDeclaration = TypeName ( &#39;public&#39; | &#39;internal&#39; | &#39;private&#39; | &#39;constant&#39; )? Identifier (&#39;=&#39; Expression)? &#39;;&#39;
UsingForDeclaration = &#39;using&#39; Identifier &#39;for&#39; (&#39;*&#39; | TypeName) &#39;;&#39;
StructDefinition = &#39;struct&#39; Identifier &#39;{&#39;
                     ( VariableDeclaration &#39;;&#39; (VariableDeclaration &#39;;&#39;)* )? &#39;}&#39;

ModifierDefinition = &#39;modifier&#39; Identifier ParameterList? Block
ModifierInvocation = Identifier ( &#39;(&#39; ExpressionList? &#39;)&#39; )?

FunctionDefinition = &#39;function&#39; Identifier? ParameterList
                     ( ModifierInvocation | StateMutability | &#39;external&#39; | &#39;public&#39; | &#39;internal&#39; | &#39;private&#39; )*
                     ( &#39;returns&#39; ParameterList )? ( &#39;;&#39; | Block )
EventDefinition = &#39;event&#39; Identifier IndexedParameterList &#39;anonymous&#39;? &#39;;&#39;

EnumValue = Identifier
EnumDefinition = &#39;enum&#39; Identifier &#39;{&#39; EnumValue? (&#39;,&#39; EnumValue)* &#39;}&#39;

IndexedParameterList = &#39;(&#39; ( TypeName &#39;indexed&#39;? Identifier? (&#39;,&#39; TypeName &#39;indexed&#39;? Identifier?)* )? &#39;)&#39;
ParameterList =        &#39;(&#39; ( TypeName            Identifier? (&#39;,&#39; TypeName            Identifier?)* )? &#39;)&#39;
TypeNameList =         &#39;(&#39; ( TypeName (&#39;,&#39; TypeName )* )? &#39;)&#39;

// semantic restriction: mappings and structs (recursively) containing mappings
// are not allowed in argument lists
VariableDeclaration = TypeName StorageLocation? Identifier

TypeName = ElementaryTypeName
         | UserDefinedTypeName
         | Mapping
         | ArrayTypeName
         | FunctionTypeName

UserDefinedTypeName = Identifier ( &#39;.&#39; Identifier )*

Mapping = &#39;mapping&#39; &#39;(&#39; ElementaryTypeName &#39;=&gt;&#39; TypeName &#39;)&#39;
ArrayTypeName = TypeName &#39;[&#39; Expression? &#39;]&#39;
FunctionTypeName = &#39;function&#39; TypeNameList ( &#39;internal&#39; | &#39;external&#39; | StateMutability )*
                   ( &#39;returns&#39; TypeNameList )?
StorageLocation = &#39;memory&#39; | &#39;storage&#39;
StateMutability = &#39;pure&#39; | &#39;constant&#39; | &#39;view&#39; | &#39;payable&#39;

Block = &#39;{&#39; Statement* &#39;}&#39;
Statement = IfStatement | WhileStatement | ForStatement | Block | InlineAssemblyStatement |
            ( DoWhileStatement | PlaceholderStatement | Continue | Break | Return |
              Throw | SimpleStatement ) &#39;;&#39;

ExpressionStatement = Expression
IfStatement = &#39;if&#39; &#39;(&#39; Expression &#39;)&#39; Statement ( &#39;else&#39; Statement )?
WhileStatement = &#39;while&#39; &#39;(&#39; Expression &#39;)&#39; Statement
PlaceholderStatement = &#39;_&#39;
SimpleStatement = VariableDefinition | ExpressionStatement
ForStatement = &#39;for&#39; &#39;(&#39; (SimpleStatement)? &#39;;&#39; (Expression)? &#39;;&#39; (ExpressionStatement)? &#39;)&#39; Statement
InlineAssemblyStatement = &#39;assembly&#39; StringLiteral? InlineAssemblyBlock
DoWhileStatement = &#39;do&#39; Statement &#39;while&#39; &#39;(&#39; Expression &#39;)&#39;
Continue = &#39;continue&#39;
Break = &#39;break&#39;
Return = &#39;return&#39; Expression?
Throw = &#39;throw&#39;
VariableDefinition = (&#39;var&#39; IdentifierList | VariableDeclaration) ( &#39;=&#39; Expression )?
IdentifierList = &#39;(&#39; ( Identifier? &#39;,&#39; )* Identifier? &#39;)&#39;

// Precedence by order (see github.com/ethereum/solidity/pull/732)
Expression
  = Expression (&#39;++&#39; | &#39;--&#39;)
  | NewExpression
  | IndexAccess
  | MemberAccess
  | FunctionCall
  | &#39;(&#39; Expression &#39;)&#39;
  | (&#39;!&#39; | &#39;~&#39; | &#39;delete&#39; | &#39;++&#39; | &#39;--&#39; | &#39;+&#39; | &#39;-&#39;) Expression
  | Expression &#39;**&#39; Expression
  | Expression (&#39;*&#39; | &#39;/&#39; | &#39;%&#39;) Expression
  | Expression (&#39;+&#39; | &#39;-&#39;) Expression
  | Expression (&#39;&lt;&lt;&#39; | &#39;&gt;&gt;&#39;) Expression
  | Expression &#39;&amp;&#39; Expression
  | Expression &#39;^&#39; Expression
  | Expression &#39;|&#39; Expression
  | Expression (&#39;&lt;&#39; | &#39;&gt;&#39; | &#39;&lt;=&#39; | &#39;&gt;=&#39;) Expression
  | Expression (&#39;==&#39; | &#39;!=&#39;) Expression
  | Expression &#39;&amp;&amp;&#39; Expression
  | Expression &#39;||&#39; Expression
  | Expression &#39;?&#39; Expression &#39;:&#39; Expression
  | Expression (&#39;=&#39; | &#39;|=&#39; | &#39;^=&#39; | &#39;&amp;=&#39; | &#39;&lt;&lt;=&#39; | &#39;&gt;&gt;=&#39; | &#39;+=&#39; | &#39;-=&#39; | &#39;*=&#39; | &#39;/=&#39; | &#39;%=&#39;) Expression
  | PrimaryExpression

PrimaryExpression = BooleanLiteral
                  | NumberLiteral
                  | HexLiteral
                  | StringLiteral
                  | TupleExpression
                  | Identifier
                  | ElementaryTypeNameExpression

ExpressionList = Expression ( &#39;,&#39; Expression )*
NameValueList = Identifier &#39;:&#39; Expression ( &#39;,&#39; Identifier &#39;:&#39; Expression )*

FunctionCall = Expression &#39;(&#39; FunctionCallArguments &#39;)&#39;
FunctionCallArguments = &#39;{&#39; NameValueList? &#39;}&#39;
                      | ExpressionList?

NewExpression = &#39;new&#39; TypeName
MemberAccess = Expression &#39;.&#39; Identifier
IndexAccess = Expression &#39;[&#39; Expression? &#39;]&#39;

BooleanLiteral = &#39;true&#39; | &#39;false&#39;
NumberLiteral = ( HexNumber | DecimalNumber ) (&#39; &#39; NumberUnit)?
NumberUnit = &#39;wei&#39; | &#39;szabo&#39; | &#39;finney&#39; | &#39;ether&#39;
           | &#39;seconds&#39; | &#39;minutes&#39; | &#39;hours&#39; | &#39;days&#39; | &#39;weeks&#39; | &#39;years&#39;
HexLiteral = &#39;hex&#39; (&#39;&quot;&#39; ([0-9a-fA-F]{2})* &#39;&quot;&#39; | &#39;\&#39;&#39; ([0-9a-fA-F]{2})* &#39;\&#39;&#39;)
StringLiteral = &#39;&quot;&#39; ([^&quot;\r\n\\] | &#39;\\&#39; .)* &#39;&quot;&#39;
Identifier = [a-zA-Z_$] [a-zA-Z_$0-9]*

HexNumber = &#39;0x&#39; [0-9a-fA-F]+
DecimalNumber = [0-9]+

TupleExpression = &#39;(&#39; ( Expression ( &#39;,&#39; Expression )*  )? &#39;)&#39;
                | &#39;[&#39; ( Expression ( &#39;,&#39; Expression )*  )? &#39;]&#39;

ElementaryTypeNameExpression = ElementaryTypeName

ElementaryTypeName = &#39;address&#39; | &#39;bool&#39; | &#39;string&#39; | &#39;var&#39;
                   | Int | Uint | Byte | Fixed | Ufixed

Int = &#39;int&#39; | &#39;int8&#39; | &#39;int16&#39; | &#39;int24&#39; | &#39;int32&#39; | &#39;int40&#39; | &#39;int48&#39; | &#39;int56&#39; | &#39;int64&#39; | &#39;int72&#39; | &#39;int80&#39; | &#39;int88&#39; | &#39;int96&#39; | &#39;int104&#39; | &#39;int112&#39; | &#39;int120&#39; | &#39;int128&#39; | &#39;int136&#39; | &#39;int144&#39; | &#39;int152&#39; | &#39;int160&#39; | &#39;int168&#39; | &#39;int176&#39; | &#39;int184&#39; | &#39;int192&#39; | &#39;int200&#39; | &#39;int208&#39; | &#39;int216&#39; | &#39;int224&#39; | &#39;int232&#39; | &#39;int240&#39; | &#39;int248&#39; | &#39;int256&#39;

Uint = &#39;uint&#39; | &#39;uint8&#39; | &#39;uint16&#39; | &#39;uint24&#39; | &#39;uint32&#39; | &#39;uint40&#39; | &#39;uint48&#39; | &#39;uint56&#39; | &#39;uint64&#39; | &#39;uint72&#39; | &#39;uint80&#39; | &#39;uint88&#39; | &#39;uint96&#39; | &#39;uint104&#39; | &#39;uint112&#39; | &#39;uint120&#39; | &#39;uint128&#39; | &#39;uint136&#39; | &#39;uint144&#39; | &#39;uint152&#39; | &#39;uint160&#39; | &#39;uint168&#39; | &#39;uint176&#39; | &#39;uint184&#39; | &#39;uint192&#39; | &#39;uint200&#39; | &#39;uint208&#39; | &#39;uint216&#39; | &#39;uint224&#39; | &#39;uint232&#39; | &#39;uint240&#39; | &#39;uint248&#39; | &#39;uint256&#39;

Byte = &#39;byte&#39; | &#39;bytes&#39; | &#39;bytes1&#39; | &#39;bytes2&#39; | &#39;bytes3&#39; | &#39;bytes4&#39; | &#39;bytes5&#39; | &#39;bytes6&#39; | &#39;bytes7&#39; | &#39;bytes8&#39; | &#39;bytes9&#39; | &#39;bytes10&#39; | &#39;bytes11&#39; | &#39;bytes12&#39; | &#39;bytes13&#39; | &#39;bytes14&#39; | &#39;bytes15&#39; | &#39;bytes16&#39; | &#39;bytes17&#39; | &#39;bytes18&#39; | &#39;bytes19&#39; | &#39;bytes20&#39; | &#39;bytes21&#39; | &#39;bytes22&#39; | &#39;bytes23&#39; | &#39;bytes24&#39; | &#39;bytes25&#39; | &#39;bytes26&#39; | &#39;bytes27&#39; | &#39;bytes28&#39; | &#39;bytes29&#39; | &#39;bytes30&#39; | &#39;bytes31&#39; | &#39;bytes32&#39;

Fixed = &#39;fixed&#39; | ( &#39;fixed&#39; DecimalNumber &#39;x&#39; DecimalNumber )

Uixed = &#39;ufixed&#39; | ( &#39;ufixed&#39; DecimalNumber &#39;x&#39; DecimalNumber )

InlineAssemblyBlock = &#39;{&#39; AssemblyItem* &#39;}&#39;

AssemblyItem = Identifier | FunctionalAssemblyExpression | InlineAssemblyBlock | AssemblyLocalBinding | AssemblyAssignment | AssemblyLabel | NumberLiteral | StringLiteral | HexLiteral
AssemblyLocalBinding = &#39;let&#39; Identifier &#39;:=&#39; FunctionalAssemblyExpression
AssemblyAssignment = ( Identifier &#39;:=&#39; FunctionalAssemblyExpression ) | ( &#39;=:&#39; Identifier )
AssemblyLabel = Identifier &#39;:&#39;
FunctionalAssemblyExpression = Identifier &#39;(&#39; AssemblyItem? ( &#39;,&#39; AssemblyItem )* &#39;)&#39;
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-security-considerations"></span><div class="section" id="security-considerations">
<span id="id1"></span><h2>Security Considerations<a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>While it is usually quite easy to build software that works as expected,
it is much harder to check that nobody can use it in a way that was <strong>not</strong> anticipated.</p>
<p>In Solidity, this is even more important because you can use smart contracts
to handle tokens or, possibly, even more valuable things. Furthermore, every
execution of a smart contract happens in public and, in addition to that,
the source code is often available.</p>
<p>Of course you always have to consider how much is at stake:
You can compare a smart contract with a web service that is open to the
public (and thus, also to malicious actors) and perhaps even open source.
If you only store your grocery list on that web service, you might not have
to take too much care, but if you manage your bank account using that web service,
you should be more careful.</p>
<p>This section will list some pitfalls and general security recommendations but
can, of course, never be complete. Also, keep in mind that even if your
smart contract code is bug-free, the compiler or the platform itself might
have a bug. A list of some publicly known security-relevant bugs of the compiler
can be found in the
<a class="reference internal" href="index.html#known-bugs"><span class="std std-ref">list of known bugs</span></a>, which is also machine-readable. Note
that there is a bug bounty program that covers the code generator of the
Solidity compiler.</p>
<p>As always, with open source documentation, please help us extend this section
(especially, some examples would not hurt)!</p>
<div class="section" id="pitfalls">
<h3>Pitfalls<a class="headerlink" href="#pitfalls" title="Permalink to this headline">¶</a></h3>
<div class="section" id="private-information-and-randomness">
<h4>Private Information and Randomness<a class="headerlink" href="#private-information-and-randomness" title="Permalink to this headline">¶</a></h4>
<p>Everything you use in a smart contract is publicly visible, even
local variables and state variables marked <code class="docutils literal"><span class="pre">private</span></code>.</p>
<p>Using random numbers in smart contracts is quite tricky if you do not want
miners to be able to cheat.</p>
</div>
<div class="section" id="re-entrancy">
<h4>Re-Entrancy<a class="headerlink" href="#re-entrancy" title="Permalink to this headline">¶</a></h4>
<p>Any interaction from a contract (A) with another contract (B) and any transfer
of Ether hands over control to that contract (B). This makes it possible for B
to call back into A before this interaction is completed. To give an example,
the following code contains a bug (it is just a snippet and not a
complete contract):</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="nx">Fund</span> <span class="p">{</span>
    <span class="cs">/// Mapping of ether shares of the contract.</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">shares</span><span class="p">;</span>
    <span class="cs">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]))</span>
            <span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The problem is not too serious here because of the limited gas as part
of <code class="docutils literal"><span class="pre">send</span></code>, but it still exposes a weakness: Ether transfer always
includes code execution, so the recipient could be a contract that calls
back into <code class="docutils literal"><span class="pre">withdraw</span></code>. This would let it get multiple refunds and
basically retrieve all the Ether in the contract.</p>
<p>To avoid re-entrancy, you can use the Checks-Effects-Interactions pattern as
outlined further below:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Fund</span> <span class="p">{</span>
    <span class="cs">/// Mapping of ether shares of the contract.</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">shares</span><span class="p">;</span>
    <span class="cs">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">share</span> <span class="o">=</span> <span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">share</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that re-entrancy is not only an effect of Ether transfer but of any
function call on another contract. Furthermore, you also have to take
multi-contract situations into account. A called contract could modify the
state of another contract you depend on.</p>
</div>
<div class="section" id="gas-limit-and-loops">
<h4>Gas Limit and Loops<a class="headerlink" href="#gas-limit-and-loops" title="Permalink to this headline">¶</a></h4>
<p>Loops that do not have a fixed number of iterations, for example, loops that depend on storage values, have to be used carefully:
Due to the block gas limit, transactions can only consume a certain amount of gas. Either explicitly or just due to
normal operation, the number of iterations in a loop can grow beyond the block gas limit which can cause the complete
contract to be stalled at a certain point. This may not apply to <code class="docutils literal"><span class="pre">constant</span></code> functions that are only executed
to read data from the blockchain. Still, such functions may be called by other contracts as part of on-chain operations
and stall those. Please be explicit about such cases in the documentation of your contracts.</p>
</div>
<div class="section" id="sending-and-receiving-ether">
<h4>Sending and Receiving Ether<a class="headerlink" href="#sending-and-receiving-ether" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Neither contracts nor &#8220;external accounts&#8221; are currently able to prevent that someone sends them Ether.
Contracts can react on and reject a regular transfer, but there are ways
to move Ether without creating a message call. One way is to simply &#8220;mine to&#8221;
the contract address and the second way is using <code class="docutils literal"><span class="pre">selfdestruct(x)</span></code>.</li>
<li>If a contract receives Ether (without a function being called), the fallback function is executed.
If it does not have a fallback function, the Ether will be rejected (by throwing an exception).
During the execution of the fallback function, the contract can only rely
on the &#8220;gas stipend&#8221; (2300 gas) being available to it at that time. This stipend is not enough to access storage in any way.
To be sure that your contract can receive Ether in that way, check the gas requirements of the fallback function
(for example in the &#8220;details&#8221; section in Remix).</li>
<li>There is a way to forward more gas to the receiving contract using
<code class="docutils literal"><span class="pre">addr.call.value(x)()</span></code>. This is essentially the same as <code class="docutils literal"><span class="pre">addr.transfer(x)</span></code>,
only that it forwards all remaining gas and opens up the ability for the
recipient to perform more expensive actions (and it only returns a failure code
and does not automatically propagate the error). This might include calling back
into the sending contract or other state changes you might not have thought of.
So it allows for great flexibility for honest users but also for malicious actors.</li>
<li>If you want to send Ether using <code class="docutils literal"><span class="pre">address.transfer</span></code>, there are certain details to be aware of:<ol class="arabic">
<li>If the recipient is a contract, it causes its fallback function to be executed which can, in turn, call back the sending contract.</li>
<li>Sending Ether can fail due to the call depth going above 1024. Since the caller is in total control of the call
depth, they can force the transfer to fail; take this possibility into account or use <code class="docutils literal"><span class="pre">send</span></code> and make sure to always check its return value. Better yet,
write your contract using a pattern where the recipient can withdraw Ether instead.</li>
<li>Sending Ether can also fail because the execution of the recipient contract
requires more than the allotted amount of gas (explicitly by using <code class="docutils literal"><span class="pre">require</span></code>,
<code class="docutils literal"><span class="pre">assert</span></code>, <code class="docutils literal"><span class="pre">revert</span></code>, <code class="docutils literal"><span class="pre">throw</span></code> or
because the operation is just too expensive) - it &#8220;runs out of gas&#8221; (OOG).
If you use <code class="docutils literal"><span class="pre">transfer</span></code> or <code class="docutils literal"><span class="pre">send</span></code> with a return value check, this might provide a
means for the recipient to block progress in the sending contract. Again, the best practice here is to use
a <a class="reference internal" href="index.html#withdrawal-pattern"><span class="std std-ref">&#8220;withdraw&#8221; pattern instead of a &#8220;send&#8221; pattern</span></a>.</li>
</ol>
</li>
</ul>
</div>
<div class="section" id="callstack-depth">
<h4>Callstack Depth<a class="headerlink" href="#callstack-depth" title="Permalink to this headline">¶</a></h4>
<p>External function calls can fail any time because they exceed the maximum
call stack of 1024. In such situations, Solidity throws an exception.
Malicious actors might be able to force the call stack to a high value
before they interact with your contract.</p>
<p>Note that <code class="docutils literal"><span class="pre">.send()</span></code> does <strong>not</strong> throw an exception if the call stack is
depleted but rather returns <code class="docutils literal"><span class="pre">false</span></code> in that case. The low-level functions
<code class="docutils literal"><span class="pre">.call()</span></code>, <code class="docutils literal"><span class="pre">.callcode()</span></code> and <code class="docutils literal"><span class="pre">.delegatecall()</span></code> behave in the same way.</p>
</div>
<div class="section" id="tx-origin">
<h4>tx.origin<a class="headerlink" href="#tx-origin" title="Permalink to this headline">¶</a></h4>
<p>Never use tx.origin for authorization. Let&#8217;s say you have a wallet contract like this:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="nx">TxUserWallet</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">TxUserWallet</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">transferTo</span><span class="p">(</span><span class="kt">address</span> <span class="nx">dest</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="nx">origin</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">);</span>
        <span class="nx">dest</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now someone tricks you into sending ether to the address of this attack wallet:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">interface</span> <span class="nx">TxUserWallet</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">transferTo</span><span class="p">(</span><span class="kt">address</span> <span class="nx">dest</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">TxAttackWallet</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">TxAttackWallet</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">TxUserWallet</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">).</span><span class="nx">transferTo</span><span class="p">(</span><span class="nx">owner</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If your wallet had checked <code class="docutils literal"><span class="pre">msg.sender</span></code> for authorization, it would get the address of the attack wallet, instead of the owner address. But by checking <code class="docutils literal"><span class="pre">tx.origin</span></code>, it gets the original address that kicked off the transaction, which is still the owner address. The attack wallet instantly drains all your funds.</p>
</div>
<div class="section" id="minor-details">
<h4>Minor Details<a class="headerlink" href="#minor-details" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>In <code class="docutils literal"><span class="pre">for</span> <span class="pre">(var</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">arrayName.length;</span> <span class="pre">i++)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>, the type of <code class="docutils literal"><span class="pre">i</span></code> will be <code class="docutils literal"><span class="pre">uint8</span></code>, because this is the smallest type that is required to hold the value <code class="docutils literal"><span class="pre">0</span></code>. If the array has more than 255 elements, the loop will not terminate.</li>
<li>The <code class="docutils literal"><span class="pre">constant</span></code> keyword for functions is currently not enforced by the compiler.
Furthermore, it is not enforced by the EVM, so a contract function that &#8220;claims&#8221;
to be constant might still cause changes to the state.</li>
<li>Types that do not occupy the full 32 bytes might contain &#8220;dirty higher order bits&#8221;.
This is especially important if you access <code class="docutils literal"><span class="pre">msg.data</span></code> - it poses a malleability risk:
You can craft transactions that call a function <code class="docutils literal"><span class="pre">f(uint8</span> <span class="pre">x)</span></code> with a raw byte argument
of <code class="docutils literal"><span class="pre">0xff000001</span></code> and with <code class="docutils literal"><span class="pre">0x00000001</span></code>. Both are fed to the contract and both will
look like the number <code class="docutils literal"><span class="pre">1</span></code> as far as <code class="docutils literal"><span class="pre">x</span></code> is concerned, but <code class="docutils literal"><span class="pre">msg.data</span></code> will
be different, so if you use <code class="docutils literal"><span class="pre">keccak256(msg.data)</span></code> for anything, you will get different results.</li>
</ul>
</div>
</div>
<div class="section" id="recommendations">
<h3>Recommendations<a class="headerlink" href="#recommendations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="restrict-the-amount-of-ether">
<h4>Restrict the Amount of Ether<a class="headerlink" href="#restrict-the-amount-of-ether" title="Permalink to this headline">¶</a></h4>
<p>Restrict the amount of Ether (or other tokens) that can be stored in a smart
contract. If your source code, the compiler or the platform has a bug, these
funds may be lost. If you want to limit your loss, limit the amount of Ether.</p>
</div>
<div class="section" id="keep-it-small-and-modular">
<h4>Keep it Small and Modular<a class="headerlink" href="#keep-it-small-and-modular" title="Permalink to this headline">¶</a></h4>
<p>Keep your contracts small and easily understandable. Single out unrelated
functionality in other contracts or into libraries. General recommendations
about source code quality of course apply: Limit the amount of local variables,
the length of functions and so on. Document your functions so that others
can see what your intention was and whether it is different than what the code does.</p>
</div>
<div class="section" id="use-the-checks-effects-interactions-pattern">
<h4>Use the Checks-Effects-Interactions Pattern<a class="headerlink" href="#use-the-checks-effects-interactions-pattern" title="Permalink to this headline">¶</a></h4>
<p>Most functions will first perform some checks (who called the function,
are the arguments in range, did they send enough Ether, does the person
have tokens, etc.). These checks should be done first.</p>
<p>As the second step, if all checks passed, effects to the state variables
of the current contract should be made. Interaction with other contracts
should be the very last step in any function.</p>
<p>Early contracts delayed some effects and waited for external function
calls to return in a non-error state. This is often a serious mistake
because of the re-entrancy problem explained above.</p>
<p>Note that, also, calls to known contracts might in turn cause calls to
unknown contracts, so it is probably better to just always apply this pattern.</p>
</div>
<div class="section" id="include-a-fail-safe-mode">
<h4>Include a Fail-Safe Mode<a class="headerlink" href="#include-a-fail-safe-mode" title="Permalink to this headline">¶</a></h4>
<p>While making your system fully decentralised will remove any intermediary,
it might be a good idea, especially for new code, to include some kind
of fail-safe mechanism:</p>
<p>You can add a function in your smart contract that performs some
self-checks like &#8220;Has any Ether leaked?&#8221;,
&#8220;Is the sum of the tokens equal to the balance of the contract?&#8221; or similar things.
Keep in mind that you cannot use too much gas for that, so help through off-chain
computations might be needed there.</p>
<p>If the self-check fails, the contract automatically switches into some kind
of &#8220;failsafe&#8221; mode, which, for example, disables most of the features, hands over
control to a fixed and trusted third party or just converts the contract into
a simple &#8220;give me back my money&#8221; contract.</p>
</div>
</div>
<div class="section" id="formal-verification">
<h3>Formal Verification<a class="headerlink" href="#formal-verification" title="Permalink to this headline">¶</a></h3>
<p>Using formal verification, it is possible to perform an automated mathematical
proof that your source code fulfills a certain formal specification.
The specification is still formal (just as the source code), but usually much
simpler.</p>
<p>Note that formal verification itself can only help you understand the
difference between what you did (the specification) and how you did it
(the actual implementation). You still need to check whether the specification
is what you wanted and that you did not miss any unintended effects of it.</p>
</div>
</div>
<span id="document-using-the-compiler"></span><div class="section" id="using-the-compiler">
<h2>Using the compiler<a class="headerlink" href="#using-the-compiler" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-the-commandline-compiler">
<span id="commandline-compiler"></span><span id="index-0"></span><h3>Using the Commandline Compiler<a class="headerlink" href="#using-the-commandline-compiler" title="Permalink to this headline">¶</a></h3>
<p>One of the build targets of the Solidity repository is <code class="docutils literal"><span class="pre">solc</span></code>, the solidity commandline compiler.
Using <code class="docutils literal"><span class="pre">solc</span> <span class="pre">--help</span></code> provides you with an explanation of all options. The compiler can produce various outputs, ranging from simple binaries and assembly over an abstract syntax tree (parse tree) to estimations of gas usage.
If you only want to compile a single file, you run it as <code class="docutils literal"><span class="pre">solc</span> <span class="pre">--bin</span> <span class="pre">sourceFile.sol</span></code> and it will print the binary. Before you deploy your contract, activate the optimizer while compiling using <code class="docutils literal"><span class="pre">solc</span> <span class="pre">--optimize</span> <span class="pre">--bin</span> <span class="pre">sourceFile.sol</span></code>. If you want to get some of the more advanced output variants of <code class="docutils literal"><span class="pre">solc</span></code>, it is probably better to tell it to output everything to separate files using <code class="docutils literal"><span class="pre">solc</span> <span class="pre">-o</span> <span class="pre">outputDirectory</span> <span class="pre">--bin</span> <span class="pre">--ast</span> <span class="pre">--asm</span> <span class="pre">sourceFile.sol</span></code>.</p>
<p>The commandline compiler will automatically read imported files from the filesystem, but
it is also possible to provide path redirects using <code class="docutils literal"><span class="pre">prefix=path</span></code> in the following way:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">solc</span> <span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">ethereum</span><span class="o">/</span><span class="nx">dapp</span><span class="o">-</span><span class="nx">bin</span><span class="o">/=</span><span class="err">/usr/local/lib/dapp-bin/ =/usr/local/lib/fallback file.sol</span>
</pre></div>
</div>
<p>This essentially instructs the compiler to search for anything starting with
<code class="docutils literal"><span class="pre">github.com/ethereum/dapp-bin/</span></code> under <code class="docutils literal"><span class="pre">/usr/local/lib/dapp-bin</span></code> and if it does not
find the file there, it will look at <code class="docutils literal"><span class="pre">/usr/local/lib/fallback</span></code> (the empty prefix
always matches). <code class="docutils literal"><span class="pre">solc</span></code> will not read files from the filesystem that lie outside of
the remapping targets and outside of the directories where explicitly specified source
files reside, so things like <code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;/etc/passwd&quot;;</span></code> only work if you add <code class="docutils literal"><span class="pre">=/</span></code> as a remapping.</p>
<p>If there are multiple matches due to remappings, the one with the longest common prefix is selected.</p>
<p>For security reasons the compiler has restrictions what directories it can access. Paths (and their subdirectories) of source files specified on the commandline and paths defined by remappings are allowed for import statements, but everything else is rejected. Additional paths (and their subdirectories) can be allowed via the <code class="docutils literal"><span class="pre">--allow-paths</span> <span class="pre">/sample/path,/another/sample/path</span></code> switch.</p>
<p>If your contracts use <a class="reference internal" href="index.html#libraries"><span class="std std-ref">libraries</span></a>, you will notice that the bytecode contains substrings of the form <code class="docutils literal"><span class="pre">__LibraryName______</span></code>. You can use <code class="docutils literal"><span class="pre">solc</span></code> as a linker meaning that it will insert the library addresses for you at those points:</p>
<p>Either add <code class="docutils literal"><span class="pre">--libraries</span> <span class="pre">&quot;Math:0x12345678901234567890</span> <span class="pre">Heap:0xabcdef0123456&quot;</span></code> to your command to provide an address for each library or store the string in a file (one library per line) and run <code class="docutils literal"><span class="pre">solc</span></code> using <code class="docutils literal"><span class="pre">--libraries</span> <span class="pre">fileName</span></code>.</p>
<p>If <code class="docutils literal"><span class="pre">solc</span></code> is called with the option <code class="docutils literal"><span class="pre">--link</span></code>, all input files are interpreted to be unlinked binaries (hex-encoded) in the <code class="docutils literal"><span class="pre">__LibraryName____</span></code>-format given above and are linked in-place (if the input is read from stdin, it is written to stdout). All options except <code class="docutils literal"><span class="pre">--libraries</span></code> are ignored (including <code class="docutils literal"><span class="pre">-o</span></code>) in this case.</p>
<p>If <code class="docutils literal"><span class="pre">solc</span></code> is called with the option <code class="docutils literal"><span class="pre">--standard-json</span></code>, it will expect a JSON input (as explained below) on the standard input, and return a JSON output on the standard output.</p>
</div>
<div class="section" id="compiler-input-and-output-json-description">
<span id="compiler-api"></span><h3>Compiler Input and Output JSON Description<a class="headerlink" href="#compiler-input-and-output-json-description" title="Permalink to this headline">¶</a></h3>
<p>These JSON formats are used by the compiler API as well as are available through <code class="docutils literal"><span class="pre">solc</span></code>. These are subject to change,
some fields are optional (as noted), but it is aimed at to only make backwards compatible changes.</p>
<p>The compiler API expects a JSON formatted input and outputs the compilation result in a JSON formatted output.</p>
<p>Comments are of course not permitted and used here only for explanatory purposes.</p>
<div class="section" id="input-description">
<h4>Input Description<a class="headerlink" href="#input-description" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none"><div class="highlight"><pre><span></span>{
  // Required: Source code language, such as &quot;Solidity&quot;, &quot;serpent&quot;, &quot;lll&quot;, &quot;assembly&quot;, etc.
  language: &quot;Solidity&quot;,
  // Required
  sources:
  {
    // The keys here are the &quot;global&quot; names of the source files,
    // imports can use other files via remappings (see below).
    &quot;myFile.sol&quot;:
    {
      // Optional: keccak256 hash of the source file
      // It is used to verify the retrieved content if imported via URLs.
      &quot;keccak256&quot;: &quot;0x123...&quot;,
      // Required (unless &quot;content&quot; is used, see below): URL(s) to the source file.
      // URL(s) should be imported in this order and the result checked against the
      // keccak256 hash (if available). If the hash doesn&#39;t match or none of the
      // URL(s) result in success, an error should be raised.
      &quot;urls&quot;:
      [
        &quot;bzzr://56ab...&quot;,
        &quot;ipfs://Qma...&quot;,
        &quot;file:///tmp/path/to/file.sol&quot;
      ]
    },
    &quot;mortal&quot;:
    {
      // Optional: keccak256 hash of the source file
      &quot;keccak256&quot;: &quot;0x234...&quot;,
      // Required (unless &quot;urls&quot; is used): literal contents of the source file
      &quot;content&quot;: &quot;contract mortal is owned { function kill() { if (msg.sender == owner) selfdestruct(owner); } }&quot;
    }
  },
  // Optional
  settings:
  {
    // Optional: Sorted list of remappings
    remappings: [ &quot;:g/dir&quot; ],
    // Optional: Optimizer settings (enabled defaults to false)
    optimizer: {
      enabled: true,
      runs: 500
    },
    // Metadata settings (optional)
    metadata: {
      // Use only literal content and not URLs (false by default)
      useLiteralContent: true
    },
    // Addresses of the libraries. If not all libraries are given here, it can result in unlinked objects whose output data is different.
    libraries: {
      // The top level key is the the name of the source file where the library is used.
      // If remappings are used, this source file should match the global path after remappings were applied.
      // If this key is an empty string, that refers to a global level.
      &quot;myFile.sol&quot;: {
        &quot;MyLib&quot;: &quot;0x123123...&quot;
      }
    }
    // The following can be used to select desired outputs.
    // If this field is omitted, then the compiler loads and does type checking, but will not generate any outputs apart from errors.
    // The first level key is the file name and the second is the contract name, where empty contract name refers to the file itself,
    // while the star refers to all of the contracts.
    //
    // The available output types are as follows:
    //   abi - ABI
    //   ast - AST of all source files
    //   legacyAST - legacy AST of all source files
    //   devdoc - Developer documentation (natspec)
    //   userdoc - User documentation (natspec)
    //   metadata - Metadata
    //   ir - New assembly format before desugaring
    //   evm.assembly - New assembly format after desugaring
    //   evm.legacyAssembly - Old-style assembly format in JSON
    //   evm.bytecode.object - Bytecode object
    //   evm.bytecode.opcodes - Opcodes list
    //   evm.bytecode.sourceMap - Source mapping (useful for debugging)
    //   evm.bytecode.linkReferences - Link references (if unlinked object)
    //   evm.deployedBytecode* - Deployed bytecode (has the same options as evm.bytecode)
    //   evm.methodIdentifiers - The list of function hashes
    //   evm.gasEstimates - Function gas estimates
    //   ewasm.wast - eWASM S-expressions format (not supported atm)
    //   ewasm.wasm - eWASM binary format (not supported atm)
    //
    // Note that using a using `evm`, `evm.bytecode`, `ewasm`, etc. will select every
    // target part of that output.
    //
    outputSelection: {
      // Enable the metadata and bytecode outputs of every single contract.
      &quot;*&quot;: {
        &quot;*&quot;: [ &quot;metadata&quot;, &quot;evm.bytecode&quot; ]
      },
      // Enable the abi and opcodes output of MyContract defined in file def.
      &quot;def&quot;: {
        &quot;MyContract&quot;: [ &quot;abi&quot;, &quot;evm.opcodes&quot; ]
      },
      // Enable the source map output of every single contract.
      &quot;*&quot;: {
        &quot;*&quot;: [ &quot;evm.sourceMap&quot; ]
      },
      // Enable the legacy AST output of every single file.
      &quot;*&quot;: {
        &quot;&quot;: [ &quot;legacyAST&quot; ]
      }
    }
  }
}
</pre></div>
</div>
</div>
<div class="section" id="output-description">
<h4>Output Description<a class="headerlink" href="#output-description" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none"><div class="highlight"><pre><span></span>{
  // Optional: not present if no errors/warnings were encountered
  errors: [
    {
      // Optional: Location within the source file.
      sourceLocation: {
        file: &quot;sourceFile.sol&quot;,
        start: 0,
        end: 100
      ],
      // Mandatory: Error type, such as &quot;TypeError&quot;, &quot;InternalCompilerError&quot;, &quot;Exception&quot;, etc
      type: &quot;TypeError&quot;,
      // Mandatory: Component where the error originated, such as &quot;general&quot;, &quot;ewasm&quot;, etc.
      component: &quot;general&quot;,
      // Mandatory (&quot;error&quot; or &quot;warning&quot;)
      severity: &quot;error&quot;,
      // Mandatory
      message: &quot;Invalid keyword&quot;
      // Optional: the message formatted with source location
      formattedMessage: &quot;sourceFile.sol:100: Invalid keyword&quot;
    }
  ],
  // This contains the file-level outputs. In can be limited/filtered by the outputSelection settings.
  sources: {
    &quot;sourceFile.sol&quot;: {
      // Identifier (used in source maps)
      id: 1,
      // The AST object
      ast: {},
      // The legacy AST object
      legacyAST: {}
    }
  },
  // This contains the contract-level outputs. It can be limited/filtered by the outputSelection settings.
  contracts: {
    &quot;sourceFile.sol&quot;: {
      // If the language used has no contract names, this field should equal to an empty string.
      &quot;ContractName&quot;: {
        // The Ethereum Contract ABI. If empty, it is represented as an empty array.
        // See https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI
        abi: [],
        // See the Metadata Output documentation (serialised JSON string)
        metadata: &quot;{...}&quot;,
        // User documentation (natspec)
        userdoc: {},
        // Developer documentation (natspec)
        devdoc: {},
        // Intermediate representation (string)
        ir: &quot;&quot;,
        // EVM-related outputs
        evm: {
          // Assembly (string)
          assembly: &quot;&quot;,
          // Old-style assembly (object)
          legacyAssembly: {},
          // Bytecode and related details.
          bytecode: {
            // The bytecode as a hex string.
            object: &quot;00fe&quot;,
            // Opcodes list (string)
            opcodes: &quot;&quot;,
            // The source mapping as a string. See the source mapping definition.
            sourceMap: &quot;&quot;,
            // If given, this is an unlinked object.
            linkReferences: {
              &quot;libraryFile.sol&quot;: {
                // Byte offsets into the bytecode. Linking replaces the 20 bytes located there.
                &quot;Library1&quot;: [
                  { start: 0, length: 20 },
                  { start: 200, length: 20 }
                ]
              }
            }
          },
          // The same layout as above.
          deployedBytecode: { },
          // The list of function hashes
          methodIdentifiers: {
            &quot;delegate(address)&quot;: &quot;5c19a95c&quot;
          },
          // Function gas estimates
          gasEstimates: {
            creation: {
              codeDepositCost: &quot;420000&quot;,
              executionCost: &quot;infinite&quot;,
              totalCost: &quot;infinite&quot;
            },
            external: {
              &quot;delegate(address)&quot;: &quot;25000&quot;
            },
            internal: {
              &quot;heavyLifting()&quot;: &quot;infinite&quot;
            }
          }
        },
        // eWASM related outputs
        ewasm: {
          // S-expressions format
          wast: &quot;&quot;,
          // Binary format (hex string)
          wasm: &quot;&quot;
        }
      }
    }
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-abi-spec"></span><div class="section" id="application-binary-interface-specification">
<span id="abi"></span><span id="index-0"></span><h2>Application Binary Interface Specification<a class="headerlink" href="#application-binary-interface-specification" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-design">
<h3>Basic Design<a class="headerlink" href="#basic-design" title="Permalink to this headline">¶</a></h3>
<p>The Application Binary Interface is the standard way to interact with contracts in the Ethereum ecosystem, both
from outside the blockchain and for contract-to-contract interaction. Data is encoded according to its type,
as described in this specification.  The encoding is not self describing and thus requires a schema in order to decode.</p>
<p>We assume the interface functions of a contract are strongly typed, known at compilation time and static. No introspection mechanism will be provided. We assume that all contracts will have the interface definitions of any contracts they call available at compile-time.</p>
<p>This specification does not address contracts whose interface is dynamic or otherwise known only at run-time. Should these cases become important they can be adequately handled as facilities built within the Ethereum ecosystem.</p>
</div>
<div class="section" id="function-selector">
<h3>Function Selector<a class="headerlink" href="#function-selector" title="Permalink to this headline">¶</a></h3>
<p>The first four bytes of the call data for a function call specifies the function to be called. It is the
first (left, high-order in big-endian) four bytes of the Keccak (SHA-3) hash of the signature of the function. The signature is defined as the canonical expression of the basic prototype, i.e.
the function name with the parenthesised list of parameter types. Parameter types are split by a single comma - no spaces are used.</p>
</div>
<div class="section" id="argument-encoding">
<h3>Argument Encoding<a class="headerlink" href="#argument-encoding" title="Permalink to this headline">¶</a></h3>
<p>Starting from the fifth byte, the encoded arguments follow. This encoding is also used in other places, e.g. the return values and also event arguments are encoded in the same way, without the four bytes specifying the function.</p>
</div>
<div class="section" id="types">
<h3>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h3>
<p>The following elementary types exist:</p>
<ul class="simple">
<li><cite>uint&lt;M&gt;</cite>: unsigned integer type of <cite>M</cite> bits, <cite>0 &lt; M &lt;= 256</cite>, <cite>M % 8 == 0</cite>. e.g. <cite>uint32</cite>, <cite>uint8</cite>, <cite>uint256</cite>.</li>
<li><cite>int&lt;M&gt;</cite>: two&#8217;s complement signed integer type of <cite>M</cite> bits, <cite>0 &lt; M &lt;= 256</cite>, <cite>M % 8 == 0</cite>.</li>
<li><cite>address</cite>: equivalent to <cite>uint160</cite>, except for the assumed interpretation and language typing.</li>
<li><cite>uint</cite>, <cite>int</cite>: synonyms for <cite>uint256</cite>, <cite>int256</cite> respectively (not to be used for computing the function selector).</li>
<li><cite>bool</cite>: equivalent to <cite>uint8</cite> restricted to the values 0 and 1</li>
<li><cite>fixed&lt;M&gt;x&lt;N&gt;</cite>: signed fixed-point decimal number of <cite>M</cite> bits, <cite>8 &lt;= M &lt;= 256</cite>, <cite>M % 8 ==0</cite>, and <cite>0 &lt; N &lt;= 80</cite>, which denotes the value <cite>v</cite> as <cite>v / (10 ** N)</cite>.</li>
<li><cite>ufixed&lt;M&gt;x&lt;N&gt;</cite>: unsigned variant of <cite>fixed&lt;M&gt;x&lt;N&gt;</cite>.</li>
<li><cite>fixed</cite>, <cite>ufixed</cite>: synonyms for <cite>fixed128x19</cite>, <cite>ufixed128x19</cite> respectively (not to be used for computing the function selector).</li>
<li><cite>bytes&lt;M&gt;</cite>: binary type of <cite>M</cite> bytes, <cite>0 &lt; M &lt;= 32</cite>.</li>
<li><cite>function</cite>: equivalent to <cite>bytes24</cite>: an address, followed by a function selector</li>
</ul>
<p>The following (fixed-size) array type exists:</p>
<ul class="simple">
<li><cite>&lt;type&gt;[M]</cite>: a fixed-length array of the given fixed-length type.</li>
</ul>
<p>The following non-fixed-size types exist:</p>
<ul class="simple">
<li><cite>bytes</cite>: dynamic sized byte sequence.</li>
<li><cite>string</cite>: dynamic sized unicode string assumed to be UTF-8 encoded.</li>
<li><cite>&lt;type&gt;[]</cite>: a variable-length array of the given fixed-length type.</li>
</ul>
<p>Types can be combined to anonymous structs by enclosing a finite non-negative number
of them inside parentheses, separated by commas:</p>
<ul class="simple">
<li><cite>(T1,T2,...,Tn)</cite>: anonymous struct (ordered tuple) consisting of the types <cite>T1</cite>, ..., <cite>Tn</cite>, <cite>n &gt;= 0</cite></li>
</ul>
<p>It is possible to form structs of structs, arrays of structs and so on.</p>
</div>
<div class="section" id="formal-specification-of-the-encoding">
<h3>Formal Specification of the Encoding<a class="headerlink" href="#formal-specification-of-the-encoding" title="Permalink to this headline">¶</a></h3>
<p>We will now formally specify the encoding, such that it will have the following
properties, which are especially useful if some arguments are nested arrays:</p>
<p>Properties:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The number of reads necessary to access a value is at most the depth of the value inside the argument array structure, i.e. four reads are needed to retrieve <cite>a_i[k][l][r]</cite>. In a previous version of the ABI, the number of reads scaled linearly with the total number of dynamic parameters in the worst case.</li>
<li>The data of a variable or array element is not interleaved with other data and it is relocatable, i.e. it only uses relative &#8220;addresses&#8221;</li>
</ol>
</div></blockquote>
<p>We distinguish static and dynamic types. Static types are encoded in-place and dynamic types are encoded at a separately allocated location after the current block.</p>
<p><strong>Definition:</strong> The following types are called &#8220;dynamic&#8221;:
* <cite>bytes</cite>
* <cite>string</cite>
* <cite>T[]</cite> for any <cite>T</cite>
* <cite>T[k]</cite> for any dynamic <cite>T</cite> and any <cite>k &gt; 0</cite>
* <cite>(T1,...,Tk)</cite> if any <cite>Ti</cite> is dynamic for <cite>1 &lt;= i &lt;= k</cite></p>
<p>All other types are called &#8220;static&#8221;.</p>
<p><strong>Definition:</strong> <cite>len(a)</cite> is the number of bytes in a binary string <cite>a</cite>.
The type of <cite>len(a)</cite> is assumed to be <cite>uint256</cite>.</p>
<p>We define <cite>enc</cite>, the actual encoding, as a mapping of values of the ABI types to binary strings such
that <cite>len(enc(X))</cite> depends on the value of <cite>X</cite> if and only if the type of <cite>X</cite> is dynamic.</p>
<p><strong>Definition:</strong> For any ABI value <cite>X</cite>, we recursively define <cite>enc(X)</cite>, depending
on the type of <cite>X</cite> being</p>
<ul>
<li><p class="first"><cite>(T1,...,Tk)</cite> for <cite>k &gt;= 0</cite> and any types <cite>T1</cite>, ..., <cite>Tk</cite></p>
<p><cite>enc(X) = head(X(1)) ... head(X(k-1)) tail(X(0)) ... tail(X(k-1))</cite></p>
<p>where <cite>X(i)</cite> is the <cite>ith</cite> component of the value, and
<cite>head</cite> and <cite>tail</cite> are defined for <cite>Ti</cite> being a static type as</p>
<blockquote>
<div><p><cite>head(X(i)) = enc(X(i))</cite> and <cite>tail(X(i)) = &#8220;&#8221;</cite> (the empty string)</p>
</div></blockquote>
<p>and as</p>
<blockquote>
<div><p><cite>head(X(i)) = enc(len(head(X(0)) ... head(X(k-1)) tail(X(0)) ... tail(X(i-1))))</cite>
<cite>tail(X(i)) = enc(X(i))</cite></p>
</div></blockquote>
<p>otherwise, i.e. if <cite>Ti</cite> is a dynamic type.</p>
<p>Note that in the dynamic case, <cite>head(X(i))</cite> is well-defined since the lengths of
the head parts only depend on the types and not the values. Its value is the offset
of the beginning of <cite>tail(X(i))</cite> relative to the start of <cite>enc(X)</cite>.</p>
</li>
<li><p class="first"><cite>T[k]</cite> for any <cite>T</cite> and <cite>k</cite>:</p>
<p><cite>enc(X) = enc((X[0], ..., X[k-1]))</cite></p>
<p>i.e. it is encoded as if it were an anonymous struct with <cite>k</cite> elements
of the same type.</p>
</li>
<li><p class="first"><cite>T[]</cite> where <cite>X</cite> has <cite>k</cite> elements (<cite>k</cite> is assumed to be of type <cite>uint256</cite>):</p>
<p><cite>enc(X) = enc(k) enc([X[1], ..., X[k]])</cite></p>
<p>i.e. it is encoded as if it were an array of static size <cite>k</cite>, prefixed with
the number of elements.</p>
</li>
<li><p class="first"><cite>bytes</cite>, of length <cite>k</cite> (which is assumed to be of type <cite>uint256</cite>):</p>
<dl class="docutils">
<dt><cite>enc(X) = enc(k) pad_right(X)</cite>, i.e. the number of bytes is encoded as a</dt>
<dd><p class="first last"><cite>uint256</cite> followed by the actual value of <cite>X</cite> as a byte sequence, followed by
the minimum number of zero-bytes such that <cite>len(enc(X))</cite> is a multiple of 32.</p>
</dd>
</dl>
</li>
<li><p class="first"><cite>string</cite>:</p>
<p><cite>enc(X) = enc(enc_utf8(X))</cite>, i.e. <cite>X</cite> is utf-8 encoded and this value is interpreted as of <cite>bytes</cite> type and encoded further. Note that the length used in this subsequent encoding is the number of bytes of the utf-8 encoded string, not its number of characters.</p>
</li>
<li><p class="first"><cite>uint&lt;M&gt;</cite>: <cite>enc(X)</cite> is the big-endian encoding of <cite>X</cite>, padded on the higher-order (left) side with zero-bytes such that the length is a multiple of 32 bytes.</p>
</li>
<li><p class="first"><cite>address</cite>: as in the <cite>uint160</cite> case</p>
</li>
<li><p class="first"><cite>int&lt;M&gt;</cite>: <cite>enc(X)</cite> is the big-endian two&#8217;s complement encoding of <cite>X</cite>, padded on the higher-oder (left) side with <cite>0xff</cite> for negative <cite>X</cite> and with zero bytes for positive <cite>X</cite> such that the length is a multiple of 32 bytes.</p>
</li>
<li><p class="first"><cite>bool</cite>: as in the <cite>uint8</cite> case, where <cite>1</cite> is used for <cite>true</cite> and <cite>0</cite> for <cite>false</cite></p>
</li>
<li><p class="first"><cite>fixed&lt;M&gt;x&lt;N&gt;</cite>: <cite>enc(X)</cite> is <cite>enc(X * 10**N)</cite> where <cite>X * 10**N</cite> is interpreted as a <cite>int256</cite>.</p>
</li>
<li><p class="first"><cite>fixed</cite>: as in the <cite>fixed128x19</cite> case</p>
</li>
<li><p class="first"><cite>ufixed&lt;M&gt;x&lt;N&gt;</cite>: <cite>enc(X)</cite> is <cite>enc(X * 10**N)</cite> where <cite>X * 10**N</cite> is interpreted as a <cite>uint256</cite>.</p>
</li>
<li><p class="first"><cite>ufixed</cite>: as in the <cite>ufixed128x19</cite> case</p>
</li>
<li><p class="first"><cite>bytes&lt;M&gt;</cite>: <cite>enc(X)</cite> is the sequence of bytes in <cite>X</cite> padded with zero-bytes to a length of 32.</p>
</li>
</ul>
<p>Note that for any <cite>X</cite>, <cite>len(enc(X))</cite> is a multiple of 32.</p>
</div>
<div class="section" id="function-selector-and-argument-encoding">
<h3>Function Selector and Argument Encoding<a class="headerlink" href="#function-selector-and-argument-encoding" title="Permalink to this headline">¶</a></h3>
<p>All in all, a call to the function <cite>f</cite> with parameters <cite>a_1, ..., a_n</cite> is encoded as</p>
<blockquote>
<div><cite>function_selector(f) enc((a_1, ..., a_n))</cite></div></blockquote>
<p>and the return values <cite>v_1, ..., v_k</cite> of <cite>f</cite> are encoded as</p>
<blockquote>
<div><cite>enc((v_1, ..., v_k))</cite></div></blockquote>
<p>i.e. the values are combined into an anonymous struct and encoded.</p>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>Given the contract:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Foo</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">bar</span><span class="p">(</span><span class="kt">bytes3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="nx">xy</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kd">function</span> <span class="nx">baz</span><span class="p">(</span><span class="kt">uint32</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">y</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">32</span> <span class="o">||</span> <span class="nx">y</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">sam</span><span class="p">(</span><span class="kt">bytes</span> <span class="nx">name</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">z</span><span class="p">,</span> <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Thus for our <cite>Foo</cite> example if we wanted to call <cite>baz</cite> with the parameters <cite>69</cite> and <cite>true</cite>, we would pass 68 bytes total, which can be broken down into:</p>
<ul class="simple">
<li><cite>0xcdcd77c0</cite>: the Method ID. This is derived as the first 4 bytes of the Keccak hash of the ASCII form of the signature <cite>baz(uint32,bool)</cite>.</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000045</cite>: the first parameter, a uint32 value <cite>69</cite> padded to 32 bytes</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000001</cite>: the second parameter - boolean <cite>true</cite>, padded to 32 bytes</li>
</ul>
<p>In total:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0xcdcd77c000000000000000000000000000000000000000000000000000000000000000450000000000000000000000000000000000000000000000000000000000000001</span>
</pre></div>
</div>
<p>It returns a single <cite>bool</cite>. If, for example, it were to return <cite>false</cite>, its output would be the single byte array <cite>0x0000000000000000000000000000000000000000000000000000000000000000</cite>, a single bool.</p>
<p>If we wanted to call <cite>bar</cite> with the argument <cite>[&#8220;abc&#8221;, &#8220;def&#8221;]</cite>, we would pass 68 bytes total, broken down into:</p>
<ul class="simple">
<li><cite>0xfce353f6</cite>: the Method ID. This is derived from the signature <cite>bar(bytes3[2])</cite>.</li>
<li><cite>0x6162630000000000000000000000000000000000000000000000000000000000</cite>: the first part of the first parameter, a <cite>bytes3</cite> value <cite>&#8220;abc&#8221;</cite> (left-aligned).</li>
<li><cite>0x6465660000000000000000000000000000000000000000000000000000000000</cite>: the second part of the first parameter, a <cite>bytes3</cite> value <cite>&#8220;def&#8221;</cite> (left-aligned).</li>
</ul>
<p>In total:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0xfce353f661626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000</span>
</pre></div>
</div>
<p>If we wanted to call <cite>sam</cite> with the arguments <cite>&#8220;dave&#8221;</cite>, <cite>true</cite> and <cite>[1,2,3]</cite>, we would pass 292 bytes total, broken down into:</p>
<ul class="simple">
<li><cite>0xa5643bf2</cite>: the Method ID. This is derived from the signature <cite>sam(bytes,bool,uint256[])</cite>. Note that <cite>uint</cite> is replaced with its canonical representation <cite>uint256</cite>.</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000060</cite>: the location of the data part of the first parameter (dynamic type), measured in bytes from the start of the arguments block. In this case, <cite>0x60</cite>.</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000001</cite>: the second parameter: boolean true.</li>
<li><cite>0x00000000000000000000000000000000000000000000000000000000000000a0</cite>: the location of the data part of the third parameter (dynamic type), measured in bytes. In this case, <cite>0xa0</cite>.</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000004</cite>: the data part of the first argument, it starts with the length of the byte array in elements, in this case, 4.</li>
<li><cite>0x6461766500000000000000000000000000000000000000000000000000000000</cite>: the contents of the first argument: the UTF-8 (equal to ASCII in this case) encoding of <cite>&#8220;dave&#8221;</cite>, padded on the right to 32 bytes.</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000003</cite>: the data part of the third argument, it starts with the length of the array in elements, in this case, 3.</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000001</cite>: the first entry of the third parameter.</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000002</cite>: the second entry of the third parameter.</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000003</cite>: the third entry of the third parameter.</li>
</ul>
<p>In total:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0xa5643bf20000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000464617665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003</span>
</pre></div>
</div>
</div>
<div class="section" id="use-of-dynamic-types">
<h3>Use of Dynamic Types<a class="headerlink" href="#use-of-dynamic-types" title="Permalink to this headline">¶</a></h3>
<p>A call to a function with the signature <cite>f(uint,uint32[],bytes10,bytes)</cite> with values <cite>(0x123, [0x456, 0x789], &#8220;1234567890&#8221;, &#8220;Hello, world!&#8221;)</cite> is encoded in the following way:</p>
<p>We take the first four bytes of <cite>sha3(&#8220;f(uint256,uint32[],bytes10,bytes)&#8221;)</cite>, i.e. <cite>0x8be65246</cite>.
Then we encode the head parts of all four arguments. For the static types <cite>uint256</cite> and <cite>bytes10</cite>, these are directly the values we want to pass, whereas for the dynamic types <cite>uint32[]</cite> and <cite>bytes</cite>, we use the offset in bytes to the start of their data area, measured from the start of the value encoding (i.e. not counting the first four bytes containing the hash of the function signature). These are:</p>
<blockquote>
<div><ul class="simple">
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000123</cite> (<cite>0x123</cite> padded to 32 bytes)</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000080</cite> (offset to start of data part of second parameter, 4*32 bytes, exactly the size of the head part)</li>
<li><cite>0x3132333435363738393000000000000000000000000000000000000000000000</cite> (<cite>&#8220;1234567890&#8221;</cite> padded to 32 bytes on the right)</li>
<li><cite>0x00000000000000000000000000000000000000000000000000000000000000e0</cite> (offset to start of data part of fourth parameter = offset to start of data part of first dynamic parameter + size of data part of first dynamic parameter = 4*32 + 3*32 (see below))</li>
</ul>
</div></blockquote>
<p>After this, the data part of the first dynamic argument, <cite>[0x456, 0x789]</cite> follows:</p>
<blockquote>
<div><ul class="simple">
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000002</cite> (number of elements of the array, 2)</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000456</cite> (first element)</li>
<li><cite>0x0000000000000000000000000000000000000000000000000000000000000789</cite> (second element)</li>
</ul>
</div></blockquote>
<p>Finally, we encode the data part of the second dynamic argument, <cite>&#8220;Hello, world!&#8221;</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><cite>0x000000000000000000000000000000000000000000000000000000000000000d</cite> (number of elements (bytes in this case): 13)</li>
<li><cite>0x48656c6c6f2c20776f726c642100000000000000000000000000000000000000</cite> (<cite>&#8220;Hello, world!&#8221;</cite> padded to 32 bytes on the right)</li>
</ul>
</div></blockquote>
<p>All together, the encoding is (newline after function selector and each 32-bytes for clarity):</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0x8be65246</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000123</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000080</span>
  <span class="mi">3132333435363738393000000000000000000000000000000000000000000000</span>
  <span class="mi">00000000000000000000000000000000000000000000000000000000000000</span><span class="nx">e0</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000002</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000456</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000789</span>
  <span class="mi">000000000000000000000000000000000000000000000000000000000000000</span><span class="nx">d</span>
  <span class="mi">48656</span><span class="nx">c6c6f2c20776f726c642100000000000000000000000000000000000000</span>
</pre></div>
</div>
</div>
<div class="section" id="events">
<h3>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<p>Events are an abstraction of the Ethereum logging/event-watching protocol. Log entries provide the contract&#8217;s address, a series of up to four topics and some arbitrary length binary data. Events leverage the existing function ABI in order to interpret this (together with an interface spec) as a properly typed structure.</p>
<p>Given an event name and series of event parameters, we split them into two sub-series: those which are indexed and those which are not. Those which are indexed, which may number up to 3, are used alongside the Keccak hash of the event signature to form the topics of the log entry. Those which as not indexed form the byte array of the event.</p>
<p>In effect, a log entry using this ABI is described as:</p>
<ul class="simple">
<li><cite>address</cite>: the address of the contract (intrinsically provided by Ethereum);</li>
<li><cite>topics[0]</cite>: <cite>keccak(EVENT_NAME+&#8221;(&#8220;+EVENT_ARGS.map(canonical_type_of).join(&#8221;,&#8221;)+&#8221;)&#8221;)</cite> (<cite>canonical_type_of</cite> is a function that simply returns the canonical type of a given argument, e.g. for <cite>uint indexed foo</cite>, it would return <cite>uint256</cite>). If the event is declared as <cite>anonymous</cite> the <cite>topics[0]</cite> is not generated;</li>
<li><cite>topics[n]</cite>: <cite>EVENT_INDEXED_ARGS[n - 1]</cite> (<cite>EVENT_INDEXED_ARGS</cite> is the series of <cite>EVENT_ARGS</cite> that are indexed);</li>
<li><cite>data</cite>: <cite>abi_serialise(EVENT_NON_INDEXED_ARGS)</cite> (<cite>EVENT_NON_INDEXED_ARGS</cite> is the series of <cite>EVENT_ARGS</cite> that are not indexed, <cite>abi_serialise</cite> is the ABI serialisation function used for returning a series of typed values from a function, as described above).</li>
</ul>
</div>
<div class="section" id="json">
<h3>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h3>
<p>The JSON format for a contract&#8217;s interface is given by an array of function and/or event descriptions. A function description is a JSON object with the fields:</p>
<ul class="simple">
<li><cite>type</cite>: <cite>&#8220;function&#8221;</cite>, <cite>&#8220;constructor&#8221;</cite>, or <cite>&#8220;fallback&#8221;</cite> (the <a class="reference internal" href="index.html#fallback-function"><span class="std std-ref">unnamed &#8220;default&#8221; function</span></a>);</li>
<li><cite>name</cite>: the name of the function;</li>
<li><cite>inputs</cite>: an array of objects, each of which contains:
* <cite>name</cite>: the name of the parameter;
* <cite>type</cite>: the canonical type of the parameter.</li>
<li><cite>outputs</cite>: an array of objects similar to <cite>inputs</cite>, can be omitted if function doesn&#8217;t return anything;</li>
<li><cite>payable</cite>: <cite>true</cite> if function accepts ether, defaults to <cite>false</cite>;</li>
<li><cite>stateMutability</cite>: a string with one of the following values: <cite>pure</cite> (<a class="reference internal" href="index.html#pure-functions"><span class="std std-ref">specified to not read blockchain state</span></a>), <cite>view</cite> (<a class="reference internal" href="index.html#view-functions"><span class="std std-ref">specified to not modify the blockchain state</span></a>), <cite>nonpayable</cite> and <cite>payable</cite> (same as <cite>payable</cite> above).</li>
<li><cite>constant</cite>: <cite>true</cite> if function is either <cite>pure</cite> or <cite>view</cite></li>
</ul>
<p><cite>type</cite> can be omitted, defaulting to <cite>&#8220;function&#8221;</cite>.</p>
<p>Constructor and fallback function never have <cite>name</cite> or <cite>outputs</cite>. Fallback function doesn&#8217;t have <cite>inputs</cite> either.</p>
<p>Sending non-zero ether to non-payable function will throw. Don&#8217;t do it.</p>
<p>An event description is a JSON object with fairly similar fields:</p>
<ul class="simple">
<li><cite>type</cite>: always <cite>&#8220;event&#8221;</cite></li>
<li><cite>name</cite>: the name of the event;</li>
<li><cite>inputs</cite>: an array of objects, each of which contains:
* <cite>name</cite>: the name of the parameter;
* <cite>type</cite>: the canonical type of the parameter.
* <cite>indexed</cite>: <cite>true</cite> if the field is part of the log&#8217;s topics, <cite>false</cite> if it one of the log&#8217;s data segment.</li>
<li><cite>anonymous</cite>: <cite>true</cite> if the event was declared as <cite>anonymous</cite>.</li>
</ul>
<p>For example,</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Test</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">Test</span><span class="p">(){</span> <span class="nx">b</span> <span class="o">=</span> <span class="mh">0x12345678901234567890123456789012</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">event</span> <span class="nx">Event</span><span class="p">(</span><span class="kt">uint</span> <span class="k">indexed</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="nx">b</span><span class="p">)</span>
  <span class="kd">event</span> <span class="nx">Event2</span><span class="p">(</span><span class="kt">uint</span> <span class="k">indexed</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="nx">b</span><span class="p">)</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span> <span class="p">}</span>
  <span class="kt">bytes32</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>would result in the JSON:</p>
<div class="code json highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">[{</span>
<span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;event&quot;</span><span class="p">,</span>
<span class="s2">&quot;inputs&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="s2">&quot;indexed&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">},{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;bytes32&quot;</span><span class="p">,</span><span class="s2">&quot;indexed&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">}],</span>
<span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Event&quot;</span>
<span class="p">},</span> <span class="p">{</span>
<span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;event&quot;</span><span class="p">,</span>
<span class="s2">&quot;inputs&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="s2">&quot;indexed&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">},{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;bytes32&quot;</span><span class="p">,</span><span class="s2">&quot;indexed&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">}],</span>
<span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Event2&quot;</span>
<span class="p">},</span> <span class="p">{</span>
<span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;function&quot;</span><span class="p">,</span>
<span class="s2">&quot;inputs&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">}],</span>
<span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
<span class="s2">&quot;outputs&quot;</span><span class="o">:</span> <span class="p">[]</span>
<span class="p">}]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-style-guide"></span><div class="section" id="style-guide">
<span id="index-0"></span><h2>Style Guide<a class="headerlink" href="#style-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>This guide is intended to provide coding conventions for writing solidity code.
This guide should be thought of as an evolving document that will change over
time as useful conventions are found and old conventions are rendered obsolete.</p>
<p>Many projects will implement their own style guides.  In the event of
conflicts, project specific style guides take precedence.</p>
<p>The structure and many of the recommendations within this style guide were
taken from python&#8217;s
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">pep8 style guide</a>.</p>
<p>The goal of this guide is <em>not</em> to be the right way or the best way to write
solidity code.  The goal of this guide is <em>consistency</em>.  A quote from python&#8217;s
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds">pep8</a>
captures this concept well.</p>
<blockquote>
<div>A style guide is about consistency. Consistency with this style guide is important. Consistency within a project is more important. Consistency within one module or function is most important.
But most importantly: know when to be inconsistent &#8211; sometimes the style guide just doesn&#8217;t apply. When in doubt, use your best judgment. Look at other examples and decide what looks best. And don&#8217;t hesitate to ask!</div></blockquote>
</div>
<div class="section" id="code-layout">
<h3>Code Layout<a class="headerlink" href="#code-layout" title="Permalink to this headline">¶</a></h3>
<div class="section" id="indentation">
<h4>Indentation<a class="headerlink" href="#indentation" title="Permalink to this headline">¶</a></h4>
<p>Use 4 spaces per indentation level.</p>
</div>
<div class="section" id="tabs-or-spaces">
<h4>Tabs or Spaces<a class="headerlink" href="#tabs-or-spaces" title="Permalink to this headline">¶</a></h4>
<p>Spaces are the preferred indentation method.</p>
<p>Mixing tabs and spaces should be avoided.</p>
</div>
<div class="section" id="blank-lines">
<h4>Blank Lines<a class="headerlink" href="#blank-lines" title="Permalink to this headline">¶</a></h4>
<p>Surround top level declarations in solidity source with two blank lines.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Within a contract surround function declarations with a single blank line.</p>
<p>Blank lines may be omitted between groups of related one-liners (such as stub functions for an abstract contract)</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">spam</span><span class="p">();</span>
    <span class="kd">function</span> <span class="nx">ham</span><span class="p">();</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">B</span> <span class="k">is</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">spam</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">ham</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">spam</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">ham</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="source-file-encoding">
<h4>Source File Encoding<a class="headerlink" href="#source-file-encoding" title="Permalink to this headline">¶</a></h4>
<p>UTF-8 or ASCII encoding is preferred.</p>
</div>
<div class="section" id="imports">
<h4>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h4>
<p>Import statements should always be placed at the top of the file.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="s2">&quot;owned&quot;</span><span class="p">;</span>


<span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">B</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>


<span class="k">import</span> <span class="s2">&quot;owned&quot;</span><span class="p">;</span>


<span class="kd">contract</span> <span class="nx">B</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="order-of-functions">
<h4>Order of Functions<a class="headerlink" href="#order-of-functions" title="Permalink to this headline">¶</a></h4>
<p>Ordering helps readers identify which functions they can call and to find the constructor and fallback definitions easier.</p>
<p>Functions should be grouped according to their visibility and ordered:</p>
<ul class="simple">
<li>constructor</li>
<li>fallback function (if exists)</li>
<li>external</li>
<li>public</li>
<li>internal</li>
<li>private</li>
</ul>
<p>Within a grouping, place the <code class="docutils literal"><span class="pre">constant</span></code> functions last.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">A</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="c1">// External functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// External functions that are constant</span>
    <span class="c1">// ...</span>

    <span class="c1">// Public functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Internal functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Private functions</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>

    <span class="c1">// External functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Private functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Public functions</span>
    <span class="c1">// ...</span>

    <span class="kd">function</span> <span class="nx">A</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="c1">// Internal functions</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="whitespace-in-expressions">
<h4>Whitespace in Expressions<a class="headerlink" href="#whitespace-in-expressions" title="Permalink to this headline">¶</a></h4>
<p>Avoid extraneous whitespace in the following  situations:</p>
<p>Immediately inside parenthesis, brackets or braces, with the exception of single-line function declarations.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">spam</span><span class="p">(</span><span class="nx">ham</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">Coin</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;ham&quot;</span><span class="p">}));</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">spam</span><span class="p">(</span> <span class="nx">ham</span><span class="p">[</span> <span class="mi">1</span> <span class="p">],</span> <span class="nx">Coin</span><span class="p">(</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;ham&quot;</span> <span class="p">}</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>Exception:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">singleLine</span><span class="p">()</span> <span class="p">{</span> <span class="nx">spam</span><span class="p">();</span> <span class="p">}</span>
</pre></div>
</div>
<p>Immediately before a comma, semicolon:</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">spam</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">Coin</span> <span class="nx">coin</span><span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">spam</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="p">,</span> <span class="nx">Coin</span> <span class="nx">coin</span><span class="p">)</span> <span class="p">;</span>
</pre></div>
</div>
<dl class="docutils">
<dt>More than one space around an assignment or other operator to align with</dt>
<dd>another:</dd>
</dl>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nx">long_variable</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span>             <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">y</span>             <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nx">long_variable</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
<p>Don&#8217;t include a whitespace in the fallback function:</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="control-structures">
<h4>Control Structures<a class="headerlink" href="#control-structures" title="Permalink to this headline">¶</a></h4>
<p>The braces denoting the body of a contract, library, functions and structs
should:</p>
<ul class="simple">
<li>open on the same line as the declaration</li>
<li>close on their own line at the same indentation level as the beginning of the
declaration.</li>
<li>The opening brace should be proceeded by a single space.</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">Coin</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Bank</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">Coin</span>
<span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Bank</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The same recommendations apply to the control structures <code class="docutils literal"><span class="pre">if</span></code>, <code class="docutils literal"><span class="pre">else</span></code>, <code class="docutils literal"><span class="pre">while</span></code>,
and <code class="docutils literal"><span class="pre">for</span></code>.</p>
<p>Additionally there should be a single space between the control structures
<code class="docutils literal"><span class="pre">if</span></code>, <code class="docutils literal"><span class="pre">while</span></code>, and <code class="docutils literal"><span class="pre">for</span></code> and the parenthetic block representing the
conditional, as well as a single space between the conditional parenthetic
block and the opening brace.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(...)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="k">while</span><span class="p">(...){</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...;}</span>
</pre></div>
</div>
<p>For control structures whose body contains a single statement, omitting the
braces is ok <em>if</em> the statement is contained on a single line.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
    <span class="nx">someArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Coin</span><span class="p">({</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;spam&#39;</span><span class="p">,</span>
        <span class="nx">value</span><span class="o">:</span> <span class="mi">42</span>
    <span class="p">}));</span>
</pre></div>
</div>
<p>For <code class="docutils literal"><span class="pre">if</span></code> blocks which have an <code class="docutils literal"><span class="pre">else</span></code> or <code class="docutils literal"><span class="pre">else</span> <span class="pre">if</span></code> clause, the <code class="docutils literal"><span class="pre">else</span></code> should be
placed on the same line as the <code class="docutils literal"><span class="pre">if</span></code>&#8216;s closing brace. This is an exception compared
to the rules of other block-like structures.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">else</span>
    <span class="nx">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="function-declaration">
<h4>Function Declaration<a class="headerlink" href="#function-declaration" title="Permalink to this headline">¶</a></h4>
<p>For short function declarations, it is recommended for the opening brace of the
function body to be kept on the same line as the function declaration.</p>
<p>The closing brace should be at the same indentation level as the function
declaration.</p>
<p>The opening brace should be preceeded by a single space.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="nx">onlyowner</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

<span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;}</span>
</pre></div>
</div>
<p>The visibility modifiers for a function should come before any custom
modifiers.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="k">public</span> <span class="nx">onlyowner</span> <span class="p">{</span>
    <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="nx">onlyowner</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For long function declarations, it is recommended to drop each argument onto
it&#8217;s own line at the same indentation level as the function body.  The closing
parenthesis and opening bracket should be placed on their own line as well at
the same indentation level as the function declaration.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionHasLotsOfArguments</span><span class="p">(</span>
    <span class="kt">address</span> <span class="nx">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">c</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">d</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">e</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">f</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="kt">address</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">c</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">d</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">e</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="kt">address</span> <span class="nx">a</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">c</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">d</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">e</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionHasLotsOfArguments</span><span class="p">(</span>
    <span class="kt">address</span> <span class="nx">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">c</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">d</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">e</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If a long function declaration has modifiers, then each modifier should be
dropped to it&#8217;s own line.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">z</span><span class="p">)</span>
    <span class="k">public</span>
    <span class="nx">onlyowner</span>
    <span class="nx">priced</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span>
    <span class="kt">address</span> <span class="nx">x</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">z</span><span class="p">,</span>
<span class="p">)</span>
    <span class="k">public</span>
    <span class="nx">onlyowner</span>
    <span class="nx">priced</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">z</span><span class="p">)</span>
                                      <span class="k">public</span>
                                      <span class="nx">onlyowner</span>
                                      <span class="nx">priced</span>
                                      <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">z</span><span class="p">)</span>
    <span class="k">public</span> <span class="nx">onlyowner</span> <span class="nx">priced</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">z</span><span class="p">)</span>
    <span class="k">public</span>
    <span class="nx">onlyowner</span>
    <span class="nx">priced</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For constructor functions on inherited contracts whose bases require arguments,
it is recommended to drop the base constructors onto new lines in the same
manner as modifiers if the function declaration is long or hard to read.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="k">is</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">param1</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param2</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param3</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param4</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param5</span><span class="p">)</span>
        <span class="nx">B</span><span class="p">(</span><span class="nx">param1</span><span class="p">)</span>
        <span class="nx">C</span><span class="p">(</span><span class="nx">param2</span><span class="p">,</span> <span class="nx">param3</span><span class="p">)</span>
        <span class="nx">D</span><span class="p">(</span><span class="nx">param4</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// do something with param5</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="k">is</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">param1</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param2</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param3</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param4</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param5</span><span class="p">)</span>
    <span class="nx">B</span><span class="p">(</span><span class="nx">param1</span><span class="p">)</span>
    <span class="nx">C</span><span class="p">(</span><span class="nx">param2</span><span class="p">,</span> <span class="nx">param3</span><span class="p">)</span>
    <span class="nx">D</span><span class="p">(</span><span class="nx">param4</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// do something with param5</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">A</span> <span class="k">is</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">param1</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param2</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param3</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param4</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param5</span><span class="p">)</span>
        <span class="nx">B</span><span class="p">(</span><span class="nx">param1</span><span class="p">)</span>
        <span class="nx">C</span><span class="p">(</span><span class="nx">param2</span><span class="p">,</span> <span class="nx">param3</span><span class="p">)</span>
        <span class="nx">D</span><span class="p">(</span><span class="nx">param4</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do something with param5</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When declaring short functions with a single statement, it is permissible to do it on a single line.</p>
<p>Permissible:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">shortFunction</span><span class="p">()</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
</pre></div>
</div>
<p>These guidelines for function declarations are intended to improve readability.
Authors should use their best judgement as this guide does not try to cover all
possible permutations for function declarations.</p>
</div>
<div class="section" id="mappings">
<h4>Mappings<a class="headerlink" href="#mappings" title="Permalink to this headline">¶</a></h4>
<p>TODO</p>
</div>
<div class="section" id="variable-declarations">
<h4>Variable Declarations<a class="headerlink" href="#variable-declarations" title="Permalink to this headline">¶</a></h4>
<p>Declarations of array variables should not have a space between the type and
the brackets.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint</span> <span class="p">[]</span> <span class="nx">x</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="other-recommendations">
<h4>Other Recommendations<a class="headerlink" href="#other-recommendations" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Strings should be quoted with double-quotes instead of single-quotes.</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
<span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;Hamlet says, &#39;To be or not to be...&#39;&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;&quot;Be yourself; everyone else is already taken.&quot; -Oscar Wilde&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Surround operators with a single space on either side.</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">|=</span> <span class="nx">y</span> <span class="o">&amp;&amp;</span> <span class="nx">z</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="mi">100</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">+=</span> <span class="mi">3</span><span class="o">+</span><span class="mi">4</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">|=</span> <span class="nx">y</span><span class="o">&amp;&amp;</span><span class="nx">z</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Operators with a higher priority than others can exclude surrounding
whitespace in order to denote precedence.  This is meant to allow for
improved readability for complex statement. You should always use the same
amount of whitespace on either side of an operator:</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="nx">z</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">a</span><span class="o">-</span><span class="nx">b</span><span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="nx">y</span><span class="o">+</span><span class="nx">z</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="naming-conventions">
<h3>Naming Conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a></h3>
<p>Naming conventions are powerful when adopted and used broadly.  The use of
different conventions can convey significant <em>meta</em> information that would
otherwise not be immediately available.</p>
<p>The naming recommendations given here are intended to improve the readability,
and thus they are not rules, but rather guidelines to try and help convey the
most information through the names of things.</p>
<p>Lastly, consistency within a codebase should always supercede any conventions
outlined in this document.</p>
<div class="section" id="naming-styles">
<h4>Naming Styles<a class="headerlink" href="#naming-styles" title="Permalink to this headline">¶</a></h4>
<p>To avoid confusion, the following names will be used to refer to different
naming styles.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">b</span></code> (single lowercase letter)</li>
<li><code class="docutils literal"><span class="pre">B</span></code> (single uppercase letter)</li>
<li><code class="docutils literal"><span class="pre">lowercase</span></code></li>
<li><code class="docutils literal"><span class="pre">lower_case_with_underscores</span></code></li>
<li><code class="docutils literal"><span class="pre">UPPERCASE</span></code></li>
<li><code class="docutils literal"><span class="pre">UPPER_CASE_WITH_UNDERSCORES</span></code></li>
<li><code class="docutils literal"><span class="pre">CapitalizedWords</span></code> (or CapWords)</li>
<li><code class="docutils literal"><span class="pre">mixedCase</span></code> (differs from CapitalizedWords by initial lowercase character!)</li>
<li><code class="docutils literal"><span class="pre">Capitalized_Words_With_Underscores</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using abbreviations in CapWords, capitalize all the letters of the abbreviation. Thus HTTPServerError is better than HttpServerError.</p>
</div>
</div>
<div class="section" id="names-to-avoid">
<h4>Names to Avoid<a class="headerlink" href="#names-to-avoid" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">l</span></code> - Lowercase letter el</li>
<li><code class="docutils literal"><span class="pre">O</span></code> - Uppercase letter oh</li>
<li><code class="docutils literal"><span class="pre">I</span></code> - Uppercase letter eye</li>
</ul>
<p>Never use any of these for single letter variable names.  They are often
indistinguishable from the numerals one and zero.</p>
</div>
<div class="section" id="contract-and-library-names">
<h4>Contract and Library Names<a class="headerlink" href="#contract-and-library-names" title="Permalink to this headline">¶</a></h4>
<p>Contracts and libraries should be named using the CapWords style.</p>
</div>
<div class="section" id="events">
<h4>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h4>
<p>Events should be named using the CapWords style.</p>
</div>
<div class="section" id="function-names">
<h4>Function Names<a class="headerlink" href="#function-names" title="Permalink to this headline">¶</a></h4>
<p>Functions should use mixedCase.</p>
</div>
<div class="section" id="function-arguments">
<h4>Function Arguments<a class="headerlink" href="#function-arguments" title="Permalink to this headline">¶</a></h4>
<p>When writing library functions that operate on a custom struct, the struct
should be the first argument and should always be named <code class="docutils literal"><span class="pre">self</span></code>.</p>
</div>
<div class="section" id="local-and-state-variables">
<h4>Local and State Variables<a class="headerlink" href="#local-and-state-variables" title="Permalink to this headline">¶</a></h4>
<p>Use mixedCase.</p>
</div>
<div class="section" id="constants">
<h4>Constants<a class="headerlink" href="#constants" title="Permalink to this headline">¶</a></h4>
<p>Constants should be named with all capital letters with underscores separating
words.  (for example:<code class="docutils literal"><span class="pre">MAX_BLOCKS</span></code>)</p>
</div>
<div class="section" id="modifiers">
<h4>Modifiers<a class="headerlink" href="#modifiers" title="Permalink to this headline">¶</a></h4>
<p>Use mixedCase.</p>
</div>
<div class="section" id="avoiding-collisions">
<h4>Avoiding Collisions<a class="headerlink" href="#avoiding-collisions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">single_trailing_underscore_</span></code></li>
</ul>
<p>This convention is suggested when the desired name collides with that of a
built-in or otherwise reserved name.</p>
</div>
<div class="section" id="general-recommendations">
<h4>General Recommendations<a class="headerlink" href="#general-recommendations" title="Permalink to this headline">¶</a></h4>
<p>TODO</p>
</div>
</div>
</div>
<span id="document-common-patterns"></span><div class="section" id="common-patterns">
<h2>Common Patterns<a class="headerlink" href="#common-patterns" title="Permalink to this headline">¶</a></h2>
<div class="section" id="withdrawal-from-contracts">
<span id="withdrawal-pattern"></span><span id="index-0"></span><h3>Withdrawal from Contracts<a class="headerlink" href="#withdrawal-from-contracts" title="Permalink to this headline">¶</a></h3>
<p>The recommended method of sending funds after an effect
is using the withdrawal pattern. Although the most intuitive
method of sending Ether, as a result of an effect, is a
direct <code class="docutils literal"><span class="pre">send</span></code> call, this is not recommended as it
introduces a potential security risk. You may read
more about this on the <a class="reference internal" href="index.html#security-considerations"><span class="std std-ref">Security Considerations</span></a> page.</p>
<p>This is an example of the withdrawal pattern in practice in
a contract where the goal is to send the most money to the
contract in order to become the &#8220;richest&#8221;, inspired by
<a class="reference external" href="https://www.kingoftheether.com/">King of the Ether</a>.</p>
<p>In the following contract, if you are usurped as the richest,
you will receive the funds of the person who has gone on to
become the new richest.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">WithdrawalContract</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">richest</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">mostSent</span><span class="p">;</span>

    <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">pendingWithdrawals</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">WithdrawalContract</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">richest</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">mostSent</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">becomeRichest</span><span class="p">()</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">mostSent</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">pendingWithdrawals</span><span class="p">[</span><span class="nx">richest</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="nx">richest</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
            <span class="nx">mostSent</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">pendingWithdrawals</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="c1">// Remember to zero the pending refund before</span>
        <span class="c1">// sending to prevent re-entrancy attacks</span>
        <span class="nx">pendingWithdrawals</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is as opposed to the more intuitive sending pattern:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SendContract</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">richest</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">mostSent</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">SendContract</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">richest</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">mostSent</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">becomeRichest</span><span class="p">()</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">mostSent</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// This line can cause problems (explained below).</span>
            <span class="nx">richest</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
            <span class="nx">richest</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
            <span class="nx">mostSent</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notice that, in this example, an attacker could trap the
contract into an unusable state by causing <code class="docutils literal"><span class="pre">richest</span></code> to be
the address of a contract that has a fallback function
which fails (e.g. by using <code class="docutils literal"><span class="pre">revert()</span></code> or by just
conssuming more than the 2300 gas stipend). That way,
whenever <code class="docutils literal"><span class="pre">transfer</span></code> is called to deliver funds to the
&#8220;poisoned&#8221; contract, it will fail and thus also <code class="docutils literal"><span class="pre">becomeRichest</span></code>
will fail, with the contract being stuck forever.</p>
<p>In contrast, if you use the &#8220;withdraw&#8221; pattern from the first example,
the attacker can only cause his or her own withdraw to fail and not the
rest of the contract&#8217;s workings.</p>
</div>
<div class="section" id="restricting-access">
<span id="index-1"></span><h3>Restricting Access<a class="headerlink" href="#restricting-access" title="Permalink to this headline">¶</a></h3>
<p>Restricting access is a common pattern for contracts.
Note that you can never restrict any human or computer
from reading the content of your transactions or
your contract&#8217;s state. You can make it a bit harder
by using encryption, but if your contract is supposed
to read the data, so will everyone else.</p>
<p>You can restrict read access to your contract&#8217;s state
by <strong>other contracts</strong>. That is actually the default
unless you declare make your state variables <code class="docutils literal"><span class="pre">public</span></code>.</p>
<p>Furthermore, you can restrict who can make modifications
to your contract&#8217;s state or call your contract&#8217;s
functions and this is what this page is about.</p>
<p id="index-2">The use of <strong>function modifiers</strong> makes these
restrictions highly readable.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">AccessRestriction</span> <span class="p">{</span>
    <span class="c1">// These will be assigned at the construction</span>
    <span class="c1">// phase, where `msg.sender` is the account</span>
    <span class="c1">// creating this contract.</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">creationTime</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>

    <span class="c1">// Modifiers can be used to change</span>
    <span class="c1">// the body of a function.</span>
    <span class="c1">// If this modifier is used, it will</span>
    <span class="c1">// prepend a check that only passes</span>
    <span class="c1">// if the function is called from</span>
    <span class="c1">// a certain address.</span>
    <span class="kd">modifier</span> <span class="nx">onlyBy</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_account</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">_account</span><span class="p">);</span>
        <span class="c1">// Do not forget the &quot;_;&quot;! It will</span>
        <span class="c1">// be replaced by the actual function</span>
        <span class="c1">// body when the modifier is used.</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Make `_newOwner` the new owner of this</span>
    <span class="cs">/// contract.</span>
    <span class="kd">function</span> <span class="nx">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_newOwner</span><span class="p">)</span>
        <span class="nx">onlyBy</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nx">_newOwner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">onlyAfter</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&gt;=</span> <span class="nx">_time</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Erase ownership information.</span>
    <span class="cs">/// May only be called 6 weeks after</span>
    <span class="cs">/// the contract has been created.</span>
    <span class="kd">function</span> <span class="nx">disown</span><span class="p">()</span>
        <span class="nx">onlyBy</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span>
        <span class="nx">onlyAfter</span><span class="p">(</span><span class="nx">creationTime</span> <span class="o">+</span> <span class="mi">6</span> <span class="kt">weeks</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="nx">owner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This modifier requires a certain</span>
    <span class="c1">// fee being associated with a function call.</span>
    <span class="c1">// If the caller sent too much, he or she is</span>
    <span class="c1">// refunded, but only after the function body.</span>
    <span class="c1">// This was dangerous before Solidity version 0.4.0,</span>
    <span class="c1">// where it was possible to skip the part after `_;`.</span>
    <span class="kd">modifier</span> <span class="nx">costs</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_amount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;=</span> <span class="nx">_amount</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">_amount</span><span class="p">)</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">-</span> <span class="nx">_amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">forceOwnerChange</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_newOwner</span><span class="p">)</span>
        <span class="nx">costs</span><span class="p">(</span><span class="mi">200</span> <span class="kt">ether</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nx">_newOwner</span><span class="p">;</span>
        <span class="c1">// just some example condition</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">0</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1">// This did not refund for Solidity</span>
            <span class="c1">// before version 0.4.0.</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c1">// refund overpaid fees</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A more specialised way in which access to function
calls can be restricted will be discussed
in the next example.</p>
</div>
<div class="section" id="state-machine">
<span id="index-3"></span><h3>State Machine<a class="headerlink" href="#state-machine" title="Permalink to this headline">¶</a></h3>
<p>Contracts often act as a state machine, which means
that they have certain <strong>stages</strong> in which they behave
differently or in which different functions can
be called. A function call often ends a stage
and transitions the contract into the next stage
(especially if the contract models <strong>interaction</strong>).
It is also common that some stages are automatically
reached at a certain point in <strong>time</strong>.</p>
<p>An example for this is a blind auction contract which
starts in the stage &#8220;accepting blinded bids&#8221;, then
transitions to &#8220;revealing bids&#8221; which is ended by
&#8220;determine auction outcome&#8221;.</p>
<p id="index-4">Function modifiers can be used in this situation
to model the states and guard against
incorrect usage of the contract.</p>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>In the following example,
the modifier <code class="docutils literal"><span class="pre">atStage</span></code> ensures that the function can
only be called at a certain stage.</p>
<p>Automatic timed transitions
are handled by the modifier <code class="docutils literal"><span class="pre">timeTransitions</span></code>, which
should be used for all functions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Modifier Order Matters</strong>.
If atStage is combined
with timedTransitions, make sure that you mention
it after the latter, so that the new stage is
taken into account.</p>
</div>
<p>Finally, the modifier <code class="docutils literal"><span class="pre">transitionNext</span></code> can be used
to automatically go to the next stage when the
function finishes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Modifier May be Skipped</strong>.
This only applies to Solidity before version 0.4.0:
Since modifiers are applied by simply replacing
code and not by using a function call,
the code in the transitionNext modifier
can be skipped if the function itself uses
return. If you want to do that, make sure
to call nextStage manually from those functions.
Starting with version 0.4.0, modifier code
will run even if the function explicitly returns.</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">StateMachine</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nx">Stages</span> <span class="p">{</span>
        <span class="nx">AcceptingBlindedBids</span><span class="p">,</span>
        <span class="nx">RevealBids</span><span class="p">,</span>
        <span class="nx">AnotherStage</span><span class="p">,</span>
        <span class="nx">AreWeDoneYet</span><span class="p">,</span>
        <span class="nx">Finished</span>
    <span class="p">}</span>

    <span class="c1">// This is the current stage.</span>
    <span class="nx">Stages</span> <span class="k">public</span> <span class="nx">stage</span> <span class="o">=</span> <span class="nx">Stages</span><span class="p">.</span><span class="nx">AcceptingBlindedBids</span><span class="p">;</span>

    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">creationTime</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span> <span class="nx">_stage</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">stage</span> <span class="o">==</span> <span class="nx">_stage</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">nextStage</span><span class="p">()</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nx">stage</span> <span class="o">=</span> <span class="nx">Stages</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="nx">stage</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Perform timed transitions. Be sure to mention</span>
    <span class="c1">// this modifier first, otherwise the guards</span>
    <span class="c1">// will not take the new stage into account.</span>
    <span class="kd">modifier</span> <span class="nx">timedTransitions</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stage</span> <span class="o">==</span> <span class="nx">Stages</span><span class="p">.</span><span class="nx">AcceptingBlindedBids</span> <span class="o">&amp;&amp;</span>
                    <span class="nb">now</span> <span class="o">&gt;=</span> <span class="nx">creationTime</span> <span class="o">+</span> <span class="mi">10</span> <span class="kt">days</span><span class="p">)</span>
            <span class="nx">nextStage</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stage</span> <span class="o">==</span> <span class="nx">Stages</span><span class="p">.</span><span class="nx">RevealBids</span> <span class="o">&amp;&amp;</span>
                <span class="nb">now</span> <span class="o">&gt;=</span> <span class="nx">creationTime</span> <span class="o">+</span> <span class="mi">12</span> <span class="kt">days</span><span class="p">)</span>
            <span class="nx">nextStage</span><span class="p">();</span>
        <span class="c1">// The other stages transition by transaction</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Order of the modifiers matters here!</span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">()</span>
        <span class="k">payable</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">AcceptingBlindedBids</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// We will not implement that here</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">reveal</span><span class="p">()</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">RevealBids</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="c1">// This modifier goes to the next stage</span>
    <span class="c1">// after the function is done.</span>
    <span class="kd">modifier</span> <span class="nx">transitionNext</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">_</span><span class="p">;</span>
        <span class="nx">nextStage</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">AnotherStage</span><span class="p">)</span>
        <span class="nx">transitionNext</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">h</span><span class="p">()</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">AreWeDoneYet</span><span class="p">)</span>
        <span class="nx">transitionNext</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">i</span><span class="p">()</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">Finished</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-bugs"></span><div class="section" id="list-of-known-bugs">
<span id="known-bugs"></span><span id="index-0"></span><h2>List of Known Bugs<a class="headerlink" href="#list-of-known-bugs" title="Permalink to this headline">¶</a></h2>
<p>Below, you can find a JSON-formatted list of some of the known security-relevant bugs in the
Solidity compiler. The file itself is hosted in the <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/docs/bugs.json">Github repository</a>.
The list stretches back as far as version 0.3.0, bugs known to be present only
in versions preceding that are not listed.</p>
<p>There is another file called <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/docs/bugs_by_version.json">bugs_by_version.json</a>,
which can be used to check which bugs affect a specific version of the compiler.</p>
<p>Contract source verification tools and also other tools interacting with
contracts should consult this list according to the following criteria:</p>
<blockquote>
<div><ul class="simple">
<li>It is mildly suspicious if a contract was compiled with a nightly
compiler version instead of a released version. This list does not keep
track of unreleased or nightly versions.</li>
<li>It is also mildly suspicious if a contract was compiled with a version that was
not the most recent at the time the contract was created. For contracts
created from other contracts, you have to follow the creation chain
back to a transaction and use the date of that transaction as creation date.</li>
<li>It is highly suspicious if a contract was compiled with a compiler that
contains a known bug and the contract was created at a time where a newer
compiler version containing a fix was already released.</li>
</ul>
</div></blockquote>
<p>The JSON file of known bugs below is an array of objects, one for each bug,
with the following keys:</p>
<dl class="docutils">
<dt>name</dt>
<dd>Unique name given to the bug</dd>
<dt>summary</dt>
<dd>Short description of the bug</dd>
<dt>description</dt>
<dd>Detailed description of the bug</dd>
<dt>link</dt>
<dd>URL of a website with more detailed information, optional</dd>
<dt>introduced</dt>
<dd>The first published compiler version that contained the bug, optional</dd>
<dt>fixed</dt>
<dd>The first published compiler version that did not contain the bug anymore</dd>
<dt>publish</dt>
<dd>The date at which the bug became known publicly, optional</dd>
<dt>severity</dt>
<dd>Severity of the bug: low, medium, high. Takes into account
discoverability in contract tests, likelihood of occurrence and
potential damage by exploits.</dd>
<dt>conditions</dt>
<dd>Conditions that have to be met to trigger the bug. Currently, this
is an object that can contain a boolean value <code class="docutils literal"><span class="pre">optimizer</span></code>, which
means that the optimizer has to be switched on to enable the bug.
If no conditions are given, assume that the bug is present.</dd>
</dl>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;DelegateCallReturnValue&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The low-level .delegatecall() does not return the execution outcome, but converts the value returned by the functioned called to a boolean instead.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The return value of the low-level .delegatecall() function is taken from a position in memory, where the call data or the return data resides. This value is interpreted as a boolean and put onto the stack. This means if the called function returns at least 32 zero bytes, .delegatecall() returns false even if the call was successuful.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ECRecoverMalformedInput&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The ecrecover() builtin can return garbage for malformed input.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The ecrecover precompile does not properly signal failure for malformed input (especially in the &#39;v&#39; argument) and thus the Solidity function can return data that was previously present in the return area in memory.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.14&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;SkipEmptyStringLiteral&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;If \&quot;\&quot; is used in a function call, the following function arguments will not be correctly passed to the function.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;If the empty string literal \&quot;\&quot; is used as an argument in a function call, it is skipped by the encoder. This has the effect that the encoding of all arguments following this is shifted left by 32 bytes and thus the function call data is corrupted.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ConstantOptimizerSubtraction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;In some situations, the optimizer replaces certain numbers in the code with routines that compute different numbers.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer tries to represent any number in the bytecode by routines that compute them with less gas. For some special numbers, an incorrect routine is generated. This could allow an attacker to e.g. trick victims about a specific amount of ether, or function calls to call different functions (or none at all).&quot;</span><span class="p">,</span>
        <span class="s2">&quot;link&quot;</span><span class="o">:</span> <span class="s2">&quot;https://blog.ethereum.org/2017/05/03/solidity-optimizer-bug/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.11&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;IdentityPrecompileReturnIgnored&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Failure of the identity precompile was ignored.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Calls to the identity contract, which is used for copying memory, ignored its return value. On the public chain, calls to the identity precompile can be made in a way that they never fail, but this might be different on private chains.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.7&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OptimizerStateKnowledgeNotResetForJumpdest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer did not properly reset its internal state at jump destinations, which could lead to data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer performs symbolic execution at certain stages. At jump destinations, multiple code paths join and thus it has to compute a common state from the incoming edges. Computing this common state was simplified to just use the empty state, but this implementation was not done properly. This bug can cause data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;HighOrderByteCleanStorage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;For short types, the high order bytes were not cleaned properly and could overwrite existing data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Types shorter than 32 bytes are packed together into the same 32 byte storage slot, but storage writes always write 32 bytes. For some types, the higher order bytes were not cleaned properly, which made it sometimes possible to overwrite a variable in storage when writing to another one.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;link&quot;</span><span class="o">:</span> <span class="s2">&quot;https://blog.ethereum.org/2016/11/01/security-alert-solidity-variables-can-overwritten-storage/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.1.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.4&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OptimizerStaleKnowledgeAboutSHA3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer did not properly reset its knowledge about SHA3 operations resulting in some hashes (also used for storage variable positions) not being calculated correctly.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer performs symbolic execution in order to save re-evaluating expressions whose value is already known. This knowledge was not properly reset across control flow paths and thus the optimizer sometimes thought that the result of a SHA3 operation is already present on the stack. This could result in data corruption by accessing the wrong storage slot.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;LibrariesNotCallableFromPayableFunctions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Library functions threw an exception when called from a call that received Ether.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Library functions are protected against sending them Ether through a call. Since the DELEGATECALL opcode forwards the information about how much Ether was sent with a call, the library function incorrectly assumed that Ether was sent to the library and threw an exception.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.2&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;SendFailsForZeroEther&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The send function did not provide enough gas to the recipient if no Ether was sent with it.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The recipient of an Ether transfer automatically receives a certain amount of gas from the EVM to handle the transfer. In the case of a zero-transfer, this gas is not provided which causes the recipient to throw an exception.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.0&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;DynamicAllocationInfiniteLoop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Dynamic allocation of an empty memory array caused an infinite loop and thus an exception.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Memory arrays can be created provided a length. If this length is zero, code was generated that did not terminate and thus consumed all gas.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.6&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OptimizerClearStateOnCodePathJoin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer did not properly reset its internal state at jump destinations, which could lead to data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer performs symbolic execution at certain stages. At jump destinations, multiple code paths join and thus it has to compute a common state from the incoming edges. Computing this common state was not done correctly. This bug can cause data corruption, but it is probably quite hard to use for targeted attacks.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;CleanBytesHigherOrderBits&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The higher order bits of short bytesNN types were not cleaned before comparison.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Two variables of type bytesNN were considered different if their higher order bits, which are not part of the actual value, were different. An attacker might use this to reach seemingly unreachable code paths by providing incorrectly formatted input data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium/high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.3&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ArrayAccessCleanHigherOrderBits&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Access to array elements for arrays of types with less than 32 bytes did not correctly clean the higher order bits, causing corruption in other array elements.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Multiple elements of an array of values that are shorter than 17 bytes are packed into the same storage slot. Writing to a single element of such an array did not properly clean the higher order bytes and thus could lead to data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium/high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.1&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;AncientCompiler&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;This compiler version is ancient and might contain several undocumented or undiscovered bugs.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The list of bugs is only kept for compiler versions starting from 0.3.0, so older versions might contain undocumented bugs.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.0&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<span id="document-contributing"></span><div class="section" id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p>Help is always appreciated!</p>
<p>To get started, you can try <a class="reference internal" href="index.html#building-from-source"><span class="std std-ref">Building from Source</span></a> in order to familiarize
yourself with the components of Solidity and the build process. Also, it may be
useful to become well-versed at writing smart-contracts in Solidity.</p>
<p>In particular, we need help in the following areas:</p>
<ul class="simple">
<li>Improving the documentation</li>
<li>Responding to questions from other users on <a class="reference external" href="https://ethereum.stackexchange.com">StackExchange</a> and the <a class="reference external" href="https://gitter.im/ethereum/solidity">Solidity Gitter</a></li>
<li>Fixing and responding to <a class="reference external" href="https://github.com/ethereum/solidity/issues">Solidity&#8217;s GitHub issues</a>, especially those tagged as
<a class="reference external" href="https://github.com/ethereum/solidity/issues?q=is%3Aopen+is%3Aissue+label%3Aup-for-grabs">up-for-grabs</a> which are
meant as introductory issues for external contributors.</li>
</ul>
<div class="section" id="how-to-report-issues">
<h3>How to Report Issues<a class="headerlink" href="#how-to-report-issues" title="Permalink to this headline">¶</a></h3>
<p>To report an issue, please use the
<a class="reference external" href="https://github.com/ethereum/solidity/issues">GitHub issues tracker</a>. When
reporting issues, please mention the following details:</p>
<ul class="simple">
<li>Which version of Solidity you are using</li>
<li>What was the source code (if applicable)</li>
<li>Which platform are you running on</li>
<li>How to reproduce the issue</li>
<li>What was the result of the issue</li>
<li>What the expected behaviour is</li>
</ul>
<p>Reducing the source code that caused the issue to a bare minimum is always
very helpful and sometimes even clarifies a misunderstanding.</p>
</div>
<div class="section" id="workflow-for-pull-requests">
<h3>Workflow for Pull Requests<a class="headerlink" href="#workflow-for-pull-requests" title="Permalink to this headline">¶</a></h3>
<p>In order to contribute, please fork off of the <code class="docutils literal"><span class="pre">develop</span></code> branch and make your
changes there. Your commit messages should detail <em>why</em> you made your change
in addition to <em>what</em> you did (unless it is a tiny change).</p>
<p>If you need to pull in any changes from <code class="docutils literal"><span class="pre">develop</span></code> after making your fork (for
example, to resolve potential merge conflicts), please avoid using <code class="docutils literal"><span class="pre">git</span> <span class="pre">merge</span></code>
and instead, <code class="docutils literal"><span class="pre">git</span> <span class="pre">rebase</span></code> your branch.</p>
<p>Additionally, if you are writing a new feature, please ensure you write appropriate
Boost test cases and place them under <code class="docutils literal"><span class="pre">test/</span></code>.</p>
<p>However, if you are making a larger change, please consult with the Gitter
channel, first.</p>
<p>Finally, please make sure you respect the <a class="reference external" href="https://raw.githubusercontent.com/ethereum/cpp-ethereum/develop/CodingStandards.txt">coding standards</a>
for this project. Also, even though we do CI testing, please test your code and
ensure that it builds locally before submitting a pull request.</p>
<p>Thank you for your help!</p>
</div>
<div class="section" id="running-the-compiler-tests">
<h3>Running the compiler tests<a class="headerlink" href="#running-the-compiler-tests" title="Permalink to this headline">¶</a></h3>
<p>Solidity includes different types of tests. They are included in the application
called <code class="docutils literal"><span class="pre">soltest</span></code>. Some of them require the <code class="docutils literal"><span class="pre">cpp-ethereum</span></code> client in testing mode.</p>
<p>To run <code class="docutils literal"><span class="pre">cpp-ethereum</span></code> in testing mode: <code class="docutils literal"><span class="pre">eth</span> <span class="pre">--test</span> <span class="pre">-d</span> <span class="pre">/tmp/testeth</span></code>.</p>
<p>To run the tests: <code class="docutils literal"><span class="pre">soltest</span> <span class="pre">--</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/testeth/geth.ipc</span></code>.</p>
<p>To run a subset of tests, filters can be used:
<code class="docutils literal"><span class="pre">soltest</span> <span class="pre">-t</span> <span class="pre">TestSuite/TestName</span> <span class="pre">--</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/testeth/geth.ipc</span></code>, where <code class="docutils literal"><span class="pre">TestName</span></code> can be a wildcard <code class="docutils literal"><span class="pre">*</span></code>.</p>
<p>Alternatively, there is a testing script at <code class="docutils literal"><span class="pre">scripts/test.sh</span></code> which executes all tests.</p>
</div>
<div class="section" id="whiskers">
<h3>Whiskers<a class="headerlink" href="#whiskers" title="Permalink to this headline">¶</a></h3>
<p><em>Whiskers</em> is a templating system similar to <a class="reference external" href="https://mustache.github.io">Mustache</a>. It is used by the
compiler in various places to aid readability, and thus maintainability and verifiability, of the code.</p>
<p>The syntax comes with a substantial difference to Mustache: the template markers <code class="docutils literal"><span class="pre">{{</span></code> and <code class="docutils literal"><span class="pre">}}</span></code> are
replaced by <code class="docutils literal"><span class="pre">&lt;</span></code> and <code class="docutils literal"><span class="pre">&gt;</span></code> in order to aid parsing and avoid conflicts with <a class="reference internal" href="index.html#inline-assembly"><span class="std std-ref">Inline Assembly</span></a>
(The symbols <code class="docutils literal"><span class="pre">&lt;</span></code> and <code class="docutils literal"><span class="pre">&gt;</span></code> are invalid in inline assembly, while <code class="docutils literal"><span class="pre">{</span></code> and <code class="docutils literal"><span class="pre">}</span></code> are used to delimit blocks).
Another limitation is that lists are only resolved one depth and they will not recurse. This may change in the future.</p>
<p>A rough specification is the following:</p>
<p>Any occurrence of <code class="docutils literal"><span class="pre">&lt;name&gt;</span></code> is replaced by the string-value of the supplied variable <code class="docutils literal"><span class="pre">name</span></code> without any
escaping and without iterated replacements. An area can be delimited by <code class="docutils literal"><span class="pre">&lt;#name&gt;...&lt;/name&gt;</span></code>. It is replaced
by as many concatenations of its contents as there were sets of variables supplied to the template system,
each time replacing any <code class="docutils literal"><span class="pre">&lt;inner&gt;</span></code> items by their respective value. Top-level variables can also be used
inside such areas.</p>
</div>
</div>
<span id="document-frequently-asked-questions"></span><div class="section" id="frequently-asked-questions">
<h2>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h2>
<p>This list was originally compiled by <a class="reference external" href="mailto:fivedogit&#37;&#52;&#48;gmail&#46;com">fivedogit</a>.</p>
<div class="section" id="basic-questions">
<h3>Basic Questions<a class="headerlink" href="#basic-questions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="example-contracts">
<h4>Example contracts<a class="headerlink" href="#example-contracts" title="Permalink to this headline">¶</a></h4>
<p>There are some <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/tree/master/contracts/">contract examples</a> by fivedogit and
there should be a <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/test/libsolidity/SolidityEndToEndTest.cpp">test contract</a> for every single feature of Solidity.</p>
</div>
<div class="section" id="create-and-publish-the-most-basic-contract-possible">
<h4>Create and publish the most basic contract possible<a class="headerlink" href="#create-and-publish-the-most-basic-contract-possible" title="Permalink to this headline">¶</a></h4>
<p>A quite simple contract is the <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/05_greeter.sol">greeter</a></p>
</div>
<div class="section" id="is-it-possible-to-do-something-on-a-specific-block-number-e-g-publish-a-contract-or-execute-a-transaction">
<h4>Is it possible to do something on a specific block number? (e.g. publish a contract or execute a transaction)<a class="headerlink" href="#is-it-possible-to-do-something-on-a-specific-block-number-e-g-publish-a-contract-or-execute-a-transaction" title="Permalink to this headline">¶</a></h4>
<p>Transactions are not guaranteed to happen on the next block or any future
specific block, since it is up to the miners to include transactions and not up
to the submitter of the transaction. This applies to function calls/transactions and contract
creation transactions.</p>
<p>If you want to schedule future calls of your contract, you can use the
<a class="reference external" href="http://www.ethereum-alarm-clock.com/">alarm clock</a>.</p>
</div>
<div class="section" id="what-is-the-transaction-payload">
<h4>What is the transaction &#8220;payload&#8221;?<a class="headerlink" href="#what-is-the-transaction-payload" title="Permalink to this headline">¶</a></h4>
<p>This is just the bytecode &#8220;data&#8221; sent along with the request.</p>
</div>
<div class="section" id="is-there-a-decompiler-available">
<h4>Is there a decompiler available?<a class="headerlink" href="#is-there-a-decompiler-available" title="Permalink to this headline">¶</a></h4>
<p>There is no decompiler to Solidity. This is in principle possible
to some degree, but for example variable names will be lost and
great effort will be necessary to make it look similar to
the original source code.</p>
<p>Bytecode can be decompiled to opcodes, a service that is provided by
several blockchain explorers.</p>
<p>Contracts on the blockchain should have their original source
code published if they are to be used by third parties.</p>
</div>
<div class="section" id="create-a-contract-that-can-be-killed-and-return-funds">
<h4>Create a contract that can be killed and return funds<a class="headerlink" href="#create-a-contract-that-can-be-killed-and-return-funds" title="Permalink to this headline">¶</a></h4>
<p>First, a word of warning: Killing contracts sounds like a good idea, because &#8220;cleaning up&#8221;
is always good, but as seen above, it does not really clean up. Furthermore,
if Ether is sent to removed contracts, the Ether will be forever lost.</p>
<p>If you want to deactivate your contracts, it is preferable to <strong>disable</strong> them by changing some
internal state which causes all functions to throw. This will make it impossible
to use the contract and ether sent to the contract will be returned automatically.</p>
<p>Now to answering the question: Inside a constructor, <code class="docutils literal"><span class="pre">msg.sender</span></code> is the
creator. Save it. Then <code class="docutils literal"><span class="pre">selfdestruct(creator);</span></code> to kill and return funds.</p>
<p><a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/05_greeter.sol">example</a></p>
<p>Note that if you <code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;mortal&quot;</span></code> at the top of your contracts and declare
<code class="docutils literal"><span class="pre">contract</span> <span class="pre">SomeContract</span> <span class="pre">is</span> <span class="pre">mortal</span> <span class="pre">{</span> <span class="pre">...</span></code> and compile with a compiler that already
has it (which includes <a class="reference external" href="https://remix.ethereum.org/">Remix</a>), then
<code class="docutils literal"><span class="pre">kill()</span></code> is taken care of for you. Once a contract is &#8220;mortal&#8221;, then you can
<code class="docutils literal"><span class="pre">contractname.kill.sendTransaction({from:eth.coinbase})</span></code>, just the same as my
examples.</p>
</div>
<div class="section" id="store-ether-in-a-contract">
<h4>Store Ether in a contract<a class="headerlink" href="#store-ether-in-a-contract" title="Permalink to this headline">¶</a></h4>
<p>The trick is to create the contract with <code class="docutils literal"><span class="pre">{from:someaddress,</span> <span class="pre">value:</span> <span class="pre">web3.toWei(3,&quot;ether&quot;)...}</span></code></p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/30_endowment_retriever.sol">endowment_retriever.sol</a>.</p>
</div>
<div class="section" id="use-a-non-constant-function-req-sendtransaction-to-increment-a-variable-in-a-contract">
<h4>Use a non-constant function (req <code class="docutils literal"><span class="pre">sendTransaction</span></code>) to increment a variable in a contract<a class="headerlink" href="#use-a-non-constant-function-req-sendtransaction-to-increment-a-variable-in-a-contract" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/20_value_incrementer.sol">value_incrementer.sol</a>.</p>
</div>
<div class="section" id="get-a-contract-to-return-its-funds-to-you-not-using-selfdestruct">
<h4>Get a contract to return its funds to you (not using <code class="docutils literal"><span class="pre">selfdestruct(...)</span></code>).<a class="headerlink" href="#get-a-contract-to-return-its-funds-to-you-not-using-selfdestruct" title="Permalink to this headline">¶</a></h4>
<p>This example demonstrates how to send funds from a contract to an address.</p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/30_endowment_retriever.sol">endowment_retriever</a>.</p>
</div>
<div class="section" id="can-you-return-an-array-or-a-string-from-a-solidity-function-call">
<h4>Can you return an array or a <code class="docutils literal"><span class="pre">string</span></code> from a solidity function call?<a class="headerlink" href="#can-you-return-an-array-or-a-string-from-a-solidity-function-call" title="Permalink to this headline">¶</a></h4>
<p>Yes. See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/60_array_receiver_and_returner.sol">array_receiver_and_returner.sol</a>.</p>
<p>What is problematic, though, is returning any variably-sized data (e.g. a
variably-sized array like <code class="docutils literal"><span class="pre">uint[]</span></code>) from a fuction <strong>called from within Solidity</strong>.
This is a limitation of the EVM and will be solved with the next protocol update.</p>
<p>Returning variably-sized data as part of an external transaction or call is fine.</p>
</div>
<div class="section" id="how-do-you-represent-double-float-in-solidity">
<h4>How do you represent <code class="docutils literal"><span class="pre">double</span></code>/<code class="docutils literal"><span class="pre">float</span></code> in Solidity?<a class="headerlink" href="#how-do-you-represent-double-float-in-solidity" title="Permalink to this headline">¶</a></h4>
<p>This is not yet possible.</p>
</div>
<div class="section" id="is-it-possible-to-in-line-initialize-an-array-like-so-string-myarray-a-b">
<h4>Is it possible to in-line initialize an array like so: <code class="docutils literal"><span class="pre">string[]</span> <span class="pre">myarray</span> <span class="pre">=</span> <span class="pre">[&quot;a&quot;,</span> <span class="pre">&quot;b&quot;];</span></code><a class="headerlink" href="#is-it-possible-to-in-line-initialize-an-array-like-so-string-myarray-a-b" title="Permalink to this headline">¶</a></h4>
<p>Yes. However it should be noted that this currently only works with statically sized memory arrays. You can even create an inline memory
array in the return statement. Pretty cool, huh?</p>
<p>Example:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="p">{</span>
        <span class="kt">string</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">memory</span> <span class="nx">adaArr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;This&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;an&quot;</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">];</span>
        <span class="k">return</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="are-timestamps-now-block-timestamp-reliable">
<h4>Are timestamps (<code class="docutils literal"><span class="pre">now,</span></code> <code class="docutils literal"><span class="pre">block.timestamp</span></code>) reliable?<a class="headerlink" href="#are-timestamps-now-block-timestamp-reliable" title="Permalink to this headline">¶</a></h4>
<p>This depends on what you mean by &#8220;reliable&#8221;.
In general, they are supplied by miners and are therefore vulnerable.</p>
<p>Unless someone really messes up the blockchain or the clock on
your computer, you can make the following assumptions:</p>
<p>You publish a transaction at a time X, this transaction contains same
code that calls <code class="docutils literal"><span class="pre">now</span></code> and is included in a block whose timestamp is Y
and this block is included into the canonical chain (published) at a time Z.</p>
<p>The value of <code class="docutils literal"><span class="pre">now</span></code> will be identical to Y and X &lt;= Y &lt;= Z.</p>
<p>Never use <code class="docutils literal"><span class="pre">now</span></code> or <code class="docutils literal"><span class="pre">block.hash</span></code> as a source of randomness, unless you know
what you are doing!</p>
</div>
<div class="section" id="can-a-contract-function-return-a-struct">
<h4>Can a contract function return a <code class="docutils literal"><span class="pre">struct</span></code>?<a class="headerlink" href="#can-a-contract-function-return-a-struct" title="Permalink to this headline">¶</a></h4>
<p>Yes, but only in <code class="docutils literal"><span class="pre">internal</span></code> function calls.</p>
</div>
<div class="section" id="if-i-return-an-enum-i-only-get-integer-values-in-web3-js-how-to-get-the-named-values">
<h4>If I return an <code class="docutils literal"><span class="pre">enum</span></code>, I only get integer values in web3.js. How to get the named values?<a class="headerlink" href="#if-i-return-an-enum-i-only-get-integer-values-in-web3-js-how-to-get-the-named-values" title="Permalink to this headline">¶</a></h4>
<p>Enums are not supported by the ABI, they are just supported by Solidity.
You have to do the mapping yourself for now, we might provide some help
later.</p>
</div>
<div class="section" id="what-is-the-deal-with-function-inside-solidity-contracts-how-can-a-function-not-have-a-name">
<h4>What is the deal with <code class="docutils literal"><span class="pre">function</span> <span class="pre">()</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> inside Solidity contracts? How can a function not have a name?<a class="headerlink" href="#what-is-the-deal-with-function-inside-solidity-contracts-how-can-a-function-not-have-a-name" title="Permalink to this headline">¶</a></h4>
<p>This function is called &#8220;fallback function&#8221; and it
is called when someone just sent Ether to the contract without
providing any data or if someone messed up the types so that they tried to
call a function that does not exist.</p>
<p>The default behaviour (if no fallback function is explicitly given) in
these situations is to throw an exception.</p>
<p>If the contract is meant to receive Ether with simple transfers, you
should implement the fallback function as</p>
<p><code class="docutils literal"><span class="pre">function()</span> <span class="pre">payable</span> <span class="pre">{</span> <span class="pre">}</span></code></p>
<p>Another use of the fallback function is to e.g. register that your
contract received ether by using an event.</p>
<p><em>Attention</em>: If you implement the fallback function take care that it uses as
little gas as possible, because <code class="docutils literal"><span class="pre">send()</span></code> will only supply a limited amount.</p>
</div>
<div class="section" id="is-it-possible-to-pass-arguments-to-the-fallback-function">
<h4>Is it possible to pass arguments to the fallback function?<a class="headerlink" href="#is-it-possible-to-pass-arguments-to-the-fallback-function" title="Permalink to this headline">¶</a></h4>
<p>The fallback function cannot take parameters.</p>
<p>Under special circumstances, you can send data. If you take care
that none of the other functions is invoked, you can access the data
by <code class="docutils literal"><span class="pre">msg.data</span></code>.</p>
</div>
<div class="section" id="can-state-variables-be-initialized-in-line">
<h4>Can state variables be initialized in-line?<a class="headerlink" href="#can-state-variables-be-initialized-in-line" title="Permalink to this headline">¶</a></h4>
<p>Yes, this is possible for all types (even for structs). However, for arrays it
should be noted that you must declare them as static memory arrays.</p>
<p>Examples:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">S</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">a</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">b</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">S</span> <span class="k">public</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="kt">string</span> <span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Ada&quot;</span><span class="p">;</span>
    <span class="kt">string</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="nx">adaArr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;This&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;an&quot;</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="nx">C</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-structs-work">
<h4>How do structs work?<a class="headerlink" href="#how-do-structs-work" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/65_struct_and_for_loop_tester.sol">struct_and_for_loop_tester.sol</a>.</p>
</div>
<div class="section" id="how-do-for-loops-work">
<h4>How do for loops work?<a class="headerlink" href="#how-do-for-loops-work" title="Permalink to this headline">¶</a></h4>
<p>Very similar to JavaScript. There is one point to watch out for, though:</p>
<p>If you use <code class="docutils literal"><span class="pre">for</span> <span class="pre">(var</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">a.length;</span> <span class="pre">i</span> <span class="pre">++)</span> <span class="pre">{</span> <span class="pre">a[i]</span> <span class="pre">=</span> <span class="pre">i;</span> <span class="pre">}</span></code>, then
the type of <code class="docutils literal"><span class="pre">i</span></code> will be inferred only from <code class="docutils literal"><span class="pre">0</span></code>, whose type is <code class="docutils literal"><span class="pre">uint8</span></code>.
This means that if <code class="docutils literal"><span class="pre">a</span></code> has more than <code class="docutils literal"><span class="pre">255</span></code> elements, your loop will
not terminate because <code class="docutils literal"><span class="pre">i</span></code> can only hold values up to <code class="docutils literal"><span class="pre">255</span></code>.</p>
<p>Better use <code class="docutils literal"><span class="pre">for</span> <span class="pre">(uint</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">a.length...</span></code></p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/65_struct_and_for_loop_tester.sol">struct_and_for_loop_tester.sol</a>.</p>
</div>
<div class="section" id="what-character-set-does-solidity-use">
<h4>What character set does Solidity use?<a class="headerlink" href="#what-character-set-does-solidity-use" title="Permalink to this headline">¶</a></h4>
<p>Solidity is character set agnostic concerning strings in the source code, although
UTF-8 is recommended. Identifiers (variables, functions, ...) can only use
ASCII.</p>
</div>
<div class="section" id="what-are-some-examples-of-basic-string-manipulation-substring-indexof-charat-etc">
<h4>What are some examples of basic string manipulation (<code class="docutils literal"><span class="pre">substring</span></code>, <code class="docutils literal"><span class="pre">indexOf</span></code>, <code class="docutils literal"><span class="pre">charAt</span></code>, etc)?<a class="headerlink" href="#what-are-some-examples-of-basic-string-manipulation-substring-indexof-charat-etc" title="Permalink to this headline">¶</a></h4>
<p>There are some string utility functions at <a class="reference external" href="https://github.com/ethereum/dapp-bin/blob/master/library/stringUtils.sol">stringUtils.sol</a>
which will be extended in the future. In addition, Arachnid has written <a class="reference external" href="https://github.com/Arachnid/solidity-stringutils">solidity-stringutils</a>.</p>
<p>For now, if you want to modify a string (even when you only want to know its length),
you should always convert it to a <code class="docutils literal"><span class="pre">bytes</span></code> first:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="nx">s</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">append</span><span class="p">(</span><span class="kt">byte</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bytes</span><span class="p">(</span><span class="nx">s</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">set</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span><span class="p">,</span> <span class="kt">byte</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bytes</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-concatenate-two-strings">
<h4>Can I concatenate two strings?<a class="headerlink" href="#can-i-concatenate-two-strings" title="Permalink to this headline">¶</a></h4>
<p>You have to do it manually for now.</p>
</div>
<div class="section" id="why-is-the-low-level-function-call-less-favorable-than-instantiating-a-contract-with-a-variable-contractb-b-and-executing-its-functions-b-dosomething">
<h4>Why is the low-level function <code class="docutils literal"><span class="pre">.call()</span></code> less favorable than instantiating a contract with a variable (<code class="docutils literal"><span class="pre">ContractB</span> <span class="pre">b;</span></code>) and executing its functions (<code class="docutils literal"><span class="pre">b.doSomething();</span></code>)?<a class="headerlink" href="#why-is-the-low-level-function-call-less-favorable-than-instantiating-a-contract-with-a-variable-contractb-b-and-executing-its-functions-b-dosomething" title="Permalink to this headline">¶</a></h4>
<p>If you use actual functions, the compiler will tell you if the types
or your arguments do not match, if the function does not exist
or is not visible and it will do the packing of the
arguments for you.</p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_ping.sol">ping.sol</a> and
<a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_pong.sol">pong.sol</a>.</p>
</div>
<div class="section" id="is-unused-gas-automatically-refunded">
<h4>Is unused gas automatically refunded?<a class="headerlink" href="#is-unused-gas-automatically-refunded" title="Permalink to this headline">¶</a></h4>
<p>Yes and it is immediate, i.e. done as part of the transaction.</p>
</div>
<div class="section" id="when-returning-a-value-of-say-uint-type-is-it-possible-to-return-an-undefined-or-null-like-value">
<h4>When returning a value of say <code class="docutils literal"><span class="pre">uint</span></code> type, is it possible to return an <code class="docutils literal"><span class="pre">undefined</span></code> or &#8220;null&#8221;-like value?<a class="headerlink" href="#when-returning-a-value-of-say-uint-type-is-it-possible-to-return-an-undefined-or-null-like-value" title="Permalink to this headline">¶</a></h4>
<p>This is not possible, because all types use up the full value range.</p>
<p>You have the option to <code class="docutils literal"><span class="pre">throw</span></code> on error, which will also revert the whole
transaction, which might be a good idea if you ran into an unexpected
situation.</p>
<p>If you do not want to throw, you can return a pair:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">counters</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">getCounter</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">index</span><span class="p">)</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">counter</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="nx">counters</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="p">(</span><span class="nx">counters</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">checkCounter</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="p">(</span><span class="nx">counter</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="o">=</span> <span class="nx">getCounter</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="are-comments-included-with-deployed-contracts-and-do-they-increase-deployment-gas">
<h4>Are comments included with deployed contracts and do they increase deployment gas?<a class="headerlink" href="#are-comments-included-with-deployed-contracts-and-do-they-increase-deployment-gas" title="Permalink to this headline">¶</a></h4>
<p>No, everything that is not needed for execution is removed during compilation.
This includes, among others, comments, variable names and type names.</p>
</div>
<div class="section" id="what-happens-if-you-send-ether-along-with-a-function-call-to-a-contract">
<h4>What happens if you send ether along with a function call to a contract?<a class="headerlink" href="#what-happens-if-you-send-ether-along-with-a-function-call-to-a-contract" title="Permalink to this headline">¶</a></h4>
<p>It gets added to the total balance of the contract, just like when you send ether when creating a contract.
You can only send ether along to a function that has the <code class="docutils literal"><span class="pre">payable</span></code> modifier,
otherwise an exception is thrown.</p>
</div>
<div class="section" id="is-it-possible-to-get-a-tx-receipt-for-a-transaction-executed-contract-to-contract">
<h4>Is it possible to get a tx receipt for a transaction executed contract-to-contract?<a class="headerlink" href="#is-it-possible-to-get-a-tx-receipt-for-a-transaction-executed-contract-to-contract" title="Permalink to this headline">¶</a></h4>
<p>No, a function call from one contract to another does not create its own transaction,
you have to look in the overall transaction. This is also the reason why several
block explorer do not show Ether sent between contracts correctly.</p>
</div>
<div class="section" id="what-is-the-memory-keyword-what-does-it-do">
<h4>What is the <code class="docutils literal"><span class="pre">memory</span></code> keyword? What does it do?<a class="headerlink" href="#what-is-the-memory-keyword-what-does-it-do" title="Permalink to this headline">¶</a></h4>
<p>The Ethereum Virtual Machine has three areas where it can store items.</p>
<p>The first is &#8220;storage&#8221;, where all the contract state variables reside.
Every contract has its own storage and it is persistent between function calls
and quite expensive to use.</p>
<p>The second is &#8220;memory&#8221;, this is used to hold temporary values. It
is erased between (external) function calls and is cheaper to use.</p>
<p>The third one is the stack, which is used to hold small local variables.
It is almost free to use, but can only hold a limited amount of values.</p>
<p>For almost all types, you cannot specify where they should be stored, because
they are copied everytime they are used.</p>
<p>The types where the so-called storage location is important are structs
and arrays. If you e.g. pass such variables in function calls, their
data is not copied if it can stay in memory or stay in storage.
This means that you can modify their content in the called function
and these modifications will still be visible in the caller.</p>
<p>There are defaults for the storage location depending on which type
of variable it concerns:</p>
<ul class="simple">
<li>state variables are always in storage</li>
<li>function arguments are always in memory</li>
<li>local variables always reference storage</li>
</ul>
<p>Example:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data1</span><span class="p">;</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data2</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">appendOne</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">append</span><span class="p">(</span><span class="nx">data1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">appendTwo</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">append</span><span class="p">(</span><span class="nx">data2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">append</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">storage</span> <span class="nx">d</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The function <code class="docutils literal"><span class="pre">append</span></code> can work both on <code class="docutils literal"><span class="pre">data1</span></code> and <code class="docutils literal"><span class="pre">data2</span></code> and its modifications will be
stored permanently. If you remove the <code class="docutils literal"><span class="pre">storage</span></code> keyword, the default
is to use <code class="docutils literal"><span class="pre">memory</span></code> for function arguments. This has the effect that
at the point where <code class="docutils literal"><span class="pre">append(data1)</span></code> or <code class="docutils literal"><span class="pre">append(data2)</span></code> is called, an
independent copy of the state variable is created in memory and
<code class="docutils literal"><span class="pre">append</span></code> operates on this copy (which does not support <code class="docutils literal"><span class="pre">.push</span></code> - but that
is another issue). The modifications to this independent copy do not
carry back to <code class="docutils literal"><span class="pre">data1</span></code> or <code class="docutils literal"><span class="pre">data2</span></code>.</p>
<p>A common mistake is to declare a local variable and assume that it will
be created in memory, although it will be created in storage:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="cs">/// THIS CONTRACT CONTAINS AN ERROR</span>

<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">someVariable</span><span class="p">;</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span><span class="p">;</span>
        <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The type of the local variable <code class="docutils literal"><span class="pre">x</span></code> is <code class="docutils literal"><span class="pre">uint[]</span> <span class="pre">storage</span></code>, but since
storage is not dynamically allocated, it has to be assigned from
a state variable before it can be used. So no space in storage will be
allocated for <code class="docutils literal"><span class="pre">x</span></code>, but instead it functions only as an alias for
a pre-existing variable in storage.</p>
<p>What will happen is that the compiler interprets <code class="docutils literal"><span class="pre">x</span></code> as a storage
pointer and will make it point to the storage slot <code class="docutils literal"><span class="pre">0</span></code> by default.
This has the effect that <code class="docutils literal"><span class="pre">someVariable</span></code> (which resides at storage
slot <code class="docutils literal"><span class="pre">0</span></code>) is modified by <code class="docutils literal"><span class="pre">x.push(2)</span></code>.</p>
<p>The correct way to do this is the following:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">someVariable</span><span class="p">;</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="what-is-the-difference-between-bytes-and-byte">
<h4>What is the difference between <code class="docutils literal"><span class="pre">bytes</span></code> and <code class="docutils literal"><span class="pre">byte[]</span></code>?<a class="headerlink" href="#what-is-the-difference-between-bytes-and-byte" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">bytes</span></code> is usually more efficient: When used as arguments to functions (i.e. in
CALLDATA) or in memory, every single element of a <code class="docutils literal"><span class="pre">byte[]</span></code> is padded to 32
bytes which wastes 31 bytes per element.</p>
</div>
<div class="section" id="is-it-possible-to-send-a-value-while-calling-an-overloaded-function">
<h4>Is it possible to send a value while calling an overloaded function?<a class="headerlink" href="#is-it-possible-to-send-a-value-while-calling-an-overloaded-function" title="Permalink to this headline">¶</a></h4>
<p>It&#8217;s a known missing feature. <a class="reference external" href="https://www.pivotaltracker.com/story/show/92020468">https://www.pivotaltracker.com/story/show/92020468</a>
as part of <a class="reference external" href="https://www.pivotaltracker.com/n/projects/1189488">https://www.pivotaltracker.com/n/projects/1189488</a></p>
<p>Best solution currently see is to introduce a special case for gas and value and
just re-check whether they are present at the point of overload resolution.</p>
</div>
</div>
<div class="section" id="advanced-questions">
<h3>Advanced Questions<a class="headerlink" href="#advanced-questions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="how-do-you-get-a-random-number-in-a-contract-implement-a-self-returning-gambling-contract">
<h4>How do you get a random number in a contract? (Implement a self-returning gambling contract.)<a class="headerlink" href="#how-do-you-get-a-random-number-in-a-contract-implement-a-self-returning-gambling-contract" title="Permalink to this headline">¶</a></h4>
<p>Getting randomness right is often the crucial part in a crypto project and
most failures result from bad random number generators.</p>
<p>If you do not want it to be safe, you build something similar to the <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/35_coin_flipper.sol">coin flipper</a>
but otherwise, rather use a contract that supplies randomness, like the <a class="reference external" href="https://github.com/randao/randao">RANDAO</a>.</p>
</div>
<div class="section" id="get-return-value-from-non-constant-function-from-another-contract">
<h4>Get return value from non-constant function from another contract<a class="headerlink" href="#get-return-value-from-non-constant-function-from-another-contract" title="Permalink to this headline">¶</a></h4>
<p>The key point is that the calling contract needs to know about the function it intends to call.</p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_ping.sol">ping.sol</a>
and <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_pong.sol">pong.sol</a>.</p>
</div>
<div class="section" id="get-contract-to-do-something-when-it-is-first-mined">
<h4>Get contract to do something when it is first mined<a class="headerlink" href="#get-contract-to-do-something-when-it-is-first-mined" title="Permalink to this headline">¶</a></h4>
<p>Use the constructor. Anything inside it will be executed when the contract is first mined.</p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/50_replicator.sol">replicator.sol</a>.</p>
</div>
<div class="section" id="how-do-you-create-2-dimensional-arrays">
<h4>How do you create 2-dimensional arrays?<a class="headerlink" href="#how-do-you-create-2-dimensional-arrays" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/55_2D_array.sol">2D_array.sol</a>.</p>
<p>Note that filling a 10x10 square of <code class="docutils literal"><span class="pre">uint8</span></code> + contract creation took more than <code class="docutils literal"><span class="pre">800,000</span></code>
gas at the time of this writing. 17x17 took <code class="docutils literal"><span class="pre">2,000,000</span></code> gas. With the limit at
3.14 million... well, there’s a pretty low ceiling for what you can create right
now.</p>
<p>Note that merely &#8220;creating&#8221; the array is free, the costs are in filling it.</p>
<p>Note2: Optimizing storage access can pull the gas costs down considerably, because
32 <code class="docutils literal"><span class="pre">uint8</span></code> values can be stored in a single slot. The problem is that these optimizations
currently do not work across loops and also have a problem with bounds checking.
You might get much better results in the future, though.</p>
</div>
<div class="section" id="what-does-p-recipient-call-value-p-amount-p-data-do">
<h4>What does <code class="docutils literal"><span class="pre">p.recipient.call.value(p.amount)(p.data)</span></code> do?<a class="headerlink" href="#what-does-p-recipient-call-value-p-amount-p-data-do" title="Permalink to this headline">¶</a></h4>
<p>Every external function call in Solidity can be modified in two ways:</p>
<ol class="arabic simple">
<li>You can add Ether together with the call</li>
<li>You can limit the amount of gas available to the call</li>
</ol>
<p>This is done by &#8220;calling a function on the function&#8221;:</p>
<p><code class="docutils literal"><span class="pre">f.gas(2).value(20)()</span></code> calls the modified function <code class="docutils literal"><span class="pre">f</span></code> and thereby sending 20
Wei and limiting the gas to 2 (so this function call will most likely go out of
gas and return your 20 Wei).</p>
<p>In the above example, the low-level function <code class="docutils literal"><span class="pre">call</span></code> is used to invoke another
contract with <code class="docutils literal"><span class="pre">p.data</span></code> as payload and <code class="docutils literal"><span class="pre">p.amount</span></code> Wei is sent with that call.</p>
</div>
<div class="section" id="what-happens-to-a-struct-s-mapping-when-copying-over-a-struct">
<h4>What happens to a <code class="docutils literal"><span class="pre">struct</span></code>&#8216;s mapping when copying over a <code class="docutils literal"><span class="pre">struct</span></code>?<a class="headerlink" href="#what-happens-to-a-struct-s-mapping-when-copying-over-a-struct" title="Permalink to this headline">¶</a></h4>
<p>This is a very interesting question. Suppose that we have a contract field set up like such:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">struct</span> <span class="nx">user</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">string</span> <span class="o">=&gt;</span> <span class="kt">address</span><span class="p">)</span> <span class="nx">usedContracts</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">somefunction</span> <span class="p">{</span>
   <span class="nx">user</span> <span class="nx">user1</span><span class="p">;</span>
   <span class="nx">user1</span><span class="p">.</span><span class="nx">usedContracts</span><span class="p">[</span><span class="s2">&quot;Hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;World&quot;</span><span class="p">;</span>
   <span class="nx">user</span> <span class="nx">user2</span> <span class="o">=</span> <span class="nx">user1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this case, the mapping of the struct being copied over into the userList is ignored as there is no &#8220;list of mapped keys&#8221;.
Therefore it is not possible to find out which values should be copied over.</p>
</div>
<div class="section" id="how-do-i-initialize-a-contract-with-only-a-specific-amount-of-wei">
<h4>How do I initialize a contract with only a specific amount of wei?<a class="headerlink" href="#how-do-i-initialize-a-contract-with-only-a-specific-amount-of-wei" title="Permalink to this headline">¶</a></h4>
<p>Currently the approach is a little ugly, but there is little that can be done to improve it.
In the case of a <code class="docutils literal"><span class="pre">contract</span> <span class="pre">A</span></code> calling a new instance of <code class="docutils literal"><span class="pre">contract</span> <span class="pre">B</span></code>, parentheses have to be used around
<code class="docutils literal"><span class="pre">new</span> <span class="pre">B</span></code> because <code class="docutils literal"><span class="pre">B.value</span></code> would refer to a member of <code class="docutils literal"><span class="pre">B</span></code> called <code class="docutils literal"><span class="pre">value</span></code>.
You will need to make sure that you have both contracts aware of each other&#8217;s presence and that <code class="docutils literal"><span class="pre">contract</span> <span class="pre">B</span></code> has a <code class="docutils literal"><span class="pre">payable</span></code> constructor.
In this example:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">B</span><span class="p">()</span> <span class="k">payable</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="nx">child</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">test</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">child</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">B</span><span class="p">).</span><span class="nx">value</span><span class="p">(</span><span class="mi">10</span><span class="p">)();</span> <span class="c1">//construct a new B with 10 wei</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="can-a-contract-function-accept-a-two-dimensional-array">
<h4>Can a contract function accept a two-dimensional array?<a class="headerlink" href="#can-a-contract-function-accept-a-two-dimensional-array" title="Permalink to this headline">¶</a></h4>
<p>This is not yet implemented for external calls and dynamic arrays -
you can only use one level of dynamic arrays.</p>
</div>
<div class="section" id="what-is-the-relationship-between-bytes32-and-string-why-is-it-that-bytes32-somevar-stringliteral-works-and-what-does-the-saved-32-byte-hex-value-mean">
<h4>What is the relationship between <code class="docutils literal"><span class="pre">bytes32</span></code> and <code class="docutils literal"><span class="pre">string</span></code>? Why is it that <code class="docutils literal"><span class="pre">bytes32</span> <span class="pre">somevar</span> <span class="pre">=</span> <span class="pre">&quot;stringliteral&quot;;</span></code> works and what does the saved 32-byte hex value mean?<a class="headerlink" href="#what-is-the-relationship-between-bytes32-and-string-why-is-it-that-bytes32-somevar-stringliteral-works-and-what-does-the-saved-32-byte-hex-value-mean" title="Permalink to this headline">¶</a></h4>
<p>The type <code class="docutils literal"><span class="pre">bytes32</span></code> can hold 32 (raw) bytes. In the assignment <code class="docutils literal"><span class="pre">bytes32</span> <span class="pre">samevar</span> <span class="pre">=</span> <span class="pre">&quot;stringliteral&quot;;</span></code>,
the string literal is interpreted in its raw byte form and if you inspect <code class="docutils literal"><span class="pre">somevar</span></code> and
see a 32-byte hex value, this is just <code class="docutils literal"><span class="pre">&quot;stringliteral&quot;</span></code> in hex.</p>
<p>The type <code class="docutils literal"><span class="pre">bytes</span></code> is similar, only that it can change its length.</p>
<p>Finally, <code class="docutils literal"><span class="pre">string</span></code> is basically identical to <code class="docutils literal"><span class="pre">bytes</span></code> only that it is assumed
to hold the UTF-8 encoding of a real string. Since <code class="docutils literal"><span class="pre">string</span></code> stores the
data in UTF-8 encoding it is quite expensive to compute the number of
characters in the string (the encoding of some characters takes more
than a single byte). Because of that, <code class="docutils literal"><span class="pre">string</span> <span class="pre">s;</span> <span class="pre">s.length</span></code> is not yet
supported and not even index access <code class="docutils literal"><span class="pre">s[2]</span></code>. But if you want to access
the low-level byte encoding of the string, you can use
<code class="docutils literal"><span class="pre">bytes(s).length</span></code> and <code class="docutils literal"><span class="pre">bytes(s)[2]</span></code> which will result in the number
of bytes in the UTF-8 encoding of the string (not the number of
characters) and the second byte (not character) of the UTF-8 encoded
string, respectively.</p>
</div>
<div class="section" id="can-a-contract-pass-an-array-static-size-or-string-or-bytes-dynamic-size-to-another-contract">
<h4>Can a contract pass an array (static size) or string or <code class="docutils literal"><span class="pre">bytes</span></code> (dynamic size) to another contract?<a class="headerlink" href="#can-a-contract-pass-an-array-static-size-or-string-or-bytes-dynamic-size-to-another-contract" title="Permalink to this headline">¶</a></h4>
<p>Sure. Take care that if you cross the memory / storage boundary,
independent copies will be created:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nx">x</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">g</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
        <span class="nx">h</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nx">y</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nx">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">h</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="k">storage</span> <span class="nx">y</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nx">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The call to <code class="docutils literal"><span class="pre">g(x)</span></code> will not have an effect on <code class="docutils literal"><span class="pre">x</span></code> because it needs
to create an independent copy of the storage value in memory
(the default storage location is memory). On the other hand,
<code class="docutils literal"><span class="pre">h(x)</span></code> successfully modifies <code class="docutils literal"><span class="pre">x</span></code> because only a reference
and not a copy is passed.</p>
</div>
<div class="section" id="sometimes-when-i-try-to-change-the-length-of-an-array-with-ex-arrayname-length-7-i-get-a-compiler-error-value-must-be-an-lvalue-why">
<h4>Sometimes, when I try to change the length of an array with ex: <code class="docutils literal"><span class="pre">arrayname.length</span> <span class="pre">=</span> <span class="pre">7;</span></code> I get a compiler error <code class="docutils literal"><span class="pre">Value</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">an</span> <span class="pre">lvalue</span></code>. Why?<a class="headerlink" href="#sometimes-when-i-try-to-change-the-length-of-an-array-with-ex-arrayname-length-7-i-get-a-compiler-error-value-must-be-an-lvalue-why" title="Permalink to this headline">¶</a></h4>
<p>You can resize a dynamic array in storage (i.e. an array declared at the
contract level) with <code class="docutils literal"><span class="pre">arrayname.length</span> <span class="pre">=</span> <span class="pre">&lt;some</span> <span class="pre">new</span> <span class="pre">length&gt;;</span></code>. If you get the
&#8220;lvalue&#8221; error, you are probably doing one of two things wrong.</p>
<ol class="arabic simple">
<li>You might be trying to resize an array in &#8220;memory&#8221;, or</li>
<li>You might be trying to resize a non-dynamic array.</li>
</ol>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">int8</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">memArr</span><span class="p">;</span>        <span class="c1">// Case 1</span>
<span class="nx">memArr</span><span class="p">.</span><span class="nx">length</span><span class="o">++</span><span class="p">;</span>             <span class="c1">// illegal</span>
<span class="kt">int8</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="nx">storageArr</span><span class="p">;</span>          <span class="c1">// Case 2</span>
<span class="nx">somearray</span><span class="p">.</span><span class="nx">length</span><span class="o">++</span><span class="p">;</span>          <span class="c1">// legal</span>
<span class="kt">int8</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">storage</span> <span class="nx">storageArr2</span><span class="p">;</span> <span class="c1">// Explicit case 2</span>
<span class="nx">somearray2</span><span class="p">.</span><span class="nx">length</span><span class="o">++</span><span class="p">;</span>         <span class="c1">// legal</span>
</pre></div>
</div>
<p><strong>Important note:</strong> In Solidity, array dimensions are declared backwards from the way you
might be used to declaring them in C or Java, but they are access as in
C or Java.</p>
<p>For example, <code class="docutils literal"><span class="pre">int8[][5]</span> <span class="pre">somearray;</span></code> are 5 dynamic <code class="docutils literal"><span class="pre">int8</span></code> arrays.</p>
<p>The reason for this is that <code class="docutils literal"><span class="pre">T[5]</span></code> is always an array of 5 <code class="docutils literal"><span class="pre">T</span></code>&#8216;s,
no matter whether <code class="docutils literal"><span class="pre">T</span></code> itself is an array or not (this is not the
case in C or Java).</p>
</div>
<div class="section" id="is-it-possible-to-return-an-array-of-strings-string-from-a-solidity-function">
<h4>Is it possible to return an array of strings (<code class="docutils literal"><span class="pre">string[]</span></code>) from a Solidity function?<a class="headerlink" href="#is-it-possible-to-return-an-array-of-strings-string-from-a-solidity-function" title="Permalink to this headline">¶</a></h4>
<p>Not yet, as this requires two levels of dynamic arrays (<code class="docutils literal"><span class="pre">string</span></code> is a dynamic array itself).</p>
</div>
<div class="section" id="if-you-issue-a-call-for-an-array-it-is-possible-to-retrieve-the-whole-array-or-must-you-write-a-helper-function-for-that">
<h4>If you issue a call for an array, it is possible to retrieve the whole array? Or must you write a helper function for that?<a class="headerlink" href="#if-you-issue-a-call-for-an-array-it-is-possible-to-retrieve-the-whole-array-or-must-you-write-a-helper-function-for-that" title="Permalink to this headline">¶</a></h4>
<p>The automatic <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">getter function</span></a>  for a public state variable of array type only returns
individual elements. If you want to return the complete array, you have to
manually write a function to do that.</p>
</div>
<div class="section" id="what-could-have-happened-if-an-account-has-storage-value-s-but-no-code-example-http-test-ether-camp-account-5f740b3a43fbb99724ce93a879805f4dc89178b5">
<h4>What could have happened if an account has storage value(s) but no code?  Example: <a class="reference external" href="http://test.ether.camp/account/5f740b3a43fbb99724ce93a879805f4dc89178b5">http://test.ether.camp/account/5f740b3a43fbb99724ce93a879805f4dc89178b5</a><a class="headerlink" href="#what-could-have-happened-if-an-account-has-storage-value-s-but-no-code-example-http-test-ether-camp-account-5f740b3a43fbb99724ce93a879805f4dc89178b5" title="Permalink to this headline">¶</a></h4>
<p>The last thing a constructor does is returning the code of the contract.
The gas costs for this depend on the length of the code and it might be
that the supplied gas is not enough. This situation is the only one
where an &#8220;out of gas&#8221; exception does not revert changes to the state,
i.e. in this case the initialisation of the state variables.</p>
<p><a class="reference external" href="https://github.com/ethereum/wiki/wiki/Subtleties">https://github.com/ethereum/wiki/wiki/Subtleties</a></p>
<p>After a successful CREATE operation&#8217;s sub-execution, if the operation returns x, 5 * len(x) gas is subtracted from the remaining gas before the contract is created. If the remaining gas is less than 5 * len(x), then no gas is subtracted, the code of the created contract becomes the empty string, but this is not treated as an exceptional condition - no reverts happen.</p>
</div>
<div class="section" id="what-does-the-following-strange-check-do-in-the-custom-token-contract">
<h4>What does the following strange check do in the Custom Token contract?<a class="headerlink" href="#what-does-the-following-strange-check-do-in-the-custom-token-contract" title="Permalink to this headline">¶</a></h4>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nb">require</span><span class="p">((</span><span class="nx">balanceOf</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span> <span class="o">+</span> <span class="nx">_value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">balanceOf</span><span class="p">[</span><span class="nx">_to</span><span class="p">]);</span>
</pre></div>
</div>
<p>Integers in Solidity (and most other machine-related programming languages) are restricted to a certain range.
For <code class="docutils literal"><span class="pre">uint256</span></code>, this is <code class="docutils literal"><span class="pre">0</span></code> up to <code class="docutils literal"><span class="pre">2**256</span> <span class="pre">-</span> <span class="pre">1</span></code>. If the result of some operation on those numbers
does not fit inside this range, it is truncated. These truncations can have
<a class="reference external" href="https://en.bitcoin.it/wiki/Value_overflow_incident">serious consequences</a>, so code like the one
above is necessary to avoid certain attacks.</p>
</div>
<div class="section" id="more-questions">
<h4>More Questions?<a class="headerlink" href="#more-questions" title="Permalink to this headline">¶</a></h4>
<p>If you have more questions or your question is not answered here, please talk to us on
<a class="reference external" href="https://gitter.im/ethereum/solidity">gitter</a> or file an <a class="reference external" href="https://github.com/ethereum/solidity/issues">issue</a>.</p>
</div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2017, Ethereum.
      
        <span class="commit">
          Revision <code>b364bd04</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: develop
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/v0.4.15/">v0.4.15</a></dd>
        
          <dd><a href="/en/v0.4.14/">v0.4.14</a></dd>
        
          <dd><a href="/en/v0.4.13/">v0.4.13</a></dd>
        
          <dd><a href="/en/v0.4.12/">v0.4.12</a></dd>
        
          <dd><a href="/en/v0.4.11/">v0.4.11</a></dd>
        
          <dd><a href="/en/v0.4.10/">v0.4.10</a></dd>
        
          <dd><a href="/en/v0.4.9/">v0.4.9</a></dd>
        
          <dd><a href="/en/v0.4.8/">v0.4.8</a></dd>
        
          <dd><a href="/en/v0.4.7/">v0.4.7</a></dd>
        
          <dd><a href="/en/v0.4.6/">v0.4.6</a></dd>
        
          <dd><a href="/en/v0.4.5/">v0.4.5</a></dd>
        
          <dd><a href="/en/v0.4.4/">v0.4.4</a></dd>
        
          <dd><a href="/en/v0.4.3/">v0.4.3</a></dd>
        
          <dd><a href="/en/v0.4.2/">v0.4.2</a></dd>
        
          <dd><a href="/en/v0.4.1/">v0.4.1</a></dd>
        
          <dd><a href="/en/v0.4.0/">v0.4.0</a></dd>
        
          <dd><a href="/en/v0.3.6/">v0.3.6</a></dd>
        
          <dd><a href="/en/v0.3.5/">v0.3.5</a></dd>
        
          <dd><a href="/en/v0.3.4/">v0.3.4</a></dd>
        
          <dd><a href="/en/v0.3.3/">v0.3.3</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//readthedocs.org/projects/solidity/downloads/pdf/develop/">pdf</a></dd>
        
          <dd><a href="//readthedocs.org/projects/solidity/downloads/htmlzip/develop/">htmlzip</a></dd>
        
          <dd><a href="//readthedocs.org/projects/solidity/downloads/epub/develop/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/solidity/?fromdocs=solidity">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/solidity/?fromdocs=solidity">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.4.17',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>